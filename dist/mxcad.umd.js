!function(t,h){"object"==typeof exports&&"undefined"!=typeof module?h(exports,require("mxdraw")):"function"==typeof define&&define.amd?define(["exports","mxdraw"],h):h((t="undefined"!=typeof globalThis?globalThis:t||self).MxCAD={},t.Mx)}(this,(function(t,h){"use strict";function getAugmentedNamespace(t){var h=t.default;if("function"==typeof h){var a=function(){return h.apply(this,arguments)};a.prototype=h.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(t).forEach((function(h){var p=Object.getOwnPropertyDescriptor(t,h);Object.defineProperty(a,h,p.get?p:{enumerable:!0,get:function(){return t[h]}})})),a}for(var p={},x={byteLength:function byteLength(t){var h=getLens(t),p=h[0],x=h[1];return 3*(p+x)/4-x},toByteArray:function toByteArray(t){var h,p,x=getLens(t),M=x[0],N=x[1],V=new I(function _byteLength(t,h,p){return 3*(h+p)/4-p}(0,M,N)),ee=0,te=N>0?M-4:M;for(p=0;p<te;p+=4)h=k[t.charCodeAt(p)]<<18|k[t.charCodeAt(p+1)]<<12|k[t.charCodeAt(p+2)]<<6|k[t.charCodeAt(p+3)],V[ee++]=h>>16&255,V[ee++]=h>>8&255,V[ee++]=255&h;2===N&&(h=k[t.charCodeAt(p)]<<2|k[t.charCodeAt(p+1)]>>4,V[ee++]=255&h);1===N&&(h=k[t.charCodeAt(p)]<<10|k[t.charCodeAt(p+1)]<<4|k[t.charCodeAt(p+2)]>>2,V[ee++]=h>>8&255,V[ee++]=255&h);return V},fromByteArray:function fromByteArray(t){for(var h,p=t.length,x=p%3,k=[],I=16383,N=0,V=p-x;N<V;N+=I)k.push(encodeChunk(t,N,N+I>V?V:N+I));1===x?(h=t[p-1],k.push(M[h>>2]+M[h<<4&63]+"==")):2===x&&(h=(t[p-2]<<8)+t[p-1],k.push(M[h>>10]+M[h>>4&63]+M[h<<2&63]+"="));return k.join("")}},M=[],k=[],I="undefined"!=typeof Uint8Array?Uint8Array:Array,N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V=0;V<64;++V)M[V]=N[V],k[N.charCodeAt(V)]=V;function getLens(t){var h=t.length;if(h%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var p=t.indexOf("=");return-1===p&&(p=h),[p,p===h?0:4-p%4]}function encodeChunk(t,h,p){for(var x,k,I=[],N=h;N<p;N+=3)x=(t[N]<<16&16711680)+(t[N+1]<<8&65280)+(255&t[N+2]),I.push(M[(k=x)>>18&63]+M[k>>12&63]+M[k>>6&63]+M[63&k]);return I.join("")}k["-".charCodeAt(0)]=62,k["_".charCodeAt(0)]=63;var ee={};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function asyncGeneratorStep(t,h,p,x,M,k,I){try{var N=t[k](I),V=N.value}catch(ee){return void p(ee)}N.done?h(V):Promise.resolve(V).then(x,M)}function _asyncToGenerator(t){return function(){var h=this,p=arguments;return new Promise((function(x,M){var k=t.apply(h,p);function _next(t){asyncGeneratorStep(k,x,M,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(k,x,M,_next,_throw,"throw",t)}_next(void 0)}))}}ee.read=function(t,h,p,x,M){var k,I,N=8*M-x-1,V=(1<<N)-1,ee=V>>1,te=-7,re=p?M-1:0,ne=p?-1:1,ie=t[h+re];for(re+=ne,k=ie&(1<<-te)-1,ie>>=-te,te+=N;te>0;k=256*k+t[h+re],re+=ne,te-=8);for(I=k&(1<<-te)-1,k>>=-te,te+=x;te>0;I=256*I+t[h+re],re+=ne,te-=8);if(0===k)k=1-ee;else{if(k===V)return I?NaN:1/0*(ie?-1:1);I+=Math.pow(2,x),k-=ee}return(ie?-1:1)*I*Math.pow(2,k-x)},ee.write=function(t,h,p,x,M,k){var I,N,V,ee=8*k-M-1,te=(1<<ee)-1,re=te>>1,ne=23===M?Math.pow(2,-24)-Math.pow(2,-77):0,ie=x?0:k-1,ae=x?1:-1,oe=h<0||0===h&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(N=isNaN(h)?1:0,I=te):(I=Math.floor(Math.log(h)/Math.LN2),h*(V=Math.pow(2,-I))<1&&(I--,V*=2),(h+=I+re>=1?ne/V:ne*Math.pow(2,1-re))*V>=2&&(I++,V/=2),I+re>=te?(N=0,I=te):I+re>=1?(N=(h*V-1)*Math.pow(2,M),I+=re):(N=h*Math.pow(2,re-1)*Math.pow(2,M),I=0));M>=8;t[p+ie]=255&N,ie+=ae,N/=256,M-=8);for(I=I<<M|N,ee+=M;ee>0;t[p+ie]=255&I,ie+=ae,I/=256,ee-=8);t[p+ie-ae]|=128*oe},
/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <https://feross.org>
	 * @license  MIT
	 */
function(t){const h=x,p=ee,M="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=Buffer,t.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},t.INSPECT_MAX_BYTES=50;const k=2147483647;function createBuffer(t){if(t>k)throw new RangeError('The value "'+t+'" is invalid for option "size"');const h=new Uint8Array(t);return Object.setPrototypeOf(h,Buffer.prototype),h}function Buffer(t,h,p){if("number"==typeof t){if("string"==typeof h)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(t)}return from(t,h,p)}function from(t,h,p){if("string"==typeof t)return function fromString(t,h){"string"==typeof h&&""!==h||(h="utf8");if(!Buffer.isEncoding(h))throw new TypeError("Unknown encoding: "+h);const p=0|byteLength(t,h);let x=createBuffer(p);const M=x.write(t,h);M!==p&&(x=x.slice(0,M));return x}(t,h);if(ArrayBuffer.isView(t))return function fromArrayView(t){if(isInstance(t,Uint8Array)){const h=new Uint8Array(t);return fromArrayBuffer(h.buffer,h.byteOffset,h.byteLength)}return fromArrayLike(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(isInstance(t,ArrayBuffer)||t&&isInstance(t.buffer,ArrayBuffer))return fromArrayBuffer(t,h,p);if("undefined"!=typeof SharedArrayBuffer&&(isInstance(t,SharedArrayBuffer)||t&&isInstance(t.buffer,SharedArrayBuffer)))return fromArrayBuffer(t,h,p);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const x=t.valueOf&&t.valueOf();if(null!=x&&x!==t)return Buffer.from(x,h,p);const M=function fromObject(t){if(Buffer.isBuffer(t)){const h=0|checked(t.length),p=createBuffer(h);return 0===p.length||t.copy(p,0,0,h),p}if(void 0!==t.length)return"number"!=typeof t.length||numberIsNaN(t.length)?createBuffer(0):fromArrayLike(t);if("Buffer"===t.type&&Array.isArray(t.data))return fromArrayLike(t.data)}(t);if(M)return M;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return Buffer.from(t[Symbol.toPrimitive]("string"),h,p);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function allocUnsafe(t){return assertSize(t),createBuffer(t<0?0:0|checked(t))}function fromArrayLike(t){const h=t.length<0?0:0|checked(t.length),p=createBuffer(h);for(let x=0;x<h;x+=1)p[x]=255&t[x];return p}function fromArrayBuffer(t,h,p){if(h<0||t.byteLength<h)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<h+(p||0))throw new RangeError('"length" is outside of buffer bounds');let x;return x=void 0===h&&void 0===p?new Uint8Array(t):void 0===p?new Uint8Array(t,h):new Uint8Array(t,h,p),Object.setPrototypeOf(x,Buffer.prototype),x}function checked(t){if(t>=k)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+k.toString(16)+" bytes");return 0|t}function byteLength(t,h){if(Buffer.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||isInstance(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const p=t.length,x=arguments.length>2&&!0===arguments[2];if(!x&&0===p)return 0;let M=!1;for(;;)switch(h){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*p;case"hex":return p>>>1;case"base64":return base64ToBytes(t).length;default:if(M)return x?-1:utf8ToBytes(t).length;h=(""+h).toLowerCase(),M=!0}}function slowToString(t,h,p){let x=!1;if((void 0===h||h<0)&&(h=0),h>this.length)return"";if((void 0===p||p>this.length)&&(p=this.length),p<=0)return"";if((p>>>=0)<=(h>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,h,p);case"utf8":case"utf-8":return utf8Slice(this,h,p);case"ascii":return asciiSlice(this,h,p);case"latin1":case"binary":return latin1Slice(this,h,p);case"base64":return base64Slice(this,h,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,h,p);default:if(x)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),x=!0}}function swap(t,h,p){const x=t[h];t[h]=t[p],t[p]=x}function bidirectionalIndexOf(t,h,p,x,M){if(0===t.length)return-1;if("string"==typeof p?(x=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),numberIsNaN(p=+p)&&(p=M?0:t.length-1),p<0&&(p=t.length+p),p>=t.length){if(M)return-1;p=t.length-1}else if(p<0){if(!M)return-1;p=0}if("string"==typeof h&&(h=Buffer.from(h,x)),Buffer.isBuffer(h))return 0===h.length?-1:arrayIndexOf(t,h,p,x,M);if("number"==typeof h)return h&=255,"function"==typeof Uint8Array.prototype.indexOf?M?Uint8Array.prototype.indexOf.call(t,h,p):Uint8Array.prototype.lastIndexOf.call(t,h,p):arrayIndexOf(t,[h],p,x,M);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,h,p,x,M){let k,I=1,N=t.length,V=h.length;if(void 0!==x&&("ucs2"===(x=String(x).toLowerCase())||"ucs-2"===x||"utf16le"===x||"utf-16le"===x)){if(t.length<2||h.length<2)return-1;I=2,N/=2,V/=2,p/=2}function read(t,h){return 1===I?t[h]:t.readUInt16BE(h*I)}if(M){let x=-1;for(k=p;k<N;k++)if(read(t,k)===read(h,-1===x?0:k-x)){if(-1===x&&(x=k),k-x+1===V)return x*I}else-1!==x&&(k-=k-x),x=-1}else for(p+V>N&&(p=N-V),k=p;k>=0;k--){let p=!0;for(let x=0;x<V;x++)if(read(t,k+x)!==read(h,x)){p=!1;break}if(p)return k}return-1}function hexWrite(t,h,p,x){p=Number(p)||0;const M=t.length-p;x?(x=Number(x))>M&&(x=M):x=M;const k=h.length;let I;for(x>k/2&&(x=k/2),I=0;I<x;++I){const x=parseInt(h.substr(2*I,2),16);if(numberIsNaN(x))return I;t[p+I]=x}return I}function utf8Write(t,h,p,x){return blitBuffer(utf8ToBytes(h,t.length-p),t,p,x)}function asciiWrite(t,h,p,x){return blitBuffer(function asciiToBytes(t){const h=[];for(let p=0;p<t.length;++p)h.push(255&t.charCodeAt(p));return h}(h),t,p,x)}function base64Write(t,h,p,x){return blitBuffer(base64ToBytes(h),t,p,x)}function ucs2Write(t,h,p,x){return blitBuffer(function utf16leToBytes(t,h){let p,x,M;const k=[];for(let I=0;I<t.length&&!((h-=2)<0);++I)p=t.charCodeAt(I),x=p>>8,M=p%256,k.push(M),k.push(x);return k}(h,t.length-p),t,p,x)}function base64Slice(t,p,x){return 0===p&&x===t.length?h.fromByteArray(t):h.fromByteArray(t.slice(p,x))}function utf8Slice(t,h,p){p=Math.min(t.length,p);const x=[];let M=h;for(;M<p;){const h=t[M];let k=null,I=h>239?4:h>223?3:h>191?2:1;if(M+I<=p){let p,x,N,V;switch(I){case 1:h<128&&(k=h);break;case 2:p=t[M+1],128==(192&p)&&(V=(31&h)<<6|63&p,V>127&&(k=V));break;case 3:p=t[M+1],x=t[M+2],128==(192&p)&&128==(192&x)&&(V=(15&h)<<12|(63&p)<<6|63&x,V>2047&&(V<55296||V>57343)&&(k=V));break;case 4:p=t[M+1],x=t[M+2],N=t[M+3],128==(192&p)&&128==(192&x)&&128==(192&N)&&(V=(15&h)<<18|(63&p)<<12|(63&x)<<6|63&N,V>65535&&V<1114112&&(k=V))}}null===k?(k=65533,I=1):k>65535&&(k-=65536,x.push(k>>>10&1023|55296),k=56320|1023&k),x.push(k),M+=I}return function decodeCodePointsArray(t){const h=t.length;if(h<=I)return String.fromCharCode.apply(String,t);let p="",x=0;for(;x<h;)p+=String.fromCharCode.apply(String,t.slice(x,x+=I));return p}(x)}t.kMaxLength=k,Buffer.TYPED_ARRAY_SUPPORT=function typedArraySupport(){try{const t=new Uint8Array(1),h={foo:function(){return 42}};return Object.setPrototypeOf(h,Uint8Array.prototype),Object.setPrototypeOf(t,h),42===t.foo()}catch(t){return!1}}(),!Buffer.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),Buffer.poolSize=8192,Buffer.from=function(t,h,p){return from(t,h,p)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(t,h,p){return function alloc(t,h,p){return assertSize(t),t<=0?createBuffer(t):void 0!==h?"string"==typeof p?createBuffer(t).fill(h,p):createBuffer(t).fill(h):createBuffer(t)}(t,h,p)},Buffer.allocUnsafe=function(t){return allocUnsafe(t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(t)},Buffer.isBuffer=function isBuffer(t){return null!=t&&!0===t._isBuffer&&t!==Buffer.prototype},Buffer.compare=function compare(t,h){if(isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),isInstance(h,Uint8Array)&&(h=Buffer.from(h,h.offset,h.byteLength)),!Buffer.isBuffer(t)||!Buffer.isBuffer(h))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===h)return 0;let p=t.length,x=h.length;for(let M=0,k=Math.min(p,x);M<k;++M)if(t[M]!==h[M]){p=t[M],x=h[M];break}return p<x?-1:x<p?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,h){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);let p;if(void 0===h)for(h=0,p=0;p<t.length;++p)h+=t[p].length;const x=Buffer.allocUnsafe(h);let M=0;for(p=0;p<t.length;++p){let h=t[p];if(isInstance(h,Uint8Array))M+h.length>x.length?(Buffer.isBuffer(h)||(h=Buffer.from(h)),h.copy(x,M)):Uint8Array.prototype.set.call(x,h,M);else{if(!Buffer.isBuffer(h))throw new TypeError('"list" argument must be an Array of Buffers');h.copy(x,M)}M+=h.length}return x},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let h=0;h<t;h+=2)swap(this,h,h+1);return this},Buffer.prototype.swap32=function swap32(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let h=0;h<t;h+=4)swap(this,h,h+3),swap(this,h+1,h+2);return this},Buffer.prototype.swap64=function swap64(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let h=0;h<t;h+=8)swap(this,h,h+7),swap(this,h+1,h+6),swap(this,h+2,h+5),swap(this,h+3,h+4);return this},Buffer.prototype.toString=function toString(){const t=this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){let h="";const p=t.INSPECT_MAX_BYTES;return h=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(h+=" ... "),"<Buffer "+h+">"},M&&(Buffer.prototype[M]=Buffer.prototype.inspect),Buffer.prototype.compare=function compare(t,h,p,x,M){if(isInstance(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===h&&(h=0),void 0===p&&(p=t?t.length:0),void 0===x&&(x=0),void 0===M&&(M=this.length),h<0||p>t.length||x<0||M>this.length)throw new RangeError("out of range index");if(x>=M&&h>=p)return 0;if(x>=M)return-1;if(h>=p)return 1;if(this===t)return 0;let k=(M>>>=0)-(x>>>=0),I=(p>>>=0)-(h>>>=0);const N=Math.min(k,I),V=this.slice(x,M),ee=t.slice(h,p);for(let te=0;te<N;++te)if(V[te]!==ee[te]){k=V[te],I=ee[te];break}return k<I?-1:I<k?1:0},Buffer.prototype.includes=function includes(t,h,p){return-1!==this.indexOf(t,h,p)},Buffer.prototype.indexOf=function indexOf(t,h,p){return bidirectionalIndexOf(this,t,h,p,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,h,p){return bidirectionalIndexOf(this,t,h,p,!1)},Buffer.prototype.write=function write(t,h,p,x){if(void 0===h)x="utf8",p=this.length,h=0;else if(void 0===p&&"string"==typeof h)x=h,p=this.length,h=0;else{if(!isFinite(h))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");h>>>=0,isFinite(p)?(p>>>=0,void 0===x&&(x="utf8")):(x=p,p=void 0)}const M=this.length-h;if((void 0===p||p>M)&&(p=M),t.length>0&&(p<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");x||(x="utf8");let k=!1;for(;;)switch(x){case"hex":return hexWrite(this,t,h,p);case"utf8":case"utf-8":return utf8Write(this,t,h,p);case"ascii":case"latin1":case"binary":return asciiWrite(this,t,h,p);case"base64":return base64Write(this,t,h,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,h,p);default:if(k)throw new TypeError("Unknown encoding: "+x);x=(""+x).toLowerCase(),k=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function asciiSlice(t,h,p){let x="";p=Math.min(t.length,p);for(let M=h;M<p;++M)x+=String.fromCharCode(127&t[M]);return x}function latin1Slice(t,h,p){let x="";p=Math.min(t.length,p);for(let M=h;M<p;++M)x+=String.fromCharCode(t[M]);return x}function hexSlice(t,h,p){const x=t.length;(!h||h<0)&&(h=0),(!p||p<0||p>x)&&(p=x);let M="";for(let k=h;k<p;++k)M+=te[t[k]];return M}function utf16leSlice(t,h,p){const x=t.slice(h,p);let M="";for(let k=0;k<x.length-1;k+=2)M+=String.fromCharCode(x[k]+256*x[k+1]);return M}function checkOffset(t,h,p){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+h>p)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,h,p,x,M,k){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>M||h<k)throw new RangeError('"value" argument is out of bounds');if(p+x>t.length)throw new RangeError("Index out of range")}function wrtBigUInt64LE(t,h,p,x,M){checkIntBI(h,x,M,t,p,7);let k=Number(h&BigInt(4294967295));t[p++]=k,k>>=8,t[p++]=k,k>>=8,t[p++]=k,k>>=8,t[p++]=k;let I=Number(h>>BigInt(32)&BigInt(4294967295));return t[p++]=I,I>>=8,t[p++]=I,I>>=8,t[p++]=I,I>>=8,t[p++]=I,p}function wrtBigUInt64BE(t,h,p,x,M){checkIntBI(h,x,M,t,p,7);let k=Number(h&BigInt(4294967295));t[p+7]=k,k>>=8,t[p+6]=k,k>>=8,t[p+5]=k,k>>=8,t[p+4]=k;let I=Number(h>>BigInt(32)&BigInt(4294967295));return t[p+3]=I,I>>=8,t[p+2]=I,I>>=8,t[p+1]=I,I>>=8,t[p]=I,p+8}function checkIEEE754(t,h,p,x,M,k){if(p+x>t.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function writeFloat(t,h,x,M,k){return h=+h,x>>>=0,k||checkIEEE754(t,0,x,4),p.write(t,h,x,M,23,4),x+4}function writeDouble(t,h,x,M,k){return h=+h,x>>>=0,k||checkIEEE754(t,0,x,8),p.write(t,h,x,M,52,8),x+8}Buffer.prototype.slice=function slice(t,h){const p=this.length;(t=~~t)<0?(t+=p)<0&&(t=0):t>p&&(t=p),(h=void 0===h?p:~~h)<0?(h+=p)<0&&(h=0):h>p&&(h=p),h<t&&(h=t);const x=this.subarray(t,h);return Object.setPrototypeOf(x,Buffer.prototype),x},Buffer.prototype.readUintLE=Buffer.prototype.readUIntLE=function readUIntLE(t,h,p){t>>>=0,h>>>=0,p||checkOffset(t,h,this.length);let x=this[t],M=1,k=0;for(;++k<h&&(M*=256);)x+=this[t+k]*M;return x},Buffer.prototype.readUintBE=Buffer.prototype.readUIntBE=function readUIntBE(t,h,p){t>>>=0,h>>>=0,p||checkOffset(t,h,this.length);let x=this[t+--h],M=1;for(;h>0&&(M*=256);)x+=this[t+--h]*M;return x},Buffer.prototype.readUint8=Buffer.prototype.readUInt8=function readUInt8(t,h){return t>>>=0,h||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUint16LE=Buffer.prototype.readUInt16LE=function readUInt16LE(t,h){return t>>>=0,h||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUint16BE=Buffer.prototype.readUInt16BE=function readUInt16BE(t,h){return t>>>=0,h||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUint32LE=Buffer.prototype.readUInt32LE=function readUInt32LE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUint32BE=Buffer.prototype.readUInt32BE=function readUInt32BE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readBigUInt64LE=defineBigIntMethod((function readBigUInt64LE(t){validateNumber(t>>>=0,"offset");const h=this[t],p=this[t+7];void 0!==h&&void 0!==p||boundsError(t,this.length-8);const x=h+256*this[++t]+65536*this[++t]+this[++t]*2**24,M=this[++t]+256*this[++t]+65536*this[++t]+p*2**24;return BigInt(x)+(BigInt(M)<<BigInt(32))})),Buffer.prototype.readBigUInt64BE=defineBigIntMethod((function readBigUInt64BE(t){validateNumber(t>>>=0,"offset");const h=this[t],p=this[t+7];void 0!==h&&void 0!==p||boundsError(t,this.length-8);const x=h*2**24+65536*this[++t]+256*this[++t]+this[++t],M=this[++t]*2**24+65536*this[++t]+256*this[++t]+p;return(BigInt(x)<<BigInt(32))+BigInt(M)})),Buffer.prototype.readIntLE=function readIntLE(t,h,p){t>>>=0,h>>>=0,p||checkOffset(t,h,this.length);let x=this[t],M=1,k=0;for(;++k<h&&(M*=256);)x+=this[t+k]*M;return M*=128,x>=M&&(x-=Math.pow(2,8*h)),x},Buffer.prototype.readIntBE=function readIntBE(t,h,p){t>>>=0,h>>>=0,p||checkOffset(t,h,this.length);let x=h,M=1,k=this[t+--x];for(;x>0&&(M*=256);)k+=this[t+--x]*M;return M*=128,k>=M&&(k-=Math.pow(2,8*h)),k},Buffer.prototype.readInt8=function readInt8(t,h){return t>>>=0,h||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,h){t>>>=0,h||checkOffset(t,2,this.length);const p=this[t]|this[t+1]<<8;return 32768&p?4294901760|p:p},Buffer.prototype.readInt16BE=function readInt16BE(t,h){t>>>=0,h||checkOffset(t,2,this.length);const p=this[t+1]|this[t]<<8;return 32768&p?4294901760|p:p},Buffer.prototype.readInt32LE=function readInt32LE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readBigInt64LE=defineBigIntMethod((function readBigInt64LE(t){validateNumber(t>>>=0,"offset");const h=this[t],p=this[t+7];void 0!==h&&void 0!==p||boundsError(t,this.length-8);const x=this[t+4]+256*this[t+5]+65536*this[t+6]+(p<<24);return(BigInt(x)<<BigInt(32))+BigInt(h+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),Buffer.prototype.readBigInt64BE=defineBigIntMethod((function readBigInt64BE(t){validateNumber(t>>>=0,"offset");const h=this[t],p=this[t+7];void 0!==h&&void 0!==p||boundsError(t,this.length-8);const x=(h<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(x)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+p)})),Buffer.prototype.readFloatLE=function readFloatLE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),p.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,h){return t>>>=0,h||checkOffset(t,4,this.length),p.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,h){return t>>>=0,h||checkOffset(t,8,this.length),p.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,h){return t>>>=0,h||checkOffset(t,8,this.length),p.read(this,t,!1,52,8)},Buffer.prototype.writeUintLE=Buffer.prototype.writeUIntLE=function writeUIntLE(t,h,p,x){if(t=+t,h>>>=0,p>>>=0,!x){checkInt(this,t,h,p,Math.pow(2,8*p)-1,0)}let M=1,k=0;for(this[h]=255&t;++k<p&&(M*=256);)this[h+k]=t/M&255;return h+p},Buffer.prototype.writeUintBE=Buffer.prototype.writeUIntBE=function writeUIntBE(t,h,p,x){if(t=+t,h>>>=0,p>>>=0,!x){checkInt(this,t,h,p,Math.pow(2,8*p)-1,0)}let M=p-1,k=1;for(this[h+M]=255&t;--M>=0&&(k*=256);)this[h+M]=t/k&255;return h+p},Buffer.prototype.writeUint8=Buffer.prototype.writeUInt8=function writeUInt8(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,1,255,0),this[h]=255&t,h+1},Buffer.prototype.writeUint16LE=Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,2,65535,0),this[h]=255&t,this[h+1]=t>>>8,h+2},Buffer.prototype.writeUint16BE=Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,2,65535,0),this[h]=t>>>8,this[h+1]=255&t,h+2},Buffer.prototype.writeUint32LE=Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,4,4294967295,0),this[h+3]=t>>>24,this[h+2]=t>>>16,this[h+1]=t>>>8,this[h]=255&t,h+4},Buffer.prototype.writeUint32BE=Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,4,4294967295,0),this[h]=t>>>24,this[h+1]=t>>>16,this[h+2]=t>>>8,this[h+3]=255&t,h+4},Buffer.prototype.writeBigUInt64LE=defineBigIntMethod((function writeBigUInt64LE(t,h=0){return wrtBigUInt64LE(this,t,h,BigInt(0),BigInt("0xffffffffffffffff"))})),Buffer.prototype.writeBigUInt64BE=defineBigIntMethod((function writeBigUInt64BE(t,h=0){return wrtBigUInt64BE(this,t,h,BigInt(0),BigInt("0xffffffffffffffff"))})),Buffer.prototype.writeIntLE=function writeIntLE(t,h,p,x){if(t=+t,h>>>=0,!x){const x=Math.pow(2,8*p-1);checkInt(this,t,h,p,x-1,-x)}let M=0,k=1,I=0;for(this[h]=255&t;++M<p&&(k*=256);)t<0&&0===I&&0!==this[h+M-1]&&(I=1),this[h+M]=(t/k>>0)-I&255;return h+p},Buffer.prototype.writeIntBE=function writeIntBE(t,h,p,x){if(t=+t,h>>>=0,!x){const x=Math.pow(2,8*p-1);checkInt(this,t,h,p,x-1,-x)}let M=p-1,k=1,I=0;for(this[h+M]=255&t;--M>=0&&(k*=256);)t<0&&0===I&&0!==this[h+M+1]&&(I=1),this[h+M]=(t/k>>0)-I&255;return h+p},Buffer.prototype.writeInt8=function writeInt8(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,1,127,-128),t<0&&(t=255+t+1),this[h]=255&t,h+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,2,32767,-32768),this[h]=255&t,this[h+1]=t>>>8,h+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,2,32767,-32768),this[h]=t>>>8,this[h+1]=255&t,h+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,4,2147483647,-2147483648),this[h]=255&t,this[h+1]=t>>>8,this[h+2]=t>>>16,this[h+3]=t>>>24,h+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,h,p){return t=+t,h>>>=0,p||checkInt(this,t,h,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[h]=t>>>24,this[h+1]=t>>>16,this[h+2]=t>>>8,this[h+3]=255&t,h+4},Buffer.prototype.writeBigInt64LE=defineBigIntMethod((function writeBigInt64LE(t,h=0){return wrtBigUInt64LE(this,t,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Buffer.prototype.writeBigInt64BE=defineBigIntMethod((function writeBigInt64BE(t,h=0){return wrtBigUInt64BE(this,t,h,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),Buffer.prototype.writeFloatLE=function writeFloatLE(t,h,p){return writeFloat(this,t,h,!0,p)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,h,p){return writeFloat(this,t,h,!1,p)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,h,p){return writeDouble(this,t,h,!0,p)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,h,p){return writeDouble(this,t,h,!1,p)},Buffer.prototype.copy=function copy(t,h,p,x){if(!Buffer.isBuffer(t))throw new TypeError("argument should be a Buffer");if(p||(p=0),x||0===x||(x=this.length),h>=t.length&&(h=t.length),h||(h=0),x>0&&x<p&&(x=p),x===p)return 0;if(0===t.length||0===this.length)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(p<0||p>=this.length)throw new RangeError("Index out of range");if(x<0)throw new RangeError("sourceEnd out of bounds");x>this.length&&(x=this.length),t.length-h<x-p&&(x=t.length-h+p);const M=x-p;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(h,p,x):Uint8Array.prototype.set.call(t,this.subarray(p,x),h),M},Buffer.prototype.fill=function fill(t,h,p,x){if("string"==typeof t){if("string"==typeof h?(x=h,h=0,p=this.length):"string"==typeof p&&(x=p,p=this.length),void 0!==x&&"string"!=typeof x)throw new TypeError("encoding must be a string");if("string"==typeof x&&!Buffer.isEncoding(x))throw new TypeError("Unknown encoding: "+x);if(1===t.length){const h=t.charCodeAt(0);("utf8"===x&&h<128||"latin1"===x)&&(t=h)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(h<0||this.length<h||this.length<p)throw new RangeError("Out of range index");if(p<=h)return this;let M;if(h>>>=0,p=void 0===p?this.length:p>>>0,t||(t=0),"number"==typeof t)for(M=h;M<p;++M)this[M]=t;else{const k=Buffer.isBuffer(t)?t:Buffer.from(t,x),I=k.length;if(0===I)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(M=0;M<p-h;++M)this[M+h]=k[M%I]}return this};const N={};function E(t,h,p){N[t]=class NodeError extends p{constructor(){super(),Object.defineProperty(this,"message",{value:h.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function addNumericalSeparator(t){let h="",p=t.length;const x="-"===t[0]?1:0;for(;p>=x+4;p-=3)h=`_${t.slice(p-3,p)}${h}`;return`${t.slice(0,p)}${h}`}function checkIntBI(t,h,p,x,M,k){if(t>p||t<h){const x="bigint"==typeof h?"n":"";let M;throw M=k>3?0===h||h===BigInt(0)?`>= 0${x} and < 2${x} ** ${8*(k+1)}${x}`:`>= -(2${x} ** ${8*(k+1)-1}${x}) and < 2 ** ${8*(k+1)-1}${x}`:`>= ${h}${x} and <= ${p}${x}`,new N.ERR_OUT_OF_RANGE("value",M,t)}!function checkBounds(t,h,p){validateNumber(h,"offset"),void 0!==t[h]&&void 0!==t[h+p]||boundsError(h,t.length-(p+1))}(x,M,k)}function validateNumber(t,h){if("number"!=typeof t)throw new N.ERR_INVALID_ARG_TYPE(h,"number",t)}function boundsError(t,h,p){if(Math.floor(t)!==t)throw validateNumber(t,p),new N.ERR_OUT_OF_RANGE(p||"offset","an integer",t);if(h<0)throw new N.ERR_BUFFER_OUT_OF_BOUNDS;throw new N.ERR_OUT_OF_RANGE(p||"offset",`>= ${p?1:0} and <= ${h}`,t)}E("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),E("ERR_INVALID_ARG_TYPE",(function(t,h){return`The "${t}" argument must be of type number. Received type ${typeof h}`}),TypeError),E("ERR_OUT_OF_RANGE",(function(t,h,p){let x=`The value of "${t}" is out of range.`,M=p;return Number.isInteger(p)&&Math.abs(p)>2**32?M=addNumericalSeparator(String(p)):"bigint"==typeof p&&(M=String(p),(p>BigInt(2)**BigInt(32)||p<-(BigInt(2)**BigInt(32)))&&(M=addNumericalSeparator(M)),M+="n"),x+=` It must be ${h}. Received ${M}`,x}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function utf8ToBytes(t,h){let p;h=h||1/0;const x=t.length;let M=null;const k=[];for(let I=0;I<x;++I){if(p=t.charCodeAt(I),p>55295&&p<57344){if(!M){if(p>56319){(h-=3)>-1&&k.push(239,191,189);continue}if(I+1===x){(h-=3)>-1&&k.push(239,191,189);continue}M=p;continue}if(p<56320){(h-=3)>-1&&k.push(239,191,189),M=p;continue}p=65536+(M-55296<<10|p-56320)}else M&&(h-=3)>-1&&k.push(239,191,189);if(M=null,p<128){if((h-=1)<0)break;k.push(p)}else if(p<2048){if((h-=2)<0)break;k.push(p>>6|192,63&p|128)}else if(p<65536){if((h-=3)<0)break;k.push(p>>12|224,p>>6&63|128,63&p|128)}else{if(!(p<1114112))throw new Error("Invalid code point");if((h-=4)<0)break;k.push(p>>18|240,p>>12&63|128,p>>6&63|128,63&p|128)}}return k}function base64ToBytes(t){return h.toByteArray(function base64clean(t){if((t=(t=t.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,h,p,x){let M;for(M=0;M<x&&!(M+p>=h.length||M>=t.length);++M)h[M+p]=t[M];return M}function isInstance(t,h){return t instanceof h||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===h.name}function numberIsNaN(t){return t!=t}const te=function(){const t="0123456789abcdef",h=new Array(256);for(let p=0;p<16;++p){const x=16*p;for(let M=0;M<16;++M)h[x+M]=t[p]+t[M]}return h}();function defineBigIntMethod(t){return"undefined"==typeof BigInt?BufferBigIntNotDefined:t}function BufferBigIntNotDefined(){throw new Error("BigInt not supported")}}(p);var te={exports:{}},re={exports:{}};!function(t){function _typeof(h){return t.exports=_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,_typeof(h)}t.exports=_typeof,t.exports.__esModule=!0,t.exports.default=t.exports}(re),function(t){var h=re.exports.default;function _regeneratorRuntime(){t.exports=_regeneratorRuntime=function _regeneratorRuntime(){return x},t.exports.__esModule=!0,t.exports.default=t.exports;var p,x={},M=Object.prototype,k=M.hasOwnProperty,I=Object.defineProperty||function(t,h,p){t[h]=p.value},N="function"==typeof Symbol?Symbol:{},V=N.iterator||"@@iterator",ee=N.asyncIterator||"@@asyncIterator",te=N.toStringTag||"@@toStringTag";function define(t,h,p){return Object.defineProperty(t,h,{value:p,enumerable:!0,configurable:!0,writable:!0}),t[h]}try{define({},"")}catch(p){define=function define(t,h,p){return t[h]=p}}function wrap(t,h,p,x){var M=h&&h.prototype instanceof Generator?h:Generator,k=Object.create(M.prototype),N=new Context(x||[]);return I(k,"_invoke",{value:makeInvokeMethod(t,p,N)}),k}function tryCatch(t,h,p){try{return{type:"normal",arg:t.call(h,p)}}catch(t){return{type:"throw",arg:t}}}x.wrap=wrap;var re="suspendedStart",ne="suspendedYield",ie="executing",ae="completed",oe={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var se={};define(se,V,(function(){return this}));var ce=Object.getPrototypeOf,ue=ce&&ce(ce(values([])));ue&&ue!==M&&k.call(ue,V)&&(se=ue);var le=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(se);function defineIteratorMethods(t){["next","throw","return"].forEach((function(h){define(t,h,(function(t){return this._invoke(h,t)}))}))}function AsyncIterator(t,p){function invoke(x,M,I,N){var V=tryCatch(t[x],t,M);if("throw"!==V.type){var ee=V.arg,te=ee.value;return te&&"object"==h(te)&&k.call(te,"__await")?p.resolve(te.__await).then((function(t){invoke("next",t,I,N)}),(function(t){invoke("throw",t,I,N)})):p.resolve(te).then((function(t){ee.value=t,I(ee)}),(function(t){return invoke("throw",t,I,N)}))}N(V.arg)}var x;I(this,"_invoke",{value:function value(t,h){function callInvokeWithMethodAndArg(){return new p((function(p,x){invoke(t,h,p,x)}))}return x=x?x.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,h,x){var M=re;return function(k,I){if(M===ie)throw new Error("Generator is already running");if(M===ae){if("throw"===k)throw I;return{value:p,done:!0}}for(x.method=k,x.arg=I;;){var N=x.delegate;if(N){var V=maybeInvokeDelegate(N,x);if(V){if(V===oe)continue;return V}}if("next"===x.method)x.sent=x._sent=x.arg;else if("throw"===x.method){if(M===re)throw M=ae,x.arg;x.dispatchException(x.arg)}else"return"===x.method&&x.abrupt("return",x.arg);M=ie;var ee=tryCatch(t,h,x);if("normal"===ee.type){if(M=x.done?ae:ne,ee.arg===oe)continue;return{value:ee.arg,done:x.done}}"throw"===ee.type&&(M=ae,x.method="throw",x.arg=ee.arg)}}}function maybeInvokeDelegate(t,h){var x=h.method,M=t.iterator[x];if(M===p)return h.delegate=null,"throw"===x&&t.iterator.return&&(h.method="return",h.arg=p,maybeInvokeDelegate(t,h),"throw"===h.method)||"return"!==x&&(h.method="throw",h.arg=new TypeError("The iterator does not provide a '"+x+"' method")),oe;var k=tryCatch(M,t.iterator,h.arg);if("throw"===k.type)return h.method="throw",h.arg=k.arg,h.delegate=null,oe;var I=k.arg;return I?I.done?(h[t.resultName]=I.value,h.next=t.nextLoc,"return"!==h.method&&(h.method="next",h.arg=p),h.delegate=null,oe):I:(h.method="throw",h.arg=new TypeError("iterator result is not an object"),h.delegate=null,oe)}function pushTryEntry(t){var h={tryLoc:t[0]};1 in t&&(h.catchLoc=t[1]),2 in t&&(h.finallyLoc=t[2],h.afterLoc=t[3]),this.tryEntries.push(h)}function resetTryEntry(t){var h=t.completion||{};h.type="normal",delete h.arg,t.completion=h}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var x=t[V];if(x)return x.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var M=-1,I=function next(){for(;++M<t.length;)if(k.call(t,M))return next.value=t[M],next.done=!1,next;return next.value=p,next.done=!0,next};return I.next=I}}throw new TypeError(h(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,I(le,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),I(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,te,"GeneratorFunction"),x.isGeneratorFunction=function(t){var h="function"==typeof t&&t.constructor;return!!h&&(h===GeneratorFunction||"GeneratorFunction"===(h.displayName||h.name))},x.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,te,"GeneratorFunction")),t.prototype=Object.create(le),t},x.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,ee,(function(){return this})),x.AsyncIterator=AsyncIterator,x.async=function(t,h,p,M,k){void 0===k&&(k=Promise);var I=new AsyncIterator(wrap(t,h,p,M),k);return x.isGeneratorFunction(h)?I:I.next().then((function(t){return t.done?t.value:I.next()}))},defineIteratorMethods(le),define(le,te,"Generator"),define(le,V,(function(){return this})),define(le,"toString",(function(){return"[object Generator]"})),x.keys=function(t){var h=Object(t),p=[];for(var x in h)p.push(x);return p.reverse(),function next(){for(;p.length;){var t=p.pop();if(t in h)return next.value=t,next.done=!1,next}return next.done=!0,next}},x.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(resetTryEntry),!t)for(var h in this)"t"===h.charAt(0)&&k.call(this,h)&&!isNaN(+h.slice(1))&&(this[h]=p)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var h=this;function handle(x,M){return I.type="throw",I.arg=t,h.next=x,M&&(h.method="next",h.arg=p),!!M}for(var x=this.tryEntries.length-1;x>=0;--x){var M=this.tryEntries[x],I=M.completion;if("root"===M.tryLoc)return handle("end");if(M.tryLoc<=this.prev){var N=k.call(M,"catchLoc"),V=k.call(M,"finallyLoc");if(N&&V){if(this.prev<M.catchLoc)return handle(M.catchLoc,!0);if(this.prev<M.finallyLoc)return handle(M.finallyLoc)}else if(N){if(this.prev<M.catchLoc)return handle(M.catchLoc,!0)}else{if(!V)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return handle(M.finallyLoc)}}}},abrupt:function abrupt(t,h){for(var p=this.tryEntries.length-1;p>=0;--p){var x=this.tryEntries[p];if(x.tryLoc<=this.prev&&k.call(x,"finallyLoc")&&this.prev<x.finallyLoc){var M=x;break}}M&&("break"===t||"continue"===t)&&M.tryLoc<=h&&h<=M.finallyLoc&&(M=null);var I=M?M.completion:{};return I.type=t,I.arg=h,M?(this.method="next",this.next=M.finallyLoc,oe):this.complete(I)},complete:function complete(t,h){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&h&&(this.next=h),oe},finish:function finish(t){for(var h=this.tryEntries.length-1;h>=0;--h){var p=this.tryEntries[h];if(p.finallyLoc===t)return this.complete(p.completion,p.afterLoc),resetTryEntry(p),oe}},catch:function _catch(t){for(var h=this.tryEntries.length-1;h>=0;--h){var p=this.tryEntries[h];if(p.tryLoc===t){var x=p.completion;if("throw"===x.type){var M=x.arg;resetTryEntry(p)}return M}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,h,x){return this.delegate={iterator:values(t),resultName:h,nextLoc:x},"next"===this.method&&(this.arg=p),oe}},x}t.exports=_regeneratorRuntime,t.exports.__esModule=!0,t.exports.default=t.exports}(te);var ne=te.exports(),ie=ne;try{regeneratorRuntime=ne}catch(Nf){"object"==typeof globalThis?globalThis.regeneratorRuntime=ne:Function("r","regeneratorRuntime = r")(ne)}function b64Encode(t){return btoa(unescape(encodeURIComponent(t)))}function b64Decode(t){return decodeURIComponent(escape(atob(t)))}function crateHexString(t){return Array.from((new TextEncoder).encode(t)).map((function(t){return t.toString(16).padStart(2,"0")})).join("")}function saveAsFileDialog(t){return _saveAsFileDialog.apply(this,arguments)}function _saveAsFileDialog(){return(_saveAsFileDialog=_asyncToGenerator(ie.mark((function _callee3(t){var h,p,x,M,k,I,N,V,ee,te,re,ne;return ie.wrap((function _callee3$(ie){for(;;)switch(ie.prev=ie.next){case 0:if(h=t.blob,p=t.filename,x=void 0===p?"":p,M=t.types,k=void 0===M?[{description:"mxweb File",accept:{"application/octet-stream":[".mxweb"]}}]:M,h){ie.next=4;break}return ie.abrupt("return");case 4:if(ie.prev=4,"function"!=typeof window.showSaveFilePicker){ie.next=31;break}if(!(null!=(N=null===(I=window.navigator)||void 0===I?void 0:I.userActivation)&&N.isActive||null!=N&&N.hasBeenActive)){ie.next=30;break}return ie.prev=8,ie.next=11,window.showSaveFilePicker({suggestedName:x,types:k});case 11:return V=ie.sent,ie.next=14,V.createWritable();case 14:return ee=ie.sent,ie.next=17,ee.write(h);case 17:return ie.next=19,ee.close();case 19:return ie.abrupt("return",V);case 22:if(ie.prev=22,ie.t0=ie.catch(8),"AbortError"!==ie.t0.name){ie.next=27;break}return ie.abrupt("return",!1);case 27:"AbortError"===ie.t0.name||ie.t0.name;case 28:ie.next=31;break;case 30:case 31:if(!window.navigator.msSaveOrOpenBlob||"function"!=typeof window.navigator.msSaveOrOpenBlob){ie.next=35;break}return te=h.slice(0,h.size,h.type||"application/octet-stream"),window.navigator.msSaveOrOpenBlob(te,x),ie.abrupt("return");case 35:return re=window.URL.createObjectURL(h),(ne=document.createElement("a")).href=re,ne.download=x,ne.style.display="none",document.body.appendChild(ne),ne.click(),setTimeout((function(){window.URL.revokeObjectURL(re)}),100),document.body.removeChild(ne),ie.abrupt("return");case 47:ie.prev=47,ie.t1=ie.catch(4);case 50:case"end":return ie.stop()}}),_callee3,null,[[4,47],[8,22]])})))).apply(this,arguments)}function downloadFile(t,h){var p=document.createElement("a");p.href=window.URL.createObjectURL(t),p.download=h,p.click()}function downloadFileFromUrl(t,h){fetch(t).then((function(t){return t.blob()})).then((function(t){var p=document.createElement("a");p.href=window.URL.createObjectURL(t),p.download=h,p.click()}))}var ae=function(){var t=_asyncToGenerator(ie.mark((function _callee(t){return ie.wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,fetch(t);case 3:return h.next=5,h.sent.json();case 5:return h.abrupt("return",h.sent);case 8:h.prev=8,h.t0=h.catch(0);case 11:case"end":return h.stop()}}),_callee,null,[[0,8]])})));return function getJsonFromUrl(h){return t.apply(this,arguments)}}(),oe=function(){var t=_asyncToGenerator(ie.mark((function _callee2(t){return ie.wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,fetch(t);case 3:return h.abrupt("return",h.sent);case 6:h.prev=6,h.t0=h.catch(0);case 9:case"end":return h.stop()}}),_callee2,null,[[0,6]])})));return function getFileFromUrl(h){return t.apply(this,arguments)}}();function _ML_String(t,p){return h.MxFun.getLanguageString(t,p)}function IsZero(t){return Math.abs(t)<1e-7}function postMemoryFile(t,h,p,x,M){try{var k=new FormData,I=new Blob([t],{type:"application/octet-stream"});k.append("file",new File([I],p)),M&&k.append("param",M);var N=new XMLHttpRequest;N.open("POST",h),N.send(k),N.onreadystatechange=function(){N.readyState===XMLHttpRequest.DONE&&(200===N.status?x(0,N.responseText):x(4,"server error"))}}catch(V){x(-1,"catch error")}}function postEmscriptenIndexedDBFile(t,h,p,x){var M=window.indexedDB.open("emscripten_filesystem",1);M.onerror=function(){p(1,"open emscripten_filesystem failed")},M.onsuccess=function(M){try{if(null!=M.target){var k=M.target.result.transaction("FILES","readonly").objectStore("FILES").get(t);k.onerror=function(){p(3,"get file error")},k.onsuccess=function(){var t=k.result;if(t){var M=new FormData;M.append("file",t),x&&M.append("param",x);var I=new XMLHttpRequest;I.open("POST",h),I.send(M),I.onreadystatechange=function(){I.readyState===XMLHttpRequest.DONE&&(200===I.status?p(0,I.responseText):p(4,"server error"))}}else p(5,"get file data error")}}else p(2,"event.target == null")}catch(I){p(-1,"catch error")}}}function createCursorHelp(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff",M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:document.createElement("canvas"),k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"transparent";M.width=M.height=t,M.style.background=k;var I=M.getContext("2d"),N=t%2==0?-.5:0,V=h%2==0?-.5:0;return I.strokeStyle=x,I.lineWidth=0,I.imageSmoothingEnabled=!1,p&&(I.beginPath(),I.moveTo(M.width/2+N,N),I.lineTo(M.width/2+N,M.height+N),I.stroke(),I.beginPath(),I.moveTo(N,M.height/2+N),I.lineTo(M.width+N,M.height/2+N),I.stroke()),I.beginPath(),I.strokeRect(t/2-h/2+V,t/2-h/2+V,h,h),I.stroke(),M.toDataURL("image/png")}function createCursor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff";return{Rect:"url('".concat(createCursorHelp(t,h,!1,p),"') ").concat(t/2," ").concat(t/2,", auto"),Cross:"url('".concat(createCursorHelp(t,0,!0,p),"') ").concat(t/2," ").concat(t/2," , auto"),Normal:"url('".concat(createCursorHelp(t,h,!0,p),"') ").concat(t/2," ").concat(t/2,", auto")}}var se={b64Encode:b64Encode,b64Decode:b64Decode,saveAsFileDialog:saveAsFileDialog,downloadFile:downloadFile,downloadFileFromUrl:downloadFileFromUrl,getJsonFromUrl:ae,getFileFromUrl:oe,_ML_String:_ML_String,IsZero:IsZero,postEmscriptenIndexedDBFile:postEmscriptenIndexedDBFile,postMemoryFile:postMemoryFile,createCursor:createCursor};function _classCallCheck$1(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}function _typeof$1(t){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof$1(t)}function toPropertyKey(t){var h=function toPrimitive(t,h){if("object"!=_typeof$1(t)||!t)return t;var p=t[Symbol.toPrimitive];if(void 0!==p){var x=p.call(t,h||"default");if("object"!=_typeof$1(x))return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===h?String:Number)(t)}(t,"string");return"symbol"==_typeof$1(h)?h:String(h)}function _defineProperties$1(t,h){for(var p=0;p<h.length;p++){var x=h[p];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(t,toPropertyKey(x.key),x)}}function _createClass$1(t,h,p){return h&&_defineProperties$1(t.prototype,h),p&&_defineProperties$1(t,p),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,h,p){return(h=toPropertyKey(h))in t?Object.defineProperty(t,h,{value:p,enumerable:!0,configurable:!0,writable:!0}):t[h]=p,t}var ce,ue=function(){function MxCanvas2Image(){var t,h,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;_classCallCheck$1(this,MxCanvas2Image),_defineProperty(this,"$support",void 0),_defineProperty(this,"downloadMime","image/octet-stream"),_defineProperty(this,"mydocument",document),p&&(this.mydocument=p),this.$support=(t=p.createElement("canvas"),{canvas:!!(h=t.getContext("2d")),imageData:!!h.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa})}return _createClass$1(MxCanvas2Image,[{key:"scaleCanvas",value:function scaleCanvas(t,h,p){var x=t.width,M=t.height;null==h&&(h=x),null==p&&(p=M);var k=this.mydocument.createElement("canvas"),I=k.getContext("2d");return k.width=h,k.height=p,I.drawImage(t,0,0,x,M,0,0,h,p),k}},{key:"getDataURL",value:function getDataURL(t,h,p,x){return(t=this.scaleCanvas(t,p,x)).toDataURL(h)}},{key:"saveFile",value:function saveFile(t){var h=this.mydocument.createElement("a");h.href=t,h.download="save.bmp",h.click()}},{key:"genImage",value:function genImage(t){var h=this.mydocument.createElement("img");return h.src=t,h}},{key:"fixType",value:function fixType(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}},{key:"encodeData",value:function encodeData(t){if(!window.btoa)throw"btoa undefined";var h="";if("string"==typeof t)h=t;else for(var p=0;p<t.length;p++)h+=String.fromCharCode(t[p]);return btoa(h)}},{key:"getImageData",value:function getImageData(t){var h=t.width,p=t.height;return t.getContext("2d").getImageData(0,0,h,p)}},{key:"makeURI",value:function makeURI(t,h){return"data:"+h+";base64,"+t}},{key:"genBitmapImage",value:function genBitmapImage(t){var h=t.width,p=t.height,x=h*p*3,M=x+54,k=[66,77,255&M,M>>8&255,M>>16&255,M>>24&255,0,0,0,0,54,0,0,0],I=[40,0,0,0,255&h,h>>8&255,h>>16&255,h>>24&255,255&p,p>>8&255,p>>16&255,p>>24&255,1,0,24,0,0,0,0,0,255&x,x>>8&255,x>>16&255,x>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],N=(4-3*h%4)%4,V=t.data,ee="",te=h<<2,re=p,ne=String.fromCharCode;do{for(var ie=te*(re-1),ae="",oe=0;oe<h;oe++){var se=oe<<2;ae+=ne(V[ie+se+2])+ne(V[ie+se+1])+ne(V[ie+se])}for(var ce=0;ce<N;ce++)ae+=String.fromCharCode(0);ee+=ae}while(--re);return this.encodeData(k.concat(I))+this.encodeData(ee)}},{key:"saveAsImage",value:function saveAsImage(t,h,p,x){if(this.$support.canvas&&this.$support.dataURL)if("string"==typeof t&&(t=this.mydocument.getElementById(t)),null==x&&(x="png"),x=this.fixType(x),/bmp/.test(x)){var M=this.getImageData(this.scaleCanvas(t,h,p)),k=this.genBitmapImage(M);this.saveFile(this.makeURI(k,this.downloadMime))}else{var I=this.getDataURL(t,x,h,p);this.saveFile(I.replace(x,this.downloadMime))}}},{key:"convertToImage",value:function convertToImage(t,h,p,x){if(this.$support.canvas&&this.$support.dataURL){if("string"==typeof t&&(t=this.mydocument.getElementById(t)),null==x&&(x="png"),x=this.fixType(x),/bmp/.test(x)){var M=this.getImageData(this.scaleCanvas(t,h,p)),k=this.genBitmapImage(M);return this.genImage(this.makeURI(k,"image/bmp"))}var I=this.getDataURL(t,x,h,p);return this.genImage(I)}}}]),MxCanvas2Image}(),le={exports:{}},he=p,fe=he.Buffer,de={};for(ce in he)he.hasOwnProperty(ce)&&"SlowBuffer"!==ce&&"Buffer"!==ce&&(de[ce]=he[ce]);var pe=de.Buffer={};for(ce in fe)fe.hasOwnProperty(ce)&&"allocUnsafe"!==ce&&"allocUnsafeSlow"!==ce&&(pe[ce]=fe[ce]);if(de.Buffer.prototype=fe.prototype,pe.from&&pe.from!==Uint8Array.from||(pe.from=function(t,h,p){if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof t);if(t&&void 0===t.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);return fe(t,h,p)}),pe.alloc||(pe.alloc=function(t,h,p){if("number"!=typeof t)throw new TypeError('The "size" argument must be of type number. Received type '+typeof t);if(t<0||t>=2*(1<<30))throw new RangeError('The value "'+t+'" is invalid for option "size"');var x=fe(t);return h&&0!==h.length?"string"==typeof p?x.fill(h,p):x.fill(h):x.fill(0),x}),!de.kStringMaxLength)try{de.kStringMaxLength=process.binding("buffer").kStringMaxLength}catch(Vf){}de.constants||(de.constants={MAX_LENGTH:de.kMaxLength},de.kStringMaxLength&&(de.constants.MAX_STRING_LENGTH=de.kStringMaxLength));var me=de,ge={};function PrependBOMWrapper(t,h){this.encoder=t,this.addBOM=!0}function StripBOMWrapper(t,h){this.decoder=t,this.pass=!1,this.options=h||{}}ge.PrependBOM=PrependBOMWrapper,PrependBOMWrapper.prototype.write=function(t){return this.addBOM&&(t="\ufeff"+t,this.addBOM=!1),this.encoder.write(t)},PrependBOMWrapper.prototype.end=function(){return this.encoder.end()},ge.StripBOM=StripBOMWrapper,StripBOMWrapper.prototype.write=function(t){var h=this.decoder.write(t);return this.pass||!h||("\ufeff"===h[0]&&(h=h.slice(1),"function"==typeof this.options.stripBOM&&this.options.stripBOM()),this.pass=!0),h},StripBOMWrapper.prototype.end=function(){return this.decoder.end()};var ve,ye,be,xe,Me={},we={},_e={exports:{}};function requireString_decoder(){if(ye)return we;ye=1;var t=function requireSafeBuffer(){return ve||(ve=1,function(t,h){var x=p,M=x.Buffer;function copyProps(t,h){for(var p in t)h[p]=t[p]}function SafeBuffer(t,h,p){return M(t,h,p)}M.from&&M.alloc&&M.allocUnsafe&&M.allocUnsafeSlow?t.exports=x:(copyProps(x,h),h.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(M.prototype),copyProps(M,SafeBuffer),SafeBuffer.from=function(t,h,p){if("number"==typeof t)throw new TypeError("Argument must not be a number");return M(t,h,p)},SafeBuffer.alloc=function(t,h,p){if("number"!=typeof t)throw new TypeError("Argument must be a number");var x=M(t);return void 0!==h?"string"==typeof p?x.fill(h,p):x.fill(h):x.fill(0),x},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return M(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return x.SlowBuffer(t)}}(_e,_e.exports)),_e.exports}().Buffer,h=t.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(p){var x;switch(this.encoding=function normalizeEncoding(p){var x=function _normalizeEncoding(t){if(!t)return"utf8";for(var h;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(h)return;t=(""+t).toLowerCase(),h=!0}}(p);if("string"!=typeof x&&(t.isEncoding===h||!h(p)))throw new Error("Unknown encoding: "+p);return x||p}(p),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,x=4;break;case"utf8":this.fillLast=utf8FillLast,x=4;break;case"base64":this.text=base64Text,this.end=base64End,x=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(x)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var h=this.lastTotal-this.lastNeed,p=function utf8CheckExtraBytes(t,h,p){if(128!=(192&h[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&h.length>1){if(128!=(192&h[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&h.length>2&&128!=(192&h[2]))return t.lastNeed=2,""}}(this,t);return void 0!==p?p:this.lastNeed<=t.length?(t.copy(this.lastChar,h,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,h,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,h){if((t.length-h)%2==0){var p=t.toString("utf16le",h);if(p){var x=p.charCodeAt(p.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],p.slice(0,-1)}return p}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",h,t.length-1)}function utf16End(t){var h=t&&t.length?this.write(t):"";if(this.lastNeed){var p=this.lastTotal-this.lastNeed;return h+this.lastChar.toString("utf16le",0,p)}return h}function base64Text(t,h){var p=(t.length-h)%3;return 0===p?t.toString("base64",h):(this.lastNeed=3-p,this.lastTotal=3,1===p?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",h,t.length-p))}function base64End(t){var h=t&&t.length?this.write(t):"";return this.lastNeed?h+this.lastChar.toString("base64",0,3-this.lastNeed):h}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}return we.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var h,p;if(this.lastNeed){if(void 0===(h=this.fillLast(t)))return"";p=this.lastNeed,this.lastNeed=0}else p=0;return p<t.length?h?h+this.text(t,p):this.text(t,p):h||""},StringDecoder.prototype.end=function utf8End(t){var h=t&&t.length?this.write(t):"";return this.lastNeed?h+"":h},StringDecoder.prototype.text=function utf8Text(t,h){var p=function utf8CheckIncomplete(t,h,p){var x=h.length-1;if(x<p)return 0;var M=utf8CheckByte(h[x]);if(M>=0)return M>0&&(t.lastNeed=M-1),M;if(--x<p||-2===M)return 0;if(M=utf8CheckByte(h[x]),M>=0)return M>0&&(t.lastNeed=M-2),M;if(--x<p||-2===M)return 0;if(M=utf8CheckByte(h[x]),M>=0)return M>0&&(2===M?M=0:t.lastNeed=M-3),M;return 0}(this,t,h);if(!this.lastNeed)return t.toString("utf8",h);this.lastTotal=p;var x=t.length-(p-this.lastNeed);return t.copy(this.lastChar,0,x),t.toString("utf8",h,x)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length},we}function requireInternal(){if(xe)return be;xe=1;var t=me.Buffer;function InternalCodec(h,p){this.enc=h.encodingName,this.bomAware=h.bomAware,"base64"===this.enc?this.encoder=InternalEncoderBase64:"cesu8"===this.enc&&(this.enc="utf8",this.encoder=InternalEncoderCesu8,""!==t.from("eda0bdedb2a9","hex").toString()&&(this.decoder=InternalDecoderCesu8,this.defaultCharUnicode=p.defaultCharUnicode))}be={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:InternalCodec},InternalCodec.prototype.encoder=InternalEncoder,InternalCodec.prototype.decoder=InternalDecoder;var h=requireString_decoder().StringDecoder;function InternalDecoder(t,p){this.decoder=new h(p.enc)}function InternalEncoder(t,h){this.enc=h.enc}function InternalEncoderBase64(t,h){this.prevStr=""}function InternalEncoderCesu8(t,h){}function InternalDecoderCesu8(t,h){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=h.defaultCharUnicode}return h.prototype.end||(h.prototype.end=function(){}),InternalDecoder.prototype.write=function(h){return t.isBuffer(h)||(h=t.from(h)),this.decoder.write(h)},InternalDecoder.prototype.end=function(){return this.decoder.end()},InternalEncoder.prototype.write=function(h){return t.from(h,this.enc)},InternalEncoder.prototype.end=function(){},InternalEncoderBase64.prototype.write=function(h){var p=(h=this.prevStr+h).length-h.length%4;return this.prevStr=h.slice(p),h=h.slice(0,p),t.from(h,"base64")},InternalEncoderBase64.prototype.end=function(){return t.from(this.prevStr,"base64")},InternalEncoderCesu8.prototype.write=function(h){for(var p=t.alloc(3*h.length),x=0,M=0;M<h.length;M++){var k=h.charCodeAt(M);k<128?p[x++]=k:k<2048?(p[x++]=192+(k>>>6),p[x++]=128+(63&k)):(p[x++]=224+(k>>>12),p[x++]=128+(k>>>6&63),p[x++]=128+(63&k))}return p.slice(0,x)},InternalEncoderCesu8.prototype.end=function(){},InternalDecoderCesu8.prototype.write=function(t){for(var h=this.acc,p=this.contBytes,x=this.accBytes,M="",k=0;k<t.length;k++){var I=t[k];128!=(192&I)?(p>0&&(M+=this.defaultCharUnicode,p=0),I<128?M+=String.fromCharCode(I):I<224?(h=31&I,p=1,x=1):I<240?(h=15&I,p=2,x=1):M+=this.defaultCharUnicode):p>0?(h=h<<6|63&I,x++,0===--p&&(M+=2===x&&h<128&&h>0||3===x&&h<2048?this.defaultCharUnicode:String.fromCharCode(h))):M+=this.defaultCharUnicode}return this.acc=h,this.contBytes=p,this.accBytes=x,M},InternalDecoderCesu8.prototype.end=function(){var t=0;return this.contBytes>0&&(t+=this.defaultCharUnicode),t},be}var Ce,Se={};function requireUtf32(){if(Ce)return Se;Ce=1;var t=me.Buffer;function Utf32Codec(t,h){this.iconv=h,this.bomAware=!0,this.isLE=t.isLE}function Utf32Encoder(t,h){this.isLE=h.isLE,this.highSurrogate=0}function Utf32Decoder(t,h){this.isLE=h.isLE,this.badChar=h.iconv.defaultCharUnicode.charCodeAt(0),this.overflow=[]}function _writeCodepoint(t,h,p,x){if((p<0||p>1114111)&&(p=x),p>=65536){var M=55296|(p-=65536)>>10;t[h++]=255&M,t[h++]=M>>8;p=56320|1023&p}return t[h++]=255&p,t[h++]=p>>8,h}function Utf32AutoCodec(t,h){this.iconv=h}function Utf32AutoEncoder(t,h){void 0===(t=t||{}).addBOM&&(t.addBOM=!0),this.encoder=h.iconv.getEncoder(t.defaultEncoding||"utf-32le",t)}function Utf32AutoDecoder(t,h){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=t||{},this.iconv=h.iconv}function detectEncoding(t,h){var p=[],x=0,M=0,k=0,I=0,N=0;e:for(var V=0;V<t.length;V++)for(var ee=t[V],te=0;te<ee.length;te++)if(p.push(ee[te]),4===p.length){if(0===x){if(255===p[0]&&254===p[1]&&0===p[2]&&0===p[3])return"utf-32le";if(0===p[0]&&0===p[1]&&254===p[2]&&255===p[3])return"utf-32be"}if((0!==p[0]||p[1]>16)&&k++,(0!==p[3]||p[2]>16)&&M++,0!==p[0]||0!==p[1]||0===p[2]&&0===p[3]||N++,0===p[0]&&0===p[1]||0!==p[2]||0!==p[3]||I++,p.length=0,++x>=100)break e}return N-k>I-M?"utf-32be":N-k<I-M?"utf-32le":h||"utf-32le"}return Se._utf32=Utf32Codec,Se.utf32le={type:"_utf32",isLE:!0},Se.utf32be={type:"_utf32",isLE:!1},Se.ucs4le="utf32le",Se.ucs4be="utf32be",Utf32Codec.prototype.encoder=Utf32Encoder,Utf32Codec.prototype.decoder=Utf32Decoder,Utf32Encoder.prototype.write=function(h){for(var p=t.from(h,"ucs2"),x=t.alloc(2*p.length),M=this.isLE?x.writeUInt32LE:x.writeUInt32BE,k=0,I=0;I<p.length;I+=2){var N=p.readUInt16LE(I),V=55296<=N&&N<56320,ee=56320<=N&&N<57344;if(this.highSurrogate){if(!V&&ee){var te=65536+(this.highSurrogate-55296<<10|N-56320);M.call(x,te,k),k+=4,this.highSurrogate=0;continue}M.call(x,this.highSurrogate,k),k+=4}V?this.highSurrogate=N:(M.call(x,N,k),k+=4,this.highSurrogate=0)}return k<x.length&&(x=x.slice(0,k)),x},Utf32Encoder.prototype.end=function(){if(this.highSurrogate){var h=t.alloc(4);return this.isLE?h.writeUInt32LE(this.highSurrogate,0):h.writeUInt32BE(this.highSurrogate,0),this.highSurrogate=0,h}},Utf32Decoder.prototype.write=function(h){if(0===h.length)return"";var p=0,x=0,M=t.alloc(h.length+4),k=0,I=this.isLE,N=this.overflow,V=this.badChar;if(N.length>0){for(;p<h.length&&N.length<4;p++)N.push(h[p]);4===N.length&&(x=I?N[p]|N[p+1]<<8|N[p+2]<<16|N[p+3]<<24:N[p+3]|N[p+2]<<8|N[p+1]<<16|N[p]<<24,N.length=0,k=_writeCodepoint(M,k,x,V))}for(;p<h.length-3;p+=4)k=_writeCodepoint(M,k,x=I?h[p]|h[p+1]<<8|h[p+2]<<16|h[p+3]<<24:h[p+3]|h[p+2]<<8|h[p+1]<<16|h[p]<<24,V);for(;p<h.length;p++)N.push(h[p]);return M.slice(0,k).toString("ucs2")},Utf32Decoder.prototype.end=function(){this.overflow.length=0},Se.utf32=Utf32AutoCodec,Se.ucs4="utf32",Utf32AutoCodec.prototype.encoder=Utf32AutoEncoder,Utf32AutoCodec.prototype.decoder=Utf32AutoDecoder,Utf32AutoEncoder.prototype.write=function(t){return this.encoder.write(t)},Utf32AutoEncoder.prototype.end=function(){return this.encoder.end()},Utf32AutoDecoder.prototype.write=function(t){if(!this.decoder){if(this.initialBufs.push(t),this.initialBufsLen+=t.length,this.initialBufsLen<32)return"";var h=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(h,this.options);for(var p="",x=0;x<this.initialBufs.length;x++)p+=this.decoder.write(this.initialBufs[x]);return this.initialBufs.length=this.initialBufsLen=0,p}return this.decoder.write(t)},Utf32AutoDecoder.prototype.end=function(){if(!this.decoder){var t=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options);for(var h="",p=0;p<this.initialBufs.length;p++)h+=this.decoder.write(this.initialBufs[p]);var x=this.decoder.end();return x&&(h+=x),this.initialBufs.length=this.initialBufsLen=0,h}return this.decoder.end()},Se}var Te,Ae={};function requireUtf16(){if(Te)return Ae;Te=1;var t=me.Buffer;function Utf16BECodec(){}function Utf16BEEncoder(){}function Utf16BEDecoder(){this.overflowByte=-1}function Utf16Codec(t,h){this.iconv=h}function Utf16Encoder(t,h){void 0===(t=t||{}).addBOM&&(t.addBOM=!0),this.encoder=h.iconv.getEncoder("utf-16le",t)}function Utf16Decoder(t,h){this.decoder=null,this.initialBufs=[],this.initialBufsLen=0,this.options=t||{},this.iconv=h.iconv}function detectEncoding(t,h){var p=[],x=0,M=0,k=0;e:for(var I=0;I<t.length;I++)for(var N=t[I],V=0;V<N.length;V++)if(p.push(N[V]),2===p.length){if(0===x){if(255===p[0]&&254===p[1])return"utf-16le";if(254===p[0]&&255===p[1])return"utf-16be"}if(0===p[0]&&0!==p[1]&&k++,0!==p[0]&&0===p[1]&&M++,p.length=0,++x>=100)break e}return k>M?"utf-16be":k<M?"utf-16le":h||"utf-16le"}return Ae.utf16be=Utf16BECodec,Utf16BECodec.prototype.encoder=Utf16BEEncoder,Utf16BECodec.prototype.decoder=Utf16BEDecoder,Utf16BECodec.prototype.bomAware=!0,Utf16BEEncoder.prototype.write=function(h){for(var p=t.from(h,"ucs2"),x=0;x<p.length;x+=2){var M=p[x];p[x]=p[x+1],p[x+1]=M}return p},Utf16BEEncoder.prototype.end=function(){},Utf16BEDecoder.prototype.write=function(h){if(0==h.length)return"";var p=t.alloc(h.length+1),x=0,M=0;for(-1!==this.overflowByte&&(p[0]=h[0],p[1]=this.overflowByte,x=1,M=2);x<h.length-1;x+=2,M+=2)p[M]=h[x+1],p[M+1]=h[x];return this.overflowByte=x==h.length-1?h[h.length-1]:-1,p.slice(0,M).toString("ucs2")},Utf16BEDecoder.prototype.end=function(){this.overflowByte=-1},Ae.utf16=Utf16Codec,Utf16Codec.prototype.encoder=Utf16Encoder,Utf16Codec.prototype.decoder=Utf16Decoder,Utf16Encoder.prototype.write=function(t){return this.encoder.write(t)},Utf16Encoder.prototype.end=function(){return this.encoder.end()},Utf16Decoder.prototype.write=function(t){if(!this.decoder){if(this.initialBufs.push(t),this.initialBufsLen+=t.length,this.initialBufsLen<16)return"";var h=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(h,this.options);for(var p="",x=0;x<this.initialBufs.length;x++)p+=this.decoder.write(this.initialBufs[x]);return this.initialBufs.length=this.initialBufsLen=0,p}return this.decoder.write(t)},Utf16Decoder.prototype.end=function(){if(!this.decoder){var t=detectEncoding(this.initialBufs,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(t,this.options);for(var h="",p=0;p<this.initialBufs.length;p++)h+=this.decoder.write(this.initialBufs[p]);var x=this.decoder.end();return x&&(h+=x),this.initialBufs.length=this.initialBufsLen=0,h}return this.decoder.end()},Ae}var De,ke={};function requireUtf7(){if(De)return ke;De=1;var t=me.Buffer;function Utf7Codec(t,h){this.iconv=h}ke.utf7=Utf7Codec,ke.unicode11utf7="utf7",Utf7Codec.prototype.encoder=Utf7Encoder,Utf7Codec.prototype.decoder=Utf7Decoder,Utf7Codec.prototype.bomAware=!0;var h=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function Utf7Encoder(t,h){this.iconv=h.iconv}function Utf7Decoder(t,h){this.iconv=h.iconv,this.inBase64=!1,this.base64Accum=""}Utf7Encoder.prototype.write=function(p){return t.from(p.replace(h,function(t){return"+"+("+"===t?"":this.iconv.encode(t,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},Utf7Encoder.prototype.end=function(){};for(var p=/[A-Za-z0-9\/+]/,x=[],M=0;M<256;M++)x[M]=p.test(String.fromCharCode(M));var k="+".charCodeAt(0),I="-".charCodeAt(0),N="&".charCodeAt(0);function Utf7IMAPCodec(t,h){this.iconv=h}function Utf7IMAPEncoder(h,p){this.iconv=p.iconv,this.inBase64=!1,this.base64Accum=t.alloc(6),this.base64AccumIdx=0}function Utf7IMAPDecoder(t,h){this.iconv=h.iconv,this.inBase64=!1,this.base64Accum=""}Utf7Decoder.prototype.write=function(h){for(var p="",M=0,N=this.inBase64,V=this.base64Accum,ee=0;ee<h.length;ee++)if(N){if(!x[h[ee]]){if(ee==M&&h[ee]==I)p+="+";else{var te=V+this.iconv.decode(h.slice(M,ee),"ascii");p+=this.iconv.decode(t.from(te,"base64"),"utf16-be")}h[ee]!=I&&ee--,M=ee+1,N=!1,V=""}}else h[ee]==k&&(p+=this.iconv.decode(h.slice(M,ee),"ascii"),M=ee+1,N=!0);if(N){var re=(te=V+this.iconv.decode(h.slice(M),"ascii")).length-te.length%8;V=te.slice(re),te=te.slice(0,re),p+=this.iconv.decode(t.from(te,"base64"),"utf16-be")}else p+=this.iconv.decode(h.slice(M),"ascii");return this.inBase64=N,this.base64Accum=V,p},Utf7Decoder.prototype.end=function(){var h="";return this.inBase64&&this.base64Accum.length>0&&(h=this.iconv.decode(t.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",h},ke.utf7imap=Utf7IMAPCodec,Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder,Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder,Utf7IMAPCodec.prototype.bomAware=!0,Utf7IMAPEncoder.prototype.write=function(h){for(var p=this.inBase64,x=this.base64Accum,M=this.base64AccumIdx,k=t.alloc(5*h.length+10),V=0,ee=0;ee<h.length;ee++){var te=h.charCodeAt(ee);32<=te&&te<=126?(p&&(M>0&&(V+=k.write(x.slice(0,M).toString("base64").replace(/\//g,",").replace(/=+$/,""),V),M=0),k[V++]=I,p=!1),p||(k[V++]=te,te===N&&(k[V++]=I))):(p||(k[V++]=N,p=!0),p&&(x[M++]=te>>8,x[M++]=255&te,M==x.length&&(V+=k.write(x.toString("base64").replace(/\//g,","),V),M=0)))}return this.inBase64=p,this.base64AccumIdx=M,k.slice(0,V)},Utf7IMAPEncoder.prototype.end=function(){var h=t.alloc(10),p=0;return this.inBase64&&(this.base64AccumIdx>0&&(p+=h.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),p),this.base64AccumIdx=0),h[p++]=I,this.inBase64=!1),h.slice(0,p)};var V=x.slice();return V[",".charCodeAt(0)]=!0,Utf7IMAPDecoder.prototype.write=function(h){for(var p="",x=0,M=this.inBase64,k=this.base64Accum,ee=0;ee<h.length;ee++)if(M){if(!V[h[ee]]){if(ee==x&&h[ee]==I)p+="&";else{var te=k+this.iconv.decode(h.slice(x,ee),"ascii").replace(/,/g,"/");p+=this.iconv.decode(t.from(te,"base64"),"utf16-be")}h[ee]!=I&&ee--,x=ee+1,M=!1,k=""}}else h[ee]==N&&(p+=this.iconv.decode(h.slice(x,ee),"ascii"),x=ee+1,M=!0);if(M){var re=(te=k+this.iconv.decode(h.slice(x),"ascii").replace(/,/g,"/")).length-te.length%8;k=te.slice(re),te=te.slice(0,re),p+=this.iconv.decode(t.from(te,"base64"),"utf16-be")}else p+=this.iconv.decode(h.slice(x),"ascii");return this.inBase64=M,this.base64Accum=k,p},Utf7IMAPDecoder.prototype.end=function(){var h="";return this.inBase64&&this.base64Accum.length>0&&(h=this.iconv.decode(t.from(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",h},ke}var Le,Ee,Ie,Be,Oe,Re={};function requireSbcsCodec(){if(Le)return Re;Le=1;var t=me.Buffer;function SBCSCodec(h,p){if(!h)throw new Error("SBCS codec is called without the data.");if(!h.chars||128!==h.chars.length&&256!==h.chars.length)throw new Error("Encoding '"+h.type+"' has incorrect 'chars' (must be of len 128 or 256)");if(128===h.chars.length){for(var x="",M=0;M<128;M++)x+=String.fromCharCode(M);h.chars=x+h.chars}this.decodeBuf=t.from(h.chars,"ucs2");var k=t.alloc(65536,p.defaultCharSingleByte.charCodeAt(0));for(M=0;M<h.chars.length;M++)k[h.chars.charCodeAt(M)]=M;this.encodeBuf=k}function SBCSEncoder(t,h){this.encodeBuf=h.encodeBuf}function SBCSDecoder(t,h){this.decodeBuf=h.decodeBuf}return Re._sbcs=SBCSCodec,SBCSCodec.prototype.encoder=SBCSEncoder,SBCSCodec.prototype.decoder=SBCSDecoder,SBCSEncoder.prototype.write=function(h){for(var p=t.alloc(h.length),x=0;x<h.length;x++)p[x]=this.encodeBuf[h.charCodeAt(x)];return p},SBCSEncoder.prototype.end=function(){},SBCSDecoder.prototype.write=function(h){for(var p=this.decodeBuf,x=t.alloc(2*h.length),M=0,k=0,I=0;I<h.length;I++)M=2*h[I],x[k=2*I]=p[M],x[k+1]=p[M+1];return x.toString("ucs2")},SBCSDecoder.prototype.end=function(){},Re}var Fe,Ne={};function requireDbcsCodec(){if(Fe)return Ne;Fe=1;var t=me.Buffer;Ne._dbcs=DBCSCodec;for(var h=-1,p=-2,x=-10,M=-1e3,k=new Array(256),I=0;I<256;I++)k[I]=h;function DBCSCodec(t,x){if(this.encodingName=t.encodingName,!t)throw new Error("DBCS codec is called without the data.");if(!t.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var I=t.table();this.decodeTables=[],this.decodeTables[0]=k.slice(0),this.decodeTableSeq=[];for(var N=0;N<I.length;N++)this._addDecodeChunk(I[N]);if("function"==typeof t.gb18030){this.gb18030=t.gb18030();var V=this.decodeTables.length;this.decodeTables.push(k.slice(0));var ee=this.decodeTables.length;this.decodeTables.push(k.slice(0));var te=this.decodeTables[0];for(N=129;N<=254;N++)for(var re=this.decodeTables[M-te[N]],ne=48;ne<=57;ne++){if(re[ne]===h)re[ne]=M-V;else if(re[ne]>M)throw new Error("gb18030 decode tables conflict at byte 2");for(var ie=this.decodeTables[M-re[ne]],ae=129;ae<=254;ae++){if(ie[ae]===h)ie[ae]=M-ee;else{if(ie[ae]===M-ee)continue;if(ie[ae]>M)throw new Error("gb18030 decode tables conflict at byte 3")}for(var oe=this.decodeTables[M-ie[ae]],se=48;se<=57;se++)oe[se]===h&&(oe[se]=p)}}}this.defaultCharUnicode=x.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var ce={};if(t.encodeSkipVals)for(N=0;N<t.encodeSkipVals.length;N++){var ue=t.encodeSkipVals[N];if("number"==typeof ue)ce[ue]=!0;else for(ne=ue.from;ne<=ue.to;ne++)ce[ne]=!0}if(this._fillEncodeTable(0,0,ce),t.encodeAdd)for(var le in t.encodeAdd)Object.prototype.hasOwnProperty.call(t.encodeAdd,le)&&this._setEncodeChar(le.charCodeAt(0),t.encodeAdd[le]);this.defCharSB=this.encodeTable[0][x.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===h&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===h&&(this.defCharSB="?".charCodeAt(0))}function DBCSEncoder(t,h){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=h.encodeTable,this.encodeTableSeq=h.encodeTableSeq,this.defaultCharSingleByte=h.defCharSB,this.gb18030=h.gb18030}function DBCSDecoder(t,h){this.nodeIdx=0,this.prevBytes=[],this.decodeTables=h.decodeTables,this.decodeTableSeq=h.decodeTableSeq,this.defaultCharUnicode=h.defaultCharUnicode,this.gb18030=h.gb18030}function findIdx(t,h){if(t[0]>h)return-1;for(var p=0,x=t.length;p<x-1;){var M=p+(x-p+1>>1);t[M]<=h?p=M:x=M}return p}return DBCSCodec.prototype.encoder=DBCSEncoder,DBCSCodec.prototype.decoder=DBCSDecoder,DBCSCodec.prototype._getDecodeTrieNode=function(t){for(var p=[];t>0;t>>>=8)p.push(255&t);0==p.length&&p.push(0);for(var x=this.decodeTables[0],I=p.length-1;I>0;I--){var N=x[p[I]];if(N==h)x[p[I]]=M-this.decodeTables.length,this.decodeTables.push(x=k.slice(0));else{if(!(N<=M))throw new Error("Overwrite byte in "+this.encodingName+", addr: "+t.toString(16));x=this.decodeTables[M-N]}}return x},DBCSCodec.prototype._addDecodeChunk=function(t){var h=parseInt(t[0],16),p=this._getDecodeTrieNode(h);h&=255;for(var M=1;M<t.length;M++){var k=t[M];if("string"==typeof k)for(var I=0;I<k.length;){var N=k.charCodeAt(I++);if(55296<=N&&N<56320){var V=k.charCodeAt(I++);if(!(56320<=V&&V<57344))throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+t[0]);p[h++]=65536+1024*(N-55296)+(V-56320)}else if(4080<N&&N<=4095){for(var ee=4095-N+2,te=[],re=0;re<ee;re++)te.push(k.charCodeAt(I++));p[h++]=x-this.decodeTableSeq.length,this.decodeTableSeq.push(te)}else p[h++]=N}else{if("number"!=typeof k)throw new Error("Incorrect type '"+typeof k+"' given in "+this.encodingName+" at chunk "+t[0]);var ne=p[h-1]+1;for(I=0;I<k;I++)p[h++]=ne++}}if(h>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+t[0]+": too long"+h)},DBCSCodec.prototype._getEncodeBucket=function(t){var h=t>>8;return void 0===this.encodeTable[h]&&(this.encodeTable[h]=k.slice(0)),this.encodeTable[h]},DBCSCodec.prototype._setEncodeChar=function(t,p){var M=this._getEncodeBucket(t),k=255&t;M[k]<=x?this.encodeTableSeq[x-M[k]][-1]=p:M[k]==h&&(M[k]=p)},DBCSCodec.prototype._setEncodeSequence=function(t,p){var M,k=t[0],I=this._getEncodeBucket(k),N=255&k;I[N]<=x?M=this.encodeTableSeq[x-I[N]]:(M={},I[N]!==h&&(M[-1]=I[N]),I[N]=x-this.encodeTableSeq.length,this.encodeTableSeq.push(M));for(var V=1;V<t.length-1;V++){var ee=M[k];"object"==typeof ee?M=ee:(M=M[k]={},void 0!==ee&&(M[-1]=ee))}M[k=t[t.length-1]]=p},DBCSCodec.prototype._fillEncodeTable=function(t,h,p){for(var k=this.decodeTables[t],I=!1,N={},V=0;V<256;V++){var ee=k[V],te=h+V;if(!p[te])if(ee>=0)this._setEncodeChar(ee,te),I=!0;else if(ee<=M){var re=M-ee;if(!N[re]){var ne=te<<8>>>0;this._fillEncodeTable(re,ne,p)?I=!0:N[re]=!0}}else ee<=x&&(this._setEncodeSequence(this.decodeTableSeq[x-ee],te),I=!0)}return I},DBCSEncoder.prototype.write=function(p){for(var M=t.alloc(p.length*(this.gb18030?4:3)),k=this.leadSurrogate,I=this.seqObj,N=-1,V=0,ee=0;;){if(-1===N){if(V==p.length)break;var te=p.charCodeAt(V++)}else{te=N;N=-1}if(55296<=te&&te<57344)if(te<56320){if(-1===k){k=te;continue}k=te,te=h}else-1!==k?(te=65536+1024*(k-55296)+(te-56320),k=-1):te=h;else-1!==k&&(N=te,te=h,k=-1);var re=h;if(void 0!==I&&te!=h){var ne=I[te];if("object"==typeof ne){I=ne;continue}"number"==typeof ne?re=ne:null==ne&&void 0!==(ne=I[-1])&&(re=ne,N=te),I=void 0}else if(te>=0){var ie=this.encodeTable[te>>8];if(void 0!==ie&&(re=ie[255&te]),re<=x){I=this.encodeTableSeq[x-re];continue}if(re==h&&this.gb18030){var ae=findIdx(this.gb18030.uChars,te);if(-1!=ae){re=this.gb18030.gbChars[ae]+(te-this.gb18030.uChars[ae]);M[ee++]=129+Math.floor(re/12600),re%=12600,M[ee++]=48+Math.floor(re/1260),re%=1260,M[ee++]=129+Math.floor(re/10),re%=10,M[ee++]=48+re;continue}}}re===h&&(re=this.defaultCharSingleByte),re<256?M[ee++]=re:re<65536?(M[ee++]=re>>8,M[ee++]=255&re):re<16777216?(M[ee++]=re>>16,M[ee++]=re>>8&255,M[ee++]=255&re):(M[ee++]=re>>>24,M[ee++]=re>>>16&255,M[ee++]=re>>>8&255,M[ee++]=255&re)}return this.seqObj=I,this.leadSurrogate=k,M.slice(0,ee)},DBCSEncoder.prototype.end=function(){if(-1!==this.leadSurrogate||void 0!==this.seqObj){var h=t.alloc(10),p=0;if(this.seqObj){var x=this.seqObj[-1];void 0!==x&&(x<256?h[p++]=x:(h[p++]=x>>8,h[p++]=255&x)),this.seqObj=void 0}return-1!==this.leadSurrogate&&(h[p++]=this.defaultCharSingleByte,this.leadSurrogate=-1),h.slice(0,p)}},DBCSEncoder.prototype.findIdx=findIdx,DBCSDecoder.prototype.write=function(k){for(var I=t.alloc(2*k.length),N=this.nodeIdx,V=this.prevBytes,ee=this.prevBytes.length,te=-this.prevBytes.length,re=0,ne=0;re<k.length;re++){var ie,ae=re>=0?k[re]:V[re+ee];if((ie=this.decodeTables[N][ae])>=0);else if(ie===h)ie=this.defaultCharUnicode.charCodeAt(0),re=te;else if(ie===p){if(re>=3)var oe=12600*(k[re-3]-129)+1260*(k[re-2]-48)+10*(k[re-1]-129)+(ae-48);else oe=12600*(V[re-3+ee]-129)+1260*((re-2>=0?k[re-2]:V[re-2+ee])-48)+10*((re-1>=0?k[re-1]:V[re-1+ee])-129)+(ae-48);var se=findIdx(this.gb18030.gbChars,oe);ie=this.gb18030.uChars[se]+oe-this.gb18030.gbChars[se]}else{if(ie<=M){N=M-ie;continue}if(!(ie<=x))throw new Error("iconv-lite internal error: invalid decoding table value "+ie+" at "+N+"/"+ae);for(var ce=this.decodeTableSeq[x-ie],ue=0;ue<ce.length-1;ue++)ie=ce[ue],I[ne++]=255&ie,I[ne++]=ie>>8;ie=ce[ce.length-1]}if(ie>=65536){var le=55296|(ie-=65536)>>10;I[ne++]=255&le,I[ne++]=le>>8,ie=56320|1023&ie}I[ne++]=255&ie,I[ne++]=ie>>8,N=0,te=re+1}return this.nodeIdx=N,this.prevBytes=te>=0?Array.prototype.slice.call(k,te):V.slice(te+ee).concat(Array.prototype.slice.call(k)),I.slice(0,ne).toString("ucs2")},DBCSDecoder.prototype.end=function(){for(var t="";this.prevBytes.length>0;){t+=this.defaultCharUnicode;var h=this.prevBytes.slice(1);this.prevBytes=[],this.nodeIdx=0,h.length>0&&(t+=this.write(h))}return this.prevBytes=[],this.nodeIdx=0,t},Ne}const Ve=[["0","\0",128],["a1","",62],["8140","",9,""],["8180",""],["81b8",""],["81c8",""],["81da",""],["81f0",""],["81fc",""],["824f","",9],["8260","",25],["8281","",25],["829f","",82],["8340","",62],["8380","",22],["839f","",16,"",6],["83bf","",16,"",6],["8440","",5,"",25],["8470","",5,"",7],["8480","",17],["849f",""],["8740","",19,"",9],["875f",""],["877e",""],["8780","",4,""],["889f",""],["8940",""],["8980",""],["8a40",""],["8a80",""],["8b40",""],["8b80",""],["8c40",""],["8c80",""],["8d40",""],["8d80",""],["8e40",""],["8e80",""],["8f40",""],["8f80",""],["9040",""],["9080",""],["9140",""],["9180",""],["9240",""],["9280",""],["9340",""],["9380",""],["9440",""],["9480",""],["9540",""],["9580",""],["9640",""],["9680",""],["9740",""],["9780",""],["9840",""],["989f",""],["9940",""],["9980",""],["9a40",""],["9a80",""],["9b40",""],["9b80",""],["9c40",""],["9c80",""],["9d40",""],["9d80",""],["9e40",""],["9e80",""],["9f40",""],["9f80",""],["e040",""],["e080",""],["e140",""],["e180",""],["e240",""],["e280",""],["e340",""],["e380",""],["e440",""],["e480",""],["e540",""],["e580",""],["e640",""],["e680",""],["e740",""],["e780",""],["e840",""],["e880",""],["e940",""],["e980",""],["ea40",""],["ea80",""],["ed40",""],["ed80",""],["ee40",""],["ee80",""],["eeef","",9,""],["f040","",62],["f080","",124],["f140","",62],["f180","",124],["f240","",62],["f280","",124],["f340","",62],["f380","",124],["f440","",62],["f480","",124],["f540","",62],["f580","",124],["f640","",62],["f680","",124],["f740","",62],["f780","",124],["f840","",62],["f880","",124],["f940",""],["fa40","",9,"",9,""],["fa80",""],["fb40",""],["fb80",""],["fc40",""]],Ge=[["0","\0",127],["8ea1","",62],["a1a1","",9,""],["a2a1",""],["a2ba",""],["a2ca",""],["a2dc",""],["a2f2",""],["a2fe",""],["a3b0","",9],["a3c1","",25],["a3e1","",25],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a7a1","",5,"",25],["a7d1","",5,"",25],["a8a1",""],["ada1","",19,"",9],["adc0",""],["addf","",4,""],["b0a1",""],["b1a1",""],["b2a1",""],["b3a1",""],["b4a1",""],["b5a1",""],["b6a1",""],["b7a1",""],["b8a1",""],["b9a1",""],["baa1",""],["bba1",""],["bca1",""],["bda1",""],["bea1",""],["bfa1",""],["c0a1",""],["c1a1",""],["c2a1",""],["c3a1",""],["c4a1",""],["c5a1",""],["c6a1",""],["c7a1",""],["c8a1",""],["c9a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1",""],["d2a1",""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fcf1","",9,""],["8fa2af",""],["8fa2c2",""],["8fa2eb",""],["8fa6e1",""],["8fa6e7",""],["8fa6e9",""],["8fa6ec",""],["8fa6f1",""],["8fa7c2","",10,""],["8fa7f2","",10,""],["8fa9a1",""],["8fa9a4",""],["8fa9a6",""],["8fa9a8",""],["8fa9ab",""],["8fa9af",""],["8fa9c1",""],["8faaa1",""],["8faaba",""],["8faba1",""],["8fabbd",""],["8fabc5",""],["8fb0a1",""],["8fb1a1",""],["8fb2a1","",4,""],["8fb3a1",""],["8fb4a1",""],["8fb5a1",""],["8fb6a1","",5,"",4,""],["8fb7a1","",4,""],["8fb8a1",""],["8fb9a1",""],["8fbaa1","",4,""],["8fbba1",""],["8fbca1","",4,""],["8fbda1","",4,""],["8fbea1","",4,""],["8fbfa1",""],["8fc0a1",""],["8fc1a1",""],["8fc2a1",""],["8fc3a1","",4,""],["8fc4a1",""],["8fc5a1",""],["8fc6a1",""],["8fc7a1",""],["8fc8a1",""],["8fc9a1","",4,"",4,""],["8fcaa1",""],["8fcba1",""],["8fcca1","",9,""],["8fcda1","",5,""],["8fcea1","",6,""],["8fcfa1",""],["8fd0a1",""],["8fd1a1",""],["8fd2a1","",5],["8fd3a1",""],["8fd4a1","",4,""],["8fd5a1",""],["8fd6a1",""],["8fd7a1",""],["8fd8a1",""],["8fd9a1","",4,"",6,""],["8fdaa1","",4,""],["8fdba1","",6,""],["8fdca1","",4,""],["8fdda1","",4,""],["8fdea1","",4,""],["8fdfa1",""],["8fe0a1",""],["8fe1a1","",4,""],["8fe2a1",""],["8fe3a1","",5,"",4,""],["8fe4a1","",4,""],["8fe5a1","",4,""],["8fe6a1",""],["8fe7a1",""],["8fe8a1","",4,""],["8fe9a1","",4],["8feaa1","",4,""],["8feba1","",4,""],["8feca1",""],["8feda1","",4,"",4,""]],je=[["0","\0",127,""],["8140","",5,"",9,"",6,""],["8180","",6,"",4,"",4,"",5,""],["8240","",4,"",8,"",4,"",11],["8280","",10,"",4,"",7,"",5,"",8,"",20,"",4,"",6,""],["8340","",17,"",5,"",10,"",4,"",9,""],["8380","",5,"",13,"",28,"",4,"",4,"",5],["8440","",5,"",5,""],["8480","",9,"",4,"",6,"",6,"",9,"",5,"",10,"",7,""],["8540","",9,""],["8580","",4,"",6,"",4,"",4,"",7,""],["8640","",4,"",5,"",4,"",5,""],["8680","",4,"",4,"",5,"",6,"",8,"",4,"",4,"",4,""],["8740","",7,"",11,"",4,"",4],["8780","",7,"",6,"",14,"",10,"",6,"",12,"",8,"",5,"",6],["8840","",9,"",4,"",4,""],["8880","",4,"",6,"",8,"",6,"",7,"",4,"",4,"",7],["8940","",5,"",6,"",4,"",5,"",4,"",16,""],["8980","",4,"",4,"",7,"",17,"",10,"",13,"",5,"",7,"",4,""],["8a40","",4,"",12,""],["8a80","",5,"",6,"",4,"",11,"",6,"",4,"",4,"",9,"",5],["8b40","",8,"",17,"",6,"",13,""],["8b80","",4,"",4,"",5,"",4,"",4,"",22,"",11,"",25,"",7,"",6],["8c40","",7,""],["8c80","",8,"",4,"",6,"",6,"",6,"",4,"",4,"",4],["8d40","",5,"",5,"",5,"",6,"",9,"",4],["8d80","",5,"",4,"",4,"",4,"",7,"",7,"",10,"",10,"",12,"",21,""],["8e40","",21,"",12,"",6,"",12,""],["8e80","",4,"",7,"",4,"",4,"",5,"",6,"",4,"",14,"",4,"",4,"",6],["8f40","",5,"",11,"",8,""],["8f80","",6,"",14,"",5,"",5,"",4,""],["9040","",4,"",4,"",6,""],["9080","",7,"",4,"",4,"",4,"",4,"",18,"",6],["9140","",6,"",6,"",18,"",4,""],["9180","",6,"",8,"",9,"",5,"",4,"",4,"",16,"",13,"",8,"",5,"",4,""],["9240","",6,"",5,""],["9280","",5,"",7,"",6,""],["9340","",6,"",4,"",4,"",5,""],["9380","",5,"",4,"",6,"",4,"",7,"",9,"",6,"",8,"",4,"",6,""],["9440","",24,"",7,"",7,"",4,"",8],["9480","",4,"",4,"",14,"",7,"",7,""],["9540","",4,"",4,"",6,""],["9580","",4,"",4,"",8,"",4,"",4,"",25,"",7,"",5,""],["9640","",5,"",4,""],["9680","",7,"",9,"",7,"",4,"",6,"",6,"",5],["9740","",7,"",8,"",7,"",9,""],["9780","",6,"",5,"",4,"",9,"",4,"",11,"",7,"",16,""],["9840","",4,"",5,"",9,""],["9880","",7,"",5,"",11,"",9,"",9,"",11,"",5,"",5,"",6,"",4,"",7,"",6,""],["9940","",4,"",10,"",6,"",8,"",4,"",7,"",5],["9980","",114,"",6],["9a40","",11,"",7,"",13,""],["9a80","",4,"",7,"",7,"",6,"",4,"",4,"",7,"",6,"",4,"",4,""],["9b40","",4,""],["9b80","",5,"",4,"",4,"",5,""],["9c40","",7,""],["9c80","",7,"",7,"",10,"",14,"",4,"",6,"",5],["9d40","",7,"",4,"",9,"",6,""],["9d80","",9,"",5,"",6,"",12,"",4,"",10,"",5,"",5,"",6,"",10,""],["9e40","",7,"",32,"",7,"",6,"",6],["9e80","",9,"",17,"",13,"",11,"",12,"",12,""],["9f40","",6,"",10,"",4,"",10,"",7,""],["9f80","",13,"",12,"",4,"",4,"",5,"",4,"",4,"",6,"",5,"",8,"",9,"",4],["a040","",9,"",5,"",9,"",11,"",19],["a080","",9,"",6,"",4,"",11,"",11,"",6,""],["a1a1","",7,""],["a2a1","",9],["a2b1","",19,"",19,"",9],["a2e5","",9],["a2f1","",11],["a3a1","",88,""],["a4a1","",82],["a5a1","",85],["a6a1","",16,"",6],["a6c1","",16,"",6],["a6e0",""],["a6ee",""],["a6f4",""],["a7a1","",5,"",25],["a7d1","",5,"",25],["a840","",35,"",6],["a880","",7,""],["a8a1",""],["a8bd",""],["a8c0",""],["a8c5","",36],["a940","",8,""],["a959",""],["a95c",""],["a960","",9,"",8],["a980","",4,""],["a996",""],["a9a4","",75],["aa40","",5,"",5,"",8],["aa80","",7,"",10,""],["ab40","",11,"",4,"",5,"",4],["ab80","",6,"",4],["ac40","",10,"",8,"",5,"",4,"",11],["ac80","",6,"",12,"",4,""],["ad40","",10,"",7,"",15,"",12],["ad80","",9,"",8,"",6,""],["ae40","",6,"",7,"",4,""],["ae80","",7,"",6,"",4,""],["af40","",4,""],["af80",""],["b040","",6,"",5,"",4,"",6,"",7,""],["b080","",7,"",8,"",9,""],["b140","",4,"",7,"",10,""],["b180","",4,"",7,"",7,""],["b240","",11,"",5,"",11,"",4],["b280","",12,"",8,"",4,""],["b340","",5,""],["b380","",11,"",7,"",6,""],["b440","",7,"",9],["b480","",4,"",5,"",6,""],["b540","",5,"",9,"",4,"",14,"",4,"",8,""],["b580","",6,"",4,""],["b640","",6,"",11,"",10,"",4,"",5,""],["b680","",6,"",4,""],["b740","",14,"",5,"",9,"",4,"",16],["b780","",6,""],["b840","",4,"",10,"",10,"",9,"",5,""],["b880","",4,""],["b940","",5,"",10,"",6,""],["b980","",7,""],["ba40","",4,"",4,"",7,"",5,""],["ba80","",4,"",5,"",12,"",5,""],["bb40","",9,"",36,"",5,"",9],["bb80","",6,"",4,""],["bc40","",6,"",6,"",5,"",7,"",13,"",5],["bc80","",14,"",6,""],["bd40","",54,"",7],["bd80","",32,""],["be40","",12,"",6,"",42],["be80","",32,""],["bf40","",62],["bf80","",4,"",4,"",21,""],["c040","",35,"",23,""],["c080","",6,"",9,""],["c140","",4,"",7,"",4,"",4,"",6,""],["c180","",4,"",4,"",5,""],["c240","",6,"",5,""],["c280","",13,"",5,"",11,""],["c340","",5,"",4,"",6,""],["c380","",12,"",4,""],["c440","",5,"",4,"",4,"",5,"",4,""],["c480","",7,"",5,"",6,""],["c540","",14,"",4,"",5,"",4,"",5,""],["c580","",7,"",7,""],["c640",""],["c680","",4,"",9,""],["c740","",4,"",4,"",6,"",6,"",6,""],["c780",""],["c840","",4,"",5,"",5,"",7,"",5,"",7,""],["c880","",6,"",4,"",4,""],["c940","",4,"",7,"",12,""],["c980","",4,"",4,"",10,""],["ca40","",8,"",8,"",9,"",4,"",10],["ca80","",4,"",8,""],["cb40","",6,"",10,"",6,"",5,"",6,"",6,"",4,""],["cb80","",5,"",6,"",14,""],["cc40","",4,"",10,"",15,"",13,""],["cc80","",11,"",4,"",7,""],["cd40","",6,"",6,"",4,"",5,"",4,"",4,""],["cd80",""],["ce40","",6,"",5,"",7,""],["ce80","",4,"",6,"",4,""],["cf40","",4,"",4,"",6,"",9],["cf80","",5,"",7,"",4,""],["d040","",13,"",5,"",5,"",5,"",6,""],["d080","",4,"",4,"",5,""],["d140","",4,"",4,"",6,"",5],["d180","",4,"",4,"",4,""],["d240","",8,"",24,"",5,"",19,""],["d280","",26,""],["d340","",30,"",6],["d380","",4,"",5,"",21,""],["d440","",31,"",8,"",21],["d480","",25,"",6,""],["d540","",7,"",7,"",46],["d580","",32,""],["d640","",34,"",27],["d680","",30,""],["d740","",31,"",4,"",25],["d780","",24,""],["d840","",8,"",7,"",5,"",6,"",6,"",6,""],["d880","",6,"",20,""],["d940","",62],["d980","",32,""],["da40","",14,"",8,"",4,"",9,""],["da80","",12,""],["db40","",6,"",7,"",4,""],["db80","",4,"",5,"",11,""],["dc40","",4,"",6,"",6,"",11,"",6,"",7],["dc80","",10,"",21,""],["dd40","",62],["dd80","",32,""],["de40","",32,""],["de80","",4,""],["df40","",5,"",4,"",4,"",5,"",4,"",6,""],["df80","",4,""],["e040","",19,""],["e080","",10,"",6,"",8,""],["e140","",4,"",6,"",5,"",5,""],["e180","",10,"",9,"",8,""],["e240","",62],["e280","",32,"",5,""],["e340","",45,"",16],["e380","",7,"",24,""],["e440","",5,"",24,"",31],["e480","",32,""],["e540","",51,"",10],["e580","",31,""],["e640","",34,"",27],["e680","",29,""],["e740","",7,"",54],["e780","",32,"",6,"",4,""],["e840","",14,"",43,""],["e880","",20,""],["e940","",7,"",42],["e980","",32,""],["ea40","",27,"",6,""],["ea80","",4,"",12,""],["eb40","",9,"",7,"",9,"",6,""],["eb80","",4,""],["ec40","",8,"",4,"",18,"",7],["ec80","",4,"",7,"",4,"",4,""],["ed40","",6,"",46],["ed80","",4,"",23,""],["ee40","",62],["ee80","",32,"",4,"",6,""],["ef40","",5,"",37,"",4],["ef80","",30,"",4,"",8,""],["f040","",4,"",28,"",26],["f080","",9,"",12,"",4,"",6,""],["f140","",10,"",47],["f180","",32,""],["f240","",62],["f280","",32,""],["f340","",17,"",6,"",4,""],["f380","",8,"",6,""],["f440","",5,"",10,"",10,"",7,"",5],["f480","",32,""],["f540","",62],["f580","",32,""],["f640","",62],["f680","",32,"",5,"",5,"",4,"",7,""],["f740","",62],["f780","",4,"",4,""],["f840","",62],["f880","",32],["f940","",62],["f980","",32],["fa40","",62],["fa80","",32],["fb40","",27,"",9,""],["fb80","",5,"",8,"",5,""],["fc40","",8,"",4,"",8,"",6],["fc80","",4,"",5,"",8,""],["fd40","",4,"",4,"",10,"",38],["fd80","",5,"",11,"",4,""],["fe40",""]],Ue=[["a140","",62],["a180","",32],["a240","",62],["a280","",32],["a2ab","",5],["a2e3",""],["a2ef",""],["a2fd",""],["a340","",62],["a380","",31,""],["a440","",62],["a480","",32],["a4f4","",10],["a540","",62],["a580","",32],["a5f7","",7],["a640","",62],["a680","",32],["a6b9","",7],["a6d9","",6],["a6ec",""],["a6f3",""],["a6f6","",8],["a740","",62],["a780","",32],["a7c2","",14],["a7f2","",12],["a896","",10],["a8bc",""],["a8bf",""],["a8c1",""],["a8ea","",20],["a958",""],["a95b",""],["a95d",""],["a989","",11],["a997","",12],["a9f0","",14],["aaa1","",93],["aba1","",93],["aca1","",93],["ada1","",93],["aea1","",93],["afa1","",93],["d7fa","",4],["f8a1","",93],["f9a1","",93],["faa1","",93],["fba1","",93],["fca1","",93],["fda1","",93],["fe50",""],["fe80","",6,"",93],["8135f437",""]],ze={uChars:[128,165,169,178,184,216,226,235,238,244,248,251,253,258,276,284,300,325,329,334,364,463,465,467,469,471,473,475,477,506,594,610,712,716,730,930,938,962,970,1026,1104,1106,8209,8215,8218,8222,8231,8241,8244,8246,8252,8365,8452,8454,8458,8471,8482,8556,8570,8596,8602,8713,8720,8722,8726,8731,8737,8740,8742,8748,8751,8760,8766,8777,8781,8787,8802,8808,8816,8854,8858,8870,8896,8979,9322,9372,9548,9588,9616,9622,9634,9652,9662,9672,9676,9680,9702,9735,9738,9793,9795,11906,11909,11913,11917,11928,11944,11947,11951,11956,11960,11964,11979,12284,12292,12312,12319,12330,12351,12436,12447,12535,12543,12586,12842,12850,12964,13200,13215,13218,13253,13263,13267,13270,13384,13428,13727,13839,13851,14617,14703,14801,14816,14964,15183,15471,15585,16471,16736,17208,17325,17330,17374,17623,17997,18018,18212,18218,18301,18318,18760,18811,18814,18820,18823,18844,18848,18872,19576,19620,19738,19887,40870,59244,59336,59367,59413,59417,59423,59431,59437,59443,59452,59460,59478,59493,63789,63866,63894,63976,63986,64016,64018,64021,64025,64034,64037,64042,65074,65093,65107,65112,65127,65132,65375,65510,65536],gbChars:[0,36,38,45,50,81,89,95,96,100,103,104,105,109,126,133,148,172,175,179,208,306,307,308,309,310,311,312,313,341,428,443,544,545,558,741,742,749,750,805,819,820,7922,7924,7925,7927,7934,7943,7944,7945,7950,8062,8148,8149,8152,8164,8174,8236,8240,8262,8264,8374,8380,8381,8384,8388,8390,8392,8393,8394,8396,8401,8406,8416,8419,8424,8437,8439,8445,8482,8485,8496,8521,8603,8936,8946,9046,9050,9063,9066,9076,9092,9100,9108,9111,9113,9131,9162,9164,9218,9219,11329,11331,11334,11336,11346,11361,11363,11366,11370,11372,11375,11389,11682,11686,11687,11692,11694,11714,11716,11723,11725,11730,11736,11982,11989,12102,12336,12348,12350,12384,12393,12395,12397,12510,12553,12851,12962,12973,13738,13823,13919,13933,14080,14298,14585,14698,15583,15847,16318,16434,16438,16481,16729,17102,17122,17315,17320,17402,17418,17859,17909,17911,17915,17916,17936,17939,17961,18664,18703,18814,18962,19043,33469,33470,33471,33484,33485,33490,33497,33501,33505,33513,33520,33536,33550,37845,37921,37948,38029,38038,38064,38065,38066,38069,38075,38076,38078,39108,39109,39113,39114,39115,39116,39265,39394,189e3]},We=[["0","\0",127],["8141","",4,"",6,""],["8161","",9,"",5,""],["8181","",18,"",4,"",6,"",5,"",6,"",7,"",7,"",4,"",4,""],["8241","",7,"",5],["8261","",6,"",5,""],["8281","",7,"",7,"",4,"",10,"",5,"",17,"",7,"",6,"",7,"",18],["8341","",5,"",5,"",7],["8361","",18,""],["8381","",4,"",6,"",5,"",5,"",46,"",6,"",5,"",8],["8441","",5,"",8],["8461","",18],["8481","",7,"",6,"",5,"",10,"",5,"",18,"",5,"",6,"",5,"",26,""],["8541","",5,"",4,"",6,"",4],["8561","",5,"",5,"",6,""],["8581","",6,"",6,"",9,"",26,"",29,"",6,"",5,""],["8641","",6,"",5,""],["8661","",6,"",10],["8681","",22,"",4,"",6,"",5,"",6,"",22,"",4,""],["8741","",9,"",15],["8761","",18,""],["8781","",5,"",7,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",4],["8841","",4,"",5,"",6,"",4],["8861","",4,""],["8881","",15,"",4,"",6,"",5,"",54,""],["8941","",6,"",5,""],["8961","",10,"",5,""],["8981","",21,"",18,"",18,"",6,"",6,"",7,"",15],["8a41","",10,"",6,""],["8a61","",4,"",18,""],["8a81","",4,"",19,"",5,"",7,"",5,"",6,"",5,"",4,"",5,"",26,""],["8b41","",5,"",4,"",6,""],["8b61","",6,"",8],["8b81","",52,"",4,"",6,"",5,"",18,"",18],["8c41","",15,"",4],["8c61","",6,"",5,"",6,"",5],["8c81","",12,"",26,"",50,"",5,"",16],["8d41","",16,"",8],["8d61","",17,""],["8d81","",4,"",33,"",6,"",7,"",6,"",9,"",6,"",5,"",6,""],["8e41","",6,"",5,"",8],["8e61","",4,"",19],["8e81","",13,"",6,"",4,"",6,"",5,"",6,"",5,"",11,"",7,"",6,"",5,"",7],["8f41","",7,"",17],["8f61","",7,"",6,"",4],["8f81","",5,"",7,"",5,"",6,"",5,"",18,"",6,"",26,"",6,"",5],["9041","",6,"",5,""],["9061","",5,"",15],["9081","",12,"",6,"",5,"",4,"",6,"",4,"",5,"",11,"",33,""],["9141","",6,"",5],["9161","",9,"",5],["9181","",20,"",4,"",5,"",14,"",33,"",7,"",5,"",6],["9241","",7,"",4,""],["9261","",7,"",7,"",4],["9281","",21,"",18,"",6,"",7,"",6,"",35,""],["9341","",4,""],["9361","",6,"",8],["9381","",37,"",4,"",4,"",6,"",5,"",7,"",22,""],["9441","",5,"",5,"",8],["9461","",5,"",6,"",12],["9481","",5,"",6,"",6,"",9,"",22,"",4,"",6,"",10,"",6,"",24],["9541","",11,"",5,""],["9561","",6,"",5,""],["9581","",6,"",35,"",4,"",4,"",4,"",6,"",5,"",13,"",14],["9641","",23,""],["9661","",6,"",5,"",8],["9681","",10,"",5,"",13,"",33,"",6,"",44],["9741","",16,"",8],["9761","",17,"",7],["9781","",11,"",5,"",6,"",89,""],["9841","",16,"",5,""],["9861","",6,"",15],["9881","",21,"",6,"",5,"",4,"",6,"",5,"",6,"",5,"",6,"",5,""],["9941","",6,"",5,""],["9961","",6,"",5,""],["9981","",8,"",5,"",4,"",11,"",5,"",6,"",6,"",6,"",7,"",6,"",5,""],["9a41","",16],["9a61","",6,"",6,""],["9a81","",4,"",6,"",5,"",5,"",6,"",5,"",5,"",33,"",5,"",6,""],["9b41","",6,"",8],["9b61","",17,"",7],["9b81","",25,"",4,"",5,"",50,"",22,""],["9c41","",4,"",5,"",5],["9c61","",8,"",6,"",9],["9c81","",8,"",6,"",6,"",9,"",26,"",6,"",5,"",18,"",6,"",12],["9d41","",13,"",8],["9d61","",25],["9d81","",8,"",5,"",9,"",6,"",10,"",6,"",5,"",6,"",5,""],["9e41","",7,"",9,""],["9e61","",4,"",6,""],["9e81","",6,"",6,"",6,"",5,"",10,"",5,"",6,"",5,"",6,""],["9f41","",5,"",4,"",5,""],["9f61","",6,"",5,""],["9f81","",4,"",5,"",6,"",5,"",6,"",4,"",6,"",7,"",4,"",4,""],["a041","",5,"",6,""],["a061","",5,"",13],["a081","",4,"",4,"",4,"",6,"",5,"",6,"",5,"",26,"",4,"",5,"",7,""],["a141","",18,""],["a161","",6,"",5,""],["a181","",14,"",5,"",4,"",9,""],["a241","",5,"",18],["a261","",6,"",18],["a281","",7,"",6,"",7,""],["a341","",6,"",10,""],["a361","",6,"",16],["a381","",16,"",4,"",58,"",32,""],["a441","",5,""],["a461","",5,"",12],["a481","",28,"",93],["a541","",4,"",6,"",5,""],["a561","",17,"",5,""],["a581","",16,"",14,"",9],["a5b0","",9],["a5c1","",16,"",6],["a5e1","",16,"",6],["a641","",19,""],["a661","",5,"",5,"",6],["a681","",6,"",18,"",7],["a741","",4,"",6,"",7],["a761","",22,""],["a781","",6,"",5,"",7,"",9,"",9,"",4,"",5,"",4,""],["a841","",10,"",14],["a861","",18,"",6],["a881","",19,"",11,""],["a8a6",""],["a8a8",""],["a8b1","",27,"",25,"",14,""],["a941","",14,"",10],["a961","",18],["a981","",14,"",6,"",27,"",25,"",14,""],["aa41","",6,"",4,""],["aa61","",4,"",5,"",6,""],["aa81","",29,"",82],["ab41","",6,"",5,""],["ab61","",6,"",5,"",5],["ab81","",8,"",6,"",12,"",85],["ac41","",5,"",6,""],["ac61","",11,"",4],["ac81","",28,"",5,"",25],["acd1","",5,"",25],["ad41","",6,"",5,"",7],["ad61","",6,"",10,""],["ad81","",5,"",18,""],["ae41","",5,"",16],["ae61","",5,"",6,"",4],["ae81","",6,"",5,""],["af41","",19],["af61","",13,"",5,""],["af81","",5,"",6,"",5,""],["b041","",5,"",5,"",12],["b061","",5,"",19],["b081","",13,"",6,"",5,"",7,"",4,""],["b141","",6,"",5,""],["b161","",6,"",5,"",11],["b181","",14,"",6,""],["b241","",6,"",5,""],["b261","",18,"",5,""],["b281","",5,"",18,"",6,""],["b341","",19,""],["b361","",5,"",5,"",5],["b381","",5,"",5,"",19,"",4,""],["b441","",5,"",6,"",5],["b461","",6,"",10,""],["b481","",6,"",18,"",4,"",4,""],["b541","",14,"",5],["b561","",5,"",5,"",4],["b581","",6,"",5,"",11,""],["b641","",7,"",17],["b661","",15,""],["b681","",5,"",6,"",5,""],["b741","",13,"",6,""],["b761","",20,""],["b781","",6,"",14,""],["b841","",7,"",17],["b861","",8,"",13],["b881","",5,"",24,"",4,""],["b941","",6,"",5,""],["b961","",14,"",6,""],["b981","",22,"",4,"",4,""],["ba41","",5,"",6,""],["ba61","",5,"",4,"",5],["ba81","",6,"",9,""],["bb41","",4,"",5,"",4,""],["bb61","",6,"",5,""],["bb81","",31,""],["bc41","",17,""],["bc61","",5,"",6,""],["bc81","",4,"",6,"",5,"",5,"",4,""],["bd41","",7,"",7,""],["bd61","",5,"",13],["bd81","",5,"",25,""],["be41","",7,"",14],["be61","",7,"",7,""],["be81","",4,"",4,"",5,"",8,"",6,""],["bf41","",10,"",14],["bf61","",18,""],["bf81","",5,"",7,"",6,"",5,""],["c041","",5,"",6,"",5],["c061","",25],["c081","",6,"",5,"",7,""],["c141","",5,"",6,""],["c161","",19,""],["c181","",31,""],["c241","",4,"",5,""],["c261","",4,"",5,"",6,""],["c281","",5,"",7,"",9,""],["c341","",4],["c361","",4,"",5,"",11],["c381","",5,"",7,"",5,""],["c441","",7,"",7,""],["c461","",5,"",4],["c481","",5,"",11,""],["c541","",6,"",5,""],["c561","",6,"",5,"",4],["c581","",6,"",5,""],["c641","",6,"",5],["c6a1",""],["c7a1",""],["c8a1",""],["caa1",""],["cba1",""],["cca1",""],["cda1",""],["cea1",""],["cfa1",""],["d0a1",""],["d1a1","",5,"",4,""],["d2a1","",4,"",5,"",10,"",7,"",5,""],["d3a1",""],["d4a1",""],["d5a1",""],["d6a1",""],["d7a1",""],["d8a1",""],["d9a1",""],["daa1",""],["dba1",""],["dca1",""],["dda1",""],["dea1",""],["dfa1",""],["e0a1",""],["e1a1",""],["e2a1",""],["e3a1",""],["e4a1",""],["e5a1",""],["e6a1",""],["e7a1",""],["e8a1",""],["e9a1",""],["eaa1",""],["eba1",""],["eca1",""],["eda1",""],["eea1",""],["efa1",""],["f0a1",""],["f1a1",""],["f2a1",""],["f3a1",""],["f4a1",""],["f5a1",""],["f6a1",""],["f7a1",""],["f8a1",""],["f9a1",""],["faa1",""],["fba1",""],["fca1",""],["fda1",""]],He=[["0","\0",127],["a140",""],["a1a1","",4,""],["a240","",7,""],["a2a1","",9,"",9,"",8,"",25,"",21],["a340","",16,"",6,"",16,"",6,"",10],["a3a1","",25,""],["a3e1",""],["a440",""],["a4a1",""],["a540",""],["a5a1",""],["a640",""],["a6a1",""],["a740",""],["a7a1",""],["a840",""],["a8a1",""],["a940",""],["a9a1",""],["aa40",""],["aaa1",""],["ab40",""],["aba1",""],["ac40",""],["aca1",""],["ad40",""],["ada1",""],["ae40",""],["aea1",""],["af40",""],["afa1",""],["b040",""],["b0a1",""],["b140",""],["b1a1",""],["b240",""],["b2a1",""],["b340",""],["b3a1",""],["b440",""],["b4a1",""],["b540",""],["b5a1",""],["b640",""],["b6a1",""],["b740",""],["b7a1",""],["b840",""],["b8a1",""],["b940",""],["b9a1",""],["ba40",""],["baa1",""],["bb40",""],["bba1",""],["bc40",""],["bca1",""],["bd40",""],["bda1",""],["be40",""],["bea1",""],["bf40",""],["bfa1",""],["c040",""],["c0a1",""],["c140",""],["c1a1",""],["c240",""],["c2a1",""],["c340",""],["c3a1",""],["c440",""],["c4a1",""],["c540",""],["c5a1",""],["c640",""],["c940",""],["c9a1",""],["ca40",""],["caa1",""],["cb40",""],["cba1",""],["cc40",""],["cca1",""],["cd40",""],["cda1",""],["ce40",""],["cea1",""],["cf40",""],["cfa1",""],["d040",""],["d0a1",""],["d140",""],["d1a1",""],["d240",""],["d2a1",""],["d340",""],["d3a1",""],["d440",""],["d4a1",""],["d540",""],["d5a1",""],["d640",""],["d6a1",""],["d740",""],["d7a1",""],["d840",""],["d8a1",""],["d940",""],["d9a1",""],["da40",""],["daa1",""],["db40",""],["dba1",""],["dc40",""],["dca1",""],["dd40",""],["dda1",""],["de40",""],["dea1",""],["df40",""],["dfa1",""],["e040",""],["e0a1",""],["e140",""],["e1a1",""],["e240",""],["e2a1",""],["e340",""],["e3a1",""],["e440",""],["e4a1",""],["e540",""],["e5a1",""],["e640",""],["e6a1",""],["e740",""],["e7a1",""],["e840",""],["e8a1",""],["e940",""],["e9a1",""],["ea40",""],["eaa1",""],["eb40",""],["eba1",""],["ec40",""],["eca1",""],["ed40",""],["eda1",""],["ee40",""],["eea1",""],["ef40",""],["efa1",""],["f040",""],["f0a1",""],["f140",""],["f1a1",""],["f240",""],["f2a1",""],["f340",""],["f3a1",""],["f440",""],["f4a1",""],["f540",""],["f5a1",""],["f640",""],["f6a1",""],["f740",""],["f7a1",""],["f840",""],["f8a1",""],["f940",""],["f9a1",""]],$e=[["8740",""],["8767",""],["87a1",""],["8840","",4,""],["88a1",""],["8940",""],["8943",""],["8946",""],["894c",""],["89a1",""],["89ab",""],["89b0",""],["89b5",""],["89c1",""],["89c5",""],["8a40",""],["8a43",""],["8a64",""],["8a76",""],["8aa1",""],["8aac",""],["8ab2",""],["8abb",""],["8ac9",""],["8ace",""],["8adf",""],["8af6",""],["8b40",""],["8b55",""],["8ba1",""],["8bde",""],["8c40",""],["8ca1",""],["8ca7",""],["8cc9",""],["8cce",""],["8ce6",""],["8d40",""],["8d42",""],["8da1",""],["8e40",""],["8ea1",""],["8f40",""],["8fa1",""],["9040",""],["90a1",""],["9140",""],["91a1",""],["9240",""],["92a1",""],["9340",""],["93a1",""],["9440",""],["94a1",""],["9540",""],["95a1",""],["9640",""],["96a1",""],["9740",""],["97a1",""],["9840",""],["98a1",""],["9940",""],["99a1",""],["9a40",""],["9aa1",""],["9b40",""],["9b62",""],["9ba1",""],["9c40",""],["9ca1",""],["9d40",""],["9da1",""],["9e40",""],["9ea1",""],["9ead",""],["9ec5",""],["9ef5",""],["9f40",""],["9f4f",""],["9fa1",""],["9fae",""],["9fb2",""],["9fc1",""],["9fc9",""],["9fdb",""],["9fe7",""],["9feb",""],["9ff0",""],["a040",""],["a055",""],["a058",""],["a05b",""],["a063",""],["a073",""],["a0a1",""],["a0a6",""],["a0ae",""],["a0b0",""],["a0d4",""],["a0e2",""],["a3c0","",31,""],["c6a1","",9,"",9,"",9,"",23],["c740","",58,""],["c7a1","",81,"",5,"",4],["c840","",26,"",25,""],["c8a1",""],["c8cd",""],["c8f5",""],["f9fe",""],["fa40",""],["faa1",""],["fb40",""],["fba1",""],["fc40",""],["fca1",""],["fd40",""],["fda1",""],["fe40",""],["fea1",""]];var Xe,qe,Ke,Ye,Ze;function requireStreams(){if(Ze)return Ye;Ze=1;var t=me.Buffer;return Ye=function(h){var p=h.Transform;function IconvLiteEncoderStream(t,h){this.conv=t,(h=h||{}).decodeStrings=!1,p.call(this,h)}function IconvLiteDecoderStream(t,h){this.conv=t,(h=h||{}).encoding=this.encoding="utf8",p.call(this,h)}return IconvLiteEncoderStream.prototype=Object.create(p.prototype,{constructor:{value:IconvLiteEncoderStream}}),IconvLiteEncoderStream.prototype._transform=function(t,h,p){if("string"!=typeof t)return p(new Error("Iconv encoding stream needs strings as its input."));try{var x=this.conv.write(t);x&&x.length&&this.push(x),p()}catch(Vf){p(Vf)}},IconvLiteEncoderStream.prototype._flush=function(t){try{var h=this.conv.end();h&&h.length&&this.push(h),t()}catch(Vf){t(Vf)}},IconvLiteEncoderStream.prototype.collect=function(h){var p=[];return this.on("error",h),this.on("data",(function(t){p.push(t)})),this.on("end",(function(){h(null,t.concat(p))})),this},IconvLiteDecoderStream.prototype=Object.create(p.prototype,{constructor:{value:IconvLiteDecoderStream}}),IconvLiteDecoderStream.prototype._transform=function(h,p,x){if(!(t.isBuffer(h)||h instanceof Uint8Array))return x(new Error("Iconv decoding stream needs buffers as its input."));try{var M=this.conv.write(h);M&&M.length&&this.push(M,this.encoding),x()}catch(Vf){x(Vf)}},IconvLiteDecoderStream.prototype._flush=function(t){try{var h=this.conv.end();h&&h.length&&this.push(h,this.encoding),t()}catch(Vf){t(Vf)}},IconvLiteDecoderStream.prototype.collect=function(t){var h="";return this.on("error",t),this.on("data",(function(t){h+=t})),this.on("end",(function(){t(null,h)})),this},{IconvLiteEncoderStream:IconvLiteEncoderStream,IconvLiteDecoderStream:IconvLiteDecoderStream}}}const Je=getAugmentedNamespace(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));!function(t){var h,p=me.Buffer,x=ge,M=t.exports;M.encodings=null,M.defaultCharUnicode="",M.defaultCharSingleByte="?",M.encode=function encode(t,h,x){t=""+(t||"");var k=M.getEncoder(h,x),I=k.write(t),N=k.end();return N&&N.length>0?p.concat([I,N]):I},M.decode=function decode(t,h,x){"string"==typeof t&&(M.skipDecodeWarning||(M.skipDecodeWarning=!0),t=p.from(""+(t||""),"binary"));var k=M.getDecoder(h,x),I=k.write(t),N=k.end();return N?I+N:I},M.encodingExists=function encodingExists(t){try{return M.getCodec(t),!0}catch(Vf){return!1}},M.toEncoding=M.encode,M.fromEncoding=M.decode,M._codecDataCache={},M.getCodec=function getCodec(t){M.encodings||(M.encodings=function requireEncodings(){return Ke||(Ke=1,function(t){for(var h=[requireInternal(),requireUtf32(),requireUtf16(),requireUtf7(),requireSbcsCodec(),Ie?Ee:(Ie=1,Ee={10029:"maccenteuro",maccenteuro:{type:"_sbcs",chars:""},808:"cp808",ibm808:"cp808",cp808:{type:"_sbcs",chars:""},mik:{type:"_sbcs",chars:""},cp720:{type:"_sbcs",chars:""},ascii8bit:"ascii",usascii:"ascii",ansix34:"ascii",ansix341968:"ascii",ansix341986:"ascii",csascii:"ascii",cp367:"ascii",ibm367:"ascii",isoir6:"ascii",iso646us:"ascii",iso646irv:"ascii",us:"ascii",latin1:"iso88591",latin2:"iso88592",latin3:"iso88593",latin4:"iso88594",latin5:"iso88599",latin6:"iso885910",latin7:"iso885913",latin8:"iso885914",latin9:"iso885915",latin10:"iso885916",csisolatin1:"iso88591",csisolatin2:"iso88592",csisolatin3:"iso88593",csisolatin4:"iso88594",csisolatincyrillic:"iso88595",csisolatinarabic:"iso88596",csisolatingreek:"iso88597",csisolatinhebrew:"iso88598",csisolatin5:"iso88599",csisolatin6:"iso885910",l1:"iso88591",l2:"iso88592",l3:"iso88593",l4:"iso88594",l5:"iso88599",l6:"iso885910",l7:"iso885913",l8:"iso885914",l9:"iso885915",l10:"iso885916",isoir14:"iso646jp",isoir57:"iso646cn",isoir100:"iso88591",isoir101:"iso88592",isoir109:"iso88593",isoir110:"iso88594",isoir144:"iso88595",isoir127:"iso88596",isoir126:"iso88597",isoir138:"iso88598",isoir148:"iso88599",isoir157:"iso885910",isoir166:"tis620",isoir179:"iso885913",isoir199:"iso885914",isoir203:"iso885915",isoir226:"iso885916",cp819:"iso88591",ibm819:"iso88591",cyrillic:"iso88595",arabic:"iso88596",arabic8:"iso88596",ecma114:"iso88596",asmo708:"iso88596",greek:"iso88597",greek8:"iso88597",ecma118:"iso88597",elot928:"iso88597",hebrew:"iso88598",hebrew8:"iso88598",turkish:"iso88599",turkish8:"iso88599",thai:"iso885911",thai8:"iso885911",celtic:"iso885914",celtic8:"iso885914",isoceltic:"iso885914",tis6200:"tis620",tis62025291:"tis620",tis62025330:"tis620",1e4:"macroman",10006:"macgreek",10007:"maccyrillic",10079:"maciceland",10081:"macturkish",cspc8codepage437:"cp437",cspc775baltic:"cp775",cspc850multilingual:"cp850",cspcp852:"cp852",cspc862latinhebrew:"cp862",cpgr:"cp869",msee:"cp1250",mscyrl:"cp1251",msansi:"cp1252",msgreek:"cp1253",msturk:"cp1254",mshebr:"cp1255",msarab:"cp1256",winbaltrim:"cp1257",cp20866:"koi8r",20866:"koi8r",ibm878:"koi8r",cskoi8r:"koi8r",cp21866:"koi8u",21866:"koi8u",ibm1168:"koi8u",strk10482002:"rk1048",tcvn5712:"tcvn",tcvn57121:"tcvn",gb198880:"iso646cn",cn:"iso646cn",csiso14jisc6220ro:"iso646jp",jisc62201969ro:"iso646jp",jp:"iso646jp",cshproman8:"hproman8",r8:"hproman8",roman8:"hproman8",xroman8:"hproman8",ibm1051:"hproman8",mac:"macintosh",csmacintosh:"macintosh"}),Oe?Be:(Oe=1,Be={437:"cp437",737:"cp737",775:"cp775",850:"cp850",852:"cp852",855:"cp855",856:"cp856",857:"cp857",858:"cp858",860:"cp860",861:"cp861",862:"cp862",863:"cp863",864:"cp864",865:"cp865",866:"cp866",869:"cp869",874:"windows874",922:"cp922",1046:"cp1046",1124:"cp1124",1125:"cp1125",1129:"cp1129",1133:"cp1133",1161:"cp1161",1162:"cp1162",1163:"cp1163",1250:"windows1250",1251:"windows1251",1252:"windows1252",1253:"windows1253",1254:"windows1254",1255:"windows1255",1256:"windows1256",1257:"windows1257",1258:"windows1258",28591:"iso88591",28592:"iso88592",28593:"iso88593",28594:"iso88594",28595:"iso88595",28596:"iso88596",28597:"iso88597",28598:"iso88598",28599:"iso88599",28600:"iso885910",28601:"iso885911",28603:"iso885913",28604:"iso885914",28605:"iso885915",28606:"iso885916",windows874:{type:"_sbcs",chars:""},win874:"windows874",cp874:"windows874",windows1250:{type:"_sbcs",chars:""},win1250:"windows1250",cp1250:"windows1250",windows1251:{type:"_sbcs",chars:""},win1251:"windows1251",cp1251:"windows1251",windows1252:{type:"_sbcs",chars:""},win1252:"windows1252",cp1252:"windows1252",windows1253:{type:"_sbcs",chars:""},win1253:"windows1253",cp1253:"windows1253",windows1254:{type:"_sbcs",chars:""},win1254:"windows1254",cp1254:"windows1254",windows1255:{type:"_sbcs",chars:""},win1255:"windows1255",cp1255:"windows1255",windows1256:{type:"_sbcs",chars:""},win1256:"windows1256",cp1256:"windows1256",windows1257:{type:"_sbcs",chars:""},win1257:"windows1257",cp1257:"windows1257",windows1258:{type:"_sbcs",chars:""},win1258:"windows1258",cp1258:"windows1258",iso88591:{type:"_sbcs",chars:""},cp28591:"iso88591",iso88592:{type:"_sbcs",chars:""},cp28592:"iso88592",iso88593:{type:"_sbcs",chars:""},cp28593:"iso88593",iso88594:{type:"_sbcs",chars:""},cp28594:"iso88594",iso88595:{type:"_sbcs",chars:""},cp28595:"iso88595",iso88596:{type:"_sbcs",chars:""},cp28596:"iso88596",iso88597:{type:"_sbcs",chars:""},cp28597:"iso88597",iso88598:{type:"_sbcs",chars:""},cp28598:"iso88598",iso88599:{type:"_sbcs",chars:""},cp28599:"iso88599",iso885910:{type:"_sbcs",chars:""},cp28600:"iso885910",iso885911:{type:"_sbcs",chars:""},cp28601:"iso885911",iso885913:{type:"_sbcs",chars:""},cp28603:"iso885913",iso885914:{type:"_sbcs",chars:""},cp28604:"iso885914",iso885915:{type:"_sbcs",chars:""},cp28605:"iso885915",iso885916:{type:"_sbcs",chars:""},cp28606:"iso885916",cp437:{type:"_sbcs",chars:""},ibm437:"cp437",csibm437:"cp437",cp737:{type:"_sbcs",chars:""},ibm737:"cp737",csibm737:"cp737",cp775:{type:"_sbcs",chars:""},ibm775:"cp775",csibm775:"cp775",cp850:{type:"_sbcs",chars:""},ibm850:"cp850",csibm850:"cp850",cp852:{type:"_sbcs",chars:""},ibm852:"cp852",csibm852:"cp852",cp855:{type:"_sbcs",chars:""},ibm855:"cp855",csibm855:"cp855",cp856:{type:"_sbcs",chars:""},ibm856:"cp856",csibm856:"cp856",cp857:{type:"_sbcs",chars:""},ibm857:"cp857",csibm857:"cp857",cp858:{type:"_sbcs",chars:""},ibm858:"cp858",csibm858:"cp858",cp860:{type:"_sbcs",chars:""},ibm860:"cp860",csibm860:"cp860",cp861:{type:"_sbcs",chars:""},ibm861:"cp861",csibm861:"cp861",cp862:{type:"_sbcs",chars:""},ibm862:"cp862",csibm862:"cp862",cp863:{type:"_sbcs",chars:""},ibm863:"cp863",csibm863:"cp863",cp864:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},ibm864:"cp864",csibm864:"cp864",cp865:{type:"_sbcs",chars:""},ibm865:"cp865",csibm865:"cp865",cp866:{type:"_sbcs",chars:""},ibm866:"cp866",csibm866:"cp866",cp869:{type:"_sbcs",chars:""},ibm869:"cp869",csibm869:"cp869",cp922:{type:"_sbcs",chars:""},ibm922:"cp922",csibm922:"cp922",cp1046:{type:"_sbcs",chars:""},ibm1046:"cp1046",csibm1046:"cp1046",cp1124:{type:"_sbcs",chars:""},ibm1124:"cp1124",csibm1124:"cp1124",cp1125:{type:"_sbcs",chars:""},ibm1125:"cp1125",csibm1125:"cp1125",cp1129:{type:"_sbcs",chars:""},ibm1129:"cp1129",csibm1129:"cp1129",cp1133:{type:"_sbcs",chars:""},ibm1133:"cp1133",csibm1133:"cp1133",cp1161:{type:"_sbcs",chars:""},ibm1161:"cp1161",csibm1161:"cp1161",cp1162:{type:"_sbcs",chars:""},ibm1162:"cp1162",csibm1162:"cp1162",cp1163:{type:"_sbcs",chars:""},ibm1163:"cp1163",csibm1163:"cp1163",maccroatian:{type:"_sbcs",chars:""},maccyrillic:{type:"_sbcs",chars:""},macgreek:{type:"_sbcs",chars:""},maciceland:{type:"_sbcs",chars:""},macroman:{type:"_sbcs",chars:""},macromania:{type:"_sbcs",chars:""},macthai:{type:"_sbcs",chars:"\ufeff"},macturkish:{type:"_sbcs",chars:""},macukraine:{type:"_sbcs",chars:""},koi8r:{type:"_sbcs",chars:""},koi8u:{type:"_sbcs",chars:""},koi8ru:{type:"_sbcs",chars:""},koi8t:{type:"_sbcs",chars:""},armscii8:{type:"_sbcs",chars:")(.,-"},rk1048:{type:"_sbcs",chars:""},tcvn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},georgianacademy:{type:"_sbcs",chars:""},georgianps:{type:"_sbcs",chars:""},pt154:{type:"_sbcs",chars:""},viscii:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"},iso646cn:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}"},iso646jp:{type:"_sbcs",chars:"\0\b\t\n\v\f\r !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}"},hproman8:{type:"_sbcs",chars:""},macintosh:{type:"_sbcs",chars:""},ascii:{type:"_sbcs",chars:""},tis620:{type:"_sbcs",chars:""}}),requireDbcsCodec(),qe?Xe:(qe=1,Xe={shiftjis:{type:"_dbcs",table:function(){return Ve},encodeAdd:{"":92,"":126},encodeSkipVals:[{from:60736,to:63808}]},csshiftjis:"shiftjis",mskanji:"shiftjis",sjis:"shiftjis",windows31j:"shiftjis",ms31j:"shiftjis",xsjis:"shiftjis",windows932:"shiftjis",ms932:"shiftjis",932:"shiftjis",cp932:"shiftjis",eucjp:{type:"_dbcs",table:function(){return Ge},encodeAdd:{"":92,"":126}},gb2312:"cp936",gb231280:"cp936",gb23121980:"cp936",csgb2312:"cp936",csiso58gb231280:"cp936",euccn:"cp936",windows936:"cp936",ms936:"cp936",936:"cp936",cp936:{type:"_dbcs",table:function(){return je}},gbk:{type:"_dbcs",table:function(){return je.concat(Ue)}},xgbk:"gbk",isoir58:"gbk",gb18030:{type:"_dbcs",table:function(){return je.concat(Ue)},gb18030:function(){return ze},encodeSkipVals:[128],encodeAdd:{"":41699}},chinese:"gb18030",windows949:"cp949",ms949:"cp949",949:"cp949",cp949:{type:"_dbcs",table:function(){return We}},cseuckr:"cp949",csksc56011987:"cp949",euckr:"cp949",isoir149:"cp949",korean:"cp949",ksc56011987:"cp949",ksc56011989:"cp949",ksc5601:"cp949",windows950:"cp950",ms950:"cp950",950:"cp950",cp950:{type:"_dbcs",table:function(){return He}},big5:"big5hkscs",big5hkscs:{type:"_dbcs",table:function(){return He.concat($e)},encodeSkipVals:[36457,36463,36478,36523,36532,36557,36560,36695,36713,36718,36811,36862,36973,36986,37060,37084,37105,37311,37551,37552,37553,37554,37585,37959,38090,38361,38652,39285,39798,39800,39803,39878,39902,39916,39926,40002,40019,40034,40040,40043,40055,40124,40125,40144,40279,40282,40388,40431,40443,40617,40687,40701,40800,40907,41079,41180,41183,36812,37576,38468,38637,41636,41637,41639,41638,41676,41678]},cnbig5:"big5hkscs",csbig5:"big5hkscs",xxbig5:"big5hkscs"})],p=0;p<h.length;p++){var x=h[p];for(var M in x)Object.prototype.hasOwnProperty.call(x,M)&&(t[M]=x[M])}}(Me)),Me}());for(var h=M._canonicalizeEncoding(t),p={};;){var x=M._codecDataCache[h];if(x)return x;var k=M.encodings[h];switch(typeof k){case"string":h=k;break;case"object":for(var I in k)p[I]=k[I];p.encodingName||(p.encodingName=h),h=k.type;break;case"function":return p.encodingName||(p.encodingName=h),x=new k(p,M),M._codecDataCache[p.encodingName]=x,x;default:throw new Error("Encoding not recognized: '"+t+"' (searched as: '"+h+"')")}}},M._canonicalizeEncoding=function(t){return(""+t).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g,"")},M.getEncoder=function getEncoder(t,h){var p=M.getCodec(t),k=new p.encoder(h,p);return p.bomAware&&h&&h.addBOM&&(k=new x.PrependBOM(k,h)),k},M.getDecoder=function getDecoder(t,h){var p=M.getCodec(t),k=new p.decoder(h,p);return!p.bomAware||h&&!1===h.stripBOM||(k=new x.StripBOM(k,h)),k},M.enableStreamingAPI=function enableStreamingAPI(t){if(!M.supportsStreams){var h=requireStreams()(t);M.IconvLiteEncoderStream=h.IconvLiteEncoderStream,M.IconvLiteDecoderStream=h.IconvLiteDecoderStream,M.encodeStream=function encodeStream(t,h){return new M.IconvLiteEncoderStream(M.getEncoder(t,h),h)},M.decodeStream=function decodeStream(t,h){return new M.IconvLiteDecoderStream(M.getDecoder(t,h),h)},M.supportsStreams=!0}};try{h=Je}catch(Vf){}h&&h.Transform?M.enableStreamingAPI(h):M.encodeStream=M.decodeStream=function(){throw new Error("iconv-lite Streaming API is not enabled. Use iconv.enableStreamingAPI(require('stream')); to enable it.")}}(le);var Qe={exports:{}};!function(t,h){var x=p,M=x.Buffer;function copyProps(t,h){for(var p in t)h[p]=t[p]}function SafeBuffer(t,h,p){return M(t,h,p)}M.from&&M.alloc&&M.allocUnsafe&&M.allocUnsafeSlow?t.exports=x:(copyProps(x,h),h.Buffer=SafeBuffer),copyProps(M,SafeBuffer),SafeBuffer.from=function(t,h,p){if("number"==typeof t)throw new TypeError("Argument must not be a number");return M(t,h,p)},SafeBuffer.alloc=function(t,h,p){if("number"!=typeof t)throw new TypeError("Argument must be a number");var x=M(t);return void 0!==h?"string"==typeof p?x.fill(h,p):x.fill(h):x.fill(0),x},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return M(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return x.SlowBuffer(t)}}(Qe,Qe.exports);var et=function(){function MxG2312(){_classCallCheck$1(this,MxG2312),_defineProperty(this,"isUseUtf8",!1)}return _createClass$1(MxG2312,[{key:"encodeToGb2312Imp",value:function encodeToGb2312Imp(t){var h=le.exports.encode(t,"gb2312"),p="";return h.forEach((function(t){p+="%"+t.toString(16)})),p}},{key:"decodeFromGb2312Imp",value:function decodeFromGb2312Imp(t){for(var h=[],p=t.length,x=0;x<p;){if("%"!=t.charAt(x))break;x+=1;var M=parseInt(t.slice(x,x+2),16);h.push(M),x+=2}return le.exports.decode(Qe.exports.Buffer.from(h),"gb2312")}},{key:"encodeToGb2312",value:function encodeToGb2312(t){return this.isUseUtf8?t:this.encodeToGb2312Imp(t)}},{key:"decodeFromGb2312",value:function decodeFromGb2312(t){return this.isUseUtf8?t:this.decodeFromGb2312Imp(t)}}]),MxG2312}(),tt=new et,rt=window;rt.McDrawObjectEvent_utf8ToAscii=function(t){return tt.encodeToGb2312Imp(t)},rt.McDrawObjectEvent_asciiToUTF8=function(t){return tt.decodeFromGb2312Imp(t)};const nt="1.0.331";var it="SharedArrayBuffer"in window,ot=document.currentScript&&/unpkg\.com\/mxcad/.test(document.currentScript.src),st=function get2DFileURL(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.location.href;return ot?"https://unpkg.com/mxcad@".concat(nt,"/dist/wasm/2d-st/").concat(t):h+t},ct=function get2DSTFileURL(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self.location.href;return ot?"https://unpkg.com/mxcad@".concat(nt,"/dist/wasm/2d/").concat(t):h+t},ut=function loadScript(t){return new Promise((function(h,p){var x=document.createElement("script");x.src=t,x.type="text/javascript",x.crossOrigin="anonymous",document.body.appendChild(x),x.onload=function(){h()},x.onerror=function(t){p(t)}}))},lt=function(){var t=_asyncToGenerator(ie.mark((function _callee(t,h,p){var x,M;return ie.wrap((function _callee$(k){for(;;)switch(k.prev=k.next){case 0:return x=p.locateFile,M=x(t+".js"),k.prev=2,k.next=5,ut(M);case 5:return k.next=7,globalThis[h](p);case 7:return k.abrupt("return",k.sent);case 10:k.prev=10,k.t0=k.catch(2);case 14:case"end":return k.stop()}}),_callee,null,[[2,10]])})));return function loadWams(h,p,x){return t.apply(this,arguments)}}();function _arrayLikeToArray$a(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function _unsupportedIterableToArray$a(t,h){if(t){if("string"==typeof t)return _arrayLikeToArray$a(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);return"Object"===p&&t.constructor&&(p=t.constructor.name),"Map"===p||"Set"===p?Array.from(t):"Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?_arrayLikeToArray$a(t,h):void 0}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray$a(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray$a(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _setPrototypeOf$1(t,h){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,h){return t.__proto__=h,t},_setPrototypeOf$1(t,h)}function _inherits$1(t,h){if("function"!=typeof h&&null!==h)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(h&&h.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),h&&_setPrototypeOf$1(t,h)}function _assertThisInitialized$1(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn$1(t,h){if(h&&("object"===_typeof$1(h)||"function"==typeof h))return h;if(void 0!==h)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(t)}function _getPrototypeOf$1(t){return _getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf$1(t)}var ht=new FinalizationRegistry((function(h){t.MxCpp.App.destroyObject(h)})),ft={},dt=function(){function McRxObject(t){_classCallCheck$1(this,McRxObject),_defineProperty(this,"imp",0),this.imp=t,this.imp&&(this.imp.isNull(),ht.register(this,t,ft))}return _createClass$1(McRxObject,[{key:"constructor_MxCADResbuf",value:function constructor_MxCADResbuf(t){this.imp=t,this.imp&&ht.register(this,t,ft)}},{key:"getImp",value:function getImp(){return this.imp}},{key:"initTempObject",value:function initTempObject(t){this.imp=t}},{key:"objectName",get:function get(){return this.imp.getObjectName()}},{key:"dxf0",get:function get(){return this.imp.getDxf0()}},{key:"getJson",value:function getJson(){var t=this.imp.getJson();return tt.decodeFromGb2312(t)}},{key:"setJson",value:function setJson(t){var h=tt.encodeToGb2312(t);return this.imp.setJson(h)}},{key:"isKindOf",value:function isKindOf(t){return this.imp.isKindOf(t)}},{key:"isNull",value:function isNull(){return this.imp.isNull()}}]),McRxObject}();function _createSuper$b(t){var h=function _isNativeReflectConstruct$c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var pt=function(t){return t[t.kMxCAD=0]="kMxCAD",t[t.kMxDraw=1]="kMxDraw",t[t.kInvalid=2]="kInvalid",t}(pt||{}),mt=function(){function McObjectId(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;_classCallCheck$1(this,McObjectId),_defineProperty(this,"id",void 0),_defineProperty(this,"type",void 0),this.id=t,this.type=t?2==h?0:h:2}return _createClass$1(McObjectId,[{key:"isValid",value:function isValid(){return 2!=this.type&&0!=this.id}},{key:"isNull",value:function isNull(){return 2==this.type||0==this.id}},{key:"isErase",value:function isErase(){return!!this.isValid()&&(0==this.type&&0!=this.id&&t.MxCpp.App.getImp().isObjectEraseSataus(this.id))}},{key:"erase",value:function erase(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isValid()&&(1==this.type?h.MxFun.getCurrentDraw().eraseMxEntity(this.id):0==this.type&&Mt.eraseObject(this.id,t))}},{key:"getMcDbObject",value:function getMcDbObject(){return this.isValid()&&0==this.type?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"isKindOf",value:function isKindOf(h){return!!this.isValid()&&(0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,h))}},{key:"getMcDbEntity",value:function getMcDbEntity(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbEntity")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbCurve",value:function getMcDbCurve(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbCurve")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbBlockTableRecord",value:function getMcDbBlockTableRecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbBlockTableRecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbLayerTableRecord",value:function getMcDbLayerTableRecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbLayerTableRecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbDimStyleTableRecord",value:function getMcDbDimStyleTableRecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbDimStyleTableRecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbLinetypeTableRecord",value:function getMcDbLinetypeTableRecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbLinetypeTableRecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbTextStyleTableRecord",value:function getMcDbTextStyleTableRecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbTextStyleTableRecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbDimension",value:function getMcDbDimension(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbDimension")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbCustomEntity",value:function getMcDbCustomEntity(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbCustomEntity")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"clone",value:function clone(){if(!this.isValid())return null;if(0==this.type){var h=t.MxCpp.App.getImp();if(h.ObjectIdIsKindOf(this.id,"McDbCustomEntity")){var p=this.getMcDbCustomEntity();return p?p.clone():null}var x=h.ObjectIdToMdObject(this.id);if(!x)return null;var M=x.Clone();return t.MxCpp.App.destroyObject(x),t.MxCpp.App.createCloneObject(M)}return null}},{key:"getObjectName",value:function getObjectName(){if(0==this.type)return t.MxCpp.App.getImp().ObjectIdToObjectName(this.id);if(1==this.type){var p=h.MxFun.getCurrentDraw().getMxEntity(this.id);if(p)return p.getTypeName()}return""}},{key:"getMxDbEntity",value:function getMxDbEntity(){return this.isValid()&&1==this.type?h.MxFun.getCurrentDraw().getMxEntity(this.id):null}},{key:"getMcDbRasterImageDef",value:function getMcDbRasterImageDef(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbRasterImageDef")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbDictionary",value:function getMcDbDictionary(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbDictionary")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbXrecord",value:function getMcDbXrecord(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbXrecord")?t.MxCpp.App.objectIdToObject(this.id):null}},{key:"getMcDbGroup",value:function getMcDbGroup(){return this.isValid()&&0==this.type&&t.MxCpp.App.objectIdIsKindOf(this.id,"McDbGroup")?t.MxCpp.App.objectIdToObject(this.id):null}}]),McObjectId}(),gt=function(h){_inherits$1(McDbObject,h);var p=_createSuper$b(McDbObject);function McDbObject(t){return _classCallCheck$1(this,McDbObject),p.call(this,t)}return _createClass$1(McDbObject,[{key:"getObjectID",value:function getObjectID(){return new mt(this.imp.GetObjectID(),0)}},{key:"erase",value:function erase(){return this.imp.Erase()}},{key:"isErased",value:function isErased(){return this.imp.isErased()}},{key:"unErase",value:function unErase(){return this.imp.unErase()}},{key:"clone",value:function clone(){var h=this.imp.Clone();return t.MxCpp.App.createCloneObject(h)}},{key:"getHandle",value:function getHandle(){return this.imp.GetHandle()}},{key:"getDatabase",value:function getDatabase(){return new Ir(this.imp.GetDatabase())}},{key:"getOwnerID",value:function getOwnerID(){return this.imp.GetOwnerID()}},{key:"getExtensionDictionary",value:function getExtensionDictionary(){return new Fr(this.imp.GetExtensionDictionary())}},{key:"isHaveExtensionDictionary",value:function isHaveExtensionDictionary(){return this.imp.IsHaveExtensionDictionary()}},{key:"createExtensionDictionary",value:function createExtensionDictionary(){return this.imp.createExtensionDictionary()}},{key:"getDatabaseIndexId",value:function getDatabaseIndexId(){return this.imp.GetDatabaseIndexId()}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){return this.imp.moveGripPointsAt(t,h,p,x)}},{key:"getGripPoints",value:function getGripPoints(){return new ln(this.imp.getGripPoints())}},{key:"tempRelationObject",value:function tempRelationObject(){return 0}},{key:"freeTempRelationObject",value:function freeTempRelationObject(){}},{key:"assertObjectModification",value:function assertObjectModification(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.imp.assertObjectModification(t)}}]),McDbObject}(dt),vt=function(){function McDbObjectArray(h){if(_classCallCheck$1(this,McDbObjectArray),_defineProperty(this,"aryVal",[]),h){for(var p=0,x=h.length();p<x;p++){var M=h.release(p),k=t.MxCpp.App.createCloneObject(M);null!=k&&this.aryVal.push(k)}t.MxCpp.App.destroyObject(h)}}return _createClass$1(McDbObjectArray,[{key:"forEach",value:function forEach(t){for(var h=this.aryVal.length,p=0;p<h;p++)t(this.aryVal[p],p)}},{key:"length",value:function length(){return this.aryVal.length}},{key:"empty",value:function empty(){return 0==this.aryVal.length}}]),McDbObjectArray}();function _createSuper$a(t){var h=function _isNativeReflectConstruct$b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var yt=function(){function MxCoordConvertType(){_classCallCheck$1(this,MxCoordConvertType)}return _createClass$1(MxCoordConvertType,[{key:"doc2cad",value:function doc2cad(t){return t}},{key:"cad2doc",value:function cad2doc(t){return t}},{key:"doc2cad1",value:function doc2cad1(t){return new rn(t.x,t.y,t.z)}},{key:"doc2cad2",value:function doc2cad2(t,h,p){return new rn(t,h,p)}},{key:"cad2doc1",value:function cad2doc1(t){return new THREE.Vector3(t.x,t.y,t.z)}},{key:"cad2doc2",value:function cad2doc2(t,h,p){return new THREE.Vector3(t,h,p)}}]),MxCoordConvertType}();function getFilterImp(){var h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return h?h.getImp():new t.MxCpp.mxcadassemblyimp.McDrawResbuf}t.MxCoordConvert=void 0,t.MxCoordConvert=new yt;var bt=function(h){_inherits$1(MxCADResbuf,h);var p=_createSuper$a(MxCADResbuf);function MxCADResbuf(h){var x;if(_classCallCheck$1(this,MxCADResbuf),h)if(h instanceof Array){(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.McDrawResbuf);for(var M=h.length,k=!1,I=0;I<M;I++)if(h[I]instanceof Object){k=!0;break}if(k)x.setJson(JSON.stringify(h));else{for(var N=[],V=0;V+1<M;V+=2)"number"==typeof h[V]&&N.push({type:h[V],val:h[V+1]});N.length>0&&x.setJson(JSON.stringify(N))}}else(x=p.call(this)).constructor_MxCADResbuf(h);else(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.McDrawResbuf);return _possibleConstructorReturn$1(x)}return _createClass$1(MxCADResbuf,[{key:"Clear",value:function Clear(){this.imp.Clear()}},{key:"forEach",value:function forEach(t){for(var h=this.GetCount(),p=0;p<h;p++){var x=this.ItemDataType(p),M=this.ItemDataDxf(p);5005==x?t(this.AtString(p,!0).val,x,M,p):5009==x?t(this.AtPoint(p).val,x,M,p):5001==x?t(this.AtDouble(p).val,x,M,p):5003==x||5010==x?t(this.AtLong(p).val,5010,M,p):-8500==M?t(this.AtObject(p).val,-8500,-8500,p):-8e3==x||-8001==x||-8002==x||-8003==x||-8004==x?t(this.AtObjectId(p).val,-8e3,-8e3,p):t(void 0,x,M,p)}}},{key:"GetCount",value:function GetCount(){return this.imp.GetCount()}},{key:"GetPoints",value:function GetPoints(){var t=new ln;return this.forEach((function(h,p,x){if(1010===x){var M=new rn(h.x,h.y,h.z);t.append(M)}})),t}},{key:"AtDouble",value:function AtDouble(h){return{val:this.imp.AtDouble(h),ret:0==t.MxCpp.getCallResult()}}},{key:"AtLong",value:function AtLong(h){return{val:this.imp.Atlong(h),ret:0==t.MxCpp.getCallResult()}}},{key:"AtObject",value:function AtObject(h){if(h>=this.imp.GetCount())return{val:void 0,ret:!1};var p=this.imp.AtObject(h),x=t.MxCpp.App.createCloneObject(p);return null===x?{val:void 0,ret:!1}:{val:x,ret:!0}}},{key:"AddObject",value:function AddObject(t){this.imp.AddObject(t.getImp())}},{key:"AtObjectId",value:function AtObjectId(h){return{val:new mt(this.imp.AtObjectId(h),pt.kMxCAD),ret:0==t.MxCpp.getCallResult()}}},{key:"AtString",value:function AtString(h){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?{val:tt.decodeFromGb2312(this.imp.AtString(h,!0)),ret:0==t.MxCpp.getCallResult()}:{val:this.imp.AtString(h,!0),ret:0==t.MxCpp.getCallResult()}}},{key:"AtPoint",value:function AtPoint(h){return{val:new rn(this.imp.AtPoint(h)),ret:0==t.MxCpp.getCallResult()}}},{key:"ItemDataType",value:function ItemDataType(t){return this.imp.ItemDataType(t)}},{key:"ItemDataDxf",value:function ItemDataDxf(t){return this.imp.ItemDataDxf(t)}},{key:"AddDouble",value:function AddDouble(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-10;return this.imp.AddDouble(t,h)}},{key:"AddLong",value:function AddLong(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-10;return this.imp.Addlong(t,h)}},{key:"AddObjectId",value:function AddObjectId(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-10;return this.imp.AddObjectId(t,h)}},{key:"AddString",value:function AddString(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-10;return!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?this.imp.AddString(tt.encodeToGb2312(t),h):this.imp.AddString(t,h)}},{key:"AddAppName",value:function AddAppName(t){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?this.imp.AddAppName(tt.encodeToGb2312(t)):this.imp.AddAppName(t)}},{key:"AddMcDbEntityTypes",value:function AddMcDbEntityTypes(t){return this.imp.AddString(t,5020)}},{key:"AddPoint",value:function AddPoint(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-10;return this.imp.AddPoint(t.imp,h)}},{key:"RemoveAll",value:function RemoveAll(){this.imp.RemoveAll()}},{key:"Remove",value:function Remove(t){this.imp.Remove(t)}},{key:"PrintData",value:function PrintData(){this.imp.PrintData()}}]),MxCADResbuf}(dt),xt=function(){function MxCADUtilityClass(){_classCallCheck$1(this,MxCADUtilityClass),_defineProperty(this,"imp",void 0)}var p,x;return _createClass$1(MxCADUtilityClass,[{key:"eraseObject",value:function eraseObject(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.init(),this.imp.eraseObject(t,h)}},{key:"highlightEntity",value:function highlightEntity(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.init(),this.imp.highlightEntity(t,h)}},{key:"findEntAtPoint",value:function findEntAtPoint(t,h,p){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.init();var k=this.imp.findEntAtPoint(t,h,p,x,getFilterImp(M));return new mt(k,pt.kMxCAD)}},{key:"selectEnt",value:function selectEnt(p){var x=this,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,k=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],I=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;return this.init(),new Promise(function(){var V=_asyncToGenerator(ie.mark((function _callee(V){var ee,te,re,ne,ae;return ie.wrap((function _callee$(ie){for(;;)switch(ie.prev=ie.next){case 0:return ee=new h.MrxDbgUiPrPoint,"function"==typeof I&&I(ee),p&&ee.setMessage(p),ee.setCursorType(h.MxCursorType.kRect),ee.disableAllTrace(),ee.setDynamicInputType(h.DynamicInputType.kDynTip),ie.next=8,ee.go();case 8:if(te=ie.sent){ie.next=12;break}return V([]),ie.abrupt("return");case 12:"function"==typeof N&&N((new rn).setFromVector3(te)),ee.clearLastInputPoint(),k?h.MrxDbgUtils.findEntAtPoint(te).then((function(h){var p=[];h.forEach((function(t){p.push(new mt(t,pt.kMxDraw))}));var k=t.MxCoordConvert.doc2cad1(te),I=x.findEntAtPoint(k.x,k.y,k.z,-1,M);I.isValid()&&p.push(I),V(p)})):(re=[],ne=t.MxCoordConvert.doc2cad1(te),(ae=x.findEntAtPoint(ne.x,ne.y,ne.z,-1,M)).isValid()&&re.push(ae),V(re));case 15:case"end":return ie.stop()}}),_callee)})));return function(t){return V.apply(this,arguments)}}())}},{key:"getCurrentSelectPoints",value:function getCurrentSelectPoints(){var t=h.MxFun.getCurrentDraw().getSelectPoints();return t.isvalid?{point1:new rn(t.point1),point2:new rn(t.point2),isvalid:!0}:{point1:new rn,point2:new rn,isvalid:!1}}},{key:"getCurrentSelect",value:function getCurrentSelect(){var p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],M=[];arguments.length>2&&void 0!==arguments[2]&&!arguments[2]||h.MxFun.getCurrentDraw().getMxCurrentSelect().forEach((function(t){M.push(new mt(t,pt.kMxDraw))}));if(x){var k=h.MxFun.getCurrentDraw().getMxCADCurrentSelect();if(k.length<=0)return M;if(p){var I=new cn;k.forEach((function(t){I.append(t)}));var N=new t.MxCpp.mxcadassemblyimp.McDrawSelSet,V=N.getFilterEntity(I.imp,getFilterImp(p));t.MxCpp.App.destroyObject(N),k=[];for(var ee=V.length(),te=0;te<ee;te++)k.push(V.at(te))}k.forEach((function(t){M.push(new mt(t,pt.kMxCAD))}))}return M}},{key:"userSelect",value:(x=_asyncToGenerator(ie.mark((function _callee2(t){var h,p,x,M,k=arguments;return ie.wrap((function _callee2$(I){for(;;)switch(I.prev=I.next){case 0:if(h=k.length>1&&void 0!==k[1]?k[1]:null,p=k.length>2?k[2]:void 0,0!=(x=this.getCurrentSelect(h)).length){I.next=9;break}return M=new _t,I.next=7,M.userSelect(t,h,(function(t){p&&p(M,t)}));case 7:if(!I.sent){I.next=9;break}M.forEach((function(t){x.push(t)}));case 9:return I.abrupt("return",new Promise((function(t){t(x)})));case 10:case"end":return I.stop()}}),_callee2,this)}))),function userSelect(t){return x.apply(this,arguments)})},{key:"init",value:function init(){this.imp||(this.imp=new t.MxCpp.mxcadassemblyimp.McDrawUtility,(new Kn).rxInit(),(new Qn).rxInit(),(new ni).rxInit())}},{key:"getCorner",value:(p=_asyncToGenerator(ie.mark((function _callee3(p,x,M){var k,I,N,V,ee,te,re,ne,ae=arguments;return ie.wrap((function _callee3$(ie){for(;;)switch(ie.prev=ie.next){case 0:k=ae.length>3&&void 0!==ae[3]&&ae[3],I=ae.length>4&&void 0!==ae[4]&&ae[4],N=ae.length>5?ae[5]:void 0,V=0,ee=void 0;case 5:if(x){ie.next=16;break}return te=new St,p&&te.setMessage(p),I&&te.disableAllTrace(!0),N&&N(te),te.setDynamicInputType(h.DynamicInputType.kDynTip),ie.next=14,te.go();case 14:x=ie.sent,V=te.getDetailedResult();case 16:if(x){ie.next=18;break}return ie.abrupt("break",26);case 18:return re=t.MxCoordConvert.cad2doc1(x),ie.next=21,h.MrxDbgUtils.getCorner(re,p,k,(function(t){V=t.detailedResult}),I);case 21:return(ne=ie.sent)&&(ee=t.MxCoordConvert.doc2cad1(ne)),ie.abrupt("break",26);case 26:return M&&M(V),ie.abrupt("return",new Promise((function(t){V==h.DetailedResult.kEcsIn||V==h.DetailedResult.kNewCommadIn||V==h.DetailedResult.kUnknown?t(null):t(x&&ee?{pt1:x,pt2:ee}:null)})));case 28:case"end":return ie.stop()}}),_callee3)}))),function getCorner(t,h,x){return p.apply(this,arguments)})},{key:"getMcDbEntitysBoundingBox",value:function getMcDbEntitysBoundingBox(t){var h=void 0,p=void 0;return t.forEach((function(t){var x=t.getMcDbEntity();if(null!=x){var M=x.getBoundingBox();M.ret&&(h&&p?(h.x>M.minPt.x&&(h.x=M.minPt.x),h.y>M.minPt.y&&(h.y=M.minPt.y),p.x<M.maxPt.x&&(p.x=M.maxPt.x),p.y<M.maxPt.y&&(p.y=M.maxPt.y)):(h=new THREE.Vector3(M.minPt.x,M.minPt.y,0),p=new THREE.Vector3(M.maxPt.x,M.maxPt.y,0)))}})),h&&p?{minPt:new rn(h),maxPt:new rn(p)}:void 0}},{key:"calcBulge",value:function calcBulge(h,p,x){return{val:this.imp.calcBulge(h.imp,p.imp,x.imp),ret:0==t.MxCpp.getCallResult()}}},{key:"pointInPolygon",value:function pointInPolygon(t,h,p){return this.imp.pointInPolygon(t.imp,h,p)}},{key:"builderHatchFromPoint",value:function builderHatchFromPoint(h){var p=this.imp.builderHatchFromPoint(h.x,h.y);return p.isNull()?(t.MxCpp.App.destroyObject(p),null):new Yt(p)}},{key:"getTextBox",value:function getTextBox(h,p,x,M){if(M.type!=pt.kMxCAD)return{minPt:new rn,maxPt:new rn,ret:!1};var k=this.imp.getTextBox(tt.encodeToGb2312(h),p,x,M.id);if(k){var I={minPt:new rn,maxPt:new rn,ret:!1};return 0!=k.GetCount()&&(I={minPt:new rn(k.AtPoint(0)),maxPt:new rn(k.AtPoint(1)),ret:!0}),t.MxCpp.App.destroyObject(k),I}return{minPt:new rn,maxPt:new rn,ret:!1}}},{key:"getTextEntityBox",value:function getTextEntityBox(h){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],x=this.imp.getTextEntityBox(h.imp,p);if(x){var M={minPt:new rn,maxPt:new rn,ret:!1};return 0!=x.GetCount()&&(M={minPt:new rn(x.AtPoint(0)),maxPt:new rn(x.AtPoint(1)),ret:!0}),t.MxCpp.App.destroyObject(x),M}return{minPt:new rn,maxPt:new rn,ret:!1}}}]),MxCADUtilityClass}(),Mt=new xt,wt=function(t){return t[t.kSelected=0]="kSelected",t[t.kNone=1]="kNone",t[t.kCanceled=2]="kCanceled",t[t.kRejected=3]="kRejected",t[t.kKeyword=4]="kKeyword",t}(wt||{}),_t=function(p){_inherits$1(MxCADSelectionSet,p);var x,M,k=_createSuper$a(MxCADSelectionSet);function MxCADSelectionSet(){var p;return _classCallCheck$1(this,MxCADSelectionSet),_defineProperty(_assertThisInitialized$1(p=k.call(this)),"isWhileSelect",!0),_defineProperty(_assertThisInitialized$1(p),"isSelectHighlight",!0),_defineProperty(_assertThisInitialized$1(p),"selectPoints",[]),p.initTempObject(new t.MxCpp.mxcadassemblyimp.McDrawSelSet),p.isWhileSelect=h.MxFun.isPC(),p}return _createClass$1(MxCADSelectionSet,[{key:"getSelectPoint",value:function getSelectPoint(){return 1==this.selectPoints.length?{pt1:this.selectPoints[0],pt2:this.selectPoints[0]}:this.selectPoints.length>1?{pt1:this.selectPoints[0],pt2:this.selectPoints[1]}:{pt1:new rn,pt2:new rn}}},{key:"getSelectPoints",value:function getSelectPoints(){return this.selectPoints}},{key:"allSelect",value:function allSelect(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.imp.allSelect(getFilterImp(t))}},{key:"pointSelect",value:function pointSelect(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;return this.imp.pointSelect(t,h,getFilterImp(p),x)}},{key:"crossingSelect",value:function crossingSelect(t,h,p,x){var M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return this.imp.crossingSelect(t,h,p,x,getFilterImp(M))}},{key:"count",value:function count(){return this.imp.count()}},{key:"isNull",value:function isNull(){return 0==this.imp.count()}},{key:"item",value:function item(t){return new mt(this.imp.item(t),pt.kMxCAD)}},{key:"clear",value:function clear(){this.imp.clear()}},{key:"forEach",value:function forEach(t){for(var h=this.imp.count(),p=0;p<h;p++)t(this.item(p))}},{key:"getIds",value:function getIds(){for(var t=[],h=this.imp.count(),p=0;p<h;p++)t.push(this.item(p));return t}},{key:"userSelect",value:(M=_asyncToGenerator(ie.mark((function _callee4(p){var x,M,k,I,N,V,ee,te,re,ne=arguments;return ie.wrap((function _callee4$(ie){for(;;)switch(ie.prev=ie.next){case 0:x=ne.length>1&&void 0!==ne[1]?ne[1]:null,M=ne.length>2?ne[2]:void 0,this.selectPoints=[],k=new h.MrxDbgUiPrPoint,p&&k.setMessage(p),k.setCursorType(h.MxCursorType.kRect),k.setDynamicInputType(h.DynamicInputType.kDynTip),k.disableAllTrace(),k.setDisableOsnap(!0),I=0,M&&M(k),N=getFilterImp(x);case 12:return k.setDynamicInputType(h.DynamicInputType.kDynTip),k.setInputToucheType(h.MxType.InputToucheType.kGetBegan),ie.next=17,k.go();case 17:if(V=ie.sent,k.clearLastInputPoint(),I=k.getDetailedResult(),V){ie.next=22;break}return ie.abrupt("break",43);case 22:if(ee=t.MxCoordConvert.doc2cad1(V),0!=this.imp.userPointSelect(ee.x,ee.y,N,this.isSelectHighlight)){ie.next=30;break}if(this.selectPoints.push(ee.clone()),!this.isWhileSelect){ie.next=29;break}return ie.abrupt("continue",12);case 29:return ie.abrupt("break",43);case 30:return ie.next=32,h.MrxDbgUtils.getCorner(V,p,!0,(function(t){I=t.detailedResult}));case 32:if(te=ie.sent){ie.next=35;break}return ie.abrupt("break",43);case 35:if(re=t.MxCoordConvert.doc2cad1(te),this.imp.userSelect(ee.x,ee.y,re.x,re.y,N,this.isSelectHighlight),this.selectPoints.push(ee.clone()),this.selectPoints.push(re.clone()),this.isWhileSelect){ie.next=41;break}return ie.abrupt("break",43);case 41:ie.next=12;break;case 43:if(this.isSelectHighlight&&this.imp.highlightEntity(!1),I!=h.DetailedResult.kEcsIn&&I!=h.DetailedResult.kNewCommadIn&&I!=h.DetailedResult.kUnknown){ie.next=48;break}return ie.abrupt("return",new Promise((function(t){t(!1)})));case 48:return ie.abrupt("return",new Promise((function(t){t(!0)})));case 49:case"end":return ie.stop()}}),_callee4,this)}))),function userSelect(t){return M.apply(this,arguments)})},{key:"fenceSelect",value:(x=_asyncToGenerator(ie.mark((function _callee5(p){var x,M,k,I,N,V,ee,te,re,ne=arguments;return ie.wrap((function _callee5$(ie){for(;;)switch(ie.prev=ie.next){case 0:x=ne.length>1&&void 0!==ne[1]?ne[1]:null,M=ne.length>2?ne[2]:void 0,this.imp.clear(),this.selectPoints=[],k=new h.MrxDbgUiPrPoint,p&&k.setMessage(p),k.setCursorType(h.MxCursorType.kCross),k.setDynamicInputType(h.DynamicInputType.kDynTip),k.disableAllTrace(),k.setDisableOsnap(!0),I=0,M&&M(k),N=getFilterImp(x);case 13:if(V){ie.next=26;break}return k.setDynamicInputType(h.DynamicInputType.kDynTip),k.setInputToucheType(h.MxType.InputToucheType.kGetBegan),ie.next=19,k.go();case 19:if(ee=ie.sent,I=k.getDetailedResult(),k.clearLastInputPoint(),ee){ie.next=24;break}return ie.abrupt("break",43);case 24:V=t.MxCoordConvert.doc2cad1(ee),this.selectPoints.push(V);case 26:return k.setBasePt(V.toVector3()),k.setUseBasePt(!0),ie.next=30,k.go();case 30:if(te=ie.sent,k.clearLastInputPoint(),I=k.getDetailedResult(),te){ie.next=35;break}return ie.abrupt("break",43);case 35:if(re=t.MxCoordConvert.doc2cad1(te),this.imp.fenceSelect(V.x,V.y,re.x,re.y,N,this.isSelectHighlight),this.selectPoints.push(re),re=V,this.isWhileSelect){ie.next=41;break}return ie.abrupt("break",43);case 41:ie.next=13;break;case 43:if(this.isSelectHighlight&&this.imp.highlightEntity(!1),I!=h.DetailedResult.kEcsIn&&I!=h.DetailedResult.kNewCommadIn&&I!=h.DetailedResult.kUnknown){ie.next=48;break}return ie.abrupt("return",new Promise((function(t){t(!1)})));case 48:return ie.abrupt("return",new Promise((function(t){t(!0)})));case 49:case"end":return ie.stop()}}),_callee5,this)}))),function fenceSelect(t){return x.apply(this,arguments)})}]),MxCADSelectionSet}(dt),Ct=function(){function MxCADUiPrBase(t){_classCallCheck$1(this,MxCADUiPrBase),_defineProperty(this,"imp",void 0),_defineProperty(this,"mxobj",void 0),this.imp=t,this.mxobj=h.MxFun.getCurrentDraw()}return _createClass$1(MxCADUiPrBase,[{key:"doc2cad1",value:function doc2cad1(t){return new rn(t.x,t.y,t.z)}},{key:"doc2cad2",value:function doc2cad2(t,h,p){return new rn(t,h,p)}},{key:"cad2doc1",value:function cad2doc1(t){return new THREE.Vector3(t.x,t.y,t.z)}},{key:"cad2doc2",value:function cad2doc2(t,h,p){return new THREE.Vector3(t,h,p)}},{key:"keyWords",value:function keyWords(){return this.imp.keyWords()}},{key:"setKeyWords",value:function setKeyWords(t){this.imp.setKeyWords(t)}},{key:"clearLastInputPoint",value:function clearLastInputPoint(){this.imp.clearLastInputPoint()}},{key:"setLastInputPoint",value:function setLastInputPoint(t){this.imp.setLastInputPoint(this.cad2doc1(t))}},{key:"message",value:function message(){return this.imp.message()}},{key:"setMessage",value:function setMessage(t){this.imp.setMessage(t)}},{key:"keyWordPicked",value:function keyWordPicked(){return this.imp.keyWordPicked()}},{key:"isKeyWordPicked",value:function isKeyWordPicked(t){return this.imp.isKeyWordPicked(t)}},{key:"setUserDraw",value:function setUserDraw(t){var h=this;this.imp.setUserDraw((function(p,x){t(h.doc2cad1(p),x)}))}},{key:"getDetailedResult",value:function getDetailedResult(){return this.imp.getDetailedResult()}},{key:"getStatus",value:function getStatus(){return this.imp.getStatus()}},{key:"drawReserve",value:function drawReserve(t){this.imp.drawReserve(t)}},{key:"setInputToucheType",value:function setInputToucheType(t){this.imp.setInputToucheType(t)}},{key:"getInputToucheType",value:function getInputToucheType(){return this.imp.getInputToucheType()}},{key:"setCursorType",value:function setCursorType(t){this.imp.setCursorType(t)}},{key:"getCursorType",value:function getCursorType(){return this.imp.getCursorType()}},{key:"setDynamicInputType",value:function setDynamicInputType(t){this.imp.setDynamicInputType(t)}},{key:"getDynamicInputType",value:function getDynamicInputType(){return this.imp.getDynamicInputType()}},{key:"isDisableDynInput",value:function isDisableDynInput(){return this.imp.isDisableDynInput()}},{key:"setDisableDynInput",value:function setDisableDynInput(t){this.imp.setDisableDynInput(t)}},{key:"setDisableOsnap",value:function setDisableOsnap(t){this.imp.setDisableOsnap(t)}},{key:"isDisableOsnap",value:function isDisableOsnap(){return this.imp.isDisableOsnap()}},{key:"isOffsetInputPostion",value:function isOffsetInputPostion(){return this.imp.isOffsetInputPostion()}},{key:"setOffsetInputPostion",value:function setOffsetInputPostion(t){return this.imp.setOffsetInputPostion(t)}},{key:"setDisableDynamicTrace",value:function setDisableDynamicTrace(t){this.imp.setDisableDynamicTrace(t)}},{key:"isDisableDynamicTrace",value:function isDisableDynamicTrace(){return this.imp.isDisableDynamicTrace()}},{key:"setDisablePolarAxisTrace",value:function setDisablePolarAxisTrace(t){this.imp.setDisablePolarAxisTrace(t)}},{key:"isDisablePolarAxisTrace",value:function isDisablePolarAxisTrace(){return this.imp.isDisablePolarAxisTrace()}},{key:"setDisableGridTrace",value:function setDisableGridTrace(t){this.imp.setDisableGridTrace(t)}},{key:"isDisableGridTrace",value:function isDisableGridTrace(){return this.imp.isDisableGridTrace()}},{key:"setDisableOrthoTrace",value:function setDisableOrthoTrace(t){this.imp.setDisableOrthoTrace(t)}},{key:"isDisableOrthoTrace",value:function isDisableOrthoTrace(){return this.imp.isDisableOrtho()}},{key:"disableAllTrace",value:function disableAllTrace(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.imp.disableAllTrace(t)}},{key:"userInputControls",value:function userInputControls(){return this.imp.userInputControls()}},{key:"setUserInputControls",value:function setUserInputControls(t){this.imp.setUserInputControls(t)}},{key:"abort",value:function abort(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.DetailedResult.kCodeAbort;this.imp.abort(t)}}]),MxCADUiPrBase}(),St=function(t){_inherits$1(MxCADUiPrPoint,t);var p=_createSuper$a(MxCADUiPrPoint);function MxCADUiPrPoint(){return _classCallCheck$1(this,MxCADUiPrPoint),p.call(this,new h.MrxDbgUiPrPoint)}return _createClass$1(MxCADUiPrPoint,[{key:"go",value:function go(){var t=this;return new Promise((function(h){t.imp.go((function(p){h(0!=p?null:t.doc2cad1(t.imp.value()))}))}))}},{key:"value",value:function value(){return this.doc2cad1(this.imp.value())}},{key:"getDocValue",value:function getDocValue(){return new rn(this.imp.value())}},{key:"basePt",value:function basePt(){return this.doc2cad1(this.imp.basePt())}},{key:"setBasePt",value:function setBasePt(t){this.imp.setBasePt(this.cad2doc1(t)),this.imp.setUseBasePt(!0)}},{key:"setUseBasePt",value:function setUseBasePt(t){this.imp.setUseBasePt(t)}}]),MxCADUiPrPoint}(Ct),Tt=function(t){_inherits$1(MxCADUiPrDist,t);var p=_createSuper$a(MxCADUiPrDist);function MxCADUiPrDist(){return _classCallCheck$1(this,MxCADUiPrDist),p.call(this,new h.MrxDbgUiPrDist)}return _createClass$1(MxCADUiPrDist,[{key:"value",value:function value(){return this.imp.value()}},{key:"basePt",value:function basePt(){return this.doc2cad1(this.imp.basePt())}},{key:"setBasePt",value:function setBasePt(t){this.imp.setBasePt(this.cad2doc1(t)),this.imp.setUseBasePt(!0)}},{key:"setUseBasePt",value:function setUseBasePt(t){return this.imp.setUseBasePt(t)}},{key:"go",value:function go(){return this.imp.go()}}]),MxCADUiPrDist}(Ct),At=function(t){_inherits$1(MxCADUiPrAngle,t);var p=_createSuper$a(MxCADUiPrAngle);function MxCADUiPrAngle(){return _classCallCheck$1(this,MxCADUiPrAngle),p.call(this,new h.MrxDbgUiPrAngle)}return _createClass$1(MxCADUiPrAngle,[{key:"value",value:function value(){return this.imp.value()}},{key:"basePt",value:function basePt(){return this.doc2cad1(this.imp.basePt())}},{key:"setBasePt",value:function setBasePt(t){this.imp.setBasePt(this.cad2doc1(t)),this.imp.setUseBasePt(!0)}},{key:"setUseBasePt",value:function setUseBasePt(t){return this.imp.setUseBasePt(t)}},{key:"go",value:function go(){return this.imp.go()}}]),MxCADUiPrAngle}(Ct),Dt=function(t){_inherits$1(MxCADUiPrInt,t);var p=_createSuper$a(MxCADUiPrInt);function MxCADUiPrInt(){return _classCallCheck$1(this,MxCADUiPrInt),p.call(this,new h.MrxDbgUiPrInt)}return _createClass$1(MxCADUiPrInt,[{key:"value",value:function value(){return this.imp.value()}},{key:"go",value:function go(){return this.imp.go()}}]),MxCADUiPrInt}(Ct),kt=function(t){_inherits$1(MxCADUiPrKeyWord,t);var p=_createSuper$a(MxCADUiPrKeyWord);function MxCADUiPrKeyWord(){return _classCallCheck$1(this,MxCADUiPrKeyWord),p.call(this,new h.MrxDbgUiPrKeyWord)}return _createClass$1(MxCADUiPrKeyWord,[{key:"go",value:function go(){return this.imp.go()}}]),MxCADUiPrKeyWord}(Ct),Pt=function(t){_inherits$1(MxCADUiPrString,t);var p=_createSuper$a(MxCADUiPrString);function MxCADUiPrString(){var t;return _classCallCheck$1(this,MxCADUiPrString),(t=p.call(this,new h.MrxDbgUiPrString)).setDynamicInputType(h.DynamicInputType.kNoInput),t.disableAllTrace(),t}return _createClass$1(MxCADUiPrString,[{key:"value",value:function value(){return this.imp.value()}},{key:"go",value:function go(){return this.imp.go()}}]),MxCADUiPrString}(Ct),Lt=function(t){_inherits$1(MxCADUiPrEntity,t);var p=_createSuper$a(MxCADUiPrEntity);function MxCADUiPrEntity(){var t;return _classCallCheck$1(this,MxCADUiPrEntity),_defineProperty(_assertThisInitialized$1(t=p.call(this,new h.MrxDbgUiPrPoint)),"filter",void 0),_defineProperty(_assertThisInitialized$1(t),"id",new mt),t.setCursorType(h.MxCursorType.kRect),t.setDynamicInputType(h.DynamicInputType.kDynTip),t.disableAllTrace(),t}return _createClass$1(MxCADUiPrEntity,[{key:"setFilter",value:function setFilter(t){this.filter=t}},{key:"getFilter",value:function getFilter(){return this.filter}},{key:"go",value:function go(){var t=this;return new Promise((function(h){var p=t;t.imp.go((function(t){if(p.clearLastInputPoint(),0!=t)h(new mt);else{var x=p.imp.value(),M=p.doc2cad1(x);p.id=Mt.findEntAtPoint(M.x,M.y,M.z,-1,p.filter),h(p.id)}}))}))}},{key:"pickPoint",value:function pickPoint(){return this.doc2cad1(this.imp.value())}},{key:"value",value:function value(){return this.id}},{key:"getDocPickPoint",value:function getDocPickPoint(){return new rn(this.imp.value())}}]),MxCADUiPrEntity}(Ct);function _createSuper$9(t){var h=function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var Et=function(h){_inherits$1(McDbEntity,h);var p=_createSuper$9(McDbEntity);function McDbEntity(t){return _classCallCheck$1(this,McDbEntity),p.call(this,t)}return _createClass$1(McDbEntity,[{key:"explode",value:function explode(){var t=this.imp.explode();return new bt(t)}},{key:"trueColor",get:function get(){return new Cr(this.imp.TrueColor())},set:function set(t){this.imp.SetTrueColor(t.getImp())}},{key:"colorIndex",get:function get(){return this.imp.ColorIndex()},set:function set(t){this.imp.SetColorIndex(t)}},{key:"layer",get:function get(){return tt.decodeFromGb2312(this.imp.Layer())},set:function set(t){this.imp.SetLayer(tt.encodeToGb2312(t))}},{key:"linetype",get:function get(){return tt.decodeFromGb2312(this.imp.Linetype())},set:function set(t){this.imp.SetLinetype(tt.encodeToGb2312(t))}},{key:"linetypeScale",get:function get(){return this.imp.LinetypeScale()},set:function set(t){this.imp.SetLinetypeScale(t)}},{key:"visible",get:function get(){return this.imp.Visible()},set:function set(t){this.imp.SetVisible(t)}},{key:"lineweight",get:function get(){return this.imp.Lineweight()},set:function set(t){this.imp.SetLineweight(t)}},{key:"textStyle",get:function get(){return tt.decodeFromGb2312(this.imp.TextStyle())},set:function set(t){this.imp.SetTextStyle(tt.encodeToGb2312(t))}},{key:"highlight",value:function highlight(t){this.imp.Highlight(t)}},{key:"move",value:function move(t,h){this.tempRelationObject();var p=this.imp.Move(t.imp,h.imp);return this.freeTempRelationObject(),p}},{key:"rotate",value:function rotate(t,h){this.tempRelationObject();var p=this.imp.Rotate(t.imp,h);return this.freeTempRelationObject(),p}},{key:"mirror",value:function mirror(t,h){this.tempRelationObject();var p=this.imp.Mirror(t.imp,h.imp);return this.freeTempRelationObject(),p}},{key:"scaleEntity",value:function scaleEntity(t,h){this.tempRelationObject();var p=this.imp.ScaleEntity(t.imp,h);return this.freeTempRelationObject(),p}},{key:"transformBy",value:function transformBy(t){return this.imp.TransformBy(t.imp)}},{key:"getBoundingBox",value:function getBoundingBox(){var h=this.imp.GetBoundingBox();if(h){if(h.GetCount()<2)return t.MxCpp.App.destroyObject(h),{minPt:new rn,maxPt:new rn,ret:!1};var p={minPt:new rn(h.AtPoint(0)),maxPt:new rn(h.AtPoint(1)),ret:!0};return t.MxCpp.App.destroyObject(h),p}return{minPt:new rn,maxPt:new rn,ret:!1}}},{key:"getxData",value:function getxData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new bt(this.imp.GetXData(tt.encodeToGb2312(t)))}},{key:"setxData",value:function setxData(t){return this.imp.SetXData(t.getImp())}},{key:"getxDataString",value:function getxDataString(h){var p=this.imp.GetxDataString(tt.encodeToGb2312(h),0);return{val:tt.decodeFromGb2312(p),ret:0==t.MxCpp.getCallResult()}}},{key:"setxDataString",value:function setxDataString(t,h){return this.imp.SetxDataString(tt.encodeToGb2312(t),0,tt.encodeToGb2312(h))}},{key:"getxDataDouble",value:function getxDataDouble(h){return{val:this.imp.GetxDataDouble(tt.encodeToGb2312(h),0),ret:0==t.MxCpp.getCallResult()}}},{key:"setxDataDouble",value:function setxDataDouble(t,h){return this.imp.SetxDataDouble(tt.encodeToGb2312(t),0,h)}},{key:"getxDataLong",value:function getxDataLong(h){return{val:this.imp.GetxDataLong(tt.encodeToGb2312(h),0),ret:0==t.MxCpp.getCallResult()}}},{key:"setxDataLong",value:function setxDataLong(t,h){return this.imp.SetxDataLong(tt.encodeToGb2312(t),0,h)}},{key:"getxDataPoint",value:function getxDataPoint(h){var p=this.imp.GetxDataPoint(tt.encodeToGb2312(h),0),x=new rn;if(0==t.MxCpp.getCallResult()){var M=!1;return p&&(x.x=p.x,x.y=p.y,x.z=p.z,t.MxCpp.App.getImp().DestroyMdGePoint3d(p),M=!0),{val:x,ret:M}}return{val:x,ret:!1}}},{key:"setxDataPoint",value:function setxDataPoint(t,h){return this.imp.SetxDataPoint(tt.encodeToGb2312(t),0,h.imp)}},{key:"deleteXData",value:function deleteXData(t){return this.imp.DeleteXData(tt.encodeToGb2312(t))}},{key:"getAllAppName",value:function getAllAppName(){return new un(this.imp.GetAllAppName())}},{key:"layerId",get:function get(){return new mt(this.imp.LayerId(),pt.kMxCAD)},set:function set(t){t.type==pt.kMxCAD&&this.imp.SetLayerId(t.id)}},{key:"linetypeId",get:function get(){return new mt(this.imp.LinetypeId(),pt.kMxCAD)},set:function set(t){t.type==pt.kMxCAD&&this.imp.SetLinetypeId(t.id)}},{key:"textStyleId",get:function get(){return new mt(this.imp.TextStyleId(),pt.kMxCAD)},set:function set(t){t.type==pt.kMxCAD&&this.imp.SetTextStyleId(t.id)}},{key:"IntersectWith",value:function IntersectWith(t,h){return new ln(this.imp.IntersectWith(t.imp,h))}},{key:"getArea",value:function getArea(){return{val:this.imp.getArea(),ret:0==t.MxCpp.getCallResult()}}},{key:"disableDisplay",value:function disableDisplay(t){this.imp.disableUpdateDisplay(t)}},{key:"updateDisplay",value:function updateDisplay(){this.imp.updateDisplay()}},{key:"syncData",value:function syncData(){return!1}},{key:"drawOrder",get:function get(){return this.imp.DrawOrder()},set:function set(t){this.imp.SetDrawOrder(t)}},{key:"normal",get:function get(){return new nn(this.imp.normal())},set:function set(t){this.imp.setNormal(t.imp)}}]),McDbEntity}(gt),It=function(h){_inherits$1(McDbCurve,h);var p=_createSuper$9(McDbCurve);function McDbCurve(t){return _classCallCheck$1(this,McDbCurve),p.call(this,t)}return _createClass$1(McDbCurve,[{key:"getStartParam",value:function getStartParam(){return{val:this.imp.getStartParam(),ret:0==t.MxCpp.getCallResult()}}},{key:"getEndParam",value:function getEndParam(){return{val:this.imp.getEndParam(),ret:0==t.MxCpp.getCallResult()}}},{key:"getDistAtParam",value:function getDistAtParam(h){return{val:this.imp.getDistAtParam(h),ret:0==t.MxCpp.getCallResult()}}},{key:"getParamAtDist",value:function getParamAtDist(h){return{val:this.imp.getParamAtDist(h),ret:0==t.MxCpp.getCallResult()}}},{key:"getDistAtPoint",value:function getDistAtPoint(h){return{val:this.imp.getDistAtPoint(h.imp),ret:0==t.MxCpp.getCallResult()}}},{key:"getPointAtDist",value:function getPointAtDist(h){return{val:new rn(this.imp.getPointAtDist(h)),ret:0==t.MxCpp.getCallResult()}}},{key:"getStartPoint",value:function getStartPoint(){return{val:new rn(this.imp.getStartPoint()),ret:0==t.MxCpp.getCallResult()}}},{key:"getEndPoint",value:function getEndPoint(){return{val:new rn(this.imp.getEndPoint()),ret:0==t.MxCpp.getCallResult()}}},{key:"getPointAtParam",value:function getPointAtParam(h){return{val:new rn(this.imp.getPointAtParam(h)),ret:0==t.MxCpp.getCallResult()}}},{key:"getParamAtPoint",value:function getParamAtPoint(h){return{val:this.imp.getParamAtPoint(h.imp),ret:0==t.MxCpp.getCallResult()}}},{key:"getFirstDerivFromParam",value:function getFirstDerivFromParam(h){return{val:new nn(this.imp.getFirstDeriv(h)),ret:0==t.MxCpp.getCallResult()}}},{key:"getFirstDeriv",value:function getFirstDeriv(h){return{val:new nn(this.imp.getFirstDerivEx(h.imp)),ret:0==t.MxCpp.getCallResult()}}},{key:"getClosestPointTo",value:function getClosestPointTo(h,p){return{val:new rn(this.imp.getClosestPointTo(h.imp,p)),ret:0==t.MxCpp.getCallResult()}}},{key:"offsetCurves",value:function offsetCurves(t,h){var p=this.imp.offsetCurves(t,h.imp);return new vt(p)}},{key:"splitCurves",value:function splitCurves(t){var h=new bt;t.forEach((function(t){h.AddPoint(t)}));var p=this.imp.splitCurves(h.getImp());return new vt(p)}},{key:"splitCurvesFromParam",value:function splitCurvesFromParam(t){var h=new bt;t.forEach((function(t){h.AddDouble(t)}));var p=this.imp.splitCurves(h.getImp());return new vt(p)}},{key:"getSamplePoints",value:function getSamplePoints(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-4,h=this.imp.getSamplePoints(t);return new bt(h)}},{key:"getLength",value:function getLength(){return{val:this.imp.getLength(),ret:0==t.MxCpp.getCallResult()}}}]),McDbCurve}(Et),Bt=function(h){_inherits$1(McDbLine,h);var p=_createSuper$9(McDbLine);function McDbLine(h,x,M,k,I,N){var V;return _classCallCheck$1(this,McDbLine),h instanceof Object?h instanceof rn?((V=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbLine),x instanceof rn&&(V.startPoint=h,V.endPoint=x)):V=p.call(this,h):((V=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbLine),V.startPoint=new rn(h,x,M),V.endPoint=new rn(k,I,N)),_possibleConstructorReturn$1(V)}return _createClass$1(McDbLine,[{key:"startPoint",get:function get(){return new rn(this.imp.startPoint())},set:function set(t){this.imp.setStartPoint(t.imp)}},{key:"endPoint",get:function get(){return new rn(this.imp.endPoint())},set:function set(t){this.imp.setEndPoint(t.imp)}}]),McDbLine}(It),Ot=function(h){_inherits$1(McDbText,h);var p=_createSuper$9(McDbText);function McDbText(h){var x;return _classCallCheck$1(this,McDbText),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbText),x}return _createClass$1(McDbText,[{key:"position",get:function get(){return new rn(this.imp.position())},set:function set(t){this.imp.setPosition(t.imp)}},{key:"alignmentPoint",get:function get(){return new rn(this.imp.position())},set:function set(t){this.imp.setAlignmentPoint(t.imp)}},{key:"oblique",get:function get(){return this.imp.oblique()},set:function set(t){this.imp.setOblique(t)}},{key:"rotation",get:function get(){return this.imp.rotation()},set:function set(t){this.imp.setRotation(t)}},{key:"height",get:function get(){return this.imp.height()},set:function set(t){this.imp.setHeight(t)}},{key:"widthFactor",get:function get(){return this.imp.widthFactor()},set:function set(t){this.imp.setWidthFactor(t)}},{key:"textString",get:function get(){return tt.decodeFromGb2312(this.imp.textString())},set:function set(t){this.imp.setTextString(tt.encodeToGb2312(t))}},{key:"horizontalMode",get:function get(){return this.imp.horizontalMode()},set:function set(t){this.imp.setHorizontalMode(t)}},{key:"verticalMode",get:function get(){return this.imp.verticalMode()},set:function set(t){this.imp.setVerticalMode(t)}},{key:"adjustAlignment",value:function adjustAlignment(){this.imp.adjustAlignment()}}]),McDbText}(Et),Rt=function(h){_inherits$1(McDbAttribute,h);var p=_createSuper$9(McDbAttribute);function McDbAttribute(h){var x;return _classCallCheck$1(this,McDbAttribute),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbAttribute),x}return _createClass$1(McDbAttribute,[{key:"tag",get:function get(){return tt.decodeFromGb2312(this.imp.tag())},set:function set(t){this.imp.setTag(tt.encodeToGb2312(t))}},{key:"isInvisible",get:function get(){return this.imp.isInvisible()},set:function set(t){this.imp.setInvisible(t)}}]),McDbAttribute}(Ot),Ft=function(h){_inherits$1(McDbAttributeDefinition,h);var p=_createSuper$9(McDbAttributeDefinition);function McDbAttributeDefinition(h){var x;return _classCallCheck$1(this,McDbAttributeDefinition),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbAttributeDefinition),x}return _createClass$1(McDbAttributeDefinition,[{key:"tag",get:function get(){return tt.decodeFromGb2312(this.imp.tag())},set:function set(t){this.imp.setTag(tt.encodeToGb2312(t))}},{key:"isInvisible",get:function get(){return this.imp.isInvisible()},set:function set(t){this.imp.setInvisible(t)}},{key:"prompt",get:function get(){return tt.decodeFromGb2312(this.imp.prompt())},set:function set(t){this.imp.setPrompt(tt.encodeToGb2312(t))}},{key:"isConstant",get:function get(){return this.imp.isConstant()},set:function set(t){this.imp.setConstant(t)}},{key:"isVerifiable",get:function get(){return this.imp.isVerifiable()},set:function set(t){this.imp.setVerifiable(t)}},{key:"isPreset",get:function get(){return this.imp.isPreset()},set:function set(t){this.imp.setPreset(t)}}]),McDbAttributeDefinition}(Ot),Nt=function(h){_inherits$1(McDbMText,h);var p=_createSuper$9(McDbMText);function McDbMText(h){var x;return _classCallCheck$1(this,McDbMText),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbMText),x}return _createClass$1(McDbMText,[{key:"location",get:function get(){return new rn(this.imp.location())},set:function set(t){this.imp.setLocation(t.imp)}},{key:"rotation",get:function get(){return this.imp.rotation()},set:function set(t){this.imp.setRotation(t)}},{key:"width",get:function get(){return this.imp.width()},set:function set(t){this.imp.setWidth(t)}},{key:"textHeight",get:function get(){return this.imp.textHeight()},set:function set(t){this.imp.setTextHeight(t)}},{key:"attachment",get:function get(){return this.imp.attachment()},set:function set(t){this.imp.setAttachment(t)}},{key:"contents",get:function get(){return tt.decodeFromGb2312(this.imp.contents())},set:function set(t){this.imp.setContents(tt.encodeToGb2312(t))}},{key:"getTextString",value:function getTextString(){return tt.decodeFromGb2312(this.imp.getTextString())}},{key:"reCompute",value:function reCompute(){return this.imp.reCompute()}}]),McDbMText}(Et),Vt=function(h){_inherits$1(McDbCircle,h);var p=_createSuper$9(McDbCircle);function McDbCircle(h,x,M,k){var I;return _classCallCheck$1(this,McDbCircle),h instanceof Object?I=p.call(this,h):((I=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbCircle),"number"==typeof h&&(I.imp.setCenter(new rn(h,x,M).imp),I.imp.setRadius(k))),_possibleConstructorReturn$1(I)}return _createClass$1(McDbCircle,[{key:"setCenter",value:function setCenter(t,h,p){this.imp.setCenter(new rn(t,h,p).imp)}},{key:"center",get:function get(){return new rn(this.imp.center())},set:function set(t){this.imp.setCenter(t.imp)}},{key:"radius",get:function get(){return this.imp.radius()},set:function set(t){this.imp.setRadius(t)}}]),McDbCircle}(It),Gt=function(h){_inherits$1(McDbPolyline,h);var p=_createSuper$9(McDbPolyline);function McDbPolyline(h){var x;return _classCallCheck$1(this,McDbPolyline),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbPolyline),x}return _createClass$1(McDbPolyline,[{key:"isClosed",get:function get(){return this.imp.isClosed()},set:function set(t){this.imp.setClosed(t)}},{key:"constantWidth",get:function get(){return this.imp.getConstantWidth()},set:function set(t){this.imp.setConstantWidth(t)}},{key:"addVertexAt",value:function addVertexAt(h){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(h instanceof THREE.Vector3){var I=new t.MxCpp.mxcadassemblyimp.MdGePoint3d;return I.x=h.x,I.y=h.y,I.z=h.z,this.imp.addVertexAt(k,I,p,x,M)}return this.imp.addVertexAt(k,h.imp,p,x,M)}},{key:"removeVertexAt",value:function removeVertexAt(t){return this.imp.removeVertexAt(t)}},{key:"numVerts",value:function numVerts(){return this.imp.numVerts()}},{key:"getPointAt",value:function getPointAt(h){return{val:new rn(this.imp.getPointAt(h)),ret:t.MxCpp.getCallResult()}}},{key:"getBulgeAt",value:function getBulgeAt(t){return this.imp.getBulgeAt(t)}},{key:"getWidthsAt",value:function getWidthsAt(h){return{val1:this.imp.getStartWidthsAt(h),val2:this.imp.getEndWidthsAt(h),ret:0==t.MxCpp.getCallResult()}}},{key:"setPointAt",value:function setPointAt(t,h){return this.imp.setPointAt(t,h.imp)}},{key:"setBulgeAt",value:function setBulgeAt(t,h){return this.imp.setBulgeAt(t,h)}},{key:"pointInPolygon",value:function pointInPolygon(t,h){return this.imp.pointInPolygon(t,h)}},{key:"setWidthsAt",value:function setWidthsAt(t,h,p){return this.imp.setWidthsAt(t,h,p)}},{key:"getType",value:function getType(){return this.imp.getType()}},{key:"setType",value:function setType(t){return this.imp.setType(t)}}]),McDbPolyline}(It),jt=function(h){_inherits$1(McDbBlockReference,h);var p=_createSuper$9(McDbBlockReference);function McDbBlockReference(h){var x;return _classCallCheck$1(this,McDbBlockReference),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbBlockReference),x}return _createClass$1(McDbBlockReference,[{key:"blockTableRecordId",get:function get(){return new mt(this.imp.blockTableRecordId(),pt.kMxCAD)},set:function set(t){this.imp.setBlockTableRecordId(t.id)}},{key:"position",get:function get(){return new rn(this.imp.position())},set:function set(t){this.imp.setPosition(t.imp)}},{key:"scaleFactors",get:function get(){return new rn(this.imp.scaleFactors())},set:function set(t){this.imp.setScaleFactors(t.imp)}},{key:"setScale",value:function setScale(t){this.imp.setScaleFactors(new rn(t,t,t).imp)}},{key:"getScale",value:function getScale(){return this.imp.scaleFactors().x}},{key:"rotation",get:function get(){return this.imp.rotation()},set:function set(t){this.imp.setRotation(t)}},{key:"blockTransform",get:function get(){return new sn(this.imp.blockTransform())},set:function set(t){this.imp.setBlockTransform(t.imp)}},{key:"blockName",get:function get(){return tt.decodeFromGb2312(this.imp.getBlockName())}},{key:"appendAttribute",value:function appendAttribute(t){return new mt(this.imp.appendAttribute(t.getImp()),pt.kMxCAD)}},{key:"getAllAttribute",value:function getAllAttribute(){for(var h=[],p=this.imp.getAllAttribute(),x=p.length(),M=0;M<x;M++)h.push(new mt(p.at(M),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(p),h}},{key:"createAttribute",value:function createAttribute(){return this.imp.createAttribute()}},{key:"getSpatialFilterId",value:function getSpatialFilterId(){return new mt(this.imp.getSpatialFilterId(),pt.kMxCAD)}},{key:"createSpatialFilter",value:function createSpatialFilter(){return this.imp.createSpatialFilter()}},{key:"clearSpatialFilterCache",value:function clearSpatialFilterCache(){return this.imp.clearSpatialFilterCache()}},{key:"copyAttribute",value:function copyAttribute(t){return this.imp.copyAttribute(t.imp)}},{key:"eraseAllAttribute",value:function eraseAllAttribute(){this.imp.eraseAllAttribute()}}]),McDbBlockReference}(Et),Ut=function(h){_inherits$1(McDbSpatialFilter,h);var p=_createSuper$9(McDbSpatialFilter);function McDbSpatialFilter(h){var x;return _classCallCheck$1(this,McDbSpatialFilter),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbSpatialFilter),x}return _createClass$1(McDbSpatialFilter,[{key:"boundary",value:function boundary(){return new ln(this.imp.boundary())}},{key:"setBoundary",value:function setBoundary(t){return this.imp.setBoundary(t.imp)}},{key:"isFilterInverted",value:function isFilterInverted(){return this.imp.isFilterInverted()}},{key:"setFilterInverted",value:function setFilterInverted(t){return this.imp.setFilterInverted(t)}},{key:"isEnabled",value:function isEnabled(){return this.imp.isEnabled()}},{key:"setEnable",value:function setEnable(t){return this.imp.setEnable(t)}}]),McDbSpatialFilter}(gt),zt=function(t){_inherits$1(McDbDimension,t);var h=_createSuper$9(McDbDimension);function McDbDimension(t){return _classCallCheck$1(this,McDbDimension),h.call(this,t)}return _createClass$1(McDbDimension,[{key:"textPosition",get:function get(){return new rn(this.imp.textPosition())},set:function set(t){this.imp.setTextPosition(t.imp)}},{key:"isUsingDefaultTextPosition",value:function isUsingDefaultTextPosition(){return this.imp.isUsingDefaultTextPosition()}},{key:"useSetTextPosition",value:function useSetTextPosition(){return this.imp.useSetTextPosition()}},{key:"useDefaultTextPosition",value:function useDefaultTextPosition(){return this.imp.useDefaultTextPosition()}},{key:"elevation",get:function get(){return this.imp.elevation()},set:function set(t){this.imp.setElevation(t)}},{key:"dimensionText",get:function get(){return tt.decodeFromGb2312(this.imp.dimensionText())},set:function set(t){this.imp.setDimensionText(tt.encodeToGb2312(t))}},{key:"textRotation",get:function get(){return this.imp.textRotation()},set:function set(t){this.imp.setTextRotation(t)}},{key:"dimensionStyle",get:function get(){return new mt(this.imp.dimensionStyle(),pt.kMxCAD)},set:function set(t){this.imp.setDimensionStyle(t.id)}},{key:"textAttachment",get:function get(){return this.imp.textAttachment()},set:function set(t){this.imp.setTextAttachment(t)}},{key:"needToUpdateDimBlock",value:function needToUpdateDimBlock(t){this.imp.SetUpDimBlock(t)}},{key:"horizontalRotation",get:function get(){return this.imp.horizontalRotation()},set:function set(t){this.imp.setHorizontalRotation(t)}},{key:"recomputeDimBlock",value:function recomputeDimBlock(){this.imp.recomputeDimBlock(!0)}},{key:"getDimVarInt",value:function getDimVarInt(t){return this.imp.GetDimVarInt(t)}},{key:"setDimVarInt",value:function setDimVarInt(t,h){this.imp.SetDimVarInt(t,h)}},{key:"getDimVarDouble",value:function getDimVarDouble(t){return this.imp.GetDimVarDouble(t)}},{key:"setDimVarDouble",value:function setDimVarDouble(t,h){this.imp.SetDimVarDouble(t,h)}},{key:"getDimVarString",value:function getDimVarString(t){return this.imp.GetDimVarString(t)}},{key:"setDimVarString",value:function setDimVarString(t,h){this.imp.SetDimVarString(t,h)}},{key:"getDimVarObjectId",value:function getDimVarObjectId(t){return new mt(this.imp.GetDimVarObjectId(t),pt.kMxCAD)}},{key:"setDimVarObjectId",value:function setDimVarObjectId(t,h){this.imp.SetDimVarObjectId(t,h.id)}},{key:"GetAllText",value:function GetAllText(){return new un(this.imp.GetAllText())}}]),McDbDimension}(Et),Wt=function(h){_inherits$1(McDbAlignedDimension,h);var p=_createSuper$9(McDbAlignedDimension);function McDbAlignedDimension(h){var x;return _classCallCheck$1(this,McDbAlignedDimension),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbAlignedDimension),x}return _createClass$1(McDbAlignedDimension,[{key:"xLine1Point",get:function get(){return new rn(this.imp.xLine1Point())},set:function set(t){this.imp.setXLine1Point(t.imp)}},{key:"xLine2Point",get:function get(){return new rn(this.imp.xLine2Point())},set:function set(t){this.imp.setXLine2Point(t.imp)}},{key:"dimLinePoint",get:function get(){return new rn(this.imp.dimLinePoint())},set:function set(t){this.imp.setDimLinePoint(t.imp)}},{key:"oblique",get:function get(){return this.imp.oblique()},set:function set(t){this.imp.setOblique(t)}}]),McDbAlignedDimension}(zt),Ht=function(h){_inherits$1(McDbRotatedDimension,h);var p=_createSuper$9(McDbRotatedDimension);function McDbRotatedDimension(h){var x;return _classCallCheck$1(this,McDbRotatedDimension),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbRotatedDimension),x}return _createClass$1(McDbRotatedDimension,[{key:"xLine1Point",get:function get(){return new rn(this.imp.xLine1Point())},set:function set(t){this.imp.setXLine1Point(t.imp)}},{key:"xLine2Point",get:function get(){return new rn(this.imp.xLine2Point())},set:function set(t){this.imp.setXLine2Point(t.imp)}},{key:"dimLinePoint",get:function get(){return new rn(this.imp.dimLinePoint())},set:function set(t){this.imp.setDimLinePoint(t.imp)}},{key:"oblique",get:function get(){return this.imp.oblique()},set:function set(t){this.imp.setOblique(t)}},{key:"rotation",get:function get(){return this.imp.rotation()},set:function set(t){this.imp.setRotation(t)}}]),McDbRotatedDimension}(zt),$t=function(h){_inherits$1(McDb2LineAngularDimension,h);var p=_createSuper$9(McDb2LineAngularDimension);function McDb2LineAngularDimension(h){var x;return _classCallCheck$1(this,McDb2LineAngularDimension),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDb2LineAngularDimension),x}return _createClass$1(McDb2LineAngularDimension,[{key:"arcPoint",get:function get(){return new rn(this.imp.arcPoint())},set:function set(t){this.imp.setArcPoint(t.imp)}},{key:"xLine1Start",get:function get(){return new rn(this.imp.xLine1Start())},set:function set(t){this.imp.setXLine1Start(t.imp)}},{key:"xLine1End",get:function get(){return new rn(this.imp.xLine1End())},set:function set(t){this.imp.setXLine1End(t.imp)}},{key:"xLine2Start",get:function get(){return new rn(this.imp.xLine2Start())},set:function set(t){this.imp.setXLine2Start(t.imp)}},{key:"xLine2End",get:function get(){return new rn(this.imp.xLine2End())},set:function set(t){this.imp.setXLine2End(t.imp)}},{key:"compute",value:function compute(t,h,p,x,M,k,I,N){return this.imp.compute(t,h,p,x,M,k,I,N)}}]),McDb2LineAngularDimension}(zt),Xt=function(h){_inherits$1(McDbArc,h);var p=_createSuper$9(McDbArc);function McDbArc(h){var x;return _classCallCheck$1(this,McDbArc),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbArc),x}return _createClass$1(McDbArc,[{key:"setCenter",value:function setCenter(t,h,p){this.imp.setCenter(new rn(t,h,p).imp)}},{key:"center",get:function get(){return new rn(this.imp.center())},set:function set(t){this.imp.setCenter(t.imp)}},{key:"radius",get:function get(){return this.imp.radius()},set:function set(t){this.imp.setRadius(t)}},{key:"startAngle",get:function get(){return this.imp.startAngle()},set:function set(t){this.imp.setStartAngle(t)}},{key:"endAngle",get:function get(){return this.imp.endAngle()},set:function set(t){this.imp.setEndAngle(t)}},{key:"computeArc",value:function computeArc(t,h,p,x,M,k){return this.imp.computeArc(t,h,p,x,M,k)}}]),McDbArc}(It),qt=function(h){_inherits$1(McDbEllipse,h);var p=_createSuper$9(McDbEllipse);function McDbEllipse(h,x,M,k,I,N,V,ee,te){var re;return _classCallCheck$1(this,McDbEllipse),h instanceof Object?re=p.call(this,h):((re=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbEllipse),"number"==typeof h&&(V||(V=1),"number"!=typeof ee&&(ee=0),"number"!=typeof te&&(te=2*Math.PI),re.imp.InitData(new rn(h,x,M).imp,new nn(k,I,N).imp,V,ee,te))),_possibleConstructorReturn$1(re)}return _createClass$1(McDbEllipse,[{key:"setCenter",value:function setCenter(t,h,p){this.imp.setCenter(new rn(t,h,p).imp)}},{key:"center",get:function get(){return new rn(this.imp.center())},set:function set(t){this.imp.setCenter(t.imp)}},{key:"setMajorAxis",value:function setMajorAxis(t,h,p){this.imp.setMajorAxis(new nn(t,h,p).imp)}},{key:"majorAxis",get:function get(){return new nn(this.imp.majorAxis())},set:function set(t){this.imp.setMajorAxis(t.imp)}},{key:"setMinorAxis",value:function setMinorAxis(t,h,p){this.imp.setMinorAxis(new nn(t,h,p).imp)}},{key:"minorAxis",get:function get(){return new nn(this.imp.minorAxis())},set:function set(t){this.imp.setMinorAxis(t.imp)}},{key:"radiusRatio",get:function get(){return this.imp.radiusRatio()},set:function set(t){this.imp.setRadiusRatio(t)}},{key:"startAngle",get:function get(){return this.imp.startAngle()},set:function set(t){this.imp.setStartAngle(t)}},{key:"endAngle",get:function get(){return this.imp.endAngle()},set:function set(t){this.imp.setEndAngle(t)}}]),McDbEllipse}(It),Kt=function(h){_inherits$1(McDbPoint,h);var p=_createSuper$9(McDbPoint);function McDbPoint(h,x,M){var k;return _classCallCheck$1(this,McDbPoint),h instanceof Object?h instanceof rn?((k=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbPoint),k.imp.setPosition(h.imp)):k=p.call(this,h):((k=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbPoint),"number"==typeof h&&k.imp.setPosition(new rn(h,x,M).imp)),_possibleConstructorReturn$1(k)}return _createClass$1(McDbPoint,[{key:"setPosition",value:function setPosition(t,h,p){this.imp.setPosition(new rn(t,h,p).imp)}},{key:"position",get:function get(){return new rn(this.imp.position())},set:function set(t){this.imp.setPosition(t.imp)}}]),McDbPoint}(Et),Yt=function(h){_inherits$1(McDbHatch,h);var p=_createSuper$9(McDbHatch);function McDbHatch(h){var x;return _classCallCheck$1(this,McDbHatch),h instanceof Object?x=p.call(this,h):(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbHatch),_possibleConstructorReturn$1(x)}return _createClass$1(McDbHatch,[{key:"numLoops",get:function get(){return this.imp.numLoops()}},{key:"loopTypeAt",value:function loopTypeAt(t){return this.imp.loopTypeAt(t)}},{key:"getLoopAt",value:function getLoopAt(h){var p=this.imp.getLoopAt(h);if(!p)return{ret:!1,lootype:0,vertices:[],bulges:[]};var x=p.GetCount();if(x<=0)return t.MxCpp.App.destroyObject(p),{ret:!1,lootype:0,vertices:[],bulges:[]};var M;M=p.Atlong(0);for(var k=[],I=[],N=1;N+1<x;N+=2)k.push(new rn(p.AtPoint(N))),I.push(p.AtDouble(N+1));return t.MxCpp.App.destroyObject(p),{ret:!0,lootype:M,vertices:k,bulges:I}}},{key:"patternType",value:function patternType(){return this.imp.patternType()}},{key:"patternName",value:function patternName(){return tt.decodeFromGb2312(this.imp.patternName())}},{key:"setPattern",value:function setPattern(t,h){this.imp.setPattern(t,tt.encodeToGb2312(h))}},{key:"patternAngle",get:function get(){return this.imp.patternAngle()},set:function set(t){this.imp.setPatternAngle(t)}},{key:"patternScale",get:function get(){return this.imp.patternScale()},set:function set(t){this.imp.setPatternScale(t)}},{key:"patternSpace",get:function get(){return this.imp.patternSpace()},set:function set(t){this.imp.setPatternSpace(t)}},{key:"patternDouble",get:function get(){return this.imp.patternDouble()},set:function set(t){this.imp.setPatternDouble(t)}},{key:"numPatternDefinitions",get:function get(){return this.imp.numPatternDefinitions()}},{key:"getPatternDefinitionAt",value:function getPatternDefinitionAt(h){var p=this.imp.getPatternDefinitionAt(h);if(!p)return{ret:!1,angle:0,baseX:0,baseY:0,offsetX:0,offsetY:0,aryDashes:[]};var x=p.length();if(x<5)return t.MxCpp.App.getImp().DestroyMdGeDoubleArray(p),{ret:!1,angle:0,baseX:0,baseY:0,offsetX:0,offsetY:0,aryDashes:[]};for(var M=p.at(0),k=p.at(1),I=p.at(2),N=p.at(3),V=p.at(4),ee=[],te=5;te<x;te++)ee.push(p.at(te));return t.MxCpp.App.getImp().DestroyMdGeDoubleArray(p),{ret:!1,angle:M,baseX:k,baseY:I,offsetX:N,offsetY:V,aryDashes:ee}}},{key:"addPatternDefinition",value:function addPatternDefinition(t,h,p,x,M,k){var I=new hn;return k.forEach((function(t){I.append(t)})),this.imp.addPatternDefinition(t,h,p,x,M,I.imp)}},{key:"clearPatternDefinition",value:function clearPatternDefinition(){return this.imp.clearPatternDefinition()}},{key:"hatchStyle",value:function hatchStyle(){return this.imp.hatchStyle()}},{key:"setHatchStyle",value:function setHatchStyle(t){return this.imp.setHatchStyle(t)}},{key:"appendLoop",value:function appendLoop(h){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.McDb.HatchLoopType.kPolyline,M=new hn;return p.forEach((function(t){M.append(t)})),this.imp.appendLoop(x,h.imp,M.imp)}},{key:"appendCircleLoop",value:function appendCircleLoop(h,p,x){var M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.McDb.HatchLoopType.kPolyline;return this.imp.appendCircleLoop(k,h,p,0,x,M)}},{key:"removeLoopAt",value:function removeLoopAt(t){return this.imp.removeLoopAt(t)}},{key:"removeAllLoop",value:function removeAllLoop(){return this.imp.removeAllLoop()}},{key:"setLoopAt",value:function setLoopAt(h,p,x){var M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.McDb.HatchLoopType.kPolyline,k=new hn;return x.forEach((function(t){k.append(t)})),this.imp.setLoopAt(h,M,p.imp,k.imp)}},{key:"isSolid",value:function isSolid(){return this.imp.isSolid()}},{key:"scalePattern",value:function scalePattern(t){return this.imp.scalePattern(t)}}]),McDbHatch}(Et),Zt=function(h){_inherits$1(McDbProxyEntity,h);var p=_createSuper$9(McDbProxyEntity);function McDbProxyEntity(h){var x;return _classCallCheck$1(this,McDbProxyEntity),h instanceof Object?x=p.call(this,h):(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbProxyEntity),_possibleConstructorReturn$1(x)}return _createClass$1(McDbProxyEntity,[{key:"getAllTextContent",value:function getAllTextContent(){return new un(this.imp.getAllTextContent())}},{key:"getAllEntityIds",value:function getAllEntityIds(){for(var h=[],p=this.imp.getAllEntityIds(),x=p.length(),M=0;M<x;M++)h.push(new mt(p.at(M),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(p),h}},{key:"getOriginalClassName",value:function getOriginalClassName(){return this.imp.getOriginalClassName()}}]),McDbProxyEntity}(Et),Jt=function(h){_inherits$1(McDbRasterImage,h);var p=_createSuper$9(McDbRasterImage);function McDbRasterImage(h){var x;return _classCallCheck$1(this,McDbRasterImage),h instanceof Object?x=p.call(this,h):(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbRasterImage),_possibleConstructorReturn$1(x)}return _createClass$1(McDbRasterImage,[{key:"setOrientation",value:function setOrientation(t,h,p){return this.imp.setOrientation(t.imp,h.imp,p.imp)}},{key:"getOrientation",value:function getOrientation(){var t=this.imp.getOrientation();return t.length()<3?{origin:new rn,uCorner:nn.kXAxis.clone(),vOnPlane:nn.kYAxis.clone()}:{origin:new rn(t.at(0)),uCorner:new nn(t.at(1)),vOnPlane:new nn(t.at(2))}}},{key:"setDwgImageSize",value:function setDwgImageSize(t,h){return this.imp.setImageSize(t,h)}},{key:"getDwgImageSize",value:function getDwgImageSize(){var t=this.imp.getImageSize();return[t.x,t.y]}},{key:"setImageDefId",value:function setImageDefId(t){t.type==pt.kMxCAD&&this.imp.setImageDefId(t.id)}},{key:"imageDefId",value:function imageDefId(){return new mt(this.imp.imageDefId(),pt.kMxCAD)}},{key:"setClipBoundary",value:function setClipBoundary(t,h){return this.imp.setClipBoundary(t,h.imp)}},{key:"clipBoundary",value:function clipBoundary(){return new ln(this.imp.clipBoundary())}},{key:"clipBoundaryType",value:function clipBoundaryType(){return this.imp.clipBoundaryType()}}]),McDbRasterImage}(Et),Qt=function(h){_inherits$1(McDbWipeout,h);var p=_createSuper$9(McDbWipeout);function McDbWipeout(h){var x;return _classCallCheck$1(this,McDbWipeout),h instanceof Object?x=p.call(this,h):(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbWipeout),_possibleConstructorReturn$1(x)}return _createClass$1(McDbWipeout,[{key:"setVertices",value:function setVertices(t){return this.imp.setVertices(t.imp)}},{key:"getVertices",value:function getVertices(){return new ln(this.imp.getVertices())}}]),McDbWipeout}(Et),er=function(h){_inherits$1(McDbBackgroundEntity,h);var p=_createSuper$9(McDbBackgroundEntity);function McDbBackgroundEntity(t){return _classCallCheck$1(this,McDbBackgroundEntity),p.call(this,t)}return _createClass$1(McDbBackgroundEntity,[{key:"setShow",value:function setShow(t,h){return this.imp.setShow(tt.encodeToGb2312(t),h)}},{key:"isShow",value:function isShow(t){return this.imp.isShow(tt.encodeToGb2312(t))}},{key:"setShowColor",value:function setShowColor(t,h){return this.imp.setShowColor(tt.encodeToGb2312(t),h)}},{key:"getBackgroundDatabase",value:function getBackgroundDatabase(h){var p=this.imp.getBackgroundDatabase(tt.encodeToGb2312(h));return p.isNull()?(t.MxCpp.App.destroyObject(p),null):new Ir(p)}},{key:"clearAll",value:function clearAll(){return this.imp.clearAll()}},{key:"clearDwg",value:function clearDwg(t){return this.imp.clearDwg(tt.encodeToGb2312(t))}}]),McDbBackgroundEntity}(Et),tr=function(h){_inherits$1(McDbSpline,h);var p=_createSuper$9(McDbSpline);function McDbSpline(h){var x;return _classCallCheck$1(this,McDbSpline),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbSpline),x}return _createClass$1(McDbSpline,[{key:"getNurbsData",value:function getNurbsData(){var h=this.imp.GetNurbsDataParam(),p=h.Atlong(0),x=1==h.Atlong(1),M=1==h.Atlong(2),k=1==h.Atlong(3),I=h.AtDouble(4),N=h.AtDouble(5);return t.MxCpp.App.destroyObject(h),{degree:p,rational:x,closed:M,periodic:k,controlPoints:new ln(this.imp.GetControlPoints(),!0),knots:new hn(this.imp.GetKnots(),!0),weights:new hn(this.imp.GetWeights(),!0),controlPtTol:I,knotTol:N}}},{key:"setNurbsData",value:function setNurbsData(t){var h=new bt;return h.AddLong(t.degree),h.AddLong(t.rational?1:0),h.AddLong(t.closed?1:0),h.AddLong(t.periodic?1:0),h.AddDouble(t.controlPtTol),h.AddDouble(t.knotTol),this.imp.SetNurbsData(h.getImp(),t.controlPoints.imp,t.knots.imp,t.weights.imp),!0}},{key:"getFitPoints",value:function getFitPoints(){var h=this.imp.GetFitDataParam(),p=h.Atlong(0),x=h.AtDouble(1),M=1==h.Atlong(2),k=h.AtPoint(3),I=h.AtPoint(4),N=new nn(k.x,k.y,k.z),V=new nn(I.x,I.y,I.z);return t.MxCpp.App.destroyObject(h),{degree:p,fitTolerance:x,tangentsExist:M,startTangent:N,endTangent:V,fitPoints:new ln(this.imp.GeFitPoints(),!0)}}},{key:"setFitPoints",value:function setFitPoints(t){var h=new bt;return h.AddLong(t.degree),h.AddDouble(t.fitTolerance),h.AddLong(t.tangentsExist?1:0),h.AddPoint(new rn(t.startTangent.x,t.startTangent.y,t.startTangent.z)),h.AddPoint(new rn(t.endTangent.x,t.endTangent.y,t.endTangent.z)),this.imp.SetFitData(h.getImp(),t.fitPoints.imp),!0}}]),McDbSpline}(It);function _createSuper$8(t){var h=function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var rr=function(t){return t[t.kClone=1]="kClone",t[t.kDragClone=2]="kDragClone",t[t.kCPPClone=3]="kCPPClone",t}(rr||{}),nr=function(t){return t[t.kWorldDraw=1]="kWorldDraw",t[t.kExplodeDraw=2]="kExplodeDraw",t}(nr||{}),ir=function(){function IMcDbDwgFiler(t){_classCallCheck$1(this,IMcDbDwgFiler),_defineProperty(this,"type",1),this.type=t}return _createClass$1(IMcDbDwgFiler,[{key:"getType",value:function getType(){return this.type}},{key:"writePoints",value:function writePoints(t,h){var p=this;this.writeLong(t+"_n",h.length),h.forEach((function(h,x){p.writePoint(t+"_"+x,h)}))}},{key:"readPoints",value:function readPoints(t){var h=[],p=this.readLong(t+"_n");if(p.ret)for(var x=0;x<p.val;x++){var M=this.readPoint(t+"_"+x);M.ret&&h.push(M.val)}return{val:h,ret:!0}}}]),IMcDbDwgFiler}(),ar=function(t){_inherits$1(McDbDwgFiler,t);var h=_createSuper$8(McDbDwgFiler);function McDbDwgFiler(){var t,p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return _classCallCheck$1(this,McDbDwgFiler),_defineProperty(_assertThisInitialized$1(t=h.call(this,p)),"data",{}),t}return _createClass$1(McDbDwgFiler,[{key:"writePoint",value:function writePoint(t,h){this.data[t]=h.clone()}},{key:"readPoint",value:function readPoint(t){return this.data[t]&&this.data[t]instanceof rn?{val:this.data[t],ret:!0}:{val:new rn(0,0,0),ret:!1}}},{key:"writeLong",value:function writeLong(t,h){this.data[t]=h}},{key:"readLong",value:function readLong(t){return this.data[t]&&"number"==typeof this.data[t]?{val:this.data[t],ret:!0}:{val:0,ret:!1}}},{key:"writeDouble",value:function writeDouble(t,h){this.data[t]=h}},{key:"readDouble",value:function readDouble(t){return this.data[t]&&"number"==typeof this.data[t]?{val:this.data[t],ret:!0}:{val:0,ret:!1}}},{key:"writeString",value:function writeString(t,h){this.data[t]=h}},{key:"readString",value:function readString(t){return this.data[t]&&"string"==typeof this.data[t]?{val:this.data[t],ret:!0}:{val:"",ret:!1}}}]),McDbDwgFiler}(ir),or=function(){function MxCADWorldDraw(h){_classCallCheck$1(this,MxCADWorldDraw),_defineProperty(this,"imp",void 0),_defineProperty(this,"type",1),this.imp=new t.MxCpp.mxcadassemblyimp.MdGiWorldDraw(h)}return _createClass$1(MxCADWorldDraw,[{key:"getDatabase",value:function getDatabase(){return new Ir(this.imp.getDatabase())}},{key:"setupForEntity",value:function setupForEntity(t){return this.imp.setupForEntity(t.imp)}},{key:"drawEntity",value:function drawEntity(t){this.imp.drawEntity(t.imp)}},{key:"drawOsnapEntity",value:function drawOsnapEntity(t){this.imp.drawOsnapEntity(t.imp)}},{key:"trueColor",get:function get(){return new Cr(this.imp.trueColor())},set:function set(t){this.imp.setTrueColor(t.getImp())}},{key:"layerId",get:function get(){return new mt(this.imp.layerId())},set:function set(t){this.imp.setLayerId(t.id)}},{key:"lineTypeId",get:function get(){return new mt(this.imp.lineTypeId())},set:function set(t){this.imp.setLineTypeId(t.id)}},{key:"lineWeight",get:function get(){return new this.imp.lineWeight},set:function set(t){this.imp.setLineWeight(t)}},{key:"lineTypeScale",get:function get(){return new this.imp.lineTypeScale},set:function set(t){this.imp.setLineTypeScale(t)}},{key:"getType",value:function getType(){return this.type}},{key:"initType",value:function initType(t){this.type=t}}]),MxCADWorldDraw}(),sr=function(h){_inherits$1(McDbCustomEntity,h);var p=_createSuper$8(McDbCustomEntity);function McDbCustomEntity(h){var x;return _classCallCheck$1(this,McDbCustomEntity),h instanceof Object?x=p.call(this,h):(x=p.call(this)).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbCustomEntity(x.getTypeName())),_possibleConstructorReturn$1(x)}return _createClass$1(McDbCustomEntity,[{key:"rxInit",value:function rxInit(){cr.rxInit(this)}},{key:"clone",value:function clone(){var t=this.create(),h=new ar(1);return this.dwgOutFields(h),t.dwgInFields(h),t}},{key:"syncData",value:function syncData(){if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){var h=this.imp.getFilter(!0),p=new lr(h);this.dwgOutFields(p),t.MxCpp.App.getImp().DestroyMdDbCustomEntityDwgFiler(h)}else{var x=this.imp.getFilter(!1),M=new lr(x);this.dwgInFields(M),t.MxCpp.App.getImp().DestroyMdDbCustomEntityDwgFiler(x)}return!0}},{key:"tempRelationObject",value:function tempRelationObject(){return cr.tmpRelationObject(this)}},{key:"freeTempRelationObject",value:function freeTempRelationObject(){cr.freeTmpObject(this)}},{key:"assertWrite",value:function assertWrite(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.imp.assertWrite(t,!0,!0,!0,!1)}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){}},{key:"getGripPoints",value:function getGripPoints(){return new ln}},{key:"transformBy",value:function transformBy(t){return!1}},{key:"getName",value:function getName(){return this.getTypeName()}},{key:"getBoundingBox",value:function getBoundingBox(){return{minPt:new rn,maxPt:new rn,ret:!1}}}]),McDbCustomEntity}(Et);function _createSuper$7(t){var h=function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var cr,ur=function(){function MxCustomEntityManagerImp(){_classCallCheck$1(this,MxCustomEntityManagerImp),_defineProperty(this,"mapType2Create",new Map),_defineProperty(this,"mapId2DatabaseMap",{}),_defineProperty(this,"alloc_id",1),_defineProperty(this,"alloc_tempid",1),_defineProperty(this,"mapTempId2Entity",new Map)}return _createClass$1(MxCustomEntityManagerImp,[{key:"rxInit",value:function rxInit(t){var h=t.getTypeName();this.mapType2Create.get(h),this.mapType2Create.set(h,t)}},{key:"tmpRelationObject",value:function tmpRelationObject(t){return this.alloc_tempid>9007199254740900&&(this.alloc_tempid=1),this.alloc_tempid+=1,t.imp.setCustomEntityTempid(this.alloc_tempid),this.mapTempId2Entity.set(this.alloc_tempid,t),this.alloc_tempid}},{key:"freeTmpObject",value:function freeTmpObject(t){if("number"==typeof t)this.mapTempId2Entity.delete(t);else{var h=t.imp.getCustomEntityTempid();t.imp.setCustomEntityTempid(0),this.mapTempId2Entity.delete(h)}}},{key:"getTmpObject",value:function getTmpObject(t){return this.mapTempId2Entity.get(t)}},{key:"allocId",value:function allocId(){return this.alloc_id>9007199254740900&&(this.alloc_id=1),this.alloc_id+=1,this.alloc_id}},{key:"isHaveType",value:function isHaveType(t){return this.mapType2Create.has(t)}},{key:"createMxEntity",value:function createMxEntity(t,h){if(0==t.length)return null;var p=this.mapType2Create.get(t);if(!p)return null;var x=p.create(h);return x.getTypeName(),x}},{key:"relationObject",value:function relationObject(t,h){if(0==h)return 0;var p=this.allocId(),x=this.mapId2DatabaseMap[h];return x||(x=new Map,this.mapId2DatabaseMap[h]=x),x.set(p,{idIndex:t,init:!1,customEntity:null}),p}},{key:"freeObject",value:function freeObject(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0==h)for(var p in this.mapId2DatabaseMap){this.mapId2DatabaseMap[p].delete(t)}else{var x=this.mapId2DatabaseMap[h];if(!x)return;x.delete(t)}}},{key:"freeDatabase",value:function freeDatabase(t){this.mapId2DatabaseMap.hasOwnProperty(t)&&delete this.mapId2DatabaseMap[t]}},{key:"getObjectFormId",value:function getObjectFormId(h){return h.isValid()&&h.type==pt.kMxCAD&&t.MxCpp.App.objectIdIsKindOf(h.id,"McDbCustomEntity")?t.MxCpp.App.objectIdToObject(h.id):null}},{key:"getObject",value:function getObject(h){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0==h)return null;var x=void 0;if(0!=p){var M=this.mapId2DatabaseMap[p];if(!M)return null;x=M.get(h)}else for(var k in this.mapId2DatabaseMap){if(x=this.mapId2DatabaseMap[k].get(h)){p=parseInt(k);break}}if(!x)return null;if(x.customEntity)return x.customEntity;if(x.init)return null;x.init=!0;var I=t.MxCpp.App.getImp().ObjectIdToMdDbCustomEntity(x.idIndex);if(!I)return null;var N=cr.createMxEntity(I.getCustomEntityTypeName(),I);return null==N?null:(N.syncData(!1),x.customEntity=N,N)}},{key:"init",value:function init(){var t=window;t.MxCustomEntityManager_freeObject=function(t,h){cr.freeObject(t,h)},t.MxCustomEntityManager_relationObject=function(t,h){return cr.relationObject(t,h)},t.MxCustomEntityManager_freeDatabase=function(t){cr.freeDatabase(t)},t.MxCustomEntityManager_worldDraw=function(t,h,p,x,M,k){var I;if(I=0!=x?cr.getTmpObject(x):cr.getObject(t,h)){var N=new or(p);0!==M&&N.imp.connectVecOsnapEntity(M),0!==k&&(N.initType(nr.kExplodeDraw),N.imp.connectVecExplodeEntity(k)),I.worldDraw(N)}},t.MxCustomEntityManager_getGeomExtents=function(t,h,p,x){var M;if(M=0!=x?cr.getTmpObject(x):cr.getObject(t,h)){var k=M.getBoundingBox();if(k.ret){var I=new bt;I.getImp().Connect(p,!1),I.AddPoint(k.minPt),I.AddPoint(k.maxPt)}}},t.MxCustomEntityManager_syncData=function(t,h,p){var x=cr.getObject(t,h);x&&x.syncData(0!=p)},t.MxCustomEntityManager_transformBy=function(t,h,p,x){var M,k=new sn;k.imp.copyFormPointer(p),(M=0!=x?cr.getTmpObject(x):cr.getObject(t,h))&&M.transformBy(k)}}}]),MxCustomEntityManagerImp}(),lr=function(h){_inherits$1(McDbDwgFilerCpp,h);var p=_createSuper$7(McDbDwgFilerCpp);function McDbDwgFilerCpp(h){var x;return _classCallCheck$1(this,McDbDwgFilerCpp),_defineProperty(_assertThisInitialized$1(x=p.call(this,rr.kCPPClone)),"imp",void 0),h||(h=new t.MxCpp.mxcadassemblyimp.MdDbCustomEntityDwgFiler),x.imp=h,x}return _createClass$1(McDbDwgFilerCpp,[{key:"writePoint",value:function writePoint(t,h){this.imp.writePoint(t,h.imp.x,h.imp.y,h.imp.z)}},{key:"readPoint",value:function readPoint(h){var p=this.imp.readPoint(h),x={};return x=0==t.MxCpp.getCallResult()?{val:new rn(p),ret:!0}:{val:new rn,ret:!1},t.MxCpp.App.getImp().DestroyMdGePoint3d(p),x}},{key:"writeLong",value:function writeLong(t,h){this.imp.writeLong(t,h)}},{key:"readLong",value:function readLong(h){var p=this.imp.readLong(h);return 0==t.MxCpp.getCallResult()?{val:p,ret:!0}:{val:0,ret:!1}}},{key:"writeDouble",value:function writeDouble(t,h){this.imp.writeDouble(t,h)}},{key:"readDouble",value:function readDouble(h){var p=this.imp.readDouble(h);return 0==t.MxCpp.getCallResult()?{val:p,ret:!0}:{val:0,ret:!1}}},{key:"writeString",value:function writeString(t,h){this.imp.writeString(t,h)}},{key:"readString",value:function readString(h){var p=this.imp.readString(h);return 0==t.MxCpp.getCallResult()?{val:p,ret:!0}:{val:"",ret:!1}}}]),McDbDwgFilerCpp}(ir);function _createSuper$6(t){var h=function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}cr=new ur;var hr,fr,dr,pr,mr,gr,vr,yr,br,xr,Mr,wr,_r=function(t){return t[t.kEntityType=5020]="kEntityType",t[t.kLayer=8]="kLayer",t[t.kBlockName=2]="kBlockName",t[t.kColor=62]="kColor",t[t.kAppName=-3]="kAppName",t[t.kLong=1071]="kLong",t[t.kDouble=1040]="kDouble",t[t.kString=1e3]="kString",t[t.kPoint=1010]="kPoint",t[t.kEntityId=-8e3]="kEntityId",t[t.kEntity=-8500]="kEntity",t[t.kExDataName=1001]="kExDataName",t}(_r||{});t.McDb=void 0,hr=t.McDb||(t.McDb={}),(fr=hr.PolylineType||(hr.PolylineType={}))[fr.kLwPolyline=0]="kLwPolyline",fr[fr.k3dPolyline=2]="k3dPolyline",(dr=hr.TextHorzMode||(hr.TextHorzMode={}))[dr.kTextLeft=0]="kTextLeft",dr[dr.kTextCenter=1]="kTextCenter",dr[dr.kTextRight=2]="kTextRight",dr[dr.kTextAlign=3]="kTextAlign",dr[dr.kTextMid=4]="kTextMid",dr[dr.kTextFit=5]="kTextFit",(pr=hr.Intersect||(hr.Intersect={}))[pr.kOnBothOperands=0]="kOnBothOperands",pr[pr.kExtendThis=1]="kExtendThis",pr[pr.kExtendArg=2]="kExtendArg",pr[pr.kExtendBoth=3]="kExtendBoth",(mr=hr.TextVertMode||(hr.TextVertMode={}))[mr.kTextBase=0]="kTextBase",mr[mr.kTextBottom=1]="kTextBottom",mr[mr.kTextVertMid=2]="kTextVertMid",mr[mr.kTextTop=3]="kTextTop",(gr=hr.AttachmentPoint||(hr.AttachmentPoint={}))[gr.kTopLeft=1]="kTopLeft",gr[gr.kTopCenter=2]="kTopCenter",gr[gr.kTopRight=3]="kTopRight",gr[gr.kMiddleLeft=4]="kMiddleLeft",gr[gr.kMiddleCenter=5]="kMiddleCenter",gr[gr.kMiddleRight=6]="kMiddleRight",gr[gr.kBottomLeft=7]="kBottomLeft",gr[gr.kBottomCenter=8]="kBottomCenter",gr[gr.kBottomRight=9]="kBottomRight",gr[gr.kBaseLeft=10]="kBaseLeft",gr[gr.kBaseCenter=11]="kBaseCenter",gr[gr.kBaseRight=12]="kBaseRight",gr[gr.kBaseAlign=13]="kBaseAlign",gr[gr.kBottomAlign=14]="kBottomAlign",gr[gr.kMiddleAlign=15]="kMiddleAlign",gr[gr.kTopAlign=16]="kTopAlign",gr[gr.kBaseFit=17]="kBaseFit",gr[gr.kBottomFit=18]="kBottomFit",gr[gr.kMiddleFit=19]="kMiddleFit",gr[gr.kTopFit=20]="kTopFit",gr[gr.kBaseMid=21]="kBaseMid",gr[gr.kBottomMid=22]="kBottomMid",gr[gr.kMiddleMid=23]="kMiddleMid",gr[gr.kTopMid=24]="kTopMid",(vr=hr.LineWeight||(hr.LineWeight={}))[vr.kLnWt000=0]="kLnWt000",vr[vr.kLnWt005=5]="kLnWt005",vr[vr.kLnWt009=9]="kLnWt009",vr[vr.kLnWt013=13]="kLnWt013",vr[vr.kLnWt015=15]="kLnWt015",vr[vr.kLnWt018=18]="kLnWt018",vr[vr.kLnWt020=20]="kLnWt020",vr[vr.kLnWt025=25]="kLnWt025",vr[vr.kLnWt030=30]="kLnWt030",vr[vr.kLnWt035=35]="kLnWt035",vr[vr.kLnWt040=40]="kLnWt040",vr[vr.kLnWt050=50]="kLnWt050",vr[vr.kLnWt053=53]="kLnWt053",vr[vr.kLnWt060=60]="kLnWt060",vr[vr.kLnWt070=70]="kLnWt070",vr[vr.kLnWt080=80]="kLnWt080",vr[vr.kLnWt090=90]="kLnWt090",vr[vr.kLnWt100=100]="kLnWt100",vr[vr.kLnWt106=106]="kLnWt106",vr[vr.kLnWt120=120]="kLnWt120",vr[vr.kLnWt140=140]="kLnWt140",vr[vr.kLnWt158=158]="kLnWt158",vr[vr.kLnWt200=200]="kLnWt200",vr[vr.kLnWt211=211]="kLnWt211",vr[vr.kLnWtByLayer=-1]="kLnWtByLayer",vr[vr.kLnWtByBlock=-2]="kLnWtByBlock",vr[vr.kLnWtByLwDefault=-3]="kLnWtByLwDefault",(yr=hr.HatchLoopType||(hr.HatchLoopType={}))[yr.kDefault=0]="kDefault",yr[yr.kExternal=1]="kExternal",yr[yr.kPolyline=2]="kPolyline",yr[yr.kDerived=4]="kDerived",yr[yr.kTextbox=8]="kTextbox",yr[yr.kOutermost=16]="kOutermost",yr[yr.kNotClosed=32]="kNotClosed",yr[yr.kSelfIntersecting=64]="kSelfIntersecting",yr[yr.kTextIsland=128]="kTextIsland",(br=hr.HatchEdgeType||(hr.HatchEdgeType={}))[br.kLine=1]="kLine",br[br.kCirArc=2]="kCirArc",br[br.kEllArc=3]="kEllArc",br[br.kSpline=4]="kSpline",(xr=hr.HatchPatternType||(hr.HatchPatternType={}))[xr.kUserDefined=0]="kUserDefined",xr[xr.kPreDefined=1]="kPreDefined",xr[xr.kCustomDefined=2]="kCustomDefined",(Mr=hr.HatchStyle||(hr.HatchStyle={}))[Mr.kNormal=0]="kNormal",Mr[Mr.kOuter=1]="kOuter",Mr[Mr.kIgnore=2]="kIgnore",(wr=hr.ClipBoundaryType||(hr.ClipBoundaryType={}))[wr.kInvalid=0]="kInvalid",wr[wr.kRect=1]="kRect",wr[wr.kPoly=2]="kPoly";var Cr=function(){function McCmColor(h,p,x,M){_classCallCheck$1(this,McCmColor),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdCmColor,h instanceof Object?(this.imp.red=h.red,this.imp.green=h.green,this.imp.blue=h.blue,this.imp.method=h.method,this.imp.n=h.n,this.imp.colorIndex=h.colorIndex):"number"==typeof h&&"number"==typeof p&&"number"==typeof x&&(this.imp.setRGB(h,p,x),"number"==typeof M&&(this.imp.n=M))}return _createClass$1(McCmColor,[{key:"getImp",value:function getImp(){return this.imp}},{key:"copy",value:function copy(t){return this.imp.red=t.imp.red,this.imp.green=t.imp.green,this.imp.blue=t.imp.blue,this.imp.method=t.imp.method,this.imp.n=t.imp.n,this.imp.colorIndex=t.imp.colorIndex,this}},{key:"clone",value:function clone(){return new McCmColor(this.imp)}},{key:"setColorIndex",value:function setColorIndex(t){this.imp.setColorIndex(t)}},{key:"setRGB",value:function setRGB(t,h,p){this.imp.setRGB(t,h,p)}},{key:"red",get:function get(){return this.imp.red},set:function set(t){this.imp.red=t}},{key:"green",get:function get(){return this.imp.green},set:function set(t){this.imp.green=t}},{key:"blue",get:function get(){return this.imp.blue},set:function set(t){this.imp.blue=t}},{key:"n",get:function get(){return this.imp.n},set:function set(t){this.imp.n=t}},{key:"method",get:function get(){return this.imp.method},set:function set(t){this.imp.method=t}},{key:"colorIndex",get:function get(){return this.imp.colorIndex},set:function set(t){this.imp.colorIndex=t}},{key:"getColorString",value:function getColorString(){return this.imp.getColorString()}},{key:"getColorValue",value:function getColorValue(t,h){var p=0;(null==t?void 0:t.type)==pt.kMxCAD&&(p=t.id);var x=0;return(null==h?void 0:h.type)==pt.kMxCAD&&(x=h.id),this.imp.getColorValue(p,x)}},{key:"getStyle",value:function getStyle(){var t=this.red,h=this.green,p=this.blue,x=this.colorIndex,M=Oi(t/255,h/255,p/255);if(x===Bi.kWhite){var k={h:0,s:0,l:0};M.getHSL(k),k.h=(k.h+.5)%1,M.setHSL(k.h,k.s,k.l)}return M.getStyle()}}]),McCmColor}(),Sr=function(h){_inherits$1(McDbLinetypeTableRecord,h);var p=_createSuper$6(McDbLinetypeTableRecord);function McDbLinetypeTableRecord(h){var x;return _classCallCheck$1(this,McDbLinetypeTableRecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbLinetypeTableRecord),x}return _createClass$1(McDbLinetypeTableRecord,[{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.getName())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}},{key:"numDashes",get:function get(){return this.imp.numDashes()},set:function set(t){this.imp.setNumDashes(t)}},{key:"dashLengthAt",value:function dashLengthAt(t){return this.imp.dashLengthAt(t)}},{key:"setDashLengthAt",value:function setDashLengthAt(t,h){return this.imp.setDashLengthAt(t,h)}},{key:"comments",get:function get(){return tt.decodeFromGb2312(this.imp.comments())},set:function set(t){this.imp.setComments(tt.encodeToGb2312(t))}},{key:"shapeStyleAt",value:function shapeStyleAt(t){return this.imp.shapeStyleAt(t)}},{key:"setShapeStyleAt",value:function setShapeStyleAt(t,h){return this.imp.setShapeStyleAt(t,h)}},{key:"shapeNumberAt",value:function shapeNumberAt(t){return this.imp.shapeNumberAt(t)}},{key:"setShapeNumberAt",value:function setShapeNumberAt(t,h){return this.imp.setShapeNumberAt(t,h)}},{key:"shapeOffsetAt",value:function shapeOffsetAt(t){return new nn(this.imp.shapeOffsetAt(t))}},{key:"setShapeOffsetAt",value:function setShapeOffsetAt(t,h){return this.imp.setShapeOffsetAt(t,h.imp)}},{key:"shapeScaleAt",value:function shapeScaleAt(t){return this.imp.shapeScaleAt(t)}},{key:"setShapeScaleAt",value:function setShapeScaleAt(t,h){return this.imp.setShapeScaleAt(t,h)}},{key:"isScaledToFit",get:function get(){return this.imp.isScaledToFit()},set:function set(t){this.imp.setIsScaledToFit(t)}},{key:"shapeIsUcsOrientedAt",value:function shapeIsUcsOrientedAt(t){return this.imp.shapeIsUcsOrientedAt(t)}},{key:"setShapeIsUcsOrientedAt",value:function setShapeIsUcsOrientedAt(t,h){return this.imp.setShapeScaleAt(t,h)}},{key:"shapeRotationAt",value:function shapeRotationAt(t){return this.imp.shapeRotationAt(t)}},{key:"setShapeRotationAt",value:function setShapeRotationAt(t,h){return this.imp.setShapeRotationAt(t,h)}},{key:"textAt",value:function textAt(t){return tt.decodeFromGb2312(this.imp.textAt(t))}},{key:"setTextAt",value:function setTextAt(t,h){return this.imp.setTextAt(t,tt.encodeToGb2312(h))}}]),McDbLinetypeTableRecord}(gt),Tr=function(h){_inherits$1(McDbDimStyleTableRecord,h);var p=_createSuper$6(McDbDimStyleTableRecord);function McDbDimStyleTableRecord(h){var x;return _classCallCheck$1(this,McDbDimStyleTableRecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbDimStyleTableRecord),x}return _createClass$1(McDbDimStyleTableRecord,[{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.getName())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}},{key:"getDimVarInt",value:function getDimVarInt(t){return this.imp.getDimVarInt(t)}},{key:"setDimVarInt",value:function setDimVarInt(t,h){return this.imp.setDimVarInt(t,h)}},{key:"getDimVarDouble",value:function getDimVarDouble(t){return this.imp.getDimVarDouble(t)}},{key:"setDimVarDouble",value:function setDimVarDouble(t,h){return this.imp.setDimVarDouble(t,h)}},{key:"getDimVarString",value:function getDimVarString(t){return tt.decodeFromGb2312(this.imp.getDimVarString(t))}},{key:"setDimVarString",value:function setDimVarString(t,h){return this.imp.setDimVarString(t,tt.encodeToGb2312(h))}},{key:"getDimVarObjectId",value:function getDimVarObjectId(t){return new mt(this.imp.getDimVarObjectId(t),pt.kMxCAD)}},{key:"setDimVarObjectId",value:function setDimVarObjectId(t,h){return this.imp.setDimVarObjectId(t,h.id)}},{key:"getDimblk",value:function getDimblk(){return this.imp.getDimblk()}},{key:"setDimblk",value:function setDimblk(t){return this.imp.setDimblk(t)}},{key:"getDimblk1",value:function getDimblk1(){return this.imp.getDimblk1()}},{key:"setDimblk1",value:function setDimblk1(t){return this.imp.setDimblk1(t)}},{key:"getDimblk2",value:function getDimblk2(){return this.imp.getDimblk2()}},{key:"setDimblk2",value:function setDimblk2(t){return this.imp.setDimblk2(t)}},{key:"getDimldrblk",value:function getDimldrblk(){return this.imp.getDimldrblk()}},{key:"setDimldrblk",value:function setDimldrblk(t){return this.imp.setDimldrblk(t)}}]),McDbDimStyleTableRecord}(gt),Ar=function(h){_inherits$1(McDbTextStyleTableRecord,h);var p=_createSuper$6(McDbTextStyleTableRecord);function McDbTextStyleTableRecord(h){var x;return _classCallCheck$1(this,McDbTextStyleTableRecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbTextStyleTableRecord),x}return _createClass$1(McDbTextStyleTableRecord,[{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.getName())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}},{key:"isShapeFile",get:function get(){return this.imp.isShapeFile()},set:function set(t){this.imp.setIsShapeFile(t)}},{key:"isVertical",get:function get(){return this.imp.isVertical()},set:function set(t){this.imp.setIsVertical(t)}},{key:"textSize",get:function get(){return this.imp.textSize()},set:function set(t){this.imp.setTextSize(t)}},{key:"xScale",get:function get(){return this.imp.xScale()},set:function set(t){this.imp.setXScale(t)}},{key:"obliquingAngle",get:function get(){return this.imp.obliquingAngle()},set:function set(t){this.imp.setObliquingAngle(t)}},{key:"flagBits",get:function get(){return this.imp.flagBits()},set:function set(t){this.imp.setFlagBits(t)}},{key:"fileName",get:function get(){return tt.decodeFromGb2312(this.imp.fileName())},set:function set(t){this.imp.setFileName(tt.encodeToGb2312(t))}},{key:"bigFontFileName",get:function get(){return tt.decodeFromGb2312(this.imp.bigFontFileName())},set:function set(t){this.imp.setBigFontFileName(tt.encodeToGb2312(t))}},{key:"setFont",value:function setFont(t,h,p,x,M){return this.imp.setFont(tt.encodeToGb2312(t),h,p,x,M)}},{key:"font",value:function font(){var t=this.imp.font();return t?{sTypeface:tt.decodeFromGb2312(t.AtString(0,!0)),bold:0!=t.Atlong(1),italic:0!=t.Atlong(2),charset:t.Atlong(3),pitchAndFamily:t.Atlong(4)}:{sTypeface:"",bold:!1,italic:!1,charset:0,pitchAndFamily:0}}}]),McDbTextStyleTableRecord}(gt),Dr=function(h){_inherits$1(McDbLayerTableRecord,h);var p=_createSuper$6(McDbLayerTableRecord);function McDbLayerTableRecord(h){var x;return _classCallCheck$1(this,McDbLayerTableRecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbLayerTableRecord),x}return _createClass$1(McDbLayerTableRecord,[{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.getName())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}},{key:"isFrozen",get:function get(){return this.imp.isFrozen()},set:function set(t){this.imp.setIsFrozen(t)}},{key:"isOff",get:function get(){return this.imp.isOff()},set:function set(t){this.imp.setIsOff(t)}},{key:"isLocked",get:function get(){return this.imp.isLocked()},set:function set(t){this.imp.setIsLocked(t)}},{key:"color",get:function get(){return new Cr(this.imp.color())},set:function set(t){this.imp.setColor(t.getImp())}},{key:"linetypeObjectId",get:function get(){return new mt(this.imp.linetypeObjectId(),pt.kMxCAD)},set:function set(t){this.imp.setLinetypeObjectId(t.id)}},{key:"lineWeight",get:function get(){return this.imp.lineWeight()},set:function set(t){this.imp.setLineWeight(t)}}]),McDbLayerTableRecord}(gt),kr=function(h){_inherits$1(McDbLayerTable,h);var p=_createSuper$6(McDbLayerTable);function McDbLayerTable(t){return _classCallCheck$1(this,McDbLayerTable),p.call(this,t)}return _createClass$1(McDbLayerTable,[{key:"getAllRecordId",value:function getAllRecordId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllRecordId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"add",value:function add(t){return new mt(this.imp.add(t.getImp()),pt.kMxCAD)}},{key:"get",value:function get(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.get(p,h))}},{key:"has",value:function has(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return 0!=this.imp.get(p,h)}}]),McDbLayerTable}(gt),Pr=function(h){_inherits$1(McDbLinetypeTable,h);var p=_createSuper$6(McDbLinetypeTable);function McDbLinetypeTable(t){return _classCallCheck$1(this,McDbLinetypeTable),p.call(this,t)}return _createClass$1(McDbLinetypeTable,[{key:"getAllRecordId",value:function getAllRecordId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllRecordId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"add",value:function add(t){return new mt(this.imp.add(t.getImp()),pt.kMxCAD)}},{key:"get",value:function get(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.get(p,h))}},{key:"has",value:function has(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return 0!=this.imp.get(p,h)}}]),McDbLinetypeTable}(gt),Lr=function(h){_inherits$1(McDbDimStyleTable,h);var p=_createSuper$6(McDbDimStyleTable);function McDbDimStyleTable(t){return _classCallCheck$1(this,McDbDimStyleTable),p.call(this,t)}return _createClass$1(McDbDimStyleTable,[{key:"getAllRecordId",value:function getAllRecordId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllRecordId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"add",value:function add(t){return new mt(this.imp.add(t.getImp()),pt.kMxCAD)}},{key:"get",value:function get(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.get(p,h))}},{key:"has",value:function has(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return 0!=this.imp.get(p,h)}}]),McDbDimStyleTable}(gt),Er=function(h){_inherits$1(McDbTextStyleTable,h);var p=_createSuper$6(McDbTextStyleTable);function McDbTextStyleTable(t){return _classCallCheck$1(this,McDbTextStyleTable),p.call(this,t)}return _createClass$1(McDbTextStyleTable,[{key:"getAllRecordId",value:function getAllRecordId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllRecordId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"add",value:function add(t){return new mt(this.imp.add(t.getImp()),pt.kMxCAD)}},{key:"get",value:function get(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.get(p,h))}},{key:"has",value:function has(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return 0!=this.imp.get(p,h)}}]),McDbTextStyleTable}(gt),Ir=function(h){_inherits$1(McDbDatabase,h);var p=_createSuper$6(McDbDatabase);function McDbDatabase(h){var x;return _classCallCheck$1(this,McDbDatabase),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbDatabase),x}return _createClass$1(McDbDatabase,[{key:"ucsMatrix",get:function get(){return new sn(this.imp.getUcsMatrix())},set:function set(t){this.imp.setUcsMatrix(t.imp)}},{key:"getLayerTable",value:function getLayerTable(){return new kr(this.imp.GetLayerTable())}},{key:"wblock",value:function wblock(t,h,p){p||(p=rn.kOrigin);var x=new cn;return h.forEach((function(t){x.append(t.id)})),this.imp.wblock(t.getImp(),x.imp,p.imp)}},{key:"insert",value:function insert(t,h){var p=tt.encodeToGb2312(h);return new mt(this.imp.insert(t.getImp(),p),pt.kMxCAD)}},{key:"readFile",value:function readFile(t){return this.imp.readFile(t)}},{key:"saveAs",value:function saveAs(t){return this.imp.saveAs(t)}},{key:"layerTable",get:function get(){return new kr(this.imp.GetLayerTable())}},{key:"getLinetypeTable",value:function getLinetypeTable(){return new Pr(this.imp.GetLinetypeTable())}},{key:"getDimStyleTable",value:function getDimStyleTable(){return new Lr(this.imp.GetDimStyleTable())}},{key:"dimStyleTable",get:function get(){return new Lr(this.imp.GetDimStyleTable())}},{key:"linetypeTable",get:function get(){return new Pr(this.imp.GetLinetypeTable())}},{key:"getTextStyleTable",value:function getTextStyleTable(){return new Er(this.imp.GetTextStyleTable())}},{key:"textStyleTable",get:function get(){return new Er(this.imp.GetTextStyleTable())}},{key:"getBlockTable",value:function getBlockTable(){return new Or(this.imp.GetBlockTable())}},{key:"getNamedObjectsDictionary",value:function getNamedObjectsDictionary(){return new Fr(this.imp.GetNamedObjectsDictionary())}},{key:"getEntitiesInTheGroup",value:function getEntitiesInTheGroup(h){for(var p=[],x=this.imp.getEntitiesInTheGroup(h.id),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"GetGroupDictionary",value:function GetGroupDictionary(){return new Fr(this.imp.GetGroupDictionary())}},{key:"CreateGroup",value:function CreateGroup(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=this.GetGroupDictionary(),x=new Vr;return x.appendArray(t),x.name=h,p.addObject(h,x),!0}},{key:"blockTable",get:function get(){return new Or(this.imp.GetBlockTable())}},{key:"currentSpace",get:function get(){return new Br(this.imp.CurrentSpace())}},{key:"currentSpaceId",get:function get(){return new mt(this.imp.CurrentSpaceId(),pt.kMxCAD)}},{key:"modelSpaceId",get:function get(){return new mt(this.imp.ModelSpaceId(),pt.kMxCAD)}},{key:"zeroLayerId",get:function get(){return new mt(this.imp.ZeroLayerId(),pt.kMxCAD)}},{key:"isCurrentModelSpace",get:function get(){return this.imp.isCurrentModelSpace()}},{key:"getCurrentlyLineTypeScale",value:function getCurrentlyLineTypeScale(){return this.imp.GetCurrentlyLineTypeScale()}},{key:"setCurrentlyLineTypeScale",value:function setCurrentlyLineTypeScale(t){return this.imp.SetCurrentlyLineTypeScale(t)}},{key:"getCurrentlyLineTypeName",value:function getCurrentlyLineTypeName(){var t=this.imp.GetCurrentlyLineTypeName();return tt.decodeFromGb2312(t)}},{key:"setCurrentlyLineTypeName",value:function setCurrentlyLineTypeName(t){var h=tt.encodeToGb2312(t);this.imp.SetCurrentlyLineTypeName(h)}},{key:"getCurrentlyLayerName",value:function getCurrentlyLayerName(){var t=this.imp.GetCurrentlyLayerName();return tt.decodeFromGb2312(t)}},{key:"setCurrentlyLayerName",value:function setCurrentlyLayerName(t){var h=tt.encodeToGb2312(t);this.imp.SetCurrentlyLayerName(h)}},{key:"getCurrentlyTrueColor",value:function getCurrentlyTrueColor(){return new Cr(this.imp.GetCurrentlyTrueColor())}},{key:"getCurrentlyDrawColor",value:function getCurrentlyDrawColor(){var t=this.imp.GetCurrentlyDrawColor(),h=new THREE.Color;return h.setRGB(t.at(0)/255,t.at(1)/255,t.at(2)/255),h}},{key:"setCurrentlyTrueColor",value:function setCurrentlyTrueColor(t){return this.imp.SetCurrentlyTrueColor(t.getImp())}},{key:"getCurrentlyColorIndex",value:function getCurrentlyColorIndex(){return this.imp.GetCurrentlyColorIndex()}},{key:"setCurrentlyColorIndex",value:function setCurrentlyColorIndex(t){return this.imp.SetCurrentlyColorIndex(t)}},{key:"getCurrentlyTextStyleName",value:function getCurrentlyTextStyleName(){var t=this.imp.GetCurrentlyTextStyleName();return tt.decodeFromGb2312(t)}},{key:"setCurrentlyTextStyle",value:function setCurrentlyTextStyle(t){var h=tt.encodeToGb2312(t);this.imp.SetCurrentlyTextStyle(h)}},{key:"getCurrentlyLineWeight",value:function getCurrentlyLineWeight(){return this.imp.GetCurrentlyLineWeight()}},{key:"setCurrentlyLineWeight",value:function setCurrentlyLineWeight(t){return this.imp.SetCurrentlyLineWeight(t)}},{key:"getCurrentlyTextStyleId",value:function getCurrentlyTextStyleId(){return new mt(this.imp.GetCurrentlyTextStyleId(),pt.kMxCAD)}},{key:"SetCurrentlyTextStyleId",value:function SetCurrentlyTextStyleId(t){return this.imp.SetCurrentlyTextStyleId(t.id)}},{key:"getCurrentlyDimStyleId",value:function getCurrentlyDimStyleId(){return new mt(this.imp.GetCurrentlyDimStyleId(),pt.kMxCAD)}},{key:"setCurrentlyDimStyleId",value:function setCurrentlyDimStyleId(t){return this.imp.SetCurrentlyDimStyleId(t.id)}},{key:"getCurrentlyLayerId",value:function getCurrentlyLayerId(){return new mt(this.imp.GetCurrentlyLayerId(),pt.kMxCAD)}},{key:"setCurrentlyLayerId",value:function setCurrentlyLayerId(t){return this.imp.SetCurrentlyLayerId(t.id)}},{key:"getCurrentlyLinetypeId",value:function getCurrentlyLinetypeId(){return new mt(this.imp.GetCurrentlyLinetypeId(),pt.kMxCAD)}},{key:"setCurrentlyLinetypeId",value:function setCurrentlyLinetypeId(t){return this.imp.SetCurrentlyLinetypeId(t.id)}},{key:"handleToIdIndex",value:function handleToIdIndex(t){var h=this.imp.HandleToIdIndex(t);return new mt(h,pt.kMxCAD)}},{key:"isModifyed",value:function isModifyed(){return this.imp.IsModifyed()}},{key:"resetModificationStatus",value:function resetModificationStatus(){return this.imp.SetModifyed(!1)}}]),McDbDatabase}(dt),Br=function(h){_inherits$1(McDbBlockTableRecord,h);var p=_createSuper$6(McDbBlockTableRecord);function McDbBlockTableRecord(h){var x;return _classCallCheck$1(this,McDbBlockTableRecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbBlockTableRecord),x}return _createClass$1(McDbBlockTableRecord,[{key:"appendAcDbEntity",value:function appendAcDbEntity(t){var h=t.syncData(!0),p=new mt(this.imp.appendAcDbEntity(t.getImp()),pt.kMxCAD);return h&&cr.getObjectFormId(p),p}},{key:"getAllEntityId",value:function getAllEntityId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllEntityId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"getMinMaxDrawOrder",value:function getMinMaxDrawOrder(){var t=this.imp.getMinMaxDrawOrder();return{minDrawOrder:t.x,maxDrawOrder:t.y}}},{key:"origin",get:function get(){return new rn(this.imp.origin())},set:function set(t){this.imp.setOrigin(t.imp)}},{key:"getBoundingBox",value:function getBoundingBox(){var t=this.imp.getBoundingBox();return t.length()<2?{minPt:new rn,maxPt:new rn,ret:!1}:{minPt:new rn(t.at(0)),maxPt:new rn(t.at(1)),ret:!0}}},{key:"invalidBoundingBoxBuffer",value:function invalidBoundingBoxBuffer(){this.imp.invalidBoundingBoxBuffer()}},{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.getName())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}}]),McDbBlockTableRecord}(gt),Or=function(h){_inherits$1(McDbBlockTable,h);var p=_createSuper$6(McDbBlockTable);function McDbBlockTable(h){var x;return _classCallCheck$1(this,McDbBlockTable),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbBlockTable),x}return _createClass$1(McDbBlockTable,[{key:"getAllRecordId",value:function getAllRecordId(){for(var h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=[],x=this.imp.getAllRecordId(h),M=x.length(),k=0;k<M;k++)p.push(new mt(x.at(k),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(x),p}},{key:"add",value:function add(t){if("string"==typeof t){if(t.length>0){var h=this.get(t,!1);if(h.isValid()){var p=h.getMcDbBlockTableRecord();return p&&p.isErased()&&p.unErase(),h}}var x=new Br;return x.name=t,new mt(this.imp.add(x.getImp()),pt.kMxCAD)}return new mt(this.imp.add(t.getImp()),pt.kMxCAD)}},{key:"get",value:function get(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.get(p,h))}},{key:"has",value:function has(t){var h=tt.encodeToGb2312(t);return 0!=this.imp.get(h,!0)}}]),McDbBlockTable}(gt),Rr=function(h){_inherits$1(McDbRasterImageDef,h);var p=_createSuper$6(McDbRasterImageDef);function McDbRasterImageDef(h){var x;return _classCallCheck$1(this,McDbRasterImageDef),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbRasterImageDef),x}return _createClass$1(McDbRasterImageDef,[{key:"sourceFileName",get:function get(){return tt.decodeFromGb2312(this.imp.sourceFileName())},set:function set(t){this.imp.setSourceFileName(tt.encodeToGb2312(t))}},{key:"saveToBase64",value:function saveToBase64(t){return this.imp.saveToBase64(t)}}]),McDbRasterImageDef}(gt),Fr=function(h){_inherits$1(McDbDictionary,h);var p=_createSuper$6(McDbDictionary);function McDbDictionary(h){var x;return _classCallCheck$1(this,McDbDictionary),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbDictionary),x}return _createClass$1(McDbDictionary,[{key:"getAllObject",value:function getAllObject(){for(var h=[],p=this.imp.getAllObject(),x=p.length(),M=0;M<x;M++)h.push(new mt(p.at(M),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(p),h}},{key:"getAllObjectName",value:function getAllObjectName(){var h=this.imp.getAllObjectName(),p=new un(h);return t.MxCpp.App.getImp().DestroyMdGeStringArray(h),p}},{key:"remove",value:function remove(t){var h=tt.encodeToGb2312(t);return this.imp.remove(h)}},{key:"addObject",value:function addObject(t,h){var p=tt.encodeToGb2312(t);return new mt(this.imp.addObject(p,h.getImp()),pt.kMxCAD)}},{key:"getAt",value:function getAt(t){var h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=tt.encodeToGb2312(t);return new mt(this.imp.getAt(p,h),pt.kMxCAD)}},{key:"setName",value:function setName(t,h){return t=tt.encodeToGb2312(t),h=tt.encodeToGb2312(h),this.imp.setName(t,h)}}]),McDbDictionary}(gt),Nr=function(h){_inherits$1(McDbXrecord,h);var p=_createSuper$6(McDbXrecord);function McDbXrecord(h){var x;return _classCallCheck$1(this,McDbXrecord),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbXrecord),x}return _createClass$1(McDbXrecord,[{key:"setData",value:function setData(t){return this.imp.setData(t.getImp())}},{key:"getData",value:function getData(){return new bt(this.imp.getData())}}]),McDbXrecord}(gt),Vr=function(h){_inherits$1(McDbGroup,h);var p=_createSuper$6(McDbGroup);function McDbGroup(h){var x;return _classCallCheck$1(this,McDbGroup),x=p.call(this,h),h||x.initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbGroup),x}return _createClass$1(McDbGroup,[{key:"description",get:function get(){return tt.decodeFromGb2312(this.imp.description())},set:function set(t){this.imp.setDescription(tt.encodeToGb2312(t))}},{key:"name",get:function get(){return tt.decodeFromGb2312(this.imp.name())},set:function set(t){this.imp.setName(tt.encodeToGb2312(t))}},{key:"isSelectable",get:function get(){return this.imp.isSelectable()},set:function set(t){this.imp.setSelectable(t)}},{key:"clear",value:function clear(){return this.imp.clear()}},{key:"append",value:function append(t){return this.imp.append(t.id)}},{key:"appendArray",value:function appendArray(t){var h=new cn;return h.copyFormAryId(t),this.imp.appendArray(h.imp)}},{key:"has",value:function has(t){return this.imp.has(t.id)}},{key:"getAllEntityId",value:function getAllEntityId(){for(var h=[],p=this.imp.getAllEntityId(),x=p.length(),M=0;M<x;M++)h.push(new mt(p.at(M),pt.kMxCAD));return t.MxCpp.App.getImp().DestroyMdGeLongArray(p),h}},{key:"numEntities",value:function numEntities(){return this.imp.numEntities()}}]),McDbGroup}(gt);function angleTo(t,h,p,x){var M=t-p,k=h-x,I=0;return I=0==M?Math.PI/2:Math.atan(Math.abs(k/M)),M<0&&k>=0?I=Math.PI-I:M<0&&k<0?I=Math.PI+I:M>=0&&k<0&&(I=2*Math.PI-I),I}function findArcCenter(t,h,p){var x=(t.x+h.x)/2,M=(t.y+h.y)/2,k=Math.sqrt(Math.pow(t.x-x,2)+Math.pow(t.y-M,2))/Math.sin(p/2),I={x:h.x-t.x,y:h.y-t.y},N={x:I.x/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.y,2)),y:I.y/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.y,2))};return new rn(x+k*-N.y,M+k*N.x)}function getHostUrl(){var t=window.location.hostname;return"http"!=t.substring(0,4)&&(t=document.location.protocol+"//"+t),t}function calculateDistanceFromPointToLine(t,h,p){var x,M=h.clone(),k=p.clone(),I=t.clone(),N=I.sub(M),V=k.sub(M),ee=I.sub(k),te=N.crossProduct(V).length()/V.length(),re=N.dotProduct(V);return x=re<0?N.length():re>Math.pow(V.length(),2)?ee.length():te,Math.floor(x)}function selectLineSegmentFromPolylineByPoint(t,h){for(var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=t.numVerts(),M=0;M<t.numVerts();M++){var k=t.getPointAt(M).val,I=t.getPointAt(M+1).val,N=t.getBulgeAt(M);if(0===N){if(M+1===x&&t.isClosed&&(I=t.getPointAt(0).val),I&&calculateDistanceFromPointToLine(h,k,I)<p)return{start:k,end:I,startIndex:M,endIndex:M+1,bulge:N}}else if(I){var V=t.getParamAtPoint(k).val,ee=t.getParamAtPoint(I).val,te=t.getParamAtPoint(h).val;if(ee>te&&te>V)return{start:k,end:I,startIndex:M,endIndex:M+1,bulge:N}}}if(t.isClosed){var re=t.getPointAt(0).val,ne=t.getPointAt(t.numVerts()-1).val,ie=t.getBulgeAt(t.numVerts()-1);if(calculateDistanceFromPointToLine(h,ne,re)<p)return{start:ne,end:re,startIndex:t.numVerts()-1,endIndex:0,isClosed:!0,bulge:ie}}}function darkenColor(t,h){var p=t.r,x=t.g,M=t.b;p*=h,x*=h,M*=h,t.r=Math.max(Math.min(p,1),0),t.g=Math.max(Math.min(x,1),0),t.b=Math.max(Math.min(M,1),0)}function isSegmentStartCloserToPoint(t,h,p,x){var M=calculateDistanceFromPointToLine(x,t,p),k=calculateDistanceFromPointToLine(x,h,p);return!!isNaN(k)||!isNaN(M)&&(k===M?p.distanceTo(t)>p.distanceTo(h):M<k)}function createChamferedLinesFromSegments(t,h,p,x,M,k,I){var N=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],V=new Bt,ee=t.endPoint.sub(t.startPoint).normalize().mult(k),te=h.endPoint.sub(h.startPoint).normalize().mult(I);if(x){ee.negate();var re=p.clone().addvec(ee);N&&(t.endPoint=re),V.startPoint=re.clone()}else{var ne=p.clone().addvec(ee);N&&(t.startPoint=ne),V.startPoint=ne.clone()}if(M){te.negate();var ie=p.clone().addvec(te);N&&(h.endPoint=ie),V.endPoint=ie.clone()}else{var ae=p.clone().addvec(te);N&&(h.startPoint=ae),V.endPoint=ae.clone()}if(!(k<=0&&I<=0))return V}function createLineSegmentRoundJoin(h,p,x,M,k,I){var N=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],ee=p.startPoint,te=p.endPoint,re=x.startPoint,ne=x.endPoint,ie=M.sub(k?ee:te),ae=M.sub(I?re:ne),oe=h/Math.tan(ie.angleTo1(ae)/2),se=createChamferedLinesFromSegments(p,x,M,k,I,V?0:oe,V?0:oe,N);if(!se)return{segmentLine:se,chamferDist:oe};var ce=se.startPoint.sub(M).perpVector(),ue=se.endPoint.sub(M).perpVector();se.endPoint.addvec(ue);var le=new Bt(se.startPoint,se.startPoint.clone().addvec(ce)).IntersectWith(new Bt(se.endPoint,se.endPoint.clone().addvec(ue)),t.McDb.Intersect.kExtendBoth);if(!le.isEmpty()){var he=le.at(0),fe=he.clone().addvec(M.sub(he).normalize().mult(h)),de=new Xt,pe=Mt.calcBulge(se.startPoint,fe,se.endPoint).val;return de.computeArc(se.startPoint.x,se.startPoint.y,fe.x,fe.y,se.endPoint.x,se.endPoint.y),{arc:de,bulge:pe,segmentLine:se,chamferDist:oe,center:he,midPoint:fe}}}function calculateSlope(t,h){return(h.y-t.y)/(h.x-t.x)}function areLinesCollinear(t,h){var p=calculateSlope(t.startPoint,t.endPoint),x=calculateSlope(h.startPoint,h.endPoint);return isNaN(p)&&isNaN(x)?t.startPoint.x===h.startPoint.x:p===x}var Gr=function(){function MxAI(){_classCallCheck$1(this,MxAI),_defineProperty(this,"serverUrl",""),_defineProperty(this,"mapFun",{})}return _createClass$1(MxAI,[{key:"init",value:function init(t){"http://localhost"==t.substring(0,16)&&(t=getHostUrl()+t.substring(16)),this.serverUrl=t}},{key:"addFunction",value:function addFunction(t,h){this.mapFun[t]=h}},{key:"registTool",value:function registTool(t){if(0!=this.serverUrl.length){var h=new XMLHttpRequest,p=this.serverUrl+"/add_toolfun";h.open("POST",p),h.setRequestHeader("Content-Type","application/json"),h.send(JSON.stringify(t)),h.onreadystatechange=function(){4===h.readyState&&h.status}}}},{key:"reloadTools",value:function reloadTools(t){if(0!=this.serverUrl.length){var h=new XMLHttpRequest,p=this.serverUrl+"/reload_toolfun";h.open("POST",p),h.setRequestHeader("Content-Type","application/json"),h.send(JSON.stringify(t)),h.onreadystatechange=function(){4===h.readyState&&h.status}}}},{key:"chat_tool",value:function chat_tool(t){if(0!=this.serverUrl.length){var h=this,p={text:t},x=new XMLHttpRequest,M=this.serverUrl+"/post";x.open("POST",M),x.setRequestHeader("Content-Type","application/json"),x.send(JSON.stringify(p)),x.onreadystatechange=function(){if(4===x.readyState&&200===x.status)try{var t=JSON.parse(x.responseText).results;t&&t.name&&h.mapFun[t.name]&&h.mapFun[t.name](t.parameters)}catch(p){}}}}}]),MxAI}(),jr=function(){function McAppFunctonImp(){_classCallCheck$1(this,McAppFunctonImp),_defineProperty(this,"mapCppCall",{}),_defineProperty(this,"currentOptNum",1)}return _createClass$1(McAppFunctonImp,[{key:"init",value:function init(){var t=window,h=this;t.loadFonts_complete=function(t){h.mapCppCall[t]&&(h.mapCppCall[t](),delete h.mapCppCall[t])}}},{key:"loadFonts",value:function loadFonts(h,p,x,M){if(0!=h.length||0!=p.length||0!=x.length){var k=new un;h.forEach((function(t){k.append(t)})),p.forEach((function(t){k.append("{big}"+t)})),x.forEach((function(t){k.append("{font}"+t)})),this.currentOptNum++,this.mapCppCall[this.currentOptNum]=M,t.MxCpp.App.getImp().loadFonts(k.imp,this.currentOptNum)}else M()}}]),McAppFunctonImp}(),Ur=new jr,zr=function(t){return t[t.EMSCRIPTEN_FETCH_LOAD_TO_MEMORY=1]="EMSCRIPTEN_FETCH_LOAD_TO_MEMORY",t[t.EMSCRIPTEN_FETCH_PERSIST_FILE=4]="EMSCRIPTEN_FETCH_PERSIST_FILE",t[t.EMSCRIPTEN_FETCH_APPEND=8]="EMSCRIPTEN_FETCH_APPEND",t[t.EMSCRIPTEN_FETCH_REPLACE=16]="EMSCRIPTEN_FETCH_REPLACE",t}(zr||{}),Wr=function(){function McObject(t){_classCallCheck$1(this,McObject),_defineProperty(this,"imp",void 0),_defineProperty(this,"event",{}),_defineProperty(this,"currentFileName",""),_defineProperty(this,"currentOriginalFileName",""),_defineProperty(this,"firstTimeOpenFile",!0),_defineProperty(this,"authorized_service",""),_defineProperty(this,"isInitMxObject",!1),this.imp=t}return _createClass$1(McObject,[{key:"creaeCallId",value:function creaeCallId(){return Math.round(1e7*Math.random())}},{key:"setAttribute",value:function setAttribute(t){return this.imp.setAttribute(JSON.stringify(t))}},{key:"getMxDrawObject",value:function getMxDrawObject(){return this.imp.mxdrawObject}},{key:"mxdraw",get:function get(){return this.imp.mxdrawObject}},{key:"getImp",value:function getImp(){return this.imp}},{key:"init",value:function init(t){this.imp=t}},{key:"create",value:function create(t){Ei(t,this)}},{key:"on",value:function on(t,h){if(this.event[t])if(this.event[t]instanceof Array)this.event[t].includes(h)||this.event[t].push(h);else{var p=this.event[t];if(p==h)return;this.event[t]=[],this.event[t].push(p),this.event[t].push(h)}else this.event[t]=h;this.isInitMxObject&&(this.event=this.synchronizeMxDrawEvent(this.event))}},{key:"off",value:function off(t,h){if(this.event[t])if(h)if(this.event[t]instanceof Array){var p=this.event[t].indexOf(h);if(p<0)return;this.event[t].splice(p,1)}else this.event[t]===h&&(this.event[t]=[]);else this.event[t]=[]}},{key:"callEvent",value:function callEvent(t,h){try{var p=this.event[t];if(!p)return!1;if(p instanceof Array){var x=!1;return p.forEach((function(t){x=t(h)})),x}return p(h)}catch(M){throw M}}},{key:"synchronizeMxDrawEvent",value:function synchronizeMxDrawEvent(t){var h=this.getMxDrawObject().getMxObjectImplement(),p={selectChange:!0,openFileComplete:!0,init:!0,init_mxdraw:!0,init_mxcad:!0,init_before_mxdraw:!0},x={};for(var M in t){var k=t[M];p[M]?x[M]=k:k instanceof Array?k.forEach((function(t){h.addEvent(M,t)})):h.addEvent(M,k)}return x}},{key:"initMxObject",value:function initMxObject(t){var p=this;this.isInitMxObject=!0,t.tmp||(t.tmp=new h.MxDrawObject(t)),this.imp.mxdrawObject=t.tmp,t.addEvent("selectChange",(function(h){var x=[];h.forEach((function(t){x.push(new mt(t,pt.kMxCAD))})),t.getMxAllSelect().forEach((function(t){x.push(new mt(t,pt.kMxDraw))})),p.callEvent("selectChange",x)})),t.addEvent("mxdrawSelectChange",(function(h){var x=[];h.forEach((function(t){x.push(new mt(t,pt.kMxDraw))})),t.getMxCADAllSelect().forEach((function(t){x.push(new mt(t,pt.kMxCAD))})),p.callEvent("selectChange",x)}));var x=this;t.addEvent("openFileComplete",(function(){p.callEvent("openFileComplete",x)})),this.event=this.synchronizeMxDrawEvent(this.event)}},{key:"regen",value:function regen(){var t=this,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;h<=0?this.imp.regen():setTimeout((function(){t.imp.regen(),t.updateDisplay(!1)}),h)}},{key:"zoomAll",value:function zoomAll(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=this.database.currentSpace.getBoundingBox();return!!h.ret&&(this.getMxDrawObject().zoomW(h.minPt.toVector3(),h.maxPt.toVector3(),void 0,void 0,t),!0)}},{key:"zoomScale",value:function zoomScale(t){this.getMxDrawObject().zoomScale(t)}},{key:"addCurrentSelect",value:function addCurrentSelect(t){var h=this,p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t instanceof Array){var x=!1,M=!1;t.forEach((function(t){t.type==pt.kMxDraw?h.getMxDrawObject().addMxCurrentSelect(t.id,!1,p)&&(x=!0):t.type==pt.kMxCAD&&h.getMxDrawObject().addMxCADCurrentSelect(t.id,!1,p)&&(M=!0)})),x&&this.getMxDrawObject().fireSelectChange(!1),M&&this.getMxDrawObject().fireSelectChange(!0)}else t.type==pt.kMxDraw?this.getMxDrawObject().addMxCurrentSelect(t.id,!0,p):t.type==pt.kMxCAD&&this.getMxDrawObject().addMxCADCurrentSelect(t.id,!0,p)}},{key:"clearMxCurrentSelect",value:function clearMxCurrentSelect(){this.getMxDrawObject().clearMxCurrentSelect()}},{key:"zoomW",value:function zoomW(t,h){this.getMxDrawObject().zoomW(t.toVector3(),h.toVector3())}},{key:"zoomCenter",value:function zoomCenter(t,h){this.getMxDrawObject().zoomCenter(t,h)}},{key:"zoomAngle",value:function zoomAngle(t){this.getMxDrawObject().setViewAngle(t),this.updateDisplay(!1,100)}},{key:"openWebFile",value:function openWebFile(h,p){var x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],M=arguments.length>3?arguments[3]:void 0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],N=this.imp.mxdrawObject,V=Math.round(1e7*Math.random());if(p){var ee=window;ee["mx_exception handling"]=function(){ee["mx_exception handling"]=void 0,p(-10)};N.addEvent("openFileComplete",(function funOpenCall(t,h){V==h&&(ee["mx_exception handling"]=void 0,N.removeEventFuction("openFileComplete",funOpenCall),p(t))}))}this.currentFileName=h.split("/").pop(),this.currentOriginalFileName=this.currentFileName;var te="";if(M&&(te=JSON.stringify(M)),this.firstTimeOpenFile||this.getMxDrawObject().clearAllObject(),this.firstTimeOpenFile=!1,3==t.MxCpp.App.getImp().getCodeVersion()){var re="";if(0!=this.authorized_service.length)if("same_current_page_url"==this.authorized_service){var ne=window.location.port;re="80"==ne?getHostUrl()+"/create_app_param":getHostUrl()+":"+ne+"/create_app_param"}else re=this.authorized_service;else re=getHostUrl()+":3090/create_app_param";var ie=this,ae=new XMLHttpRequest;return ae.open("POST",re),ae.setRequestHeader("Content-Type","application/json"),ae.onreadystatechange=function(){200===ae.status?4===ae.readyState&&(ae.responseText&&0!=ae.responseText.length?ie.imp.openWebFile(ae.responseText,x,V,te,k,I):ie.imp.openWebFile("",x,V,te,k,I)):ie.imp.openWebFile("",x,V,te,k,I)},ae.send(JSON.stringify({param:t.MxCpp.App.getImp().createAppParam(h)})),!0}return this.imp.openWebFile(h,x,V,te,k,I)}},{key:"newFile",value:function newFile(){this.currentFileName="",this.currentOriginalFileName="";var t=this.getMxDrawObject();return t.clearAllObject(),t.clearMxCurrentSelect(),this.imp.newFile()}},{key:"insertBlock",value:function insertBlock(t,h){var p=this,x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=this.imp.mxdrawObject,V=Math.round(1e7*Math.random());return new Promise((function(ee){N.addEvent("insertBlockComplete",(function funCall(t){t&&0!=t.length||ee(new mt);var h=JSON.parse(t);h.callid==V&&(N.removeEventFuction("insertBlockComplete",funCall),h.result,ee(new mt(h.blkrecid,pt.kMxCAD)))}));p.imp.insertBlock(t,tt.encodeToGb2312(h),x,V,"",M,k,I)}))}},{key:"getCurrentFileName",value:function getCurrentFileName(){return this.currentFileName}},{key:"setCurrentFileName",value:function setCurrentFileName(t){this.currentFileName=t}},{key:"getCurrentOriginaFileName",value:function getCurrentOriginaFileName(){return this.currentOriginalFileName}},{key:"setCurrentOriginaFileName",value:function setCurrentOriginaFileName(t){this.currentOriginalFileName=t}},{key:"saveFileToUrl",value:function saveFileToUrl(h,p,x,M){var k=this.imp.saveFileToMemory();if(0==k.getSize())return p(-1,"save failed"),!1;var I=k.getData(),N=k.getSize(),V=t.MxCpp.mxcadassemblyimp.HEAPU8.subarray(I,I+N),ee=new ArrayBuffer(k.getSize()),te=new Uint8Array(ee);return te.set(V),k.clear(),se.postMemoryFile(te,h,x||"temp.mxweb",p,M),!0}},{key:"saveFile",value:function saveFile(t,h){var p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],M=arguments.length>4?arguments[4]:void 0;t||0==(t=this.getCurrentFileName()).length&&(t="temp_empty.mxweb"),(-1==t.indexOf(".")||".mxweb"!=t.substring(t.length-6))&&(t+=".mxweb");var k=window;k.mx_saveFile_call=function(M){if(h&&h(M),M){var I;if(p)I=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?new Blob([M.buffer],{type:"application/octet-stream"}):new Blob([M.buffer],{type:"application/octet-binary"}),x?se.saveAsFileDialog({blob:I,filename:t,types:[{description:"mxweb File",accept:{"application/octet-stream":[".mxweb"]}}]}):se.downloadFile(I,t);k.mx_saveFile_call=null}};var I="";return M&&(I=JSON.stringify(M)),this.imp.saveFile(t,I)}},{key:"getDatabase",value:function getDatabase(){return this.imp.McDbDatabase||(this.imp.McDbDatabase=new Ir(this.imp.GetDatabase())),this.imp.McDbDatabase}},{key:"database",get:function get(){return this.getDatabase()}},{key:"setBrowse",value:function setBrowse(t){this.imp.setBrowse(t),t&&h.MxFun.setIniset({ForbiddenDynInput:!0})}},{key:"getSysVarString",value:function getSysVarString(t){return this.imp.GetSysVarString(t)}},{key:"setSysVarString",value:function setSysVarString(t,h){return this.imp.SetSysVarString(t,h)}},{key:"getSysVarDouble",value:function getSysVarDouble(t){return this.imp.GetSysVarDouble(t)}},{key:"getSysVarPoint",value:function getSysVarPoint(t){return new rn(this.imp.GetSysVarPoint(t))}},{key:"setSysVarPoint",value:function setSysVarPoint(t,h){return this.imp.SetSysVarPoint(t,h.imp,!1)}},{key:"setSysVarPoint2d",value:function setSysVarPoint2d(t,h){return this.imp.SetSysVarPoint(t,h.imp,!0)}},{key:"setSysVarDouble",value:function setSysVarDouble(t,h){return this.imp.SetSysVarDouble(t,h)}},{key:"getSysVarLong",value:function getSysVarLong(t){return this.imp.GetSysVarLong(t)}},{key:"setSysVarLong",value:function setSysVarLong(t,h){return this.imp.SetSysVarLong(t,h)}},{key:"drawColor",get:function get(){return new Cr(this.imp.GetDrawColor())},set:function set(t){this.imp.SetDrawColor(t.getImp())}},{key:"drawColorIndex",get:function get(){return this.imp.GetDrawColor().colorIndex},set:function set(t){var h=new Cr;h.setColorIndex(t),this.imp.SetDrawColor(h.getImp())}},{key:"drawLineWeight",get:function get(){return this.imp.GetDrawLineWeight()},set:function set(t){this.imp.SetDrawLineWeight(t)}},{key:"drawLineTypeScale",get:function get(){return this.imp.GetDrawLineTypeScale()},set:function set(t){this.imp.SetDrawLineTypeScale(t)}},{key:"drawLinetype",get:function get(){return tt.decodeFromGb2312(this.imp.GetDrawLinetype())},set:function set(t){this.imp.SetDrawLinetype(tt.encodeToGb2312(t))}},{key:"drawTextStyle",get:function get(){return tt.decodeFromGb2312(this.imp.GetDrawTextStyle())},set:function set(t){this.imp.SetDrawTextStyle(tt.encodeToGb2312(t))}},{key:"drawLayer",get:function get(){return tt.decodeFromGb2312(this.imp.GetDrawLayer())},set:function set(t){this.imp.SetDrawLayer(tt.encodeToGb2312(t))}},{key:"addLayer",value:function addLayer(t){return new mt(this.imp.AddLayer(tt.encodeToGb2312(t)))}},{key:"addTextStyle",value:function addTextStyle(t,h,p){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new mt(this.imp.AddTextStyle(tt.encodeToGb2312(t),tt.encodeToGb2312(h),tt.encodeToGb2312(p),x))}},{key:"AddTureTypeTextStyle",value:function AddTureTypeTextStyle(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return new mt(this.imp.AddTureTypeTextStyle(tt.encodeToGb2312(t),tt.encodeToGb2312(h),p))}},{key:"addLinetype",value:function addLinetype(t,h){return new mt(this.imp.AddLinetype(tt.encodeToGb2312(t),tt.encodeToGb2312(h)))}},{key:"addLinetypeEx",value:function addLinetypeEx(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new mt(this.imp.AddLinetypeEx(tt.encodeToGb2312(t),tt.encodeToGb2312(h),tt.encodeToGb2312(p)))}},{key:"drawLine",value:function drawLine(t,h,p,x){return new mt(this.imp.DrawLine(t,h,0,p,x,0))}},{key:"drawLine3d",value:function drawLine3d(t,h,p,x,M,k){return new mt(this.imp.DrawLine(t,h,p,x,M,k))}},{key:"addDimStyle",value:function addDimStyle(t,h,p,x,M){return new mt(this.imp.AddDimStyle(tt.encodeToGb2312(t),tt.encodeToGb2312(h),tt.encodeToGb2312(p),tt.encodeToGb2312(x),tt.encodeToGb2312(M)))}},{key:"drawDimStyle",get:function get(){return tt.decodeFromGb2312(this.imp.GetDrawDimStyle())},set:function set(t){this.imp.SetDrawDimStyle(tt.encodeToGb2312(t))}},{key:"pathMakeExclude",value:function pathMakeExclude(t){this.imp.PathMakeExclude(t)}},{key:"addPatternDefinition",value:function addPatternDefinition(t,h){this.imp.AddPatternDefinition(tt.encodeToGb2312(t),h)}},{key:"drawPatternDefinition",get:function get(){return tt.decodeFromGb2312(this.imp.GetPatternDefinition())},set:function set(t){this.imp.SetPatternDefinition(tt.encodeToGb2312(t))}},{key:"drawLineWidth",get:function get(){return this.imp.GetDrawLineWidth()},set:function set(t){this.imp.SetDrawLineWidth(t)}},{key:"drawUseDefaultProperties",get:function get(){return this.imp.GetDrawUseDefaultProperties()},set:function set(t){this.imp.SetDrawUseDefaultProperties(t)}},{key:"drawArc",value:function drawArc(t,h,p,x,M){return new mt(this.imp.DrawArc(t,h,p,x,M))}},{key:"drawArc2",value:function drawArc2(t,h,p,x,M,k){return new mt(this.imp.DrawArc2(t,h,p,x,M,k))}},{key:"drawArc3",value:function drawArc3(t,h,p,x,M){return new mt(this.imp.DrawArc3(t,h,p,x,M))}},{key:"drawCircle",value:function drawCircle(t,h,p){return new mt(this.imp.DrawCircle(t,h,p))}},{key:"loadImage",value:function loadImage(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.imp.mxdrawObject.getMxObjectImplement().loadMxCADImage(t,h,p)}},{key:"drawImage",value:function drawImage(t,h,p,x,M,k){var I=arguments.length>6&&void 0!==arguments[6]&&arguments[6],N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;return new mt(this.imp.DrawImage(t,h,p,x,M,tt.encodeToGb2312(k),I,N,V))}},{key:"addImageDefine",value:function addImageDefine(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new mt(this.imp.addImageDefine(tt.encodeToGb2312(t),tt.encodeToGb2312(h),p))}},{key:"showLineWeight",value:function showLineWeight(t){var h=this.imp.showLineWeight(t);return this.updateDisplay(!1),h}},{key:"loadDwgBackground",value:function loadDwgBackground(t,h){var p=this,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=this.creaeCallId(),I=this.imp.mxdrawObject;I.addEvent("load_dwg_gackground_result",(function funOpenCall(t){(t=JSON.parse(t)).callid==k&&(I.removeEventFuction("load_dwg_gackground_result",funOpenCall),h(1==t.l_param),1==t.l_param&&M&&p.regen(100))})),this.imp.loadDwgBackground(t,x,k,M)}},{key:"getBackgroundEntity",value:function getBackgroundEntity(){return new er(this.imp.GetBackgroundEntity())}},{key:"clearDwgBackground",value:function clearDwgBackground(){this.getBackgroundEntity().clearAll()}},{key:"addSystemVarNameForEvent",value:function addSystemVarNameForEvent(t){var h=this;t.forEach((function(t){h.imp.addSystemVarNameForEvent(t)}))}},{key:"drawEllipse",value:function drawEllipse(t,h,p,x,M){return new mt(this.imp.DrawEllipse(t,h,p,x,M))}},{key:"drawEllipseArc",value:function drawEllipseArc(t,h,p,x,M,k,I){return new mt(this.imp.DrawEllipseArc(t,h,p,x,M,k,I))}},{key:"drawPoint",value:function drawPoint(t,h){return new mt(this.imp.DrawPoint(t,h))}},{key:"drawSolid",value:function drawSolid(t,h,p,x,M,k,I,N){return new mt(this.imp.DrawSolid(t,h,p,x,M,k,I,N))}},{key:"drawMText",value:function drawMText(t,h,p,x,M,k,I){return new mt(this.imp.DrawMText(t,h,tt.encodeToGb2312(p),x,M,k,I))}},{key:"drawText",value:function drawText(t,h,p,x,M,k,I){return new mt(this.imp.DrawText(t,h,tt.encodeToGb2312(p),x,M,k,I))}},{key:"drawBlockReference",value:function drawBlockReference(t,h,p,x,M){return new mt(this.imp.DrawBlockReference(t,h,tt.encodeToGb2312(p),x,M))}},{key:"drawDimAligned",value:function drawDimAligned(t,h,p,x,M,k){return new mt(this.imp.DrawDimAligned(t,h,p,x,M,k))}},{key:"drawDimAngular",value:function drawDimAngular(t,h,p,x,M,k,I,N){return new mt(this.imp.DrawDimAngular(t,h,p,x,M,k,I,N))}},{key:"drawDimDiametric",value:function drawDimDiametric(t,h,p,x,M){return new mt(this.imp.DrawDimDiametric(t,h,p,x,M))}},{key:"drawDimRotated",value:function drawDimRotated(t,h,p,x,M,k,I){return new mt(this.imp.DrawDimRotated(t,h,p,x,M,k,I))}},{key:"drawDimOrdinate",value:function drawDimOrdinate(t,h,p,x,M){return new mt(this.imp.DrawDimOrdinate(t,h,p,x,M))}},{key:"drawDimRadial",value:function drawDimRadial(t,h,p,x,M){return new mt(this.imp.DrawDimRadial(t,h,p,x,M))}},{key:"pathMoveTo",value:function pathMoveTo(t,h){this.imp.PathMoveTo(t,h)}},{key:"pathMoveToEx",value:function pathMoveToEx(t,h,p,x,M){this.imp.PathMoveToEx(t,h,p,x,M)}},{key:"pathLineTo",value:function pathLineTo(t,h){this.imp.PathLineTo(t,h)}},{key:"pathLineToEx",value:function pathLineToEx(t,h,p,x,M){this.imp.PathLineToEx(t,h,p,x,M)}},{key:"pathCircle",value:function pathCircle(t,h,p){var x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.imp.PathCircle(t,h,p,x,M)}},{key:"drawPathToPolyline",value:function drawPathToPolyline(){return new mt(this.imp.DrawPathToPolyline())}},{key:"drawPathToSpline",value:function drawPathToSpline(){return new mt(this.imp.DrawPathToSpline())}},{key:"pathMakeClosed",value:function pathMakeClosed(){this.imp.PathMakeClosed()}},{key:"drawPathToHatch",value:function drawPathToHatch(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new mt(this.imp.DrawPathToHatch(t))}},{key:"drawEntity",value:function drawEntity(t){var h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],p=t.syncData(!0),x=new mt(this.imp.DrawEntity(t.getImp(),h));return p&&cr.getObjectFormId(x),x}},{key:"drawHatch",value:function drawHatch(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new mt(this.imp.DrawHatch(t.getImp(),h))}},{key:"objectIdToObject",value:function objectIdToObject(h){return t.MxCpp.App.objectIdToObject(h)}},{key:"destroyObject",value:function destroyObject(h){h&&t.MxCpp.App.getImp().DestroyObject(h)}},{key:"getAllLayoutName",value:function getAllLayoutName(){return new un(this.imp.GetAllLayoutName())}},{key:"setCurrentLayout",value:function setCurrentLayout(t){return this.imp.SetCurrentLayout(tt.encodeToGb2312(t))}},{key:"getCurrentLayout",value:function getCurrentLayout(){return tt.decodeFromGb2312(this.imp.GetCurrentLayout())}},{key:"getCurrentLayoutId",value:function getCurrentLayoutId(){return new mt(this.imp.GetCurrentLayout())}},{key:"getMxCpp",value:function getMxCpp(){return t.MxCpp}},{key:"getViewCADCoord",value:function getViewCADCoord(){var t=this.getMxDrawObject().getViewDocCoord();return{pt1:new rn(t.pt1),pt2:new rn(t.pt2),pt3:new rn(t.pt3),pt4:new rn(t.pt4)}}},{key:"updateDisplay",value:function updateDisplay(){var t=this,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;p<=0?this.imp.mxdrawObject.updateDisplay(h):setTimeout((function(){t.imp.mxdrawObject.updateDisplay(h)}),p)}},{key:"updateLayerDisplayStatus",value:function updateLayerDisplayStatus(){this.imp.UpdateLayerDisplayStatus()}},{key:"initRegist",value:function initRegist(t){this.imp.initRegist(t)}},{key:"iniAuthorizedService",value:function iniAuthorizedService(t){this.imp.initAuthorizedService(t),this.authorized_service=t}},{key:"isTryVersion",value:function isTryVersion(){return this.imp.isTryVersion()}},{key:"setViewBackgroundColor",value:function setViewBackgroundColor(t,h,p){var x=this.getMxDrawObject();return x&&(t&&h&&p?x.setViewColor(t<<16|h<<8|p):x.setViewColor(t)),t&&h&&p?this.imp.setViewBackgroundColor(t,h,p):this.imp.setViewBackgroundColor((16711680&t)>>16,(65280&t)>>8,255&t)}},{key:"getViewBackgroundColor",value:function getViewBackgroundColor(){return this.imp.getViewBackgroundColor()}},{key:"getCurrentDatabaseDrawColor",value:function getCurrentDatabaseDrawColor(){var t=this.getDatabase().getImp().GetCurrentlyDrawColor(),h=this.getMxDrawObject().isWhiteViewColor(),p=t.at(0),x=t.at(1),M=t.at(2);h?255==p&&255==x&&255==M&&(p=0,x=0,M=0):0==p&&0==x&&0==M&&(p=255,x=255,M=255);var k=new THREE.Color;return k.setRGB(p/255,x/255,M/255),k}},{key:"undo",value:function undo(){this.imp.undo(),this.updateDisplay(!1)}},{key:"redo",value:function redo(){this.imp.redo(),this.updateDisplay()}},{key:"undoMark",value:function undoMark(){this.imp.undoMark()}},{key:"undoIndexIncrease",value:function undoIndexIncrease(){this.imp.undoIndexIncrease()}}]),McObject}(),Hr=function(){function McAppType(){_classCallCheck$1(this,McAppType),_defineProperty(this,"imp",void 0),_defineProperty(this,"MxCADAssist",void 0),_defineProperty(this,"objectIdToObjectCalls",{}),_defineProperty(this,"classNameToCreateCalls",{}),_defineProperty(this,"shxFonts",["txt.shx"]),_defineProperty(this,"shxBigFonts",["hztxt.shx"]),_defineProperty(this,"trueFonts",{syadobe:{name:"syadobe",zhname:"",file:"syadobe.otf"}}),_defineProperty(this,"dMcGeBakTol",-1)}return _createClass$1(McAppType,[{key:"init",value:function init(h){this.imp=h,nn.kZAxis=new nn(0,0,1),nn.kNegateZAxis=new nn(0,0,-1),nn.kXAxis=new nn(1,0,0),nn.kYAxis=new nn(0,1,0),nn.kIdentity=new nn(0,0,0),rn.kOrigin=new rn(0,0,0),sn.kIdentity=new sn,this.MxCADAssist=new t.MxCpp.mxcadassemblyimp.MxDrawAssist,this.initCalls(),Ur.init()}},{key:"setImp",value:function setImp(t){this.imp=t}},{key:"getImp",value:function getImp(){return this.imp}},{key:"getLastCallResult",value:function getLastCallResult(){return this.imp.getLastCallResult()}},{key:"destroyObject",value:function destroyObject(t){this.imp.DestroyObject(t)}},{key:"getCurrentMxCAD",value:function getCurrentMxCAD(){var t=this.imp.GetCurrentMxDraw();return t.McObject||(t.McObject=new Wr(this.imp.GetCurrentMxDraw())),t.McObject}},{key:"mcedRGB2Index",value:function mcedRGB2Index(t,h,p){var x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this.imp.mcedRGB2Index(t,h,p,x)}},{key:"setDefaultViewBackgroundColor",value:function setDefaultViewBackgroundColor(t,h,p){return this.imp.setDefaultViewBackgroundColor(t,h,p)}},{key:"objectIdIsKindOf",value:function objectIdIsKindOf(t,h){return this.imp.ObjectIdIsKindOf(t,h)}},{key:"initCalls",value:function initCalls(){var t=this;this.objectIdToObjectCalls.McDbCurve=function(h){return new It(t.imp.ObjectIdToMdDbCurve(h))},this.objectIdToObjectCalls.McDbEntity=function(h){return new Et(t.imp.ObjectIdToMdDbEntity(h))},this.objectIdToObjectCalls.McDbDimension=function(h){return new zt(t.imp.ObjectIdToMdDbDimension(h))},this.classNameToCreateCalls.McDbDimension=function(){return new zt},this.objectIdToObjectCalls.McDbLine=function(h){return new Bt(t.imp.ObjectIdToMdDbLine(h))},this.classNameToCreateCalls.McDbLine=function(){return new Bt},this.objectIdToObjectCalls.McDbText=function(h){return new Ot(t.imp.ObjectIdToMdDbText(h))},this.classNameToCreateCalls.McDbText=function(){return new Ot},this.objectIdToObjectCalls.McDbAttribute=function(h){return new Rt(t.imp.ObjectIdToMdDbAttribute(h))},this.classNameToCreateCalls.McDbAttribute=function(){return new Rt},this.objectIdToObjectCalls.McDbAttributeDefinition=function(h){return new Ft(t.imp.ObjectIdToMdDbAttributeDefinition(h))},this.classNameToCreateCalls.McDbAttributeDefinition=function(){return new Ft},this.objectIdToObjectCalls.McDbPolyline=function(h){return new Gt(t.imp.ObjectIdToMdDbPolyline(h))},this.classNameToCreateCalls.McDbPolyline=function(){return new Gt},this.objectIdToObjectCalls.McDbCircle=function(h){return new Vt(t.imp.ObjectIdToMdDbCircle(h))},this.classNameToCreateCalls.McDbCircle=function(){return new Vt},this.objectIdToObjectCalls.McDbArc=function(h){return new Xt(t.imp.ObjectIdToMdDbArc(h))},this.classNameToCreateCalls.McDbArc=function(){return new Xt},this.objectIdToObjectCalls.McDbBlockReference=function(h){return new jt(t.imp.ObjectIdToMdDbBlockReference(h))},this.classNameToCreateCalls.McDbBlockReference=function(){return new jt},this.objectIdToObjectCalls.McDbSpatialFilter=function(h){return new Ut(t.imp.ObjectIdToMdDbSpatialFilter(h))},this.classNameToCreateCalls.McDbSpatialFilter=function(){return new Ut},this.objectIdToObjectCalls.McDbAlignedDimension=function(h){return new Wt(t.imp.ObjectIdToMdDbAlignedDimension(h))},this.classNameToCreateCalls.McDbAlignedDimension=function(){return new Wt},this.objectIdToObjectCalls.McDbRotatedDimension=function(h){return new Ht(t.imp.ObjectIdToMdDbRotatedDimension(h))},this.classNameToCreateCalls.McDbRotatedDimension=function(){return new Ht},this.objectIdToObjectCalls.McDb2LineAngularDimension=function(h){return new $t(t.imp.ObjectIdToMdDb2LineAngularDimension(h))},this.classNameToCreateCalls.McDb2LineAngularDimension=function(){return new $t},this.objectIdToObjectCalls.McDbMText=function(h){return new Nt(t.imp.ObjectIdToMdDbMText(h))},this.classNameToCreateCalls.McDbMText=function(){return new Nt},this.objectIdToObjectCalls.McDbEllipse=function(h){return new qt(t.imp.ObjectIdToMdDbEllipse(h))},this.classNameToCreateCalls.McDbEllipse=function(){return new qt},this.objectIdToObjectCalls.McDbPoint=function(h){return new Kt(t.imp.ObjectIdToMdDbPoint(h))},this.classNameToCreateCalls.McDbPoint=function(){return new Kt},this.objectIdToObjectCalls.McDbBlockTableRecord=function(h){return new Br(t.imp.ObjectIdToMdDbBlockTableRecord(h))},this.classNameToCreateCalls.McDbBlockTableRecord=function(){return new Br},this.objectIdToObjectCalls.McDbLayerTableRecord=function(h){return new Dr(t.imp.ObjectIdToMdDbLayerTableRecord(h))},this.classNameToCreateCalls.McDbLayerTableRecord=function(){return new Dr},this.objectIdToObjectCalls.McDbLinetypeTableRecord=function(h){return new Sr(t.imp.ObjectIdToMdDbLinetypeTableRecord(h))},this.classNameToCreateCalls.McDbLinetypeTableRecord=function(){return new Sr},this.objectIdToObjectCalls.McDbDimStyleTableRecord=function(h){return new Tr(t.imp.ObjectIdToMdDbDimStyleTableRecord(h))},this.classNameToCreateCalls.McDbDimStyleTableRecord=function(){return new Tr},this.objectIdToObjectCalls.McDbTextStyleTableRecord=function(h){return new Ar(t.imp.ObjectIdToMdDbTextStyleTableRecord(h))},this.classNameToCreateCalls.McDbTextStyleTableRecord=function(){return new Ar},this.objectIdToObjectCalls.McDbHatch=function(h){return new Yt(t.imp.ObjectIdToMdDbHatch(h))},this.classNameToCreateCalls.McDbHatch=function(){return new Yt},this.objectIdToObjectCalls.McDbProxyEntity=function(h){return new Zt(t.imp.ObjectIdToMdDbProxyEntity(h))},this.classNameToCreateCalls.McDbProxyEntity=function(){return new Zt},this.objectIdToObjectCalls.McDbRasterImage=function(h){return new Jt(t.imp.ObjectIdToMdDbRasterImage(h))},this.classNameToCreateCalls.McDbRasterImage=function(){return new Jt},this.objectIdToObjectCalls.McDbRasterImageDef=function(h){return new Rr(t.imp.ObjectIdToMdDbRasterImageDef(h))},this.classNameToCreateCalls.McDbRasterImageDef=function(){return new Rr},this.objectIdToObjectCalls.McDbWipeout=function(h){return new Qt(t.imp.ObjectIdToMdDbWipeout(h))},this.classNameToCreateCalls.McDbWipeout=function(){return new Qt},this.objectIdToObjectCalls.McDbSpline=function(h){return new tr(t.imp.ObjectIdToMdDbSpline(h))},this.classNameToCreateCalls.McDbSpline=function(){return new tr},this.objectIdToObjectCalls.McDbDictionary=function(h){return new Fr(t.imp.ObjectIdToMdDbDictionary(h))},this.classNameToCreateCalls.McDbDictionary=function(){return new Fr},this.objectIdToObjectCalls.McDbXrecord=function(h){return new Nr(t.imp.ObjectIdToMdDbXrecord(h))},this.classNameToCreateCalls.McDbXrecord=function(){return new Nr},this.objectIdToObjectCalls.McDbGroup=function(h){return new Vr(t.imp.ObjectIdToMdDbGroup(h))},this.classNameToCreateCalls.McDbGroup=function(){return new Vr}}},{key:"objectIdToObject",value:function objectIdToObject(h){if(!h)return null;var p=this.imp.ObjectIdToObjectName(h);if(this.objectIdToObjectCalls[p])return this.objectIdToObjectCalls[p](h);if("McDbCustomEntity"==p){var x=this.imp.ObjectIdToMdDbCustomEntity(h);if(!x)return null;var M=x.getCustomEntityid(),k=x.GetDatabaseIndexId();return t.MxCpp.App.destroyObject(x),0==M||0==k?null:cr.getObject(M,k)}if(this.imp.ObjectIdIsKindOf(h,"McDbCurve"))return this.objectIdToObjectCalls.McDbCurve(h);if(this.imp.ObjectIdIsKindOf(h,"McDbDimension"))return this.objectIdToObjectCalls.McDbDimension(h);if(this.imp.ObjectIdIsKindOf(h,"McDbEntity"))return this.objectIdToObjectCalls.McDbEntity(h);var I=this.imp.ObjectIdToMdObject(h);return new gt(I)}},{key:"createCloneObject",value:function createCloneObject(h){if(!h)return null;var p=h.getObjectName();if("McDbCustomEntity"==p){var x=h.getCustomEntityid(),M=h.GetDatabaseIndexId(),k=null;return 0==x||0==M?(k=cr.createMxEntity(h.getCustomEntityTypeName()))&&(k.getImp().ConnectionTempObject(h),k.syncData(!1)):k=cr.getObject(x,M),t.MxCpp.App.destroyObject(h),k}var I=null;return this.classNameToCreateCalls[p]?I=this.classNameToCreateCalls[p]():h.isKindOf("McDbCurve")?(I=new It).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbCurve):h.isKindOf("McDbEntity")&&(I=new Et).initTempObject(new t.MxCpp.mxcadassemblyimp.MdDbEntity),I?(I.getImp().ConnectionTempObject(h),t.MxCpp.App.destroyObject(h),I):new gt(h)}},{key:"setFontFilePath",value:function setFontFilePath(t){this.imp.setFontFilePath(t)}},{key:"setDefaultTrueTypeFontFile",value:function setDefaultTrueTypeFontFile(t){this.imp.setDefaultTrueTypeFontFile(t)}},{key:"setDefaultShxFontFile",value:function setDefaultShxFontFile(t,h){this.imp.setDefaultShxFontFile(t,h)}},{key:"addNetworkLoadingFont",value:function addNetworkLoadingFont(t){var h,p=this,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof t?(this.imp.addNetworkLoadingFont(t),M||(this.shxFonts=[]),this.shxFonts.push(t)):(M?(h=this.shxFonts).push.apply(h,_toConsumableArray(t)):this.shxFonts=t,t.forEach((function(t){p.imp.addNetworkLoadingFont(t)})));x.forEach((function(t){p.imp.addFontsLoadOnInitialization(t,0)}))}},{key:"IniSet",value:function IniSet(t){return t.UseUtf8&&(tt.isUseUtf8=t.UseUtf8),this.imp.IniSet(JSON.stringify(t))}},{key:"setMcGeTol",value:function setMcGeTol(t){return this.dMcGeBakTol=this.imp.setMcGeTol(t),this.dMcGeBakTol}},{key:"restoreMcGeTol",value:function restoreMcGeTol(){this.dMcGeBakTol>0&&(this.imp.setMcGeTol(this.dMcGeBakTol),this.dMcGeBakTol=-1)}},{key:"addNetworkLoadingBigFont",value:function addNetworkLoadingBigFont(t){var h,p=this,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof t?(this.imp.addNetworkLoadingFont(t),M||(this.shxBigFonts=[]),this.shxBigFonts.push(t)):(M?(h=this.shxBigFonts).push.apply(h,_toConsumableArray(t)):this.shxBigFonts=t,t.forEach((function(t){p.imp.addNetworkLoadingFont(t)})));x.forEach((function(t){p.imp.addFontsLoadOnInitialization(t,1)}))}},{key:"addNetworkLoadingTrueTypeFont",value:function addNetworkLoadingTrueTypeFont(t,h,p){for(var x=this,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],k=t.length,I=0;I<k;I++)this.imp.addNetworkLoadingTrueTypeFont(t[I],h[I],p[I]),this.trueFonts[t[I]]={name:t[I],zhname:h[I],file:p[I]};M.forEach((function(t){x.imp.addFontsLoadOnInitialization(t,2)}))}},{key:"getShxFonts",value:function getShxFonts(){return this.shxFonts}},{key:"getShxBigFonts",value:function getShxBigFonts(){return this.shxBigFonts}},{key:"loadFonts",value:function loadFonts(t,h,p,x){var M=this,k=[],I=[],N=[];t.forEach((function(t){M.imp.isAlreadyNetworkLoaded(t)||k.push(t)})),h.forEach((function(t){M.imp.isAlreadyNetworkLoaded("{big}"+t)||I.push(t)})),p.forEach((function(t){M.imp.isAlreadyNetworkLoaded("{font}"+t)||N.push(t)})),Ur.loadFonts(k,I,N,x)}},{key:"isAlreadyLoaded",value:function isAlreadyLoaded(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0==h?this.imp.isAlreadyNetworkLoaded(t):1==h?this.imp.isAlreadyNetworkLoaded("{big}"+t):2!=h||this.imp.isAlreadyNetworkLoaded("{font}"+t)}},{key:"getTrueTypeFonts",value:function getTrueTypeFonts(){var t=this,h=[];return Object.keys(this.trueFonts).forEach((function(p){h.push(t.trueFonts[p])})),h}},{key:"getVersionString",value:function getVersionString(){return this.imp.GetVersionString()}},{key:"GetVersionDateString",value:function GetVersionDateString(){return this.imp.GetVersionDateString()}},{key:"newMcObjectId",value:function newMcObjectId(t,h){return new mt(t,h)}}]),McAppType}(),$r=function(){function MxCppType(){_classCallCheck$1(this,MxCppType),_defineProperty(this,"mxcadassemblyimp",void 0),_defineProperty(this,"App",new Hr),_defineProperty(this,"PropertiesWindow",new Jr),_defineProperty(this,"Ai",new Gr)}return _createClass$1(MxCppType,[{key:"getCallResult",value:function getCallResult(){return this.App.getLastCallResult()}},{key:"newMcGePoint3d",value:function newMcGePoint3d(t){var h=new rn;return t&&"number"==typeof t.x&&"number"==typeof t.y&&(h.x=t.x,h.y=t.y,"number"==typeof t.z&&(h.z=t.z)),h}},{key:"newMcGeVector3d",value:function newMcGeVector3d(t){var h=new nn;return t&&"number"==typeof t.x&&"number"==typeof t.y&&(h.x=t.x,h.y=t.y,"number"==typeof t.z&&(h.z=t.z)),h}},{key:"getCurrentMxCAD",value:function getCurrentMxCAD(){return this.App.getCurrentMxCAD()}},{key:"getCurrentDatabase",value:function getCurrentDatabase(){return this.App.getCurrentMxCAD().getDatabase()}},{key:"decodeFromGb2312",value:function decodeFromGb2312(t){return tt.decodeFromGb2312(t)}},{key:"encodeToGb2312",value:function encodeToGb2312(t){return tt.encodeToGb2312(t)}}]),MxCppType}(),Xr=_createClass$1((function MxCADPluginMapDefaultData(){_classCallCheck$1(this,MxCADPluginMapDefaultData),_defineProperty(this,"mapOrigin",[]),_defineProperty(this,"cadOrigin",[]),_defineProperty(this,"meterInCADUnits",1),_defineProperty(this,"mapbox_accessToken",""),_defineProperty(this,"openFile",void 0),_defineProperty(this,"rasterTileLayerList",[]),_defineProperty(this,"rasterTileKey",void 0),_defineProperty(this,"providers",void 0),_defineProperty(this,"viewColor",void 0)})),qr=_createClass$1((function MxCADPluginSampleCode(){_classCallCheck$1(this,MxCADPluginSampleCode),_defineProperty(this,"type",""),_defineProperty(this,"name",""),_defineProperty(this,"code","")})),Kr=_createClass$1((function MxCADPluginBase(){_classCallCheck$1(this,MxCADPluginBase),_defineProperty(this,"sRegistData",""),_defineProperty(this,"mxcadui",void 0),_defineProperty(this,"openFile",void 0),_defineProperty(this,"map_default_data",void 0),_defineProperty(this,"sampleCode",void 0)})),Yr=function(t){return t[t.kInt=1]="kInt",t[t.kDouble=2]="kDouble",t[t.kString=3]="kString",t}(Yr||{}),Zr=_createClass$1((function MxPropertiesWindowCustomValue(){_classCallCheck$1(this,MxPropertiesWindowCustomValue),_defineProperty(this,"sVarName",""),_defineProperty(this,"iVarType",1),_defineProperty(this,"val",void 0),_defineProperty(this,"isOnlyRead",!1)})),Jr=function(){function MxPropertiesWindowCustom(){_classCallCheck$1(this,MxPropertiesWindowCustom),_defineProperty(this,"getPropertiesCall",null),_defineProperty(this,"setPropertiesCall",null)}return _createClass$1(MxPropertiesWindowCustom,[{key:"onEvent_getProperties",value:function onEvent_getProperties(t){this.getPropertiesCall=t}},{key:"onEvent_setProperties",value:function onEvent_setProperties(t){this.setPropertiesCall=t}},{key:"setEntitySupportCustom",value:function setEntitySupportCustom(t){var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=t.getMcDbEntity();p&&p.getImp().setPropertiesWindowCustom(h)}},{key:"getEntityProperties",value:function getEntityProperties(t){var h=t.getMcDbEntity();return h&&h.getImp().isPropertiesWindowCustom()?null==this.getPropertiesCall?[]:this.getPropertiesCall(t):[]}},{key:"setEntityProperties",value:function setEntityProperties(t,h){var p=t.getMcDbEntity();if(p&&p.getImp().isPropertiesWindowCustom())return null==this.setPropertiesCall?void 0:this.setPropertiesCall(t,h)}}]),MxPropertiesWindowCustom}(),Qr=function(){function MxCompare(){_classCallCheck$1(this,MxCompare),_defineProperty(this,"imp",void 0),_defineProperty(this,"result",[]),this.imp=new t.MxCpp.mxcadassemblyimp.MxCompare}return _createClass$1(MxCompare,[{key:"getTypeString",value:function getTypeString(t){var h="";switch(t){case 0:h="no modify";break;case 1:default:h="unknown";break;case 2:h="object modify";break;case 3:h="object erase";break;case 4:h="object add"}return h}},{key:"do",value:function _do(t){if(this.result=[],this.imp.Do(t.imp)){for(var h=new bt(this.imp.getResult()),p=h.GetCount(),x=0;x+2<p;x+=3){var M=h.AtLong(x);if(!M.ret)break;var k=h.AtPoint(x+1);if(!k.ret)break;var I=h.AtLong(x+2);if(!I.ret)break;this.result.push({id:new mt(M.val),pos:k.val,type:I.val,str:this.getTypeString(I.val)})}return!0}return!1}},{key:"getResult",value:function getResult(){return this.result}}]),MxCompare}(),en=function(){function MxModifyColor(){_classCallCheck$1(this,MxModifyColor),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MxTempModifyColor}return _createClass$1(MxModifyColor,[{key:"Do",value:function Do(t,h){return this.imp.Do(t.imp,h.getImp())}},{key:"DoRestore",value:function DoRestore(){this.imp.DoRestore()}}]),MxModifyColor}(),tn=function(){function MxCADTempForbiddenIntelliSelect(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_classCallCheck$1(this,MxCADTempForbiddenIntelliSelect),_defineProperty(this,"bakIsIntelliSelect",!0),this.bakIsIntelliSelect=h.MxFun.getIniSet().EnableIntelliSelect,h.MxFun.setIniset({EnableIntelliSelect:!t})}return _createClass$1(MxCADTempForbiddenIntelliSelect,[{key:"restoreSettings",value:function restoreSettings(){h.MxFun.setIniset({EnableIntelliSelect:this.bakIsIntelliSelect})}}]),MxCADTempForbiddenIntelliSelect}();function loadMxCADassembly(t){return _loadMxCADassembly.apply(this,arguments)}function _loadMxCADassembly(){return _loadMxCADassembly=_asyncToGenerator(ie.mark((function _callee2(h){var p,x,M,k,I,N=arguments;return ie.wrap((function _callee2$(V){for(;;)switch(V.prev=V.next){case 0:return p=N.length>1&&void 0!==N[1]?N[1]:it||!ot?st:ct,x=N.length>2?N[2]:void 0,M=N.length>3?N[3]:void 0,k=N.length>4?N[4]:void 0,I=N.length>5?N[5]:void 0,V.abrupt("return",new Promise(function(){var N=_asyncToGenerator(ie.mark((function _callee(N,V){var ee,te;return ie.wrap((function _callee$(re){for(;;)switch(re.prev=re.next){case 0:if(re.prev=0,t.MxCpp||(t.MxCpp=new $r),!t.MxCpp.mxcadassemblyimp){re.next=5;break}return h&&h(t.MxCpp),re.abrupt("return",N(t.MxCpp));case 5:return"mxdrawassembly_min",re.next=8,lt("mxdrawassembly_min","mxdrawassembly",{locateFile:p,wasmBinary:x});case 8:ee=re.sent,t.MxCpp.mxcadassemblyimp=ee,te=new ee.McApp,M?te.setFontFilePath(M):te.setFontFilePath("fonts"),t.MxCpp.App.setImp(te),I&&I.callEvent("init_cpp"),te.Init(),cr.init(),t.MxCpp.App.init(te),k?t.MxCpp.App.addNetworkLoadingFont(k):t.MxCpp.App.addNetworkLoadingFont(["txt.shx","hztxt.shx"]),window.__MxCpp__=t.MxCpp,h&&h(t.MxCpp),N(t.MxCpp),re.next=27;break;case 24:re.prev=24,re.t0=re.catch(0),V(re.t0);case 27:case"end":return re.stop()}}),_callee,null,[[0,24]])})));return function(t,h){return N.apply(this,arguments)}}()));case 6:case"end":return V.stop()}}),_callee2)}))),_loadMxCADassembly.apply(this,arguments)}function MxCheckTheBrowser(){var t,h={},p=navigator.userAgent.toLowerCase();if((t=p.match(/edg\/([\d.]+)/))?h.edge=t[1]:(t=p.match(/rv:([\d.]+)\) like gecko/))||(t=p.match(/msie ([\d.]+)/))?h.ie=t[1]:(t=p.match(/firefox\/([\d.]+)/))?h.firefox=t[1]:(t=p.match(/chrome\/([\d.]+)/))?h.chrome=t[1]:(t=p.match(/opera.([\d.]+)/))?h.opera=t[1]:(t=p.match(/version\/([\d.]+).*safari/))&&(h.safari=t[1]),h.ie)return{ok:!1,error:"iechromeedge",var:h};if(h.edge){if(null!=new RegExp("edg/([0-9]{1,}[.0-9]{0,})").exec(p)&&parseFloat(RegExp.$1)<107)return{ok:!1,error:"edgeedge",var:h}}else if(h.chrome){if(null!=new RegExp("chrome/([0-9]{1,}[.0-9]{0,})").exec(p))if(parseFloat(RegExp.$1)<107)return{ok:!1,error:"chrome",var:h}}else if(h.firefox){if(null!=new RegExp("firefox/([0-9]{1,}[.0-9]{0,})").exec(p))if(parseFloat(RegExp.$1)<101)return{ok:!1,error:"firefoxfirefox",var:h}}else if(!h.safari)return h.opera?{ok:!1,error:"operachromeedge",var:h}:{ok:!1,error:"chromeedge",var:h};return{ok:!0,error:"",var:h}}t.MxCpp=new $r;var rn=function(){function McGePoint3d(h,p,x){_classCallCheck$1(this,McGePoint3d),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGePoint3d,h instanceof Object?(this.imp.x=h.x,this.imp.y=h.y,this.imp.z=h.z):(this.imp.x=h||0,this.imp.y=p||0,this.imp.z=x||0)}return _createClass$1(McGePoint3d,[{key:"toVector3",value:function toVector3(){return new THREE.Vector3(this.imp.x,this.imp.y,this.imp.z)}},{key:"setFromVector3",value:function setFromVector3(t){return this.imp.x=t.x,this.imp.y=t.y,this.imp.z=t.z,this}},{key:"copy",value:function copy(t){return this.imp.x=t.x,this.imp.y=t.y,this.imp.z=t.z,this}},{key:"transformBy",value:function transformBy(t){return this.imp.transformBy(t.imp),this}},{key:"addvec",value:function addvec(t){return this.imp.addvec(t.imp),this}},{key:"av",value:function av(t){return this.imp.addvec(t.imp),this}},{key:"subvec",value:function subvec(t){return this.imp.subvec(t.imp),this}},{key:"sv",value:function sv(t){return this.imp.subvec(t.imp),this}},{key:"sub",value:function sub(t){return new nn(this.imp.sub(t.imp))}},{key:"distanceTo",value:function distanceTo(t){return this.imp.distanceTo(t.imp)}},{key:"isEqualTo",value:function isEqualTo(t){return this.imp.isEqualTo(t.imp)}},{key:"clone",value:function clone(){return new McGePoint3d(this.imp)}},{key:"c",value:function c(){return new McGePoint3d(this.imp)}},{key:"x",get:function get(){return this.imp.x},set:function set(t){this.imp.x=t}},{key:"y",get:function get(){return this.imp.y},set:function set(t){this.imp.y=t}},{key:"z",get:function get(){return this.imp.z},set:function set(t){this.imp.z=t}}]),McGePoint3d}();_defineProperty(rn,"kOrigin",void 0);var nn=function(){function McGeVector3d(h,p,x){_classCallCheck$1(this,McGeVector3d),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGeVector3d,h instanceof Object?(this.imp.x=h.x,this.imp.y=h.y,this.imp.z=h.z):(this.imp.x=h||0,this.imp.y=p||0,this.imp.z=x||0)}return _createClass$1(McGeVector3d,[{key:"toVector3",value:function toVector3(){return new THREE.Vector3(this.imp.x,this.imp.y,this.imp.z)}},{key:"copy",value:function copy(t){return this.imp.x=t.imp.x,this.imp.y=t.imp.y,this.imp.z=t.imp.z,this}},{key:"clone",value:function clone(){return new McGeVector3d(this.imp)}},{key:"c",value:function c(){return new McGeVector3d(this.imp)}},{key:"rotateBy",value:function rotateBy(t,h){return h||(h=McGeVector3d.kZAxis),this.imp.rotateBy(t,h.imp),this}},{key:"negate",value:function negate(){return this.imp.negate(),this}},{key:"perpVector",value:function perpVector(){return this.imp.perpVector(),this}},{key:"angleTo1",value:function angleTo1(t){return this.imp.angleTo(t.imp)}},{key:"angleTo2",value:function angleTo2(t,h){return h||(h=McGeVector3d.kNegateZAxis),this.imp.angleTo(t.imp,h.imp)}},{key:"normalize",value:function normalize(){return this.imp.normalize(),this}},{key:"length",value:function length(){return this.imp.length()}},{key:"isUnitLength",value:function isUnitLength(){return this.imp.isUnitLength()}},{key:"isZeroLength",value:function isZeroLength(){return this.imp.isZeroLength()}},{key:"dotProduct",value:function dotProduct(t){return this.imp.dotProduct(t.imp)}},{key:"crossProduct",value:function crossProduct(t){var h=new McGeVector3d;return h.imp=this.imp.crossProduct(t.imp),h}},{key:"isEqualTo",value:function isEqualTo(t){return this.imp.isEqualTo(t.imp)}},{key:"mult",value:function mult(t){return this.imp.mult(t),this}},{key:"x",get:function get(){return this.imp.x},set:function set(t){this.imp.x=t}},{key:"y",get:function get(){return this.imp.y},set:function set(t){this.imp.y=t}},{key:"z",get:function get(){return this.imp.z},set:function set(t){this.imp.z=t}}]),McGeVector3d}();_defineProperty(nn,"kIdentity",void 0),_defineProperty(nn,"kXAxis",void 0),_defineProperty(nn,"kYAxis",void 0),_defineProperty(nn,"kZAxis",void 0),_defineProperty(nn,"kNegateZAxis",void 0);var sn=function(){function McGeMatrix3d(h){_classCallCheck$1(this,McGeMatrix3d),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGeMatrix3d,h instanceof Object&&this.imp.copy(h)}return _createClass$1(McGeMatrix3d,[{key:"copy",value:function copy(t){return this.imp.copy(t.imp),this}},{key:"clone",value:function clone(){return new McGeMatrix3d(this.imp)}},{key:"setToIdentity",value:function setToIdentity(){return this.imp.setToIdentity(),this}},{key:"preMultBy",value:function preMultBy(t){return this.imp.preMultBy(t.imp),this}},{key:"postMultBy",value:function postMultBy(t){return this.imp.postMultBy(t.imp),this}},{key:"setToProduct",value:function setToProduct(t,h){return this.imp.setToProduct(t.imp,h.imp),this}},{key:"invert",value:function invert(){return this.imp.invert(),this}},{key:"isSingular",value:function isSingular(){return this.imp.isSingular()}},{key:"transposeIt",value:function transposeIt(){return this.imp.transposeIt(),this}},{key:"isEqualTo",value:function isEqualTo(t){return this.imp.isEqualTo(t.imp)}},{key:"det",value:function det(){return this.imp.det()}},{key:"setCoordSystem",value:function setCoordSystem(t,h,p,x){return this.imp.setCoordSystem(t.imp,h.imp,p.imp,x.imp),this}},{key:"setToTranslation",value:function setToTranslation(t){return this.imp.setToTranslation(t.imp),this}},{key:"setToRotation",value:function setToRotation(t,h,p){return this.imp.setToRotation(t,h.imp,p.imp),this}},{key:"setToScaling",value:function setToScaling(t,h){return this.imp.setToScaling(t,h.imp),this}},{key:"setMirror",value:function setMirror(t,h){return this.imp.setMirror(t.imp,h.imp),this}},{key:"scale",value:function scale(){return this.imp.scale()}},{key:"angleXYPlane",value:function angleXYPlane(){return this.imp.angleXYPlane()}},{key:"getData",value:function getData(t,h){return this.imp.getData(t,h)}},{key:"setData",value:function setData(t,h,p){return this.imp.setData(t,h,p)}}]),McGeMatrix3d}();_defineProperty(sn,"kIdentity",void 0);var cn=function(){function McGeLongArray(h){_classCallCheck$1(this,McGeLongArray),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGeLongArray,h instanceof Object&&this.imp.copy(h)}return _createClass$1(McGeLongArray,[{key:"copy",value:function copy(t){return this.imp.clear(),this.imp.copy(t.imp),this}},{key:"copyFormAryId",value:function copyFormAryId(t){var h=this;return this.imp.clear(),t.forEach((function(t){h.imp.append(t.id)})),this}},{key:"append",value:function append(t){this.imp.append(t)}},{key:"length",value:function length(){return this.imp.length()}},{key:"at",value:function at(t){return this.imp.at(t)}},{key:"setAt",value:function setAt(t,h){this.imp.setAt(t,h)}},{key:"clear",value:function clear(){this.imp.clear()}},{key:"forEach",value:function forEach(t){for(var h=this.imp.length(),p=0;p<h;p++)t(this.imp.at(p),p)}}]),McGeLongArray}(),un=function(){function McGeStringArray(h){_classCallCheck$1(this,McGeStringArray),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGeStringArray,h instanceof Object&&this.imp.copy(h)}return _createClass$1(McGeStringArray,[{key:"copy",value:function copy(t){return this.imp.copy(t.imp),this}},{key:"append",value:function append(t){this.imp.append(t)}},{key:"length",value:function length(){return this.imp.length()}},{key:"at",value:function at(t){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?tt.decodeFromGb2312(this.imp.at(t)):this.imp.at(t)}},{key:"setAt",value:function setAt(t,h){!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?this.imp.setAt(t,tt.encodeToGb2312(h)):this.imp.setAt(t,h)}},{key:"forEach",value:function forEach(t){for(var h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],p=this.imp.length(),x=0;x<p;x++)t(h?tt.decodeFromGb2312(this.imp.at(x)):this.imp.at(x),x)}},{key:"clear",value:function clear(){this.imp.clear()}}]),McGeStringArray}(),ln=function(){function McGePoint3dArray(h,p){var x=this;_classCallCheck$1(this,McGePoint3dArray),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGePoint3dArray,h instanceof Array?h.forEach((function(t){x.imp.append(t.imp)})):h instanceof Object&&(this.imp.copy(h),p&&t.MxCpp.App.getImp().DestroyMdGePoint3dArray(h))}return _createClass$1(McGePoint3dArray,[{key:"copy",value:function copy(t){var h=this;return t instanceof Array?t.forEach((function(t){h.imp.append(t.imp)})):this.imp.copy(t.imp),this}},{key:"append",value:function append(t){this.imp.append(t.imp)}},{key:"length",value:function length(){return this.imp.length()}},{key:"isEmpty",value:function isEmpty(){return 0==this.imp.length()}},{key:"at",value:function at(t){return new rn(this.imp.at(t))}},{key:"setAt",value:function setAt(t,h){this.imp.setAt(t,h.imp)}},{key:"clear",value:function clear(){this.imp.clear()}},{key:"forEach",value:function forEach(t){for(var h=this.imp.length(),p=0;p<h;p++)t(new rn(this.imp.at(p)),p)}}]),McGePoint3dArray}(),hn=function(){function McGeDoubleArray(h,p){_classCallCheck$1(this,McGeDoubleArray),_defineProperty(this,"imp",void 0),this.imp=new t.MxCpp.mxcadassemblyimp.MdGeDoubleArray,h instanceof Object&&(this.imp.copy(h),p&&t.MxCpp.App.getImp().DestroyMdGeDoubleArray(h))}return _createClass$1(McGeDoubleArray,[{key:"copy",value:function copy(t){return this.imp.clear(),this.imp.copy(t.imp),this}},{key:"append",value:function append(t){this.imp.append(t)}},{key:"length",value:function length(){return this.imp.length()}},{key:"at",value:function at(t){return this.imp.at(t)}},{key:"setAt",value:function setAt(t,h){this.imp.setAt(t,h)}},{key:"clear",value:function clear(){this.imp.clear()}},{key:"forEach",value:function forEach(t){for(var h=this.imp.length(),p=0;p<h;p++)t(this.imp.at(p),p)}}]),McGeDoubleArray}(),fn=function(){function McGeBound(t){_classCallCheck$1(this,McGeBound),_defineProperty(this,"minPoint",void 0),_defineProperty(this,"maxPoint",void 0),_defineProperty(this,"isValid",void 0),this.minPoint=new rn,this.maxPoint=new rn,this.isValid=!1,t&&this.addPoints(t)}return _createClass$1(McGeBound,[{key:"addPoint",value:function addPoint(t){this.isValid?(this.minPoint.x>t.x&&(this.minPoint.x=t.x),this.minPoint.y>t.y&&(this.minPoint.y=t.y),this.minPoint.z>t.z&&(this.minPoint.y=t.z),this.maxPoint.x<t.x&&(this.maxPoint.x=t.x),this.maxPoint.y<t.y&&(this.maxPoint.y=t.y),this.maxPoint.z<t.z&&(this.maxPoint.z=t.z)):(this.minPoint.x=t.x,this.minPoint.y=t.y,this.minPoint.z=t.z,this.maxPoint.x=t.x,this.maxPoint.y=t.y,this.maxPoint.z=t.z,this.isValid=!0)}},{key:"addPoints",value:function addPoints(t){var h=this;t.forEach((function(t){h.addPoint(t)}))}}]),McGeBound}(),dn=_createClass$1((function MxCADBaseCustomElement(){_classCallCheck$1(this,MxCADBaseCustomElement)})),pn=function(t){return t.None="none",t.Overflow="overflow",t.Word="word",t.Forced="forced",t}(pn||{}),mn=function(t){return t.Left="l",t.Center="c",t.Right="r",t.Justify="j",t.Distribute="d",t}(mn||{}),gn=function(t){return t.Paragraph="P",t.Color="c",t.ColorIndex="C",t.Font="f",t.FontAlt="F",t.FontHeight="H",t.Overline="O",t.OverlineEnd="o",t.Strike="K",t.StrikeEnd="k",t.Underline="L",t.UnderlineEnd="l",t.TiltAngle="Q",t.Tracking="T",t.WidthFactor="W",t.SuperSubScript="S",t.LineSpacing="pxsm",t}(gn||{}),vn=function(t){return t.Chinese="chinese",t.Continuous="continuous",t.Breakable="breakable",t.Element="element",t.TextNode="textNode",t}(vn||{});function isElement(t){return!(null==t||!t.children)}function isText(t){return"text"in t}var yn={CHINESE:/[\u4e00-\u9fa5]/,WHITESPACE:/\s/},bn=new RegExp("".concat(yn.CHINESE.source,"|").concat(yn.WHITESPACE.source));function isBreakableChar(t){return bn.test(t)}function createFragment(t,h,p,x){return{node:t,nodeIndex:h,startOffset:p,endOffset:x,text:isElement(t)?"":t.text.substring(p,x)}}function createSequence(t,h){return{type:t,fragments:[h],text:h.text}}function appendToSequence(t,h){t.fragments.push(h),t.text+=h.text}function createNewLine(){return{nodes:[],height:0,width:0,breakInfo:{isWrapped:!1,breakType:pn.None}}}function addTextFragmentToLine(t,h,p){t.nodes.push(h),t.width+=h.width,t.height=Math.max(t.height,p)}function updateLineBreakInfo(t,h,p){!function ensureBreakInfo(t){t.breakInfo||(t.breakInfo={isWrapped:!1,breakType:pn.None})}(t),t.breakInfo.isWrapped=h,t.breakInfo.breakType=p}var xn=new Map,Mn=function getCalculateData(t,h,p){var x=xn.get(h);if(x)return x;var M=Kn.elementTextManager.get(h.type),k=null==M?void 0:M.calculate(t,h,p);return k?(k&&xn.set(h,k),k):{width:0,height:0}},wn=new WeakMap;function generateFragmentKey(t){return"".concat(t.nodeIndex,"_").concat(t.startOffset,"_").concat(t.endOffset)}function calculateSequenceWidth(t,h,p){var x=wn.get(h);if(x)return x.width;var M,k=new Map;if(h.type===vn.Element){var I=h.fragments[0].node,N=Mn(t,I).width;M=N}else h.type===vn.Continuous?M=function calculateContinuousSequenceWidth(t,h,p){var x=h.baseHeight,M=h.getTextWidth;if(function hasUniformStyle(t){if(t.length<=1)return!0;var h=t[0].node;return t.every((function(t){return t.node===h}))}(t.fragments)){var k=M(t.text,t.fragments[0].node,x),I=k/t.fragments.length;return t.fragments.forEach((function(t){p.set(generateFragmentKey(t),I)})),k}var N=0;return t.fragments.forEach((function(t){var h=M(t.text,t.node,x);p.set(generateFragmentKey(t),h),N+=h})),N}(h,p,k):(M=0,h.fragments.forEach((function(t){var h=function calculateBreakableFragmentWidth(t,h){var p=h.baseHeight;return(0,h.getTextWidth)(t.text,t.node,p)}(t,p);k.set(generateFragmentKey(t),h),M+=h})));return wn.set(h,{width:M,fragmentWidths:k}),M}function getFragmentWidth(t,h){var p=wn.get(t);if(!p)throw new Error("Sequence width not calculated");var x=p.fragmentWidths.get(generateFragmentKey(h));if(void 0===x)throw new Error("Fragment width not found");return x}function _createForOfIteratorHelper$9(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$9(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$9(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$9(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$9(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function calculateLineBreaks(t,h,p,x){var M=x.maxWidth,k=x.baseHeight,I=x.getTextHeight,N=x.isWidthOffset;if(null==h||!h.length)return[];var V,ee=function findTextSequences(t){var h=[],p=null;return t.forEach((function(t,x){if(isText(t)){if(t.type&&Kn.elementTextManager.hasText(t.type))return p=null,void h.push(createSequence(vn.TextNode,createFragment(t,x,0,t.text.length)));var M=t.text,k=0;if(0===M.length)h.push(createSequence(vn.Continuous,createFragment(t,x,k,k)));else for(;k<M.length;){var I;if(isBreakableChar(M[k]))p=null,h.push(createSequence(vn.Breakable,createFragment(t,x,k,k+1))),k++;else{for(var N=k+1;N<M.length&&!isBreakableChar(M[N]);)N++;var V=createFragment(t,x,k,N);(null===(I=p)||void 0===I?void 0:I.type)===vn.Continuous?appendToSequence(p,V):(p=createSequence(vn.Continuous,V),h.push(p)),k=N}}}else isElement(t)&&Kn.elementTextManager.has(t.type)&&(p=null,h.push(createSequence(vn.Element,createFragment(t,x,0,0))))})),h}(h),te=[],re=createNewLine(),ne=0,ie=function updateSequence(h,x){if(isElement(x.node)){var M=Mn(t,x.node),N=M.height,V=M.width;addTextFragmentToLine(re,{node:x.node,path:[p,x.nodeIndex],startOffset:x.startOffset,endOffset:x.endOffset,width:V,index:x.nodeIndex,height:N},N)}else{var ee=I(x.node,k);addTextFragmentToLine(re,{node:x.node,path:[p,x.nodeIndex],startOffset:x.startOffset,endOffset:x.endOffset,width:getFragmentWidth(h,x),index:x.nodeIndex,height:ee},ee)}},ae=function applyCharLevelSpacing(){if(N){var t=M-ne;if(t>0){var h=re.nodes.reduce((function(t,h){return isElement(h.node)||isText(h.node)&&h.node.type&&Kn.elementTextManager.hasText(h.node.type)?t+1:t+h.endOffset-h.startOffset}),0),p=0;p=1===h?t/2:t/(h-1),re.nodes.forEach((function(t){t.hasCharLevelSpacing=!0,t.extraCharSpacing=p}))}}},oe=_createForOfIteratorHelper$9(ee);try{var se=function _loop(){var h=V.value,p=calculateSequenceWidth(t,h,x);if(0===ne&&p>M)return h.fragments.forEach((function(t){ie(h,t)})),ae(),updateLineBreakInfo(re,!0,h.type===vn.Continuous||h.isAutoBreak?pn.Word:pn.Forced),te.push(re),re=createNewLine(),ne=0,1;ne+p>M&&ne>0&&(ae(),updateLineBreakInfo(re,!0,pn.Forced),te.push(re),re=createNewLine(),ne=0),h.fragments.forEach((function(t){ie(h,t)})),ne+=p};for(oe.s();!(V=oe.n()).done;)se()}catch(ce){oe.e(ce)}finally{oe.f()}return re.nodes.length>0&&(updateLineBreakInfo(re,!0,pn.Forced),ae(),re.isEndLine=!0,te.push(re)),te}function _slicedToArray$1(t,h){return function _arrayWithHoles$1(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit$1(t,h){var p=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=p){var x,M,k,I,N=[],V=!0,ee=!1;try{if(k=(p=p.call(t)).next,0===h){if(Object(p)!==p)return;V=!1}else for(;!(V=(x=k.call(p)).done)&&(N.push(x.value),N.length!==h);V=!0);}catch(t){ee=!0,M=t}finally{try{if(!V&&null!=p.return&&(I=p.return(),Object(I)!==I))return}finally{if(ee)throw M}}return N}}(t,h)||_unsupportedIterableToArray$a(t,h)||function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _n=function setColor(t,h){var p=Cn(t);return p&&(h.trueColor=p),p},Cn=function getColor(t){var h;if("number"==typeof t.color)(h=new Cr).setColorIndex(t.color);else if(Array.isArray(t.color)){var p=_slicedToArray$1(t.color,3),x=p[0],M=void 0===x?255:x,k=p[1],I=void 0===k?255:k,N=p[2],V=void 0===N?255:N;(h=new Cr).setRGB(M,I,V)}return h},Sn=new Map,Tn=function getTextCalculateData(t,h){var p=Sn.get(h);if(p)return p;if(h.type&&Kn.elementTextManager.hasText(h.type)){var x=Kn.elementTextManager.getText(h.type),M=null==x?void 0:x.calculate(t,h);if(M)return M&&Sn.set(h,M),M}return{width:0,height:0}},An=function getTextHeight(t,h,p){return t.type&&Kn.elementTextManager.hasText(t.type)?(Tn(p,t)||{width:0}).height:h*((null==t?void 0:t.fontSize)||1)};function createFormattedTextNode(t,h){var p={text:t};return h.bold&&(p.bold=!0),h.italic&&(p.italic=!0),h.underline&&(p.underline=!0),h.overline&&(p.overline=!0),h.strike&&(p.strike=!0),h.font&&(p.font=h.font),h.fontSize&&(p.fontSize=h.fontSize),h.style&&(p.style=h.style),void 0!==h.color&&null!==h.color&&(p.color=h.color),void 0!==h.tiltAngle&&(p.tiltAngle=h.tiltAngle),void 0!==h.tracking&&(p.tracking=h.tracking),void 0!==h.widthFactor&&(p.widthFactor=h.widthFactor),void 0!==h.textPosition&&(p.textPosition=h.textPosition),p}function escapeCADSpecialChars(t){for(var h="",p=0;p<t.length;){var x=t[p];if("\\"===x){if(p+1<t.length){var M=t[p+1];if("\\"===M||"{"===M||"}"===M){h+=x+M,p+=2;continue}}h+="\\\\"}else h+="{"===x||"}"===x?"\\"+x:x;p++}return h}var Dn=function createMcText(h,p){var x=p.baseHeight,M=p.position,k=p.style,I=p.ent,N=new Nt;if(N.contents=escapeCADSpecialChars(h.text),N.textHeight=An(h,x,I),N.location=M,function setFont(h,p,x){x||(x=t.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleName()),p.textStyle=x,p.contents=function combinationMTextContents(t,h){var p=t.bold,x=t.italic,M=t.font,k=t.tiltAngle,I=t.tracking,N=t.widthFactor;t.textPosition;var V=h,ee="";return void 0===M&&!0!==p&&!0!==x||(ee+="\\f".concat(null!=M?M:"","|").concat(p?"b1":"b0","|").concat(x?"i1":"i0","|c134|p49;")),"number"==typeof k&&(ee+="\\Q".concat(k,";")),"number"==typeof I&&(ee+="\\T".concat(I,";")),"number"==typeof N&&(ee+="\\W".concat(N,";")),"{"+ee+V+"}"}(h,p.contents)}(h,N,k),I.trueColor.method===Ii.kByColor)N.trueColor=I.trueColor;else{var V=new Cr;V.setColorIndex(I.colorIndex),N.trueColor=V,N.colorIndex=I.colorIndex}return N.layer=I.layer,N.layerId=I.layerId,N.drawOrder=I.drawOrder,N.linetype=I.linetype,N.linetypeScale=I.linetypeScale,N.lineweight=I.lineweight,N},kn=function getTextPosition(t){var h=t.basePosition,p=t.horizontalOffset,x=t.verticalOffset;return h.clone().addvec(nn.kXAxis.clone().mult(p)).addvec(nn.kYAxis.clone().negate().mult(x))};function ownKeys$7(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$7(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$7(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$7(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}var Pn=function createTextEntity(t){var h=t.node,p=t.text,x=t.height,M=t.position,k=t.style,I=t.ent,N=Dn(_objectSpread$7(_objectSpread$7({},h),{},{text:p}),{baseHeight:x,position:kn(M),style:k,ent:I});return _n(h,N),N},Ln=function getTextNodeBoxInfo(t,h){var p=Dn(t,h);return p.reCompute(),function getBoxInfo(t){var h=Mt.getTextEntityBox(t,!1),p=h.maxPt.clone(),x=new rn(h.minPt.x,p.y),M=x.distanceTo(p),k=x.distanceTo(h.maxPt);return{start:x,end:p,width:M,height:k,box:h}}(p)};function _createForOfIteratorHelper$8(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$8(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$8(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$8(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$8(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function unicodeToCadSpecialChar(t){var h=t;return Kn.elementTextManager.forEachSpecialCharacter((function(t,p){h=h.replace(new RegExp(p,"g"),t)})),h}var En={color:function color(t){var color=t.color;if(void 0===color)return"";if(Array.isArray(color)){var h=_slicedToArray$1(color,3),p=h[0]+256*h[1]+256*h[2]*256;return"\\".concat(gn.Color).concat(p,";")}if("number"==typeof color)return"\\".concat(gn.ColorIndex).concat(color,";");if("string"==typeof color){var x=color.replace(/^#/,""),M=parseInt(x.substring(0,2),16)+256*parseInt(x.substring(2,4),16)+256*parseInt(x.substring(4,6),16)*256;return"\\".concat(gn.Color).concat(M,";")}return""},font:function font(t){var h=t,font=h.font||"",p=h.bold?"|b1":"|b0",x=h.italic?"|i1":"|i0";return"\\".concat(gn.Font).concat(font).concat(p).concat(x,"|c134|p49;")},fontSize:function fontSize(t){var fontSize=t.fontSize;return void 0===fontSize?"":"\\".concat(gn.FontHeight).concat(fontSize,"x;")},bold:function bold(t){return t.bold?t.font?"":"\\".concat(gn.Font,"|b1|i0|c134|p49;"):""},italic:function italic(t){return t.italic?t.font?"":"\\".concat(gn.Font,"|b0|i1|c134|p49;"):""},underline:function underline(t){return t.underline?"\\".concat(gn.Underline):""},overline:function overline(t){return t.overline?"\\".concat(gn.Overline):""},strike:function strike(t){return t.strike?"\\".concat(gn.Strike):""},tiltAngle:function tiltAngle(t){var tiltAngle=t.tiltAngle;return void 0===tiltAngle?"":"\\".concat(gn.TiltAngle).concat(tiltAngle,";")},tracking:function tracking(t){var tracking=t.tracking;return void 0===tracking?"":"\\".concat(gn.Tracking).concat(tracking,";")},widthFactor:function widthFactor(t){var widthFactor=t.widthFactor;return void 0===widthFactor?"":"\\".concat(gn.WidthFactor).concat(widthFactor,";")}};function processText(t){var h=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isDecorative,p=void 0===h||h,x="",M=function extractFormatFromNode(t){var h={},p=t;if(p.bold&&(h.bold=!0),p.italic&&(h.italic=!0),p.underline&&(h.underline=!0),p.overline&&(h.overline=!0),p.strike&&(h.strike=!0),p.font&&(h.font=p.font),p.style&&(h.style=p.style),p.fontSize&&(h.fontSize=p.fontSize),p.color){var x=p.color;"number"==typeof x?h.color=x:Array.isArray(x)&&(h.color=_toConsumableArray(x))}return void 0!==p.tiltAngle&&(h.tiltAngle=p.tiltAngle),void 0!==p.tracking&&(h.tracking=p.tracking),void 0!==p.widthFactor&&(h.widthFactor=p.widthFactor),void 0!==p.textPosition&&(h.textPosition=p.textPosition),h}(t),k=Object.keys(M).length>0,I=unicodeToCadSpecialChar(t.text);if(k){x+="{",void 0===M.font&&!0!==M.bold&&!0!==M.italic||(x+=En.font(t));for(var N=0,V=["fontSize","color","tiltAngle","tracking","widthFactor"];N<V.length;N++){var ee=V[N];if(void 0!==M[ee])x+=(0,En[ee])(t)}if(p)(!0===M.underline||!0===M.overline||!0===M.strike)&&(x+=function generateDecorationCommands(t){var h="";return t.underline&&(h+="\\".concat(gn.Underline)),t.overline&&(h+="\\".concat(gn.Overline)),t.strike&&(h+="\\".concat(gn.Strike)),h||""}(M));var te=t.textPosition;x+="superscript"===te?"\\".concat(gn.SuperSubScript).concat(escapeCADSpecialChars(I),"^;"):"subscript"===te?"\\".concat(gn.SuperSubScript,"^").concat(escapeCADSpecialChars(I),";"):escapeCADSpecialChars(I),x+="}"}else x+=escapeCADSpecialChars(I);return x}function processElement(t){if("paragraph"!==t.type)return"";var h="";void 0!==t.alignment&&(h+=function getParagraphAlignmentCommand(t){var h=mn.Left;switch(t){case"center":h=mn.Center;break;case"right":h=mn.Right;break;case"justify":h=mn.Justify;break;case"distribute":h=mn.Distribute;break;default:h=mn.Left}return"\\pxq".concat(h,";")}(t.alignment)),void 0!==t.lineHeightRatio&&(h+="\\".concat(gn.LineSpacing).concat(t.lineHeightRatio.toFixed(2),";"));var p,x=_createForOfIteratorHelper$8(t.children);try{for(x.s();!(p=x.n()).done;){h+=processText(p.value)}}catch(M){x.e(M)}finally{x.f()}return h}function ownKeys$6(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$6(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$6(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$6(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}var In=new Map,Bn=4;function getCachedCharacterWidth(t,h,p,x,M,k){var I=In.get(h);if(I&&I.baseHeight===x||(I={charWidths:new Map,baseHeight:x},In.set(h,I)),!I.charWidths.has(t)){var N=getBasicTextWidth(t.repeat(Bn),p,x,M,k)/Bn;I.charWidths.set(t,N)}return I.charWidths.get(t)}function getBasicTextWidth(t,h,p,x,M,k){var I=_objectSpread$6(_objectSpread$6({},h),{},{text:unicodeToCadSpecialChar(t)}),N=Ln(I,{position:new rn(0,0,0),baseHeight:p,style:x,ent:M}).width,V=(null==h?void 0:h.tracking)||1;return"superscript"!==h.textPosition&&"subscript"!==h.textPosition||(V=.5),N*V+(k||0)}function calculateTextWidth(t,h,p,x,M,k){if(0===t.length)return 0;var I=function generateNodeFingerprint(t,h,p){var x=t.font,M=void 0===x?"":x,k=t.fontSize,I=void 0===k?0:k,N=t.bold,V=void 0!==N&&N,ee=t.italic,te=void 0!==ee&&ee,re=t.underline,ne=void 0!==re&&re,ie=t.strike,ae=void 0!==ie&&ie,oe=t.overline,se=void 0!==oe&&oe,ce=t.type,ue=void 0===ce?"":ce,le=t.tiltAngle,he=void 0===le?0:le,fe=t.tracking,de=void 0===fe?0:fe,pe=t.widthFactor,me=void 0===pe?0:pe,ge=t.textPosition,ve=void 0===ge?"":ge;return"".concat(ue,"_").concat(ve,"_").concat(p,"_").concat(M,"_").concat(I,"_").concat(Number(V),"_").concat(Number(te),"_").concat(Number(ne),"_").concat(Number(ae),"_").concat(Number(se),"_").concat(he,"_").concat(de,"_").concat(me,"_").concat(h)}(h,p,x);if(1===t.length)return getCachedCharacterWidth(t,I,h,p,x,M);if(In.has(I))return getCachedCharacterWidth(t,I,h,p,x,M);for(var N=0,V=0,ee=/[^\u4e00-\u9fa5]/;V<t.length;)if(ee.test(t[V])){for(var te="";V<t.length&&ee.test(t[V]);)te+=t[V],V++;N+=getBasicTextWidth(te,h,p,x,M,k)}else N+=getCachedCharacterWidth(t[V],I,h,p,x,M),V++;return N}function getTextWidth(t,h,p,x,M){return h.type&&Kn.elementTextManager.hasText(h.type)?(Tn(M,h)||{width:0}).width:calculateTextWidth(t,h,p,x,M)}function ownKeys$5(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$5(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$5(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$5(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}function _createForOfIteratorHelper$7(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$7(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$7(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$7(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$7(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function ownKeys$4(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$4(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$4(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$4(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}var On=function drawLine(t,h,p,x){var M=new rn(h.x,h.y,h.z),k=new rn(p.x,p.y,p.z),I=new Bt(M,k);return x&&I.transformBy(x),t.drawEntity(I),I};function calculateLineOffset(h,p,x){if(10===h)return 0;if(11===h)return 0;switch(h){case t.McDb.AttachmentPoint.kMiddleCenter:case t.McDb.AttachmentPoint.kTopCenter:case t.McDb.AttachmentPoint.kBottomCenter:return(x-p)/2;case t.McDb.AttachmentPoint.kMiddleRight:case t.McDb.AttachmentPoint.kTopRight:case t.McDb.AttachmentPoint.kBottomRight:return x-p;default:return 0}}var Rn=function renderParagraph(h,p,x){var M=x.position,k=x.height,I=x.lines,N=x.width,V=x.transformsMatrix,ee=x.node,te=[],re=0,ne=new WeakMap,ie=new Set,ae=h.lineHeightRatio;if("paragraph"===ee.type){var oe=ee;void 0!==oe.lineHeightRatio&&(ae=oe.lineHeightRatio)}var se=function renderMText(){var t=Array.from(ie)[0];if(!t)return 0;var x=ne.get(t);if(!x)return 0;var M=x.positionInfo,I=x.lineHeight,ee=0,re=0,ae=Array.from(ie).map((function(t){var x=ne.get(t),N=Object.assign({},t);if(x){N.text=x.text;var ie=An(t,k,h);re=Math.max(re,ie);var ae=Object.assign({},M);if(ae.verticalOffset+=I-ie,ae.horizontalOffset+=ee,t.color){var oe=Cn(t);oe&&(p.trueColor=oe)}else if(h.trueColor.method===Ii.kByColor)p.trueColor=h.trueColor;else{var se=new Cr;se.setColorIndex(h.colorIndex),p.trueColor=se}var ce=kn(ae),ue=ce.clone().addvec(nn.kXAxis.clone().mult(x.width)).addvec(nn.kYAxis.clone().negate().mult(ie));t.underline&&te.push(On(p,new rn(ce.x,ue.y),ue,he.isEditState?void 0:V)),t.strike&&te.push(On(p,ce.clone().addvec(nn.kYAxis.clone().mult(.5*-ie)),ue.clone().subvec(nn.kYAxis.clone().mult(.5*-ie)),he.isEditState?void 0:V)),t.overline&&te.push(On(p,ce,new rn(ue.x,ce.y,ce.z),he.isEditState?void 0:V)),p.trueColor=h.trueColor,ee+=x.width}return N}));M.verticalOffset+=I-re;var oe,se=ee,ue=Math.max(N,ee),le=new Nt,fe="",de=_createForOfIteratorHelper$7(ae);try{for(de.s();!(oe=de.n()).done;){fe+=processText(oe.value,{isDecorative:!1})}}catch(pe){de.e(pe)}finally{de.f()}return 11===ce&&fe.length>1&&ue<N&&(fe="\\pxqd;".concat(fe)),le.contents=fe,le.textHeight=k,le.location=kn(M),le.trueColor=h.trueColor,le.textStyle=h.textStyle,ie.clear(),ne=new WeakMap,he.isEditState||le.transformBy(V),p.drawEntity(le),te.push(le),se},ce=h.textAlignment;if(isElement(ee)&&"paragraph"===ee.type){var ue=ee;ue.alignment&&(ce="justify"===ue.alignment?h.textAlignment:function getAttachmentPointFromAlignment(h){switch(h){case"center":return t.McDb.AttachmentPoint.kTopCenter;case"right":return t.McDb.AttachmentPoint.kTopRight;case"justify":return 10;case"distribute":return 11;default:return t.McDb.AttachmentPoint.kTopLeft}}(ue.alignment))}var le=function calculateLinesOffset(t,h,p){return t.map((function(t){return _objectSpread$4(_objectSpread$4({},t),{},{horizontalOffset:calculateLineOffset(h,t.width,p)})}))}(I,ce,N),he=h.getMTextImp();return le.forEach((function(t){var x=t.horizontalOffset||0,I=t.nodes.reduce((function(t,h){return isText(h.node)&&h.node.type&&Kn.elementTextManager.hasText(h.node.type)||isElement(h.node)?t+1:t+(h.endOffset-h.startOffset)}),0);t.nodes.forEach((function(N){var ee={basePosition:M,horizontalOffset:x,verticalOffset:re+t.height},ae=1===I&&N.hasCharLevelSpacing;if(ae&&(ee.horizontalOffset+=N.extraCharSpacing||0),isText(N.node)){var oe="superscript"===N.node.textPosition||"subscript"===N.node.textPosition;if(N.node.type&&Kn.elementTextManager.hasText(N.node.type)){var ce=se();x+=ce;var ue=Kn.elementTextManager.getText(N.node.type),le=Tn(h,N.node),fe=le||{width:0,height:0},de=fe.width,pe=fe.height;ee.verticalOffset-=pe,ae||(ee.horizontalOffset=x);var me=kn(ee),ge=(null==ue?void 0:ue.create(h,N.node,le||{width:de,height:pe},{position:me}))||[];ge.forEach((function(t){var h=_n(N.node,t);he.isEditState||t.transformBy(V),h&&(p.trueColor=h),p.drawEntity(t)})),te.push.apply(te,_toConsumableArray(ge)),x+=de+(N.extraCharSpacing||0)}else if(oe){var ve=se();x+=ve,ae||(ee.horizontalOffset=x);var ye=N.node.text.substring(N.startOffset,N.endOffset),be=("mtext"!==h.getMTextImp().entityType||h.getMTextImp().isEditState?N.hasCharLevelSpacing:N.hasCharLevelSpacing&&t.isEndLine)||N.node.tracking,xe={basePosition:ee.basePosition.clone(),horizontalOffset:ee.horizontalOffset,verticalOffset:ee.verticalOffset-t.height},Me=An(N.node,k/2,h);if("superscript"===N.node.textPosition?t.height>N.height&&(xe.verticalOffset-=t.height-N.height):xe.verticalOffset+=t.height-Me,be)for(var we=0;we<ye.length;we++){var _e=ye[we],Ce=Pn({node:N.node,text:_e,height:k/2,position:xe,style:h.textStyle,ent:h});he.isEditState||Ce.transformBy(V);var Se=N.width/ye.length,Te=0;if(N.hasCharLevelSpacing){var Ae=t.nodes.indexOf(N)===t.nodes.length-1,De=we===ye.length-1;Ae&&De||(Te=N.extraCharSpacing||0)}N.node.tracking&&(Te+=N.node.tracking*(k/2));var ke=Se+Te,Le=Ce.location.clone(),Ee=Le.clone().addvec(nn.kXAxis.clone().mult(ke)).addvec(nn.kYAxis.clone().negate().mult(Me));if(N.node.color){var Ie=Cn(N.node);Ie&&(p.trueColor=Ie)}else if(h.trueColor.method===Ii.kByColor)p.trueColor=h.trueColor;else{var Be=new Cr;Be.setColorIndex(h.colorIndex),p.trueColor=Be}if(N.node.underline){var Oe=On(p,new rn(Le.x,Ee.y,Le.z),new rn(Ee.x,Ee.y,Le.z),he.isEditState?void 0:V);te.push(Oe)}if(N.node.strike){var Re=Le.y-.5*Me,Fe=On(p,new rn(Le.x,Re,Le.z),new rn(Ee.x,Re,Le.z),he.isEditState?void 0:V);te.push(Fe)}if(N.node.overline){var Ne=On(p,new rn(Le.x,Le.y,Le.z),new rn(Ee.x,Le.y,Le.z),he.isEditState?void 0:V);te.push(Ne)}p.drawEntity(Ce),te.push(Ce),p.trueColor=h.trueColor,xe.horizontalOffset+=ke,x+=ke}else{var Ve=Pn({node:N.node,text:ye,height:k/2,position:xe,style:h.textStyle,ent:h});if(he.isEditState||Ve.transformBy(V),N.node.color){var Ge=Cn(N.node);Ge&&(p.trueColor=Ge)}else if(h.trueColor.method===Ii.kByColor)p.trueColor=h.trueColor;else{var je=new Cr;je.setColorIndex(h.colorIndex),p.trueColor=je}p.drawEntity(Ve),te.push(Ve);var Ue=Ve.location.clone(),ze=Ue.clone().addvec(nn.kXAxis.clone().mult(N.width)).addvec(nn.kYAxis.clone().negate().mult(Me));if(N.node.underline){var We=On(p,new rn(Ue.x,ze.y,Ue.z),new rn(ze.x,ze.y,Ue.z),he.isEditState?void 0:V);te.push(We)}if(N.node.strike){var He=Ue.y-.5*Me,$e=On(p,new rn(Ue.x,He,Ue.z),new rn(ze.x,He,Ue.z),he.isEditState?void 0:V);te.push($e)}if(N.node.overline){var Xe=On(p,new rn(Ue.x,Ue.y,Ue.z),new rn(ze.x,Ue.y,Ue.z),he.isEditState?void 0:V);te.push(Xe)}p.trueColor=h.trueColor,x+=N.width+(N.extraCharSpacing||0)}}else if(("mtext"!==h.getMTextImp().entityType||h.getMTextImp().isEditState?N.hasCharLevelSpacing:N.hasCharLevelSpacing&&t.isEndLine)||N.node.tracking){var qe=se();x+=qe,ae||(ee.horizontalOffset=x);var Ke=N.node.text.substring(N.startOffset,N.endOffset),Ye=An(N.node,k,h);ee.verticalOffset-=Ye;for(var Ze=0;Ze<Ke.length;Ze++){var Je=Ke[Ze],Qe=Pn({node:N.node,text:unicodeToCadSpecialChar(Je),height:k,position:ee,style:h.textStyle,ent:h});he.isEditState||Qe.transformBy(V);var et=getTextWidth(Je,N.node,k,h.textStyle,h),tt=0;if(N.hasCharLevelSpacing)if(1===I)tt=0;else{var rt=t.nodes.indexOf(N)===t.nodes.length-1,nt=Ze===Ke.length-1;rt&&nt||(tt=N.extraCharSpacing||0)}var it=et+tt;ee.horizontalOffset+=it;var ot=Qe.location.clone(),st=ot.clone().addvec(nn.kXAxis.clone().mult(it)).addvec(nn.kYAxis.clone().negate().mult(Ye));if(N.node.color){var ct=Cn(N.node);ct&&(p.trueColor=ct)}else if(h.trueColor.method===Ii.kByColor)p.trueColor=h.trueColor;else{var ut=new Cr;ut.setColorIndex(h.colorIndex),p.trueColor=ut}if(N.node.underline){var lt=On(p,new rn(ot.x,st.y,ot.z),new rn(st.x,st.y,ot.z),he.isEditState?void 0:V);te.push(lt)}if(N.node.strike){var ht=ot.y-.5*Ye,ft=On(p,new rn(ot.x,ht,ot.z),new rn(st.x,ht,ot.z),he.isEditState?void 0:V);te.push(ft)}if(N.node.overline){var dt=On(p,new rn(ot.x,ot.y,ot.z),new rn(st.x,ot.y,ot.z),he.isEditState?void 0:V);te.push(dt)}p.drawEntity(Qe),te.push(Qe),p.trueColor=h.trueColor,x+=it}}else{ie.add(N.node);var pt=N.node.text.substring(N.startOffset,N.endOffset);if(ne.has(N.node)){var mt=ne.get(N.node);mt&&(mt.text+=pt,mt.width+=N.width)}else ee.verticalOffset-=t.height,ne.set(N.node,{positionInfo:ee,text:pt,width:N.width,lineHeight:t.height})}}else if(isElement(N.node)){var gt=se();x+=gt,ae||(ee.horizontalOffset=x);var vt=Kn.elementTextManager.get(N.node.type),yt=Mn(h,N.node),bt=yt.width,xt=yt.height;ee.verticalOffset-=xt;var Mt=kn(ee),wt=((null==vt?void 0:vt.render(h,p,N.node,yt,{position:Mt,index:N.index,alignmentWidth:bt}))||{}).entitys,_t=void 0===wt?[]:wt;_t.forEach((function(t){he.isEditState||t.transformBy(V)})),te.push.apply(te,_toConsumableArray(_t)),x+=bt+(N.extraCharSpacing||0)}})),se(),re+=t.height+t.height*(ae-1)})),{entitys:te,position:M,width:x.width,height:re,lines:le,lineHeightRatio:ae}};function _createSuper$5(t){var h=function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var Fn=function(t){_inherits$1(MxCADParagraphElement,t);var h=_createSuper$5(MxCADParagraphElement);function MxCADParagraphElement(){var t;_classCallCheck$1(this,MxCADParagraphElement);for(var p=arguments.length,x=new Array(p),M=0;M<p;M++)x[M]=arguments[M];return _defineProperty(_assertThisInitialized$1(t=h.call.apply(h,[this].concat(x))),"type","paragraph"),t}return _createClass$1(MxCADParagraphElement,[{key:"render",value:function render(t,h,p,x,M){var k=M.position,I=M.index,N=M.alignmentWidth,V=t.textBaseHeight,ee=t.isWordWrap,te=t.getMTextImp().mat;return Rn(t,h,{position:k,isWordWrap:ee,height:V,index:I,lines:x.lines||[],width:N,contentHeight:x.height,transformsMatrix:te,calculateData:x,node:p})}},{key:"calculate",value:function calculate(t,h,p){return function calculateParagraph(t,h,p,x){var M,k=h.children;if(0===k.length||1===k.length&&isText(k[0])&&""===k[0].text){var I=[x,0],N={nodes:[{node:k[0]||_objectSpread$5({text:""},Object.create(null)),path:I,startOffset:0,endOffset:0,width:0,height:p,index:0}],height:p,width:0,breakInfo:{isWrapped:!1,breakType:pn.None},horizontalOffset:0};return{width:0,height:p,lines:[N]}}var V=!1;if("paragraph"===h.type&&(V="distribute"===h.alignment),t.isWordWrap){var ee=t.getMTextImp();M=calculateLineBreaks(t,k,x,{maxWidth:ee.maxWidth,baseHeight:p,getTextWidth:function getTextWidth$1(){for(var h=arguments.length,p=new Array(h),x=0;x<h;x++)p[x]=arguments[x];return getTextWidth.apply(void 0,p.concat([t.textStyle,t]))},getTextHeight:function getTextHeight$1(h,p){return An(h,p,t)},style:t.textStyle,isWidthOffset:V})}else{var te=k.reduce((function(h,x){return isElement(x)?h+Mn(t,x).width:h+getTextWidth(x.text,x,p,t.textStyle,t)}),0),re=Math.max.apply(Math,_toConsumableArray(k.map((function(h){return isElement(h)?Mn(t,h).height:An(h,p,t)}))));M=[{nodes:k.map((function(h,M){var k=0,I=0;if(isElement(h)){var N=Mn(t,h);k=N.width,I=N.height}else k=getTextWidth(h.text,h,p,t.textStyle,t),I=An(h,p,t);return{node:h,path:[x,M],startOffset:0,endOffset:isText(h)?h.text.length:0,width:k,height:I,index:M}})),height:re,width:te,breakInfo:{isWrapped:!1,breakType:pn.None}}]}var ne=t.lineHeightRatio;if("paragraph"===h.type){var ie=h;void 0!==ie.lineHeightRatio&&(ne=ie.lineHeightRatio)}var ae=M.reduce((function(t,h){return t+h.height+h.height*(ne-1)}),0);return{width:Math.max.apply(Math,_toConsumableArray(M.map((function(t){return t.width})))),height:ae,lines:M,lineHeightRatio:ne}}(t,h,t.textBaseHeight,p)}}]),MxCADParagraphElement}(dn),Nn=function(){function ElementTextManager(){_classCallCheck$1(this,ElementTextManager),_defineProperty(this,"elementMap",new Map),_defineProperty(this,"textMap",new Map),_defineProperty(this,"specialCharacterMap",new Map),this.registerElement(new Fn),this.registerSpecialCharacter("","%%C"),this.registerSpecialCharacter("","%%C"),this.registerSpecialCharacter("","%%P"),this.registerSpecialCharacter("","%%D")}return _createClass$1(ElementTextManager,[{key:"registerElement",value:function registerElement(t){this.elementMap.set(t.type,t)}},{key:"registerTextNode",value:function registerTextNode(t){this.textMap.set(t.type,t)}},{key:"registerSpecialCharacter",value:function registerSpecialCharacter(t,h){this.specialCharacterMap.set(t,h)}},{key:"forEachSpecialCharacter",value:function forEachSpecialCharacter(t){this.specialCharacterMap.forEach(t)}},{key:"getText",value:function getText(t){return this.textMap.get(t)}},{key:"hasText",value:function hasText(t){return this.textMap.has(t)}},{key:"get",value:function get(t){return this.elementMap.get(t)}},{key:"has",value:function has(t){return this.elementMap.has(t)}}]),ElementTextManager}(),Vn=function(){function PubSub(){_classCallCheck$1(this,PubSub),_defineProperty(this,"events",void 0),this.events={}}return _createClass$1(PubSub,[{key:"on",value:function on(t,h){var p=this;p.events.hasOwnProperty(t)||(p.events[t]=[]),p.events[t].push(h)}},{key:"once",value:function once(t,h){var p=this;this.on(t,(function onceWrapper(){h.apply(void 0,arguments),p.off(t,onceWrapper)}))}},{key:"emit",value:function emit(t){for(var h=arguments.length,p=new Array(h>1?h-1:0),x=1;x<h;x++)p[x-1]=arguments[x];this.events.hasOwnProperty(t)&&this.events[t].map((function(t){return t.apply(void 0,p)}))}},{key:"off",value:function off(t,h){if(this.events[t])if(void 0===h)this.events[t]=[];else{var p=this.events[t].indexOf(h);this.events[t].splice(p,1)}}}]),PubSub}();function getActualRenderStartPosition(){var h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.actualHeight,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.actualWidth,x=this.getTopLeftPt(),M=x.y-this.maxHeight/2,k=x.x+this.maxWidth/2,I=x.y,N=x.x;switch(this.textAlignment){case t.McDb.AttachmentPoint.kMiddleLeft:case t.McDb.AttachmentPoint.kMiddleCenter:case t.McDb.AttachmentPoint.kMiddleRight:I=M+h/2;break;case t.McDb.AttachmentPoint.kBottomLeft:case t.McDb.AttachmentPoint.kBottomCenter:case t.McDb.AttachmentPoint.kBottomRight:I=x.y-this.maxHeight+h;break;default:I=x.y}if(p>this.maxWidth)switch(this.textAlignment){case t.McDb.AttachmentPoint.kTopCenter:case t.McDb.AttachmentPoint.kMiddleCenter:case t.McDb.AttachmentPoint.kBottomCenter:N=k-p/2;break;case t.McDb.AttachmentPoint.kTopRight:case t.McDb.AttachmentPoint.kMiddleRight:case t.McDb.AttachmentPoint.kBottomRight:N=x.x+this.maxWidth-p;break;default:N=x.x}else switch(this.textAlignment){case t.McDb.AttachmentPoint.kTopCenter:case t.McDb.AttachmentPoint.kMiddleCenter:case t.McDb.AttachmentPoint.kBottomCenter:N=k-p/2;break;case t.McDb.AttachmentPoint.kTopRight:case t.McDb.AttachmentPoint.kMiddleRight:case t.McDb.AttachmentPoint.kBottomRight:N=x.x+this.maxWidth-p;break;default:N=x.x}return new rn(N,I,x.z)}var Gn=function calculateParagraphPosition(t,h,p){for(var x=0,M=t.getMTextImp(),k=0;k<p;k++){var I=M.getParagrapInfo(k).height;I&&(x+=I)}return h.clone().subvec(nn.kYAxis.clone().mult(x))},jn=function calculateLineVerticalPosition(t,h,p){var x,M,k=0;if(!t.lines||0===(null===(x=t.lines)||void 0===x?void 0:x.length))return{accumulatedHeight:0,lineHeight:0};for(var I=0;I<h;I++){var N=t.lines[I];k+=N.height+N.height*((t.lineHeightRatio||p)-1)}return{accumulatedHeight:k,lineHeight:(null===(M=t.lines[h])||void 0===M?void 0:M.height)||0}};function getLinePosition(t,h){var p=this.__PARAGRAPH_INFOS__[t];if(!p)return null;var x=p.position,M=p.lines;if(!M)return null;if(!x)return null;var k=M[h];if(!k)return null;var I=jn(p,h,this.lineHeightRatio),N=0,V=k.nodes.some((function(t){return t.extraCharSpacing}));if(V){var ee=k.nodes.reduce((function(t,h){return isElement(h.node)||isText(h.node)&&h.node.type&&Kn.elementTextManager.hasText(h.node.type)?t+1:t+(h.endOffset-h.startOffset)}),0);if(1===ee){var te=k.nodes[0];N=te.width,te.extraCharSpacing&&(N+=te.extraCharSpacing)}else if(2===ee)for(var re=0;re<k.nodes.length;re++){var ne=k.nodes[re];N+=ne.width,0===re&&ne.extraCharSpacing&&(N+=2*ne.extraCharSpacing)}else for(var ie=0;ie<k.nodes.length;ie++){var ae=k.nodes[ie];if(N+=ae.width,ae.extraCharSpacing){var oe=ie===k.nodes.length-1,se=0;isText(ae.node)&&ae.node.type&&Kn.elementTextManager.hasText(ae.node.type)||isElement(ae.node)?(N+=ae.extraCharSpacing,se=1):se=ae.endOffset-ae.startOffset,N+=oe?ae.extraCharSpacing*Math.max(0,se-1):ae.extraCharSpacing*se}}}else N=k.nodes.reduce((function(t,h){return t+h.width}),0);return function calculateLinePosition(t,h,p){var x=p.accumulatedHeight,M=p.lineHeight,k=t.y-x,I=k-M;return{start:new rn(t.x,k),end:new rn(t.x+h,k),minPt:new rn(t.x,k),maxPt:new rn(t.x+h,I),height:M}}(x,N,I)}function _createSuper$4(t){var h=function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var Un,zn=function(h){_inherits$1(MxCADMTextImp,h);var p=_createSuper$4(MxCADMTextImp);function MxCADMTextImp(){var h;_classCallCheck$1(this,MxCADMTextImp);for(var x=arguments.length,M=new Array(x),k=0;k<x;k++)M[k]=arguments[k];return _defineProperty(_assertThisInitialized$1(h=p.call.apply(p,[this].concat(M))),"position",new rn),_defineProperty(_assertThisInitialized$1(h),"maxWidth",0),_defineProperty(_assertThisInitialized$1(h),"maxHeight",0),_defineProperty(_assertThisInitialized$1(h),"textBaseHeight",20),_defineProperty(_assertThisInitialized$1(h),"data",void 0),_defineProperty(_assertThisInitialized$1(h),"isWordWrap",!0),_defineProperty(_assertThisInitialized$1(h),"textAlignment",t.McDb.AttachmentPoint.kTopLeft),_defineProperty(_assertThisInitialized$1(h),"actualHeight",0),_defineProperty(_assertThisInitialized$1(h),"actualWidth",0),_defineProperty(_assertThisInitialized$1(h),"mat",new sn),_defineProperty(_assertThisInitialized$1(h),"angle",0),_defineProperty(_assertThisInitialized$1(h),"lineHeightRatio",1.66666),_defineProperty(_assertThisInitialized$1(h),"entityType","custom"),_defineProperty(_assertThisInitialized$1(h),"isIntegrityLockedMText",!0),_defineProperty(_assertThisInitialized$1(h),"isEditState",!1),_defineProperty(_assertThisInitialized$1(h),"__PARAGRAPH_INFOS__",[]),_defineProperty(_assertThisInitialized$1(h),"getActualRenderStartPosition",getActualRenderStartPosition),_defineProperty(_assertThisInitialized$1(h),"getLinePosition",getLinePosition),_defineProperty(_assertThisInitialized$1(h),"getTextHeight",An),_defineProperty(_assertThisInitialized$1(h),"getColor",Cn),h}return _createClass$1(MxCADMTextImp,[{key:"isCustomTextOrElement",get:function get(){var t=this;if(!this.data||0===this.data.length)return!1;return this.data.some((function isSome(h){if(isText(h)){if(h.type&&Kn.elementTextManager.hasText(h.type))return!0;if(t.isIntegrityLockedMText)return!1;if("textPosition"in h&&("superscript"===h.textPosition||"subscript"===h.textPosition))return!0;if("tracking"in h&&1!==h.tracking)return!0;if("underline"in h&&h.underline)return!0;if("strike"in h&&h.strike)return!0;if("overline"in h&&h.overline)return!0}if(isElement(h)){if(function isParagraph(t){return"paragraph"===t.type}(h)){if("distribute"===h.alignment)return!0;if("number"==typeof h.lineHeightRatio&&h.lineHeightRatio!==t.lineHeightRatio)return!0}else if(Kn.elementTextManager.has(h.type))return!0;return h.children.some(isSome)}return!1}))}},{key:"dwgInFields",value:function dwgInFields(t){this.position=t.readPoint("position").val,this.maxWidth=t.readDouble("maxWidth").val,this.maxHeight=t.readDouble("maxHeight").val,this.textBaseHeight=t.readDouble("textBaseHeight").val;var h=t.readString("data").val;this.data=JSON.parse(h),this.textAlignment=t.readDouble("textAlignment").val,this.angle=t.readDouble("angle").val,this.lineHeightRatio=t.readDouble("lineHeightRatio").val||1;for(var p=t.readString("mat").val,x=JSON.parse(p),M=0;M<x.length;M++)for(var k=x[M],I=0;I<k.length;I++){var N=k[I];this.mat.setData(M,I,N)}return this.isWordWrap=1===t.readDouble("isWordWrap").val,this.entityType=t.readString("entityType").val||"custom",!0}},{key:"dwgOutFields",value:function dwgOutFields(t){t.writePoint("position",this.position),t.writeDouble("maxWidth",this.maxWidth),t.writeDouble("maxHeight",this.maxHeight),t.writeDouble("textBaseHeight",this.textBaseHeight),t.writeString("data",JSON.stringify(this.data)),t.writeDouble("textAlignment",this.textAlignment),t.writeDouble("angle",this.angle),t.writeDouble("lineHeightRatio",this.lineHeightRatio),t.writeDouble("isWordWrap",this.isWordWrap?1:0),t.writeString("entityType",this.entityType);for(var h=[],p=0;p<4;p++){h[p]=[];for(var x=0;x<4;x++){var M=this.mat.getData(p,x);h[p][x]=M}}return t.writeString("mat",JSON.stringify(h)),!0}},{key:"getGripPoints",value:function getGripPoints(){var t=new ln;if(this.isEditState)return t;var h=this.position.clone(),p=new rn(this.position.x+this.maxWidth,this.position.y,this.position.z),x=new rn(this.position.x+this.maxWidth/2,this.position.y-this.maxHeight,this.position.z),M=h.transformBy(this.mat),k=p.transformBy(this.mat),I=x.transformBy(this.mat);return t.append(M),t.append(k),t.append(I),t}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){var M=new sn;if(M.copy(this.mat),M.invert(),0===t){var k=this.position.clone().transformBy(this.mat);k.x+=h,k.y+=p,k.z+=x,this.position=k.transformBy(M)}else if(1===t){var I=new rn(this.position.x+this.maxWidth,this.position.y,this.position.z).clone().transformBy(this.mat);I.x+=h,I.y+=p,I.z+=x;var N=I.transformBy(M);this.maxWidth=N.x-this.position.x,this.maxWidth<=0&&(this.maxWidth=this.textBaseHeight)}else if(2===t){var V=new rn(this.position.x+this.maxWidth/2,this.position.y-this.maxHeight,this.position.z).clone().transformBy(this.mat);V.x+=h,V.y+=p,V.z+=x;var ee=V.transformBy(M);this.maxHeight=this.position.y-ee.y,this.maxHeight<0&&(this.maxHeight=0)}}},{key:"getParagraphLines",value:function getParagraphLines(t){var h=this.__PARAGRAPH_INFOS__[t];return(null==h?void 0:h.lines)||[]}},{key:"getParagrapInfo",value:function getParagrapInfo(t){return this.__PARAGRAPH_INFOS__[t]}},{key:"getLineCount",value:function getLineCount(t){var h,p=this.__PARAGRAPH_INFOS__[t];return p?null===(h=p.lines)||void 0===h?void 0:h.length:0}},{key:"setData",value:function setData(t){this.data=t}},{key:"getTopLeftPt",value:function getTopLeftPt(){return this.isEditState?this.position.clone().transformBy(this.mat):this.position.clone()}},{key:"getLineHorizontalOffset",value:function getLineHorizontalOffset(t,h){var p,x=this.__PARAGRAPH_INFOS__[t];return x&&null!==(p=x.lines)&&void 0!==p&&p[h]&&x.lines[h].horizontalOffset||0}},{key:"getTotalContentHeight",value:function getTotalContentHeight(){return this.__PARAGRAPH_INFOS__.reduce((function(t,h){return t+((null==h?void 0:h.height)||0)}),0)}},{key:"setEntityType",value:function setEntityType(t){this.entityType!==t&&(this.entityType=t)}}]),MxCADMTextImp}(Vn);function ownKeys$3(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$3(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$3(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$3(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}function setFormat(t,h,p){flushCurrentText(t),t.formats=_objectSpread$3(_objectSpread$3({},t.formats),{},_defineProperty({},h,p))}function createBooleanFormatHandler(t,h){return function(p){setFormat(p,t,h)}}var Wn=(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(Un={},gn.Paragraph,(function(t){flushCurrentText(t),t.currentBlock.children.length>0&&t.blocks.push(t.currentBlock),t.currentBlock={type:"paragraph",children:[]}})),gn.Color,(function(t,h){setFormat(t,"color",function decimalToRgb(t){return[255&t,t>>8&255,t>>16]}(parseInt(h,10)))})),gn.ColorIndex,(function(t,h){var p=0;try{p=parseInt(h,10)}catch(Vf){}setFormat(t,"color",p)})),gn.Font,handleFontCommand),gn.FontAlt,handleFontCommand),gn.FontHeight,(function(t,h){var p=h.replace(/x$/i,"");setFormat(t,"fontSize",parseFloat(p))})),gn.Overline,createBooleanFormatHandler("overline",!0)),gn.OverlineEnd,createBooleanFormatHandler("overline",!1)),gn.Strike,createBooleanFormatHandler("strike",!0)),gn.StrikeEnd,createBooleanFormatHandler("strike",!1)),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(Un,gn.Underline,createBooleanFormatHandler("underline",!0)),gn.UnderlineEnd,createBooleanFormatHandler("underline",!1)),gn.SuperSubScript,(function(t,h){flushCurrentText(t);var p=h;if(p.startsWith("^")){var x=p.substring(1);if(x.length>0){var M=_objectSpread$3(_objectSpread$3({},t.formats),{},{textPosition:"subscript"});t.currentBlock.children.push(createFormattedTextNode(x,M))}}else if(p.endsWith("^")&&!p.startsWith("^")){var k=p.substring(0,p.length-1);if(k.length>0){var I=_objectSpread$3(_objectSpread$3({},t.formats),{},{textPosition:"superscript"});t.currentBlock.children.push(createFormattedTextNode(k,I))}}else t.currentText+=p})),gn.TiltAngle,(function(t,h){var p=parseFloat(h);isNaN(p)||setFormat(t,"tiltAngle",p)})),gn.Tracking,(function(t,h){var p=parseFloat(h);isNaN(p)||setFormat(t,"tracking",p)})),gn.WidthFactor,(function(t,h){var p=parseFloat(h);isNaN(p)||setFormat(t,"widthFactor",p)})));function handleFontCommand(t,h){flushCurrentText(t);var p=h.split("|"),x=p[0],M="b1"===p.find((function(t){return t.startsWith("b")})),k="i1"===p.find((function(t){return t.startsWith("i")}));t.formats=_objectSpread$3(_objectSpread$3({},t.formats),{},{font:x||void 0,bold:M,italic:k})}function flushCurrentText(t){t.currentText.length>0&&(t.currentBlock.children.push(createFormattedTextNode(t.currentText,t.formats)),t.currentText="")}function getCommandTypeFromChar(t){switch(t){case gn.Paragraph:return gn.Paragraph;case gn.Color:return gn.Color;case gn.ColorIndex:return gn.ColorIndex;case gn.Font:return gn.Font;case gn.FontAlt:return gn.FontAlt;case gn.FontHeight:return gn.FontHeight;case gn.Overline:return gn.Overline;case gn.OverlineEnd:return gn.OverlineEnd;case gn.Strike:return gn.Strike;case gn.StrikeEnd:return gn.StrikeEnd;case gn.Underline:return gn.Underline;case gn.UnderlineEnd:return gn.UnderlineEnd;case gn.TiltAngle:return gn.TiltAngle;case gn.Tracking:return gn.Tracking;case gn.WidthFactor:return gn.WidthFactor;case gn.SuperSubScript:return gn.SuperSubScript;default:return null}}function isNoParamCommand(t){return["P","O","K","L","o","k","l"].includes(t)}function processCommand(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("p"===h&&p.startsWith("xq")&&p.length>=3){var x=p[2];return!!"clrjd".includes(x)&&(t.currentBlock.alignment=function getParagraphAlignmentValue(t){switch(t){case mn.Center:return"center";case mn.Right:return"right";case mn.Justify:return"justify";case mn.Distribute:return"distribute";case mn.Left:default:return"left"}}(x),!0)}if("p"===h&&p.startsWith("xsm")&&p.length>3){var M=p.substring(3),k=parseFloat(M);return!isNaN(k)&&k>0&&(t.currentBlock.lineHeightRatio=k,!0)}if(h===gn.SuperSubScript){var I=p.endsWith(";")?p.slice(0,-1):p,N=getCommandTypeFromChar(h);if(N&&Wn[N])return Wn[N](t,I),!0}var V=getCommandTypeFromChar(h);return!(!V||!Wn[V])&&(Wn[V](t,p),!0)}function cadTextToSlate(t){t=function cadSpecialCharToUnicode(t){var h=t;return Kn.elementTextManager.forEachSpecialCharacter((function(t,p){var x=t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");h=h.replace(new RegExp(x,"g"),p)})),h}(t);for(var h={currentText:"",formats:{},blocks:[],currentBlock:{type:"paragraph",children:[]},inBlock:!1,inCommand:!1,commandBuffer:"",commandGroups:[],formatStack:[]},p=0;p<t.length;){var x=t[p];if(h.inCommand)";"===x||1===h.commandBuffer.length&&isNoParamCommand(h.commandBuffer)?(processCommand(h,h.commandBuffer,""),h.inCommand=!1,h.commandBuffer="",p++):(h.commandBuffer+=x,p++);else if("\\"===x)if(p+1<t.length){var M=t[p+1];if("\\"===M)h.currentText+="\\",p+=2;else if("{"===M||"}"===M)h.currentText+=M,p+=2;else{if(flushCurrentText(h),M===gn.SuperSubScript){for(var k=p+2,I=0,N=-1;k<t.length;){var V=t[k];if("{"===V)I++;else if("}"===V)I--;else if(";"===V&&0===I){N=k;break}k++}if(-1!==N){var ee=p+2;processCommand(h,M,t.substring(ee,N)),p=N+1;continue}}if(isNoParamCommand(M)){processCommand(h,M,""),p+=2;continue}var te=t.indexOf(";",p);if(-1!==te){var re=M,ne=p+2;processCommand(h,re,ne<te?t.substring(ne,te):"")?p=te+1:(h.currentText+="\\"+re,p+=2)}else h.inCommand=!0,h.commandBuffer=M,p+=2}}else h.currentText+=x,p++;else"{"===x?(h.inBlock=!0,flushCurrentText(h),h.formatStack||(h.formatStack=[]),h.formatStack.push(_objectSpread$3({},h.formats)),p++):"}"===x?(h.inBlock=!1,flushCurrentText(h),h.formatStack&&h.formatStack.length>0?h.formats=h.formatStack.pop()||{}:h.formats={},p++):(h.currentText+=x,p++)}return flushCurrentText(h),h.currentBlock.children.length>0&&h.blocks.push(h.currentBlock),0===h.blocks.length&&h.blocks.push({type:"paragraph",children:[createFormattedTextNode("",{})]}),h.blocks}var Hn=function(){function MultilineTextConverter(){_classCallCheck$1(this,MultilineTextConverter)}return _createClass$1(MultilineTextConverter,null,[{key:"fromMText",value:function fromMText(h){var p,x=new Kn,M=h.getBoundingBox(),k=h.location,I=0===h.width?M.maxPt.x-M.minPt.x:h.width,N=M.maxPt.y-M.minPt.y;switch(h.attachment){case t.McDb.AttachmentPoint.kTopLeft:p=k.clone();break;case t.McDb.AttachmentPoint.kTopCenter:p=new rn(k.x-I/2,k.y,k.z);break;case t.McDb.AttachmentPoint.kTopRight:p=new rn(k.x-I,k.y,k.z);break;case t.McDb.AttachmentPoint.kMiddleLeft:p=new rn(k.x,k.y+N/2,k.z);break;case t.McDb.AttachmentPoint.kMiddleCenter:p=new rn(k.x-I/2,k.y+N/2,k.z);break;case t.McDb.AttachmentPoint.kMiddleRight:p=new rn(k.x-I,k.y+N/2,k.z);break;case t.McDb.AttachmentPoint.kBottomLeft:p=new rn(k.x,k.y+N,k.z);break;case t.McDb.AttachmentPoint.kBottomCenter:p=new rn(k.x-I/2,k.y+N,k.z);break;case t.McDb.AttachmentPoint.kBottomRight:p=new rn(k.x-I,k.y+N,k.z);break;default:p=k.clone()}if(x.position=p,x.maxWidth=I,h.trueColor.method===Ii.kByColor)x.trueColor=h.trueColor;else{var V=new Cr;V.setColorIndex(h.colorIndex),x.trueColor=V,x.colorIndex=h.colorIndex}x.maxHeight=N,x.layer=h.layer,x.layerId=h.layerId,x.drawOrder=h.drawOrder,x.linetype=h.linetype,x.normal=h.normal,x.lineweight=h.lineweight,x.linetypeScale=h.linetypeScale,x.textBaseHeight=h.textHeight,x.textAlignment=h.attachment,x.angle=THREE.MathUtils.radToDeg(h.rotation),x.textStyle=h.textStyle,x.textStyleId=h.textStyleId;var ee=cadTextToSlate(h.contents);return x.data=ee,x}},{key:"toMText",value:function toMText(h,p){var x=h.getMTextImp(),M=[];if(x.isCustomTextOrElement)return x.__PARAGRAPH_INFOS__.forEach((function(t){t.entitys.forEach((function(t){t&&M.push(t.clone())}))})),M;var k,I=Math.max(x.maxWidth,x.actualWidth),N=Math.max(x.maxHeight,x.actualHeight),V=x.getActualRenderStartPosition();switch(h.textAlignment){case t.McDb.AttachmentPoint.kTopLeft:k=V.clone();break;case t.McDb.AttachmentPoint.kTopCenter:k=new rn(V.x+I/2,V.y,V.z);break;case t.McDb.AttachmentPoint.kTopRight:k=new rn(V.x+I,V.y,V.z);break;case t.McDb.AttachmentPoint.kMiddleLeft:k=new rn(V.x,V.y-N/2,V.z);break;case t.McDb.AttachmentPoint.kMiddleCenter:k=new rn(V.x+I/2,V.y-N/2,V.z);break;case t.McDb.AttachmentPoint.kMiddleRight:k=new rn(V.x+I,V.y-N/2,V.z);break;case t.McDb.AttachmentPoint.kBottomLeft:k=new rn(V.x,V.y-N,V.z);break;case t.McDb.AttachmentPoint.kBottomCenter:k=new rn(V.x+I/2,V.y-N,V.z);break;case t.McDb.AttachmentPoint.kBottomRight:k=new rn(V.x+I,V.y-N,V.z);break;default:k=V.clone()}var ee=function slateToCADText(t){var h,p=[],x=_createForOfIteratorHelper$8(t);try{for(x.s();!(h=x.n()).done;){var M=processElement(h.value);p.push(M)}}catch(k){x.e(k)}finally{x.f()}return p.join("\\".concat(gn.Paragraph))}(x.data);return M.push(function createText(t,x){if(!p)if((p=new Nt).layer=h.layer,p.layerId=h.layerId,p.drawOrder=h.drawOrder,p.linetype=h.linetype,p.linetypeScale=h.linetypeScale,p.lineweight=h.lineweight,h.trueColor.method===Ii.kByColor)p.trueColor=h.trueColor;else{var M=new Cr;M.setColorIndex(h.colorIndex),p.trueColor=M,p.colorIndex=h.colorIndex}if(p.textHeight=h.textBaseHeight,p.textStyle=h.textStyle,p.location=x,p.attachment=h.textAlignment,p.contents=t,!h.isWordWrap&&p.width<I){p.width=2*I,p.reCompute();var k=p.getBoundingBox(),N=k.minPt,V=k.maxPt;I=1.01*N.distanceTo(new rn(V.x,N.y))}return p.width=I,p.rotation=THREE.MathUtils.degToRad(h.angle),p}(ee,k)),M}}]),MultilineTextConverter}(),$n=function calculateContentWidth(t){for(var h=t.getMTextImp(),p=h.data.length,x=0,M=0;M<p;M++){var k=h.getParagraphLines(M);if(k)for(var I=0;I<k.length;I++){var N=h.getLinePosition(M,I);if(N){var V=N.maxPt.x-N.minPt.x;x=Math.max(x,V)}}}return{maxWidth:x,alignmentWidth:Math.max(h.maxWidth,x)}},Xn=function calculateLineStartX(h,p,x,M,k){var I=h.getMTextImp(),N=I.textAlignment;if(void 0!==k){var V=I.data[k];if(V&&"paragraph"===V.type){var ee=V;if(ee.alignment)if("justify"===ee.alignment);else{if("distribute"===ee.alignment)return p.x;switch(ee.alignment){case"center":N=t.McDb.AttachmentPoint.kTopCenter;break;case"right":N=t.McDb.AttachmentPoint.kTopRight;break;default:N=t.McDb.AttachmentPoint.kTopLeft}}}}var te=p.x;switch(N){case t.McDb.AttachmentPoint.kTopCenter:case t.McDb.AttachmentPoint.kMiddleCenter:case t.McDb.AttachmentPoint.kBottomCenter:te=p.x+(x-M)/2;break;case t.McDb.AttachmentPoint.kTopRight:case t.McDb.AttachmentPoint.kMiddleRight:case t.McDb.AttachmentPoint.kBottomRight:te=p.x+x-M}return te};function convertCadPointToSlatePoint(t){for(var h=this,p=t.x,x=t.y,M=this.getMTextImp(),k=M.getTotalContentHeight(),I=$n(this).alignmentWidth,N=M.getActualRenderStartPosition(k,I),V=0;V<M.__PARAGRAPH_INFOS__.length;V++){var ee,te,re=M.getParagrapInfo(V);if(re){var ne=Gn(this,N,V),ie=null===(ee=re.lines)||void 0===ee?void 0:ee.some((function(t){var h;return null===(h=t.nodes)||void 0===h?void 0:h.some((function(t){return!!isElement(t.node)||t.endOffset>t.startOffset}))}));if(null!==(te=re.lines)&&void 0!==te&&te.length&&ie){for(var ae,oe=function _loop(){var t,k=re.lines[se];if(null===(t=k.nodes)||void 0===t||!t.length)return 0;var N=jn(re,se,h.lineHeightRatio).accumulatedHeight,ee=ne.y-N,te=ee-k.height-k.height*((re.lineHeightRatio||h.lineHeightRatio)-1);if(x<=ee&&x>=te){for(var ie=Xn(h,ne,I,k.width,V),ae=k.nodes.some((function(t){return t.hasCharLevelSpacing})),oe=k.nodes.reduce((function(t,h){return isElement(h.node)&&Kn.elementTextManager.has(h.node.type)||isText(h.node)&&h.node.type&&Kn.elementTextManager.hasText(h.node.type)?t+1:t+(h.endOffset-h.startOffset)}),0),ce=[],ue=ie,le=0;le<k.nodes.length;le++){var he=k.nodes[le],fe=0;if(isElement(he.node)&&Kn.elementTextManager.has(he.node.type))fe=Mn(h,he.node).width;else if(isText(he.node)&&he.node.type&&Kn.elementTextManager.hasText(he.node.type)){fe=Tn(h,he.node).width}else fe=he.width;ce.push({startX:ue,endX:ue+fe,nodeInfo:he}),ue+=fe}if(ae&&oe>1){for(var de=[],pe=0;pe<k.nodes.length;pe++){var me=k.nodes[pe];if(me.extraCharSpacing){var ge=0,ve=ge=isText(me.node)&&me.node.type&&Kn.elementTextManager.hasText(me.node.type)||isElement(me.node)&&Kn.elementTextManager.has(me.node.type)?1:me.endOffset-me.startOffset;pe===k.nodes.length-1&&(ve=Math.max(0,ge-1));var ye=me.extraCharSpacing*ve;de.push(ye)}else de.push(0)}for(var be=0;be<ce.length;be++){for(var xe=0,Me=0;Me<be;Me++)xe+=de[Me];ce[be].startX+=xe,ce[be].endX+=xe+de[be]}}else if(ae&&1===oe){var we=k.nodes[0],_e=0;if(isElement(we.node)&&Kn.elementTextManager.has(we.node.type))_e=Mn(h,we.node).width;else if(isText(we.node)&&we.node.type&&Kn.elementTextManager.hasText(we.node.type)){_e=Tn(h,we.node).width}else _e=we.width;if(we.hasCharLevelSpacing||we.extraCharSpacing){var Ce=(I-_e)/2;Ce>0&&(ce[0].startX+=Ce,ce[0].endX+=Ce)}}if(p<=ie){if(1===oe&&k.nodes.length>0){var Se=k.nodes[0],Te=ce.find((function(t){return t.nodeInfo===Se}));if(Te){var Ae=(Te.startX+Te.endX)/2;return p>=Ae?{v:{path:Se.path,offset:Se.endOffset}}:{v:{path:Se.path,offset:Se.startOffset}}}var De=Se.width;return p>=ie+De/2?{v:{path:Se.path,offset:Se.endOffset}}:{v:{path:Se.path,offset:Se.startOffset}}}if(k.nodes.length>0)return{v:{path:k.nodes[0].path,offset:k.nodes[0].startOffset}}}for(var ke,Le=function _loop2(){var t=k.nodes[Ee],x=t.startOffset,N=ce.find((function(h){return h.nodeInfo===t})),V=N?N.startX:ie+(Ee>0?k.nodes.slice(0,Ee).reduce((function(t,h){return t+h.width}),0):0),ee=N?N.endX:V+t.width;if(p>=V&&p<=ee){if(isElement(t.node)){if(p<(V+ee)/2){if(Ee>0){var te=k.nodes[Ee-1];return{v:{v:{path:te.path,offset:te.endOffset}}}}if(se>0){var ne=re.lines[se-1],ue=ne.nodes[ne.nodes.length-1];return{v:{v:{path:ue.path,offset:ue.endOffset}}}}return{v:{v:{path:t.path,offset:t.startOffset}}}}if(Ee<k.nodes.length-1){var le=k.nodes[Ee+1];return{v:{v:{path:le.path,offset:le.startOffset}}}}return{v:{v:{path:t.path,offset:t.endOffset}}}}if(t.node.type&&Kn.elementTextManager.hasText(t.node.type))return p>=V+(ee-V)/2?{v:{v:{path:t.path,offset:t.endOffset}}}:{v:{v:{path:t.path,offset:t.startOffset}}};if(isText(t.node)){if(t.endOffset-t.startOffset==1)return p>=(V+ee)/2?{v:{v:{path:t.path,offset:t.endOffset}}}:{v:{v:{path:t.path,offset:t.startOffset}}};for(var he=Number.MAX_VALUE,fe=t.startOffset,de=t.endOffset;fe<=de;){var pe=Math.floor((fe+de)/2);if(isText(t.node)){var me=t.node.text.substring(t.startOffset,pe),ge=V+getTextWidth(me,t.node,M.textBaseHeight,h.textStyle,h),ve=0;if(ae)if(1===oe){if(t.extraCharSpacing){var ye=t.node.text.substring(t.startOffset,t.endOffset),be=getTextWidth(ye,t.node,M.textBaseHeight,h.textStyle,h),xe=(I-be)/2;if(xe>0)ve=xe*(me.length/ye.length)}}else if(2===oe){var Me=0===Ee,we=pe-t.startOffset;if(Ee===k.nodes.length-1&&pe===t.endOffset);else if(Me)we>0&&t.extraCharSpacing&&(ve=t.extraCharSpacing*Math.min(2,we));else if(t.extraCharSpacing){var _e=k.nodes[Ee-1];_e.extraCharSpacing&&(ve+=2*_e.extraCharSpacing),ve+=t.extraCharSpacing*we}}else{for(var Ce=0;Ce<Ee;Ce++){var Se=k.nodes[Ce];if(Se.extraCharSpacing){var Te=0;Te=isText(Se.node)&&Se.node.type&&Kn.elementTextManager.hasText(Se.node.type)||isElement(Se.node)&&Kn.elementTextManager.has(Se.node.type)?1:Se.endOffset-Se.startOffset;var Ae=Ce===k.nodes.length-1&&Se.endOffset===t.endOffset?Math.max(0,Te-1):Te;ve+=Se.extraCharSpacing*Ae}}if(t.extraCharSpacing){var De=pe-t.startOffset,ke=Ee===k.nodes.length-1,Le=pe===t.endOffset;ke&&Le?De>0&&(ve+=t.extraCharSpacing*(De-1)):ve+=t.extraCharSpacing*De}}var Ie=ge+ve;if(pe<t.endOffset){var Be=t.node.text.charAt(pe);if(Be){var Oe=getTextWidth(Be,t.node,M.textBaseHeight,h.textStyle,h),Re=0;if(ae&&t.extraCharSpacing)Ee===k.nodes.length-1&&pe===t.endOffset-1||(Re=t.extraCharSpacing);var Fe=Ie+(Oe+Re)/2;if(p>=Fe){var Ne=Math.abs(Fe-p);Ne<he&&(he=Ne,x=pe+1),fe=pe+1;continue}var Ve=Math.abs(Fe-p);Ve<he&&(he=Ve,x=pe),de=pe-1;continue}}var Ge=Math.abs(Ie-p);Ge<he&&(he=Ge,x=pe),Ie<p?fe=pe+1:de=pe-1}else if(isElement(t.node))break}}return{v:{v:{path:t.path,offset:x}}}}},Ee=0;Ee<k.nodes.length;Ee++)if(ke=Le())return ke.v;if(p>(ce.length>0?ce[ce.length-1].endX:ie+k.width)&&k.nodes.length>0){var Ie,Be=k.nodes[k.nodes.length-1];if(null!==(Ie=k.breakInfo)&&void 0!==Ie&&Ie.isWrapped&&re.lines[se+1]){var Oe=re.lines[se+1].nodes[0];if(Oe)return{v:{path:Oe.path,offset:Oe.startOffset}}}return{v:{path:Be.path,offset:Be.endOffset}}}}},se=0;se<re.lines.length;se++)if(0!==(ae=oe())&&ae)return ae.v}else{var ce=Xn(this,ne,I,0,V);if(x<=ne.y&&x>=ne.y-re.height&&p>=ce)return{path:[V,0],offset:0}}}}return null}function _createForOfIteratorHelper$6(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$6(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$6(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$6(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$6(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function convertSlatePointToCadPoint(t){var h,p,x=this,M=this.getMTextImp(),k=t.path,I=t.offset,N=M.getTotalContentHeight(),V=$n(this).alignmentWidth,ee=M.getActualRenderStartPosition(N,V),te=k[0],re=M.__PARAGRAPH_INFOS__[te];if(!re)return null;var ne=Gn(this,ee,te),ie=null===(h=re.lines)||void 0===h?void 0:h.some((function(t){var h;return null===(h=t.nodes)||void 0===h?void 0:h.some((function(t){return!!isElement(t.node)||t.endOffset>t.startOffset}))}));if(null===(p=re.lines)||void 0===p||!p.length||!ie){var ae=Xn(this,ne,V,0,te);return{point:new rn(ae,ne.y),lineIndex:0}}for(var oe=0;oe<re.lines.length;oe++){var se,ce=re.lines[oe],ue=ce.nodes.some((function(t){return t.hasCharLevelSpacing}));if(null!==(se=ce.nodes)&&void 0!==se&&se.length){for(var le=Xn(this,ne,V,ce.width,te),he=jn(re,oe,this.lineHeightRatio).accumulatedHeight,fe=le,de=!1,pe=ce.nodes.reduce((function(t,h){return isElement(h.node)&&Kn.elementTextManager.has(h.node.type)||isText(h.node)&&h.node.type&&Kn.elementTextManager.hasText(h.node.type)?t+1:t+(h.endOffset-h.startOffset)}),0),me=[],ge=le,ve=ue,ye=0;ye<ce.nodes.length;ye++){var be=ce.nodes[ye],xe=0;if(isElement(be.node)&&Kn.elementTextManager.has(be.node.type))xe=Mn(this,be.node).width;else if(isText(be.node)&&be.node.type&&Kn.elementTextManager.hasText(be.node.type)){xe=Tn(this,be.node).width}else xe=be.width;me.push({startX:ge,endX:ge+xe,nodeInfo:be}),ge+=xe}if(ve&&pe>1){for(var Me=[],we=0;we<ce.nodes.length;we++){var _e=ce.nodes[we];if(_e.extraCharSpacing){var Ce=0,Se=Ce=isText(_e.node)&&_e.node.type&&Kn.elementTextManager.hasText(_e.node.type)||isElement(_e.node)&&Kn.elementTextManager.has(_e.node.type)?1:_e.endOffset-_e.startOffset;we===ce.nodes.length-1&&(Se=Math.max(0,Ce-1));var Te=_e.extraCharSpacing*Se;Me.push(Te)}else Me.push(0)}for(var Ae=0;Ae<me.length;Ae++){for(var De=0,ke=0;ke<Ae;ke++)De+=Me[ke];me[Ae].startX+=De,me[Ae].endX+=De+Me[Ae]}}else if(ve&&1===pe){var Le=ce.nodes[0],Ee=0;if(isElement(Le.node)&&Kn.elementTextManager.has(Le.node.type))Ee=Mn(this,Le.node).width;else if(isText(Le.node)&&Le.node.type&&Kn.elementTextManager.hasText(Le.node.type)){Ee=Tn(this,Le.node).width}else Ee=Le.width;if(Le.hasCharLevelSpacing||Le.extraCharSpacing){var Ie=(V-Ee)/2;Ie>0&&(me[0].startX+=Ie,me[0].endX+=Ie)}}var Be,Oe=_createForOfIteratorHelper$6(ce.nodes);try{var Re,Fe=function _loop(){var t=Be.value;if(t.path[0]===k[0]&&t.path[1]===k[1]&&I>=t.startOffset&&I<=t.endOffset){var h;if(de=!0,I===t.endOffset&&t===ce.nodes[ce.nodes.length-1]&&null!==(h=ce.breakInfo)&&void 0!==h&&h.isWrapped){var p=re.lines[oe+1];if(p){var N=jn(re,oe+1,x.lineHeightRatio).accumulatedHeight,ee=ne.y-N,ie=Xn(x,ne,V,p.width,te);return{v:{point:new rn(ie,ee),lineIndex:oe+1}}}}var ae=t.node.type&&Kn.elementTextManager.hasText(t.node.type),se=me.find((function(h){return h.nodeInfo===t}));if(isElement(t.node)){var ge;if(se)ge=0===I?se.startX:se.endX;else{var ve=Mn(x,t.node).width;if(ge=fe,1===I&&(ge+=ve),ue&&1===pe)if(1===I&&t.extraCharSpacing){var ye=(V-ve)/2;ye>0&&(ge=le+ye+ve)}else if(0===I&&t.extraCharSpacing){var be=(V-ve)/2;be>0&&(ge=le+be)}}var xe=ne.y-he;return{v:{point:new rn(ge,xe),lineIndex:oe}}}if(ae){var Me;if(se)Me=0===I?se.startX:se.endX;else{var we=Tn(x,t.node).width;if(Me=fe,1===I&&(Me+=we),ue&&1===pe)if(1===I&&t.extraCharSpacing){var _e=(V-we)/2;_e>0&&(Me=le+_e+we)}else if(0===I&&t.extraCharSpacing){var Ce=(V-we)/2;Ce>0&&(Me=le+Ce)}}var Se=ne.y-he;return{v:{point:new rn(Me,Se),lineIndex:oe}}}var Te=t.node.text.substring(t.startOffset,I),Ae=fe+getTextWidth(Te,t.node,M.textBaseHeight,x.textStyle,x);if(ue)if(1===pe){var De=t.node.text.substring(t.startOffset,t.endOffset),ke=getTextWidth(De,t.node,M.textBaseHeight,x.textStyle,x),Le=(V-ke)/2;if(Le>0){var Ee=Te.length/De.length;Ae=le+Le+Ee*ke}}else{for(var Ie=0,Oe=0;Oe<ce.nodes.length;Oe++){var Re=ce.nodes[Oe];if(Re===t){if(Re.extraCharSpacing){var Fe=I-Re.startOffset,Ne=Oe===ce.nodes.length-1,Ve=I===Re.endOffset;Ne&&Ve?Fe>0&&(Ie+=Re.extraCharSpacing*(Fe-1)):Ie+=Re.extraCharSpacing*Fe}break}if(Re.extraCharSpacing){var Ge=0,je=Ge=isText(Re.node)&&Re.node.type&&Kn.elementTextManager.hasText(Re.node.type)||isElement(Re.node)&&Kn.elementTextManager.has(Re.node.type)?1:Re.endOffset-Re.startOffset;Oe===ce.nodes.length-1&&(je=Math.max(0,Ge-1)),Ie+=Re.extraCharSpacing*je}}Ae+=Ie}var Ue=ne.y-he;return{v:{point:new rn(Ae,Ue),lineIndex:oe}}}fe+=t.width};for(Oe.s();!(Be=Oe.n()).done;)if(Re=Fe())return Re.v}catch(Ve){Oe.e(Ve)}finally{Oe.f()}if(de){var Ne=ne.y-he;return{point:new rn(fe,Ne),lineIndex:oe}}}}return{point:new rn(ne.x,ne.y),lineIndex:0}}function transformBy(t){var h=this.getMTextImp();this.assertWrite(),h.mat=t;var p=this.position.clone(),x=new rn(p.x+this.maxWidth,p.y,p.z),M=new nn(this.maxWidth,0,0).normalize(),k=p.clone().transformBy(t),I=x.clone().transformBy(t),N=new nn(I.x-k.x,I.y-k.y,I.z-k.z).normalize(),V=M.crossProduct(N),ee=M.dotProduct(N),te=180*Math.acos(Math.min(Math.max(ee,-1),1))/Math.PI;return te=V.z<0?360-te:te,h.angle=te,!0}var qn=_createClass$1((function MxCADBaseCustomText(){_classCallCheck$1(this,MxCADBaseCustomText)}));function ownKeys$2(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$2(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$2(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$2(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}function _createSuper$3(t){var h=function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var Kn=function(t){_inherits$1(MxCADMText,t);var h=_createSuper$3(MxCADMText);function MxCADMText(t){var p;return _classCallCheck$1(this,MxCADMText),_defineProperty(_assertThisInitialized$1(p=h.call(this,t)),"impMText",void 0),_defineProperty(_assertThisInitialized$1(p),"convertCadPointToSlatePoint",convertCadPointToSlatePoint),_defineProperty(_assertThisInitialized$1(p),"convertSlatePointToCadPoint",convertSlatePointToCadPoint),_defineProperty(_assertThisInitialized$1(p),"transformBy",transformBy),p.impMText||(p.impMText=new zn),p}return _createClass$1(MxCADMText,[{key:"getMTextImp",value:function getMTextImp(){return this.impMText}},{key:"data",get:function get(){return this.impMText.data},set:function set(t){this.assertWrite(),this.impMText.data=t}},{key:"textBaseHeight",get:function get(){return this.impMText.textBaseHeight},set:function set(t){this.assertWrite(),this.impMText.textBaseHeight=t}},{key:"angle",get:function get(){return this.impMText.angle},set:function set(t){this.assertWrite(),this.impMText.angle=t;var h=new sn;h.setToRotation(THREE.MathUtils.degToRad(t),nn.kZAxis,this.position),this.impMText.mat=h}},{key:"position",get:function get(){return this.impMText.position},set:function set(t){this.assertWrite(),this.impMText.position=t}},{key:"maxWidth",get:function get(){return this.impMText.maxWidth},set:function set(t){this.assertWrite(),t<=0&&(t=this.textBaseHeight),this.impMText.maxWidth=t}},{key:"maxHeight",get:function get(){return this.impMText.maxHeight},set:function set(t){this.assertWrite(),t<=0&&(t=this.textBaseHeight),this.impMText.maxHeight=t}},{key:"isWordWrap",get:function get(){return this.impMText.isWordWrap},set:function set(t){this.impMText.isWordWrap!==t&&(this.impMText.isWordWrap=t,this.updateDisplay())}},{key:"lineHeightRatio",get:function get(){return this.impMText.lineHeightRatio},set:function set(t){this.assertWrite();var h=Math.max(.5,Math.min(3,t));this.impMText.lineHeightRatio!==h&&(this.impMText.lineHeightRatio=h,this.updateDisplay())}},{key:"textAlignment",get:function get(){return this.impMText.textAlignment},set:function set(t){this.assertWrite(),this.impMText.textAlignment=t,this.updateDisplay()}},{key:"create",value:function create(t){return new MxCADMText(t)}},{key:"getTypeName",value:function getTypeName(){return"MxCADMText"}},{key:"getName",value:function getName(){return"MxCAD"}},{key:"dwgInFields",value:function dwgInFields(t){return this.impMText.dwgInFields(t),!0}},{key:"dwgOutFields",value:function dwgOutFields(t){return this.impMText.dwgOutFields(t),!0}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){return this.assertWrite(),this.impMText.moveGripPointsAt(t,h,p,x)}},{key:"getGripPoints",value:function getGripPoints(){return this.impMText.getGripPoints()}},{key:"worldDraw",value:function worldDraw(t){var h=this;!function clearCalculateData(){xn.clear()}(),function clearTextCalculateData(){Sn.clear()}();var p=this.getMTextImp();p.__PARAGRAPH_INFOS__=[];var x=0,M=0;p.actualWidth=p.maxWidth,p.actualHeight=p.maxHeight;var k=p.data.map((function(t,p){if(isElement(t)){var k=MxCADMText.elementTextManager.get(t.type);if(k){var I=null==k?void 0:k.calculate(h,t,p);return I&&(x+=I.height,M=Math.max(M,I.width)),I}}})),I=Math.max(p.maxWidth,M),N=p.getActualRenderStartPosition(x,I),V=0;p.data.forEach((function(x,M){if(isElement(x)){var ee=MxCADMText.elementTextManager.get(x.type);if(ee){var te=k[M];if(te){var re=N.clone().subvec(nn.kYAxis.clone().mult(V)),ne=ee.render(h,t,x,te,{position:re,index:M,alignmentWidth:I});ne&&(V+=te.height,p.__PARAGRAPH_INFOS__[M]=_objectSpread$2(_objectSpread$2({},te),ne))}}}})),p.actualWidth=Math.max(p.maxWidth,M),p.actualHeight=Math.max(p.maxHeight,x),p.emit("changed")}}]),MxCADMText}(sr);function _createForOfIteratorHelper$5(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$5(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$5(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$5(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$5(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}_defineProperty(Kn,"fromMText",Hn.fromMText),_defineProperty(Kn,"toMText",Hn.toMText),_defineProperty(Kn,"elementTextManager",new Nn);var Yn=function(){function SlateUtils(){_classCallCheck$1(this,SlateUtils)}return _createClass$1(SlateUtils,null,[{key:"isSlateData",value:function isSlateData(t){return!!Array.isArray(t)&&t.some((function(t){return"object"===_typeof$1(t)&&null!==t&&"paragraph"===t.type&&Array.isArray(t.children)}))}},{key:"extractTextFromSlate",value:function extractTextFromSlate(t){if(!this.isSlateData(t))return null==t?"":String(t);var h,p="",x=_createForOfIteratorHelper$5(t);try{for(x.s();!(h=x.n()).done;){var M=h.value;if("paragraph"===M.type){if(Array.isArray(M.children)){var k,I=_createForOfIteratorHelper$5(M.children);try{for(I.s();!(k=I.n()).done;){var N=k.value;"string"==typeof N.text&&(p+=N.text)}}catch(V){I.e(V)}finally{I.f()}}p.length>0&&(p+="\n")}}}catch(V){x.e(V)}finally{x.f()}return p.endsWith("\n")&&(p=p.slice(0,-1)),p}},{key:"convertToSlateData",value:function convertToSlateData(t){return t?t.split("\n").map((function(t){return{type:"paragraph",children:[{text:t}]}})):[{type:"paragraph",children:[{text:""}]}]}},{key:"convertTableDataToPlainText",value:function convertTableDataToPlainText(t){var h=this;return t&&Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return h.isSlateData(t)?h.extractTextFromSlate(t):t})):[]})):[]}},{key:"ensureSlateFormat",value:function ensureSlateFormat(t){var h=this;return t&&Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return h.isSlateData(t)?t:null==t?h.convertToSlateData(""):h.convertToSlateData(String(t))})):[]})):[]}}]),SlateUtils}();function _createForOfIteratorHelper$4(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$4(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$4(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$4(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$4(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}var Zn=function(){function TableDrawer(){_classCallCheck$1(this,TableDrawer)}return _createClass$1(TableDrawer,null,[{key:"drawTable",value:function drawTable(t,h,p,x,M,k,I,N,V,ee,te,re){return this.drawTableData(t,h,p,x,M,k,I,N,V,ee,te,re)}},{key:"drawTableGrid",value:function drawTableGrid(t,h,p,x,M,k,I,N,V,ee,te,re){var ne=this.calculateActualDimensions(p,x,M,I,N,ee,te,!0),ie=ne.rowPositions,ae=ne.colPositions,oe=new Map;V&&V.forEach((function(t){for(var h=t.row;h<t.row+t.rowspan;h++)for(var p=t.col;p<t.col+t.colspan;p++)p>t.col&&p<t.col+t.colspan&&oe.set("v_".concat(p,"_").concat(h,"_").concat(h+1),!0),h>t.row&&h<t.row+t.rowspan&&oe.set("h_".concat(h,"_").concat(p,"_").concat(p+1),!0)}));var se=ie.map((function(t){return h.y-t})),ce=ae.map((function(t){return h.x+t})),ue=se[x],le=ce[M],he=void 0!==k.borderLineWeight?k.borderLineWeight:.25,fe=k.borderLineType||"Continuous";this.drawLine(t,new rn(h.x,h.y,h.z),new rn(le,h.y,h.z),k.borderColor,re,he,fe),this.drawLine(t,new rn(le,h.y,h.z),new rn(le,ue,h.z),k.borderColor,re,he,fe),this.drawLine(t,new rn(le,ue,h.z),new rn(h.x,ue,h.z),k.borderColor,re,he,fe),this.drawLine(t,new rn(h.x,ue,h.z),new rn(h.x,h.y,h.z),k.borderColor,re,he,fe);for(var de=1;de<M;de++)for(var pe=ce[de],me=0;me<x;me++)if(!oe.get("v_".concat(de,"_").concat(me,"_").concat(me+1))){var ge=se[me],ve=se[me+1];this.drawLine(t,new rn(pe,ge,h.z),new rn(pe,ve,h.z),k.borderColor,re,he,fe)}for(var ye=1;ye<x;ye++)for(var be=se[ye],xe=0;xe<M;xe++)if(!oe.get("h_".concat(ye,"_").concat(xe,"_").concat(xe+1))){var Me=ce[xe],we=ce[xe+1];this.drawLine(t,new rn(Me,be,h.z),new rn(we,be,h.z),k.borderColor,re,he,fe)}}},{key:"createColor",value:function createColor(t){var h=new Cr;if("number"!=typeof t||isNaN(t))return h.setRGB(0,0,0),h;try{if(t>=Bi.kByblock&&t<=Bi.kBylayer)h.setColorIndex(t);else{var p=t.toString(16).padStart(6,"0"),x=parseInt(p.substr(0,2),16),M=parseInt(p.substr(2,2),16),k=parseInt(p.substr(4,2),16);isNaN(x)||isNaN(M)||isNaN(k)||h.setRGB(x,M,k)}}catch(Vf){}return h}},{key:"drawLine",value:function drawLine(t,h,p,x,M,k,I){var N=new Bt;if(N.startPoint=h,N.endPoint=p,N.trueColor=this.createColor(x),t.trueColor=N.trueColor,void 0!==k&&k>0&&(N.lineweight=k),I&&"Continuous"!==I)try{N.linetype=I}catch(V){}M&&N.transformBy(M),t.drawEntity(N)}},{key:"drawTableData",value:function drawTableData(h,p,x,M,k,I,N,V,ee,te,re,ne){var ie=this,ae=M.rowCount,oe=M.cols,se=new Map,ce=this.calculateActualDimensions(x,ae,oe,I,N,ee,te,!0),ue=ce.rowPositions,le=ce.colPositions,he=ue.map((function(t){return p.y-t})),fe=le.map((function(t){return p.x+t})),de=new Map;return V&&V.forEach((function(t){de.set("".concat(t.row,",").concat(t.col),t)})),M.data.forEach((function(x,M){x.forEach((function(x,I){var N=!1;if(V){var ee,te=_createForOfIteratorHelper$4(V);try{for(te.s();!(ee=te.n()).done;){var ae=ee.value;if(M>=ae.row&&M<ae.row+ae.rowspan&&I>=ae.col&&I<ae.col+ae.colspan&&(M!==ae.row||I!==ae.col)){N=!0;break}}}catch(Le){te.e(Le)}finally{te.f()}}if(!N){var oe,ce,ue=fe[I],le=he[M],pe=de.get("".concat(M,",").concat(I));pe?(oe=fe[I+pe.colspan]-ue,ce=Math.abs(he[M+pe.rowspan]-le)):(oe=fe[I+1]-ue,ce=Math.abs(he[M+1]-le));var me=x,ge=new ln;ge.append(new rn(ue,le,p.z)),ge.append(new rn(ue+oe,le,p.z)),ge.append(new rn(ue+oe,le-ce,p.z)),ge.append(new rn(ue,le-ce,p.z));var ve,ye=ie.getCellReference(M,I),be=null==re?void 0:re[ye],xe=k.backgroundColor;void 0!==(null==be?void 0:be.backgroundColor)&&null!==(null==be?void 0:be.backgroundColor)&&(xe=be.backgroundColor),null!=xe&&((ve=new Yt).appendLoop(ge),ne&&ve.transformBy(ne),ve.trueColor=ie.createColor(xe),h.trueColor=ve.trueColor,h.drawEntity(ve));var Me=new Kn;ve&&(Me.drawOrder=ve.drawOrder+10);var we=k.textColor,_e=k.textAlignment||"center",Ce=k.textVerticalAlignment||"middle",Se=k.textStyle||"Standard";if(be&&(void 0!==be.textColor&&null!==be.textColor&&(we=be.textColor),void 0!==be.alignment&&(_e=be.alignment),void 0!==be.verticalAlignment&&(Ce=be.verticalAlignment),void 0!==be.textStyle&&(Se=be.textStyle)),Yn.isSlateData(me))Me.data=me;else{var Te=String(null==me?"":me);Me.data=[{type:"paragraph",children:[{text:Te}]}]}if(Me.maxWidth=oe,Me.maxHeight=ce,Me.position=new rn(ue,le,p.z),Me.textBaseHeight=k.textHeight,Se&&"Standard"!==Se)try{Me.textStyle=Se}catch(Ee){}if(null!=we)try{Me.trueColor=ie.createColor(we)}catch(Vf){}switch(_e){case"left":switch(Ce){case"top":Me.textAlignment=t.McDb.AttachmentPoint.kTopLeft;break;case"middle":default:Me.textAlignment=t.McDb.AttachmentPoint.kMiddleLeft;break;case"bottom":Me.textAlignment=t.McDb.AttachmentPoint.kBottomLeft}break;case"center":switch(Ce){case"top":Me.textAlignment=t.McDb.AttachmentPoint.kTopCenter;break;case"middle":default:Me.textAlignment=t.McDb.AttachmentPoint.kMiddleCenter;break;case"bottom":Me.textAlignment=t.McDb.AttachmentPoint.kBottomCenter}break;case"right":switch(Ce){case"top":Me.textAlignment=t.McDb.AttachmentPoint.kTopRight;break;case"middle":default:Me.textAlignment=t.McDb.AttachmentPoint.kMiddleRight;break;case"bottom":Me.textAlignment=t.McDb.AttachmentPoint.kBottomRight}break;default:Me.textAlignment=t.McDb.AttachmentPoint.kMiddleCenter}h.trueColor=Me.trueColor,ne&&(Me.getMTextImp().mat=ne),Me.worldDraw(h);try{var Ae=Me.getMTextImp().actualWidth,De=Me.getMTextImp().actualHeight,ke="".concat(M,",").concat(I);se.set(ke,{width:Ae,height:De})}catch(Ee){}}}))})),this.drawTableGrid(h,p,x,ae,oe,k,I,N,V,ee,te,ne),se}},{key:"getCellReference",value:function getCellReference(t,h){for(var p="",x=h+1;x>0;){var M=(x-1)%26;p=String.fromCharCode(65+M)+p,x=Math.floor((x-M-1)/26)}return"".concat(p).concat(t+1)}},{key:"calculateActualDimensions",value:function calculateActualDimensions(t,h,p,x,M,k,I){for(var N=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],V=[],ee=[],te=[],re=0,ne=function _loop(t){var h=null==k?void 0:k.find((function(h){return h.row===t})),p=h?h.height:x;te.push(p),re+=p},ie=0;ie<h;ie++)ne(ie);for(var ae=[],oe=0,se=function _loop2(t){var h=null==I?void 0:I.find((function(h){return h.col===t})),p=h?h.width:M;ae.push(p),oe+=p},ce=0;ce<p;ce++)se(ce);var ue=N?t.width:oe,le=N?t.height:re,he=N?ue/oe:1,fe=N?le/re:1,de=0;V.push(de);for(var pe=0;pe<h;pe++){de+=te[pe]*fe,V.push(de)}var me=0;ee.push(me);for(var ge=0;ge<p;ge++){me+=ae[ge]*he,ee.push(me)}return{width:ue,height:le,rowPositions:V,colPositions:ee}}}]),TableDrawer}();function encodeToBase64(t){try{var h=JSON.stringify(t),p=encodeURIComponent(h).replace(/%([0-9A-F]{2})/g,(function(t,h){return String.fromCharCode(parseInt(h,16))}));return btoa(p)}catch(x){return""}}function decodeFromBase64(t){try{if(!t)return null;var h=atob(t),p=Array.from(h).map((function(t){return"%"+t.charCodeAt(0).toString(16).padStart(2,"0").toUpperCase()})).join(""),x=decodeURIComponent(p);return JSON.parse(x)}catch(M){return null}}function ownKeys$1(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread$1(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys$1(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys$1(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}var Jn=function(){function CellStyleHelper(){_classCallCheck$1(this,CellStyleHelper)}return _createClass$1(CellStyleHelper,null,[{key:"setTextStyle",value:function setTextStyle(){var t=arguments.length>1?arguments[1]:void 0;return _objectSpread$1(_objectSpread$1({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},{textStyle:t})}},{key:"setTextAngle",value:function setTextAngle(){var t=arguments.length>1?arguments[1]:void 0;return _objectSpread$1(_objectSpread$1({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},{textAngle:t})}},{key:"setBorderLineWeight",value:function setBorderLineWeight(){var t=arguments.length>1?arguments[1]:void 0;return _objectSpread$1(_objectSpread$1({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},{borderLineWeight:t})}},{key:"setBorderLineType",value:function setBorderLineType(){var t=arguments.length>1?arguments[1]:void 0;return _objectSpread$1(_objectSpread$1({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),{},{borderLineType:t})}},{key:"getTextStyle",value:function getTextStyle(t){return null==t?void 0:t.textStyle}},{key:"getTextAngle",value:function getTextAngle(t){return null==t?void 0:t.textAngle}},{key:"getBorderLineWeight",value:function getBorderLineWeight(t){return null==t?void 0:t.borderLineWeight}},{key:"getBorderLineType",value:function getBorderLineType(t){return null==t?void 0:t.borderLineType}}]),CellStyleHelper}();function ownKeys(t,h){var p=Object.keys(t);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(t);h&&(x=x.filter((function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable}))),p.push.apply(p,x)}return p}function _objectSpread(t){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ownKeys(Object(p),!0).forEach((function(h){_defineProperty(t,h,p[h])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(p)):ownKeys(Object(p)).forEach((function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(p,h))}))}return t}function _createForOfIteratorHelper$3(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$3(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$3(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$3(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$3(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function _createSuper$2(t){var h=function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}var Qn=function(h){_inherits$1(McDbXlsxTable,h);var p=_createSuper$2(McDbXlsxTable);function McDbXlsxTable(t){var h;return _classCallCheck$1(this,McDbXlsxTable),_defineProperty(_assertThisInitialized$1(h=p.call(this,t)),"_rowHeight",20),_defineProperty(_assertThisInitialized$1(h),"_colWidth",50),_defineProperty(_assertThisInitialized$1(h),"_position",new rn(0,0,0)),_defineProperty(_assertThisInitialized$1(h),"_styleName",""),_defineProperty(_assertThisInitialized$1(h),"_colWidths",[]),_defineProperty(_assertThisInitialized$1(h),"_rowHeights",[]),_defineProperty(_assertThisInitialized$1(h),"_xlsxData",""),_defineProperty(_assertThisInitialized$1(h),"_mergeCells",[]),_defineProperty(_assertThisInitialized$1(h),"_selectedCells",[]),_defineProperty(_assertThisInitialized$1(h),"_cellTextDimensions",new Map),_defineProperty(_assertThisInitialized$1(h),"_cellStyles",{}),_defineProperty(_assertThisInitialized$1(h),"_mat",new sn),h}return _createClass$1(McDbXlsxTable,[{key:"rowHeight",get:function get(){return this._rowHeight},set:function set(t){this.assertWrite(),this._rowHeight=t}},{key:"colWidth",get:function get(){return this._colWidth},set:function set(t){this.assertWrite(),this._colWidth=t}},{key:"position",get:function get(){return this._position},set:function set(t){this.assertWrite(),this._position=t}},{key:"styleName",get:function get(){return this._styleName},set:function set(t){this.assertWrite(),this._styleName=t}},{key:"xlsxData",get:function get(){return this._xlsxData},set:function set(t){this._xlsxData=t}},{key:"create",value:function create(t){return new McDbXlsxTable(t)}},{key:"getTypeName",value:function getTypeName(){return"McDbXlsxTable"}},{key:"getCellStyles",value:function getCellStyles(){return this._cellStyles}},{key:"getTableData",value:function getTableData(){try{var t;if(!this._xlsxData)return{data:[],cols:0,rowCount:0,mergeCells:[],styles:{},rowHeights:[],colWidths:[]};var h=decodeFromBase64(this._xlsxData);if(!h||!Array.isArray(h))return{data:[],cols:0,rowCount:0,mergeCells:[],styles:{},rowHeights:[],colWidths:[]};var p=this.processMergedCellData(h);return{data:p,cols:(null===(t=p[0])||void 0===t?void 0:t.length)||0,rowCount:p.length,mergeCells:this._mergeCells,styles:this._cellStyles,rowHeights:this._rowHeights,colWidths:this._colWidths}}catch(x){return{data:[],cols:0,rowCount:0,mergeCells:[],styles:{},rowHeights:[],colWidths:[]}}}},{key:"getDefaultStyle",value:function getDefaultStyle(){return{name:"STANDARD",textHeight:2.5,borderColor:0,textColor:0,textAlignment:"center",textVerticalAlignment:"middle",textStyle:"Standard",borderLineWeight:t.McDb.LineWeight.kLnWtByLayer,borderLineType:"Continuous"}}},{key:"processMergedCellData",value:function processMergedCellData(t){if(!t||0===t.length)return t;var h,p=JSON.parse(JSON.stringify(t)),x=_createForOfIteratorHelper$3(this._mergeCells);try{for(x.s();!(h=x.n()).done;){var M,k=h.value,I=k.row,N=k.col,V=k.rowspan,ee=k.colspan,te=null===(M=p[I])||void 0===M?void 0:M[N];if(void 0!==te)for(var re=0;re<V;re++)for(var ne=0;ne<ee;ne++)if(0!==re||0!==ne){var ie=I+re,ae=N+ne;p[ie]&&(p[ie][ae]=te)}}}catch(oe){x.e(oe)}finally{x.f()}return p}},{key:"dwgInFields",value:function dwgInFields(t){this.position=t.readPoint("position").val,this.styleName=t.readString("styleName").val,this._xlsxData=t.readString("xlsxData").val;for(var h=t.readString("mat").val,p=JSON.parse(h),x=0;x<p.length;x++)for(var M=p[x],k=0;k<M.length;k++){var I=M[k];this._mat.setData(x,k,I)}try{this._cellStyles=JSON.parse(t.readString("cellStyles").val)||{}}catch(te){this._cellStyles={}}try{var N=t.readString("mergeCells").val;this._mergeCells=N?JSON.parse(N):[]}catch(te){this._mergeCells=[]}try{var V=t.readString("colWidths").val;this._colWidths=V?JSON.parse(V):[]}catch(te){this._colWidths=[]}try{var ee=t.readString("rowHeights").val;this._rowHeights=ee?JSON.parse(ee):[]}catch(te){this._rowHeights=[]}return!0}},{key:"dwgOutFields",value:function dwgOutFields(t){t.writePoint("position",this.position),t.writeString("styleName",this.styleName),t.writeString("xlsxData",this._xlsxData);for(var h=[],p=0;p<4;p++){h[p]=[];for(var x=0;x<4;x++){var M=this._mat.getData(p,x);h[p][x]=M}}t.writeString("mat",JSON.stringify(h));try{t.writeString("cellStyles",JSON.stringify(this._cellStyles))}catch(k){t.writeString("cellStyles","{}")}return this._mergeCells.length>0?t.writeString("mergeCells",JSON.stringify(this._mergeCells)):t.writeString("mergeCells","[]"),this._colWidths.length>0?t.writeString("colWidths",JSON.stringify(this._colWidths)):t.writeString("colWidths","[]"),this._rowHeights.length>0?t.writeString("rowHeights",JSON.stringify(this._rowHeights)):t.writeString("rowHeights","[]"),!0}},{key:"calculateTableDimensions",value:function calculateTableDimensions(){try{var t=this.getTableData();if(0===t.rowCount||0===t.cols)return{width:0,height:0};for(var h=0,p=0;p<t.cols;p++)h+=this.getColumnWidth(p);for(var x=0,M=0;M<t.rowCount;M++)x+=this.getRowHeight(M);return{width:h,height:x}}catch(k){return{width:5*this.colWidth,height:5*this.rowHeight}}}},{key:"getSelectionRange",value:function getSelectionRange(){if(0===this._selectedCells.length)return null;var t,h=Number.MAX_VALUE,p=Number.MAX_VALUE,x=Number.MIN_VALUE,M=Number.MIN_VALUE,k=new Set,I=_createForOfIteratorHelper$3(this._selectedCells);try{for(I.s();!(t=I.n()).done;){var N,V=t.value,ee=V.row,te=V.col,re=ee,ne=te,ie=ee,ae=te,oe=!1,se=_createForOfIteratorHelper$3(this._mergeCells);try{for(se.s();!(N=se.n()).done;){var ce=N.value;if(ee===ce.row&&te===ce.col){oe=!0,ie=ee+ce.rowspan-1,ae=te+ce.colspan-1;var ue="".concat(ce.row,",").concat(ce.col);k.add(ue);break}}}catch(ge){se.e(ge)}finally{se.f()}if(!oe){var le,he=_createForOfIteratorHelper$3(this._mergeCells);try{for(he.s();!(le=he.n()).done;){var fe=le.value,de=ee>=fe.row&&ee<fe.row+fe.rowspan,pe=te>=fe.col&&te<fe.col+fe.colspan;if(de&&pe){var me="".concat(fe.row,",").concat(fe.col);if(k.has(me))break;k.add(me),re=fe.row,ne=fe.col,ie=fe.row+fe.rowspan-1,ae=fe.col+fe.colspan-1;break}}}catch(ge){he.e(ge)}finally{he.f()}}h=Math.min(h,re),p=Math.min(p,ne),x=Math.max(x,ie),M=Math.max(M,ae)}}catch(ge){I.e(ge)}finally{I.f()}return h===Number.MAX_VALUE||p===Number.MAX_VALUE?null:{minRow:h,minCol:p,maxRow:x,maxCol:M}}},{key:"setSelectedCell",value:function setSelectedCell(t,h){this._selectedCells=[{row:t,col:h}]}},{key:"addSelectedCell",value:function addSelectedCell(t,h){this._selectedCells.some((function(p){return p.row===t&&p.col===h}))||this._selectedCells.push({row:t,col:h})}},{key:"setSelectedCells",value:function setSelectedCells(t){this._selectedCells=_toConsumableArray(t)}},{key:"clearSelectedCell",value:function clearSelectedCell(){this._selectedCells=[]}},{key:"getSelectedCell",value:function getSelectedCell(){return this._selectedCells.length>0?this._selectedCells[0]:null}},{key:"getSelectedCells",value:function getSelectedCells(){return _toConsumableArray(this._selectedCells)}},{key:"isCellSelected",value:function isCellSelected(t,h){return this._selectedCells.some((function(p){return p.row===t&&p.col===h}))}},{key:"getSelectedCellCount",value:function getSelectedCellCount(){return this._selectedCells.length}},{key:"worldDraw",value:function worldDraw(t){if(0!=this.styleName.length){var h=function readDbString$1(t,h){var p=t.getNamedObjectsDictionary().getAt("MxTableStyleDictionary");if(!p.isNull()){var x=p.getMcDbDictionary();if(x){var M=x.getAt(h);if(M.isNull())return;var k=M.getMcDbXrecord();if(k){var I=k.getData();try{return JSON.parse(I.AtString(0).val)}catch(N){return}}}}}(t.getDatabase(),this.styleName);if(h||"STANDARD"!==this.styleName||(h=this.getDefaultStyle()),h){var p={x:this.position.x,y:this.position.y,z:this.position.z},x=this.getTableData(),M=this.calculateTableDimensions(),k=Zn.drawTable(t,p,M,x,h,this.rowHeight,this.colWidth,this._mergeCells,this._rowHeights,this._colWidths,this._cellStyles);k&&k.size>0&&(this._cellTextDimensions=k)}}}},{key:"setFromWorkbook",value:function setFromWorkbook(t){this.assertWrite();try{this._xlsxData=encodeToBase64(t.data),this._mergeCells=t.mergeCells||[],this._colWidths=t.colWidths||[],this._rowHeights=t.rowHeights||[],this._cellStyles=t.cellStyles||{}}catch(h){}}},{key:"setFromJson",value:function setFromJson(t){this.assertWrite();try{var h=Yn.ensureSlateFormat(t);this._xlsxData=encodeToBase64(h)}catch(p){}}},{key:"setFromArray",value:function setFromArray(t){this.assertWrite();try{var h=Yn.ensureSlateFormat(t);this._xlsxData=encodeToBase64(h)}catch(p){}}},{key:"setMergeCells",value:function setMergeCells(t){this.assertWrite(),this._mergeCells=t}},{key:"getMergeCells",value:function getMergeCells(){return this._mergeCells}},{key:"setColumnWidth",value:function setColumnWidth(t,h){if(this.assertWrite(),!(t<0||h<=0)){var p=this._colWidths.findIndex((function(h){return h.col===t}));p>=0?this._colWidths[p].width=h:this._colWidths.push({col:t,width:h})}}},{key:"getColumnWidth",value:function getColumnWidth(t){var h=this._colWidths.find((function(h){return h.col===t}));return h?h.width:this.colWidth}},{key:"getAllColumnWidths",value:function getAllColumnWidths(){return _toConsumableArray(this._colWidths)}},{key:"resetColumnWidth",value:function resetColumnWidth(t){this.assertWrite(),this._colWidths=this._colWidths.filter((function(h){return h.col!==t}))}},{key:"setRowHeight",value:function setRowHeight(t,h){if(this.assertWrite(),!(t<0||h<=0)){var p=this._rowHeights.findIndex((function(h){return h.row===t}));p>=0?this._rowHeights[p].height=h:this._rowHeights.push({row:t,height:h})}}},{key:"getRowHeight",value:function getRowHeight(t){var h=this._rowHeights.find((function(h){return h.row===t}));return h?h.height:this.rowHeight}},{key:"getAllRowHeights",value:function getAllRowHeights(){return _toConsumableArray(this._rowHeights)}},{key:"resetRowHeight",value:function resetRowHeight(t){this.assertWrite(),this._rowHeights=this._rowHeights.filter((function(h){return h.row!==t}))}},{key:"getCellValue",value:function getCellValue(t,h){try{var p=decodeFromBase64(this._xlsxData);if(!p||!Array.isArray(p)||t<0||h<0||t>=p.length)return null;var x=p[t];return!x||h>=x.length?null:x[h]}catch(M){return null}}},{key:"setCellValue",value:function setCellValue(t,h,p){this.assertWrite();try{var x,M=decodeFromBase64(this._xlsxData);if(!M||!Array.isArray(M))return;for(;M.length<=t;)M.push([]);for(;M[t].length<=h;)M[t].push(null);x=Yn.isSlateData(p)?p:Yn.convertToSlateData(String(p)),M[t][h]=x,this._xlsxData=encodeToBase64(M)}catch(k){}}},{key:"getCellTextValue",value:function getCellTextValue(t,h){var p=this.getCellValue(t,h);return Yn.extractTextFromSlate(p)}},{key:"getCellGeometry",value:function getCellGeometry(t,h){var p=this;try{var x=this.getTableData();if(t<0||h<0||t>=x.rowCount||h>=x.cols)return null;var M,k,I,N=this.calculateTableDimensions(),V=Zn.calculateActualDimensions(N,x.rowCount,x.cols,this.rowHeight,this.colWidth,this._rowHeights,this._colWidths,!0),ee=V.rowPositions,te=V.colPositions,re=ee.map((function(t){return p.position.y-t})),ne=te.map((function(t){return p.position.x+t})),ie=ne[h],ae=re[t],oe=!1,se=h+1,ce=t+1,ue=_createForOfIteratorHelper$3(this._mergeCells);try{for(ue.s();!(I=ue.n()).done;){var le=I.value;if(t===le.row&&h===le.col){oe=!0,se=h+le.colspan,ce=t+le.rowspan;break}}}catch(he){ue.e(he)}finally{ue.f()}return M=ne[oe?se:h+1],k=re[oe?ce:t+1],{min:new rn(ie,k,this.position.z),max:new rn(M,ae,this.position.z)}}catch(fe){return null}}},{key:"getCellReference",value:function getCellReference(t,h){try{var p="",x=h;do{var M=x%26;p=String.fromCharCode(65+M)+p,x=Math.floor(x/26)-1}while(x>=0);return p+(t+1).toString()}catch(k){return""}}},{key:"getCellFromReference",value:function getCellFromReference(t){try{var h=t.match(/^([A-Z]+)([0-9]+)$/);if(!h)return null;for(var p=h[1],x=h[2],M=0,k=0;k<p.length;k++)M=26*M+(p.charCodeAt(k)-64);M--;var I=parseInt(x)-1;return I<0||M<0?null:{row:I,col:M}}catch(N){return null}}},{key:"setCellBackgroundColor",value:function setCellBackgroundColor(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=_objectSpread(_objectSpread({},this._cellStyles[x]),{},{backgroundColor:p})}},{key:"getCellBackgroundColor",value:function getCellBackgroundColor(t,h){var p,x=this.getCellReference(t,h);return null===(p=this._cellStyles[x])||void 0===p?void 0:p.backgroundColor}},{key:"setCellBackgroundColorByRef",value:function setCellBackgroundColorByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellBackgroundColor(p.row,p.col,h),!0)}},{key:"setBatchCellBackgroundColor",value:function setBatchCellBackgroundColor(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellBackgroundColorByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellBackgroundColor(t.row,t.col,h)}))}},{key:"setCellTextColor",value:function setCellTextColor(t,h,p){this.assertWrite();var x=this._cellStyles[this.getCellReference(t,h)]||{};this._cellStyles[this.getCellReference(t,h)]=_objectSpread(_objectSpread({},x),{},{textColor:p})}},{key:"getCellTextColor",value:function getCellTextColor(t,h){var p,x=this.getCellReference(t,h);return null===(p=this._cellStyles[x])||void 0===p?void 0:p.textColor}},{key:"setCellTextColorByRef",value:function setCellTextColorByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellTextColor(p.row,p.col,h),!0)}},{key:"setBatchCellTextColor",value:function setBatchCellTextColor(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellTextColorByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellTextColor(t.row,t.col,h)}))}},{key:"setCellAlignment",value:function setCellAlignment(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=_objectSpread(_objectSpread({},this._cellStyles[x]),{},{alignment:p})}},{key:"getCellAlignment",value:function getCellAlignment(t,h){var p,x=this.getCellReference(t,h);return null===(p=this._cellStyles[x])||void 0===p?void 0:p.alignment}},{key:"setCellAlignmentByRef",value:function setCellAlignmentByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellAlignment(p.row,p.col,h),!0)}},{key:"setBatchCellAlignment",value:function setBatchCellAlignment(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellAlignmentByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellAlignment(t.row,t.col,h)}))}},{key:"setCellVerticalAlignment",value:function setCellVerticalAlignment(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=_objectSpread(_objectSpread({},this._cellStyles[x]),{},{verticalAlignment:p})}},{key:"getCellVerticalAlignment",value:function getCellVerticalAlignment(t,h){var p,x=this.getCellReference(t,h);return null===(p=this._cellStyles[x])||void 0===p?void 0:p.verticalAlignment}},{key:"setCellVerticalAlignmentByRef",value:function setCellVerticalAlignmentByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellVerticalAlignment(p.row,p.col,h),!0)}},{key:"setBatchCellVerticalAlignment",value:function setBatchCellVerticalAlignment(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellVerticalAlignmentByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellVerticalAlignment(t.row,t.col,h)}))}},{key:"getCellAtPoint",value:function getCellAtPoint(t){var h=this;try{var p=this.getTableData();if(0===p.rowCount||0===p.cols)return null;var x=this.calculateTableDimensions();if(t.x<this.position.x||t.x>this.position.x+x.width||t.y>this.position.y||t.y<this.position.y-x.height)return null;for(var M=Zn.calculateActualDimensions(x,p.rowCount,p.cols,this.rowHeight,this.colWidth,this._rowHeights,this._colWidths,!0),k=M.rowPositions,I=M.colPositions,N=k.map((function(t){return h.position.y-t})),V=I.map((function(t){return h.position.x+t})),ee=-1,te=0;te<N.length-1;te++)if(t.y<=N[te]&&t.y>N[te+1]){ee=te;break}for(var re=-1,ne=0;ne<V.length-1;ne++)if(t.x>=V[ne]&&t.x<V[ne+1]){re=ne;break}if(-1===ee||-1===re)return{row:ee,col:re};var ie,ae=_createForOfIteratorHelper$3(this._mergeCells);try{for(ae.s();!(ie=ae.n()).done;){var oe=ie.value,se=oe.row,ce=oe.col,ue=oe.rowspan,le=oe.colspan;if(ee>=se&&ee<se+ue&&re>=ce&&re<ce+le)return{row:se,col:ce}}}catch(he){ae.e(he)}finally{ae.f()}return{row:ee,col:re}}catch(fe){return null}}},{key:"getGripPoints",value:function getGripPoints(){var t=new ln,h=this.getTableData(),p=h.rowCount*h.cols;if(this._selectedCells.length>0&&this._selectedCells.length<p){var x=this.getSelectionRange();if(x){var M=x.minRow,k=x.minCol,I=x.maxRow,N=x.maxCol,V=Number.MAX_VALUE,ee=Number.MAX_VALUE,te=Number.MIN_VALUE,re=Number.MIN_VALUE,ne=this.getCellGeometry(M,k);ne&&(V=ne.min.x,re=ne.max.y);var ie=this.getCellGeometry(I,N);if(ie&&(te=ie.max.x,ee=ie.min.y),V!==Number.MAX_VALUE&&ee!==Number.MAX_VALUE&&te!==Number.MIN_VALUE&&re!==Number.MIN_VALUE){var ae=new rn(V,(ee+re)/2,this.position.z),oe=new rn((V+te)/2,re,this.position.z),se=new rn(te,(ee+re)/2,this.position.z),ce=new rn((V+te)/2,ee,this.position.z);return t.append(ae),t.append(oe),t.append(se),t.append(ce),t}}var ue,le=Number.MAX_VALUE,he=Number.MAX_VALUE,fe=Number.MIN_VALUE,de=Number.MIN_VALUE,pe=new Set,me=_createForOfIteratorHelper$3(this._selectedCells);try{for(me.s();!(ue=me.n()).done;){var ge,ve=ue.value,ye=ve.row,be=ve.col,xe=!1,Me=_createForOfIteratorHelper$3(this._mergeCells);try{for(Me.s();!(ge=Me.n()).done;){var we=ge.value;if(ye===we.row&&be===we.col){var _e="".concat(we.row,",").concat(we.col);if(pe.has(_e)){xe=!0;break}pe.add(_e);var Ce=this.getCellGeometry(we.row,we.col),Se=we.row+we.rowspan-1,Te=we.col+we.colspan-1,Ae=this.getCellGeometry(Se,Te);Ce&&Ae&&(le=Math.min(le,Ce.min.x),he=Math.min(he,Ce.min.y),fe=Math.max(fe,Ae.max.x),de=Math.max(de,Ae.max.y)),xe=!0;break}}}catch(Ze){Me.e(Ze)}finally{Me.f()}if(!xe){var De,ke=_createForOfIteratorHelper$3(this._mergeCells);try{for(ke.s();!(De=ke.n()).done;){var Le=De.value,Ee=ye>=Le.row&&ye<Le.row+Le.rowspan,Ie=be>=Le.col&&be<Le.col+Le.colspan;if(Ee&&Ie){var Be="".concat(Le.row,",").concat(Le.col);if(pe.has(Be)){xe=!0;break}pe.add(Be);var Oe=this.getCellGeometry(Le.row,Le.col),Re=Le.row+Le.rowspan-1,Fe=Le.col+Le.colspan-1,Ne=this.getCellGeometry(Re,Fe);Oe&&Ne&&(le=Math.min(le,Oe.min.x),he=Math.min(he,Oe.min.y),fe=Math.max(fe,Ne.max.x),de=Math.max(de,Ne.max.y)),xe=!0;break}}}catch(Ze){ke.e(Ze)}finally{ke.f()}}if(!xe){var Ve=this.getCellGeometry(ye,be);Ve&&(le=Math.min(le,Ve.min.x),he=Math.min(he,Ve.min.y),fe=Math.max(fe,Ve.max.x),de=Math.max(de,Ve.max.y))}}}catch(Ze){me.e(Ze)}finally{me.f()}if(le!==Number.MAX_VALUE&&he!==Number.MAX_VALUE&&fe!==Number.MIN_VALUE&&de!==Number.MIN_VALUE){var Ge=new rn(le,he,this.position.z),je=new rn(fe,de,this.position.z),Ue=new rn(Ge.x,(Ge.y+je.y)/2,this.position.z),ze=new rn((Ge.x+je.x)/2,je.y,this.position.z),We=new rn(je.x,(Ge.y+je.y)/2,this.position.z),He=new rn((Ge.x+je.x)/2,Ge.y,this.position.z);return t.append(Ue),t.append(ze),t.append(We),t.append(He),t}}var $e=this.calculateTableDimensions(),Xe=this.position.clone(),qe=new rn(this.position.x+$e.width,this.position.y,this.position.z),Ke=new rn(this.position.x,this.position.y-$e.height,this.position.z),Ye=new rn(this.position.x+$e.width,this.position.y-$e.height,this.position.z);return t.append(Xe),t.append(qe),t.append(Ke),t.append(Ye),t}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){if(this.assertWrite(),this._selectedCells.length>0){var M=this.getSelectionRange();if(!M)return;var k,I=M.minRow,N=M.minCol,V=M.maxRow,ee=M.maxCol,te=[],re=_createForOfIteratorHelper$3(this._mergeCells);try{for(re.s();!(k=re.n()).done;){var ne=k.value,ie=ne.row+ne.rowspan-1,ae=ne.col+ne.colspan-1;ie<I||ne.row>V||ae<N||ne.col>ee||te.push(ne)}}catch(mr){re.e(mr)}finally{re.f()}switch(t){case 0:if(h<0){for(var oe=0,se=N;se<=ee;se++)oe+=this.getColumnWidth(se);var ce=(oe+Math.abs(h))/oe;this.position.x+=h;for(var ue=N;ue<=ee;ue++){var le=this.getColumnWidth(ue)*ce;this.setColumnWidth(ue,le)}}else{for(var he=0,fe=N;fe<=ee;fe++)he+=this.getColumnWidth(fe);var de,pe=10*(ee-N+1),me=_createForOfIteratorHelper$3(te);try{for(me.s();!(de=me.n()).done;){var ge=de.value;if(ge.col<=N&&ge.col+ge.colspan-1>=N){var ve="".concat(ge.row,",").concat(ge.col),ye=this._cellTextDimensions.get(ve);if(ye){var be=ye.width+10;pe=Math.max(pe,be)}}}}catch(mr){me.e(mr)}finally{me.f()}var xe=Math.max(0,he-pe),Me=Math.min(h,xe);if(Me>0){var we=(he-Me)/he;this.position.x+=Me;for(var _e=N;_e<=ee;_e++){var Ce=this.getColumnWidth(_e),Se=Math.max(Ce*we,10);this.setColumnWidth(_e,Se)}}}break;case 1:if(p>0){for(var Te=0,Ae=I;Ae<=V;Ae++)Te+=this.getRowHeight(Ae);var De=(Te+p)/Te;this.position.y+=p;for(var ke=I;ke<=V;ke++){var Le=this.getRowHeight(ke)*De;this.setRowHeight(ke,Le)}}else{for(var Ee=0,Ie=I;Ie<=V;Ie++)Ee+=this.getRowHeight(Ie);var Be,Oe=10*(V-I+1),Re=_createForOfIteratorHelper$3(te);try{for(Re.s();!(Be=Re.n()).done;){var Fe=Be.value;if(Fe.row<=I&&Fe.row+Fe.rowspan-1>=I){var Ne="".concat(Fe.row,",").concat(Fe.col),Ve=this._cellTextDimensions.get(Ne);if(Ve){var Ge=Ve.height+10;Oe=Math.max(Oe,Ge)}}}}catch(mr){Re.e(mr)}finally{Re.f()}var je=Math.max(0,Ee-Oe),Ue=Math.min(Math.abs(p),je);if(Ue>0){var ze=(Ee-Ue)/Ee;this.position.y-=Ue;for(var We=I;We<=V;We++){var He=this.getRowHeight(We),$e=Math.max(He*ze,10);this.setRowHeight(We,$e)}}}break;case 2:if(h>0){for(var Xe=0,qe=N;qe<=ee;qe++)Xe+=this.getColumnWidth(qe);for(var Ke=(Xe+h)/Xe,Ye=N;Ye<=ee;Ye++){var Ze=this.getColumnWidth(Ye)*Ke;this.setColumnWidth(Ye,Ze)}}else{for(var Je=0,Qe=N;Qe<=ee;Qe++)Je+=this.getColumnWidth(Qe);var et,tt=10*(ee-N+1),rt=_createForOfIteratorHelper$3(te);try{for(rt.s();!(et=rt.n()).done;){var nt=et.value;if(nt.col+nt.colspan-1>=ee){var it="".concat(nt.row,",").concat(nt.col),ot=this._cellTextDimensions.get(it);if(ot){var st=ot.width+10;tt=Math.max(tt,st)}}}}catch(mr){rt.e(mr)}finally{rt.f()}var ct=Math.max(0,Je-tt),ut=Math.min(Math.abs(h),ct);if(ut>0)for(var lt=(Je-ut)/Je,ht=N;ht<=ee;ht++){var ft=this.getColumnWidth(ht),dt=Math.max(ft*lt,10);this.setColumnWidth(ht,dt)}}break;case 3:if(p<0){for(var pt=0,mt=I;mt<=V;mt++)pt+=this.getRowHeight(mt);for(var gt=(pt+Math.abs(p))/pt,vt=I;vt<=V;vt++){var yt=this.getRowHeight(vt)*gt;this.setRowHeight(vt,yt)}}else{for(var bt=0,xt=I;xt<=V;xt++)bt+=this.getRowHeight(xt);var Mt,wt=10*(V-I+1),_t=_createForOfIteratorHelper$3(te);try{for(_t.s();!(Mt=_t.n()).done;){var Ct=Mt.value;if(Ct.row+Ct.rowspan-1>=V){var St="".concat(Ct.row,",").concat(Ct.col),Tt=this._cellTextDimensions.get(St);if(Tt){var At=Tt.height+10;wt=Math.max(wt,At)}}}}catch(mr){_t.e(mr)}finally{_t.f()}var Dt=Math.max(0,bt-wt),kt=Math.min(p,Dt);if(kt>0)for(var Pt=(bt-kt)/bt,Lt=I;Lt<=V;Lt++){var Et=this.getRowHeight(Lt),It=Math.max(Et*Pt,10);this.setRowHeight(Lt,It)}}}}else{var Bt=this.getTableData(),Ot=Bt.rowCount-1,Rt=Bt.cols-1;if(Ot<0||Rt<0)return void(0===t&&(this.position.x+=h,this.position.y+=p,this.position.z+=x));switch(t){case 0:this.position.x+=h,this.position.y+=p,this.position.z+=x;break;case 1:for(var Ft=0,Nt=0;Nt<=Rt;Nt++)Ft+=this.getColumnWidth(Nt);if(Math.abs(h)<.1*Ft){var Vt=this.getColumnWidth(Rt),Gt=Math.max(Vt+h,10);this.setColumnWidth(Rt,Gt)}else for(var jt=Math.max(Ft+h,10*Rt)/Ft,Ut=0;Ut<=Rt;Ut++){var zt=this.getColumnWidth(Ut),Wt=Math.max(zt*jt,10);this.setColumnWidth(Ut,Wt)}break;case 2:for(var Ht=0,$t=0;$t<=Ot;$t++)Ht+=this.getRowHeight($t);if(Math.abs(p)<.1*Ht){var Xt=this.getRowHeight(Ot),qt=Math.max(Xt-p,10);this.setRowHeight(Ot,qt)}else for(var Kt=Math.max(Ht-p,10*Ot)/Ht,Yt=0;Yt<=Ot;Yt++){var Zt=this.getRowHeight(Yt),Jt=Math.max(Zt*Kt,10);this.setRowHeight(Yt,Jt)}break;case 3:for(var Qt=0,er=0;er<=Rt;er++)Qt+=this.getColumnWidth(er);if(Math.abs(h)<.1*Qt){var tr=this.getColumnWidth(Rt),rr=Math.max(tr+h,10);this.setColumnWidth(Rt,rr)}else for(var nr=Math.max(Qt+h,10*Rt)/Qt,ir=0;ir<=Rt;ir++){var ar=this.getColumnWidth(ir),or=Math.max(ar*nr,10);this.setColumnWidth(ir,or)}for(var sr=0,cr=0;cr<=Ot;cr++)sr+=this.getRowHeight(cr);if(Math.abs(p)<.1*sr){var ur=this.getRowHeight(Ot),lr=Math.max(ur-p,10);this.setRowHeight(Ot,lr)}else for(var hr=Math.max(sr-p,10*Ot)/sr,fr=0;fr<=Ot;fr++){var dr=this.getRowHeight(fr),pr=Math.max(dr*hr,10);this.setRowHeight(fr,pr)}}}}},{key:"transformBy",value:function transformBy(t){return this.assertWrite(),this._mat=t.clone(),!1}},{key:"setCellTextStyle",value:function setCellTextStyle(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=Jn.setTextStyle(this._cellStyles[x],p)}},{key:"getCellTextStyle",value:function getCellTextStyle(t,h){var p=this.getCellReference(t,h);return Jn.getTextStyle(this._cellStyles[p])}},{key:"setCellTextStyleByRef",value:function setCellTextStyleByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellTextStyle(p.row,p.col,h),!0)}},{key:"setBatchCellTextStyle",value:function setBatchCellTextStyle(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellTextStyleByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellTextStyle(t.row,t.col,h)}))}},{key:"setCellTextAngle",value:function setCellTextAngle(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=Jn.setTextAngle(this._cellStyles[x],p)}},{key:"getCellTextAngle",value:function getCellTextAngle(t,h){var p=this.getCellReference(t,h);return Jn.getTextAngle(this._cellStyles[p])}},{key:"setCellTextAngleByRef",value:function setCellTextAngleByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellTextAngle(p.row,p.col,h),!0)}},{key:"setBatchCellTextAngle",value:function setBatchCellTextAngle(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellTextAngleByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellTextAngle(t.row,t.col,h)}))}},{key:"setCellBorderLineWeight",value:function setCellBorderLineWeight(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=Jn.setBorderLineWeight(this._cellStyles[x],p)}},{key:"getCellBorderLineWeight",value:function getCellBorderLineWeight(t,h){var p=this.getCellReference(t,h);return Jn.getBorderLineWeight(this._cellStyles[p])}},{key:"setCellBorderLineWeightByRef",value:function setCellBorderLineWeightByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellBorderLineWeight(p.row,p.col,h),!0)}},{key:"setBatchCellBorderLineWeight",value:function setBatchCellBorderLineWeight(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellBorderLineWeightByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellBorderLineWeight(t.row,t.col,h)}))}},{key:"setCellBorderLineType",value:function setCellBorderLineType(t,h,p){this.assertWrite();var x=this.getCellReference(t,h);this._cellStyles[x]=Jn.setBorderLineType(this._cellStyles[x],p)}},{key:"getCellBorderLineType",value:function getCellBorderLineType(t,h){var p=this.getCellReference(t,h);return Jn.getBorderLineType(this._cellStyles[p])}},{key:"setCellBorderLineTypeByRef",value:function setCellBorderLineTypeByRef(t,h){var p=this.getCellFromReference(t);return!!p&&(this.setCellBorderLineType(p.row,p.col,h),!0)}},{key:"setBatchCellBorderLineType",value:function setBatchCellBorderLineType(t,h){var p=this;this.assertWrite(),t.forEach((function(t){"string"==typeof t?p.setCellBorderLineTypeByRef(t,h):t&&"object"===_typeof$1(t)&&"row"in t&&"col"in t&&p.setCellBorderLineType(t.row,t.col,h)}))}},{key:"isMergedCellSelected",value:function isMergedCellSelected(){if(!this)return!1;var t=this.getSelectedCells();if(0===t.length)return!1;var h=this.getMergeCells();if(!h||0===h.length)return!1;var p,x=_createForOfIteratorHelper$3(t);try{for(x.s();!(p=x.n()).done;){var M,k=p.value,I=_createForOfIteratorHelper$3(h);try{for(I.s();!(M=I.n()).done;){var N=M.value;if(k.row>=N.row&&k.row<N.row+N.rowspan&&k.col>=N.col&&k.col<N.col+N.colspan)return!0}}catch(V){I.e(V)}finally{I.f()}}}catch(V){x.e(V)}finally{x.f()}return!1}},{key:"hasUnmergedCellsSelected",value:function hasUnmergedCellsSelected(){if(!this)return!1;var t=this.getSelectedCells();if(0===t.length)return!1;var h=this.getMergeCells();if(!h||0===h.length)return!0;var p,x=_createForOfIteratorHelper$3(t);try{for(x.s();!(p=x.n()).done;){var M,k=p.value,I=!1,N=_createForOfIteratorHelper$3(h);try{for(N.s();!(M=N.n()).done;){var V=M.value;if(k.row>=V.row&&k.row<V.row+V.rowspan&&k.col>=V.col&&k.col<V.col+V.colspan){I=!0;break}}}catch(ee){N.e(ee)}finally{N.f()}if(!I)return!0}}catch(ee){x.e(ee)}finally{x.f()}return!1}},{key:"updateMergeCellsAfterRowInsert",value:function updateMergeCellsAfterRowInsert(t){if(this){var h=this.getMergeCells().map((function(h){return h.row>=t?_objectSpread(_objectSpread({},h),{},{row:h.row+1}):h}));this.setMergeCells(h)}}},{key:"updateSelectedCells",value:function updateSelectedCells(t,h){this.setSelectedCells(t),h&&h(t)}},{key:"insertRow",value:function insertRow(t,h){if(this)try{var p=this.xlsxData?JSON.parse(atob(this.xlsxData)):[];if(!Array.isArray(p))return;var x=this.getSelectionRange();if(!x)return;var M="above"===t?x.minRow:x.maxRow+1;if(0===p.length)p.push([]);else{var k,I=0,N=_createForOfIteratorHelper$3(p);try{for(N.s();!(k=N.n()).done;){var V=k.value;I=Math.max(I,V.length)}}catch(re){N.e(re)}finally{N.f()}var ee=Array(I).fill(null);p.splice(M,0,ee)}this.xlsxData=btoa(JSON.stringify(p)),this.updateMergeCellsAfterRowInsert(M);var te=this.getSelectedCells().map((function(h){return"above"===t&&h.row>=M||"below"===t&&h.row>M?_objectSpread(_objectSpread({},h),{},{row:h.row+1}):h}));this.updateSelectedCells(te,h)}catch(ne){}}},{key:"updateMergeCellsAfterRowDelete",value:function updateMergeCellsAfterRowDelete(t,h){if(this){var p,x=[],M=_createForOfIteratorHelper$3(this.getMergeCells());try{for(M.s();!(p=M.n()).done;){var k=p.value;k.row>=t&&k.row<=h||(k.row>h?x.push(_objectSpread(_objectSpread({},k),{},{row:k.row-(h-t+1)})):x.push(k))}}catch(I){M.e(I)}finally{M.f()}this.setMergeCells(x)}}},{key:"deleteRow",value:function deleteRow(t){if(this)try{var h=this.xlsxData?JSON.parse(atob(this.xlsxData)):[];if(!Array.isArray(h)||0===h.length)return;var p=this.getSelectionRange();if(!p)return;if(h.length<=p.maxRow-p.minRow+1)return;h.splice(p.minRow,p.maxRow-p.minRow+1),this.xlsxData=btoa(JSON.stringify(h)),this.updateMergeCellsAfterRowDelete(p.minRow,p.maxRow);var x,M=this.getSelectedCells(),k=[],I=_createForOfIteratorHelper$3(M);try{for(I.s();!(x=I.n()).done;){var N=x.value;N.row>=p.minRow&&N.row<=p.maxRow||(N.row>p.maxRow?k.push({row:N.row-(p.maxRow-p.minRow+1),col:N.col}):k.push(N))}}catch(ee){I.e(ee)}finally{I.f()}if(0===k.length&&h.length>0){var V=Math.min(p.minRow,h.length-1);h[V]&&h[V].length>0&&k.push({row:V,col:0})}this.updateSelectedCells(k,t)}catch(te){}}},{key:"updateMergeCellsAfterColumnInsert",value:function updateMergeCellsAfterColumnInsert(t){if(this){var h=this.getMergeCells().map((function(h){return h.col>=t?_objectSpread(_objectSpread({},h),{},{col:h.col+1}):h}));this.setMergeCells(h)}}},{key:"insertColumn",value:function insertColumn(t,h){if(this)try{var p=this.xlsxData?JSON.parse(atob(this.xlsxData)):[];if(!Array.isArray(p))return;var x=this.getSelectionRange();if(!x)return;for(var M="left"===t?x.minCol:x.maxCol+1,k=0;k<p.length;k++)Array.isArray(p[k])||(p[k]=[]),p[k].splice(M,0,null);this.xlsxData=btoa(JSON.stringify(p)),this.updateMergeCellsAfterColumnInsert(M);var I=this.getSelectedCells().map((function(h){return"left"===t&&h.col>=M||"right"===t&&h.col>M?_objectSpread(_objectSpread({},h),{},{col:h.col+1}):h}));this.updateSelectedCells(I,h)}catch(N){}}},{key:"updateMergeCellsAfterColumnDelete",value:function updateMergeCellsAfterColumnDelete(t,h){if(this){var p,x=[],M=_createForOfIteratorHelper$3(this.getMergeCells());try{for(M.s();!(p=M.n()).done;){var k=p.value;k.col>=t&&k.col<=h||(k.col>h?x.push(_objectSpread(_objectSpread({},k),{},{col:k.col-(h-t+1)})):x.push(k))}}catch(I){M.e(I)}finally{M.f()}this.setMergeCells(x)}}},{key:"deleteColumn",value:function deleteColumn(t){if(this)try{var h,p=this.xlsxData?JSON.parse(atob(this.xlsxData)):[];if(!Array.isArray(p)||0===p.length)return;var x=this.getSelectionRange();if(!x)return;var M,k=!1,I=_createForOfIteratorHelper$3(p);try{for(I.s();!(M=I.n()).done;){var N=M.value;if(Array.isArray(N)&&N.length>x.maxCol-x.minCol+1){k=!0;break}}}catch(oe){I.e(oe)}finally{I.f()}if(!k)return;for(var V=0;V<p.length;V++)Array.isArray(p[V])&&p[V].splice(x.minCol,x.maxCol-x.minCol+1);this.xlsxData=btoa(JSON.stringify(p)),this.updateMergeCellsAfterColumnDelete(x.minCol,x.maxCol);var ee,te=this.getSelectedCells(),re=[],ne=_createForOfIteratorHelper$3(te);try{for(ne.s();!(ee=ne.n()).done;){var ie=ee.value;ie.col>=x.minCol&&ie.col<=x.maxCol||(ie.col>x.maxCol?re.push({row:ie.row,col:ie.col-(x.maxCol-x.minCol+1)}):re.push(ie))}}catch(oe){ne.e(oe)}finally{ne.f()}if(0===re.length&&p.length>0&&(null===(h=p[0])||void 0===h?void 0:h.length)>0){var ae=Math.min(x.minCol,p[0].length-1);ae>=0&&re.push({row:0,col:ae})}this.updateSelectedCells(re,t)}catch(se){}}},{key:"mergeCells",value:function mergeCells(t){if(this)try{if(this.getSelectedCells().length<=1)return;var h=this.getSelectionRange();if(!h)return;var p,x={row:h.minRow,col:h.minCol,rowspan:h.maxRow-h.minRow+1,colspan:h.maxCol-h.minCol+1},mergeCells=this.getMergeCells(),M=[],k=[],I=_createForOfIteratorHelper$3(mergeCells);try{for(I.s();!(p=I.n()).done;){var N=p.value,V=N.row+N.rowspan-1,ee=N.col+N.colspan-1;if(!(V<h.minRow||N.row>h.maxRow||ee<h.minCol||N.col>h.maxCol)){var te=this.getCellValue(N.row,N.col);null!=te&&""!==te&&k.push({value:te,row:N.row,col:N.col})}else M.push(N)}}catch(fe){I.e(fe)}finally{I.f()}var re,ne=new Map,ie=_createForOfIteratorHelper$3(mergeCells);try{for(ie.s();!(re=ie.n()).done;)for(var ae=re.value,oe=ae.row;oe<ae.row+ae.rowspan;oe++)for(var se=ae.col;se<ae.col+ae.colspan;se++)ne.set("".concat(oe,",").concat(se),!0)}catch(fe){ie.e(fe)}finally{ie.f()}for(var ce=h.minRow;ce<=h.maxRow;ce++)for(var ue=h.minCol;ue<=h.maxCol;ue++)if(!ne.has("".concat(ce,",").concat(ue))){var le=this.getCellValue(ce,ue);null!=le&&""!==le&&k.push({value:le,row:ce,col:ue})}M.push(x),this.setMergeCells(M),k.length>0&&(k.sort((function(t,p){return Math.abs(t.row-h.minRow)+Math.abs(t.col-h.minCol)-(Math.abs(p.row-h.minRow)+Math.abs(p.col-h.minCol))})),this.setCellValue(h.minRow,h.minCol,k[0].value));var he=[{row:h.minRow,col:h.minCol}];this.updateSelectedCells(he,t)}catch(de){}}},{key:"unMergeCells",value:function unMergeCells(t){if(this)try{var h=this.getMergeCells();if(0===h.length)return;var p=this.getSelectedCells();if(0===p.length)return;var x=[],M=h.filter((function(t){var h,M=_createForOfIteratorHelper$3(p);try{for(M.s();!(h=M.n()).done;){var k=h.value;if(k.row>=t.row&&k.row<t.row+t.rowspan&&k.col>=t.col&&k.col<t.col+t.colspan){for(var I=t.row;I<t.row+t.rowspan;I++)for(var N=t.col;N<t.col+t.colspan;N++)x.push({row:I,col:N});return!1}}}catch(V){M.e(V)}finally{M.f()}return!0}));this.setMergeCells(M),x.length>0&&this.updateSelectedCells(x,t)}catch(k){}}},{key:"setAlignment",value:function setAlignment(t,h){if(this)try{var p=this.getSelectedCells();if(0===p.length)return;var x,M=_createForOfIteratorHelper$3(p);try{for(M.s();!(x=M.n()).done;){var k=x.value;this.setCellAlignment(k.row,k.col,t)}}catch(I){M.e(I)}finally{M.f()}this.updateSelectedCells(p,h)}catch(N){}}},{key:"setVerticalAlignment",value:function setVerticalAlignment(t,h){if(this)try{var p=this.getSelectedCells();if(0===p.length)return;var x,M=_createForOfIteratorHelper$3(p);try{for(M.s();!(x=M.n()).done;){var k=x.value;this.setCellVerticalAlignment(k.row,k.col,t)}}catch(I){M.e(I)}finally{M.f()}this.updateSelectedCells(p,h)}catch(N){}}},{key:"setSelectCellBackgroundColor",value:function setSelectCellBackgroundColor(t,h){if(this)try{var p=this.getSelectedCells();if(0===p.length)return;this.setBatchCellBackgroundColor(p,t),this.updateSelectedCells(p,h),this.updateDisplay()}catch(x){}}},{key:"setSelectCellTextColor",value:function setSelectCellTextColor(t,h){if(this)try{var p=this.getSelectedCells();if(0===p.length)return;this.setBatchCellTextColor(p,t),this.updateSelectedCells(p,h)}catch(x){}}},{key:"getSelectCellBackgroundColor",value:function getSelectCellBackgroundColor(){if(!this)return null;try{var t=this.getSelectedCells();return 0===t.length?null:this.getCellBackgroundColor(t[0].row,t[0].col)}catch(h){return null}}},{key:"getSelectCellTextColor",value:function getSelectCellTextColor(){if(!this)return null;try{var t=this.getSelectedCells();return 0===t.length?null:this.getCellTextColor(t[0].row,t[0].col)}catch(h){return null}}}]),McDbXlsxTable}(sr);function _createSuper$1(t){var h=function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}function _createForOfIteratorHelper$2(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$2(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$2(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$2(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$2(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}var ei=function getNumberToMcCmColor(t){var h=new Cr;try{if(t>=Bi.kByblock&&t<=Bi.kBylayer)h.setColorIndex(t),Bi.kByblock===t?h.method=Ii.kByBlock:Bi.kBylayer===t?h.method=Ii.kByLayer:h.method=Ii.kByACI;else{var p=t.toString(16).padStart(6,"0"),x=parseInt(p.substring(0,2),16),M=parseInt(p.substring(2,4),16),k=parseInt(p.substring(4,6),16);h.setRGB(x,M,k),h.method=Ii.kByColor}return h}catch(I){return h.setRGB(255,255,255),h.method=Ii.kByColor,h}},ti="STANDARD";var ri=function(t){return t[t.No=-1]="No",t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Bottom=2]="Bottom",t}(ri||{});var ni=function(h){_inherits$1(McDbMLine,h);var p=_createSuper$1(McDbMLine);function McDbMLine(t){var h;return _classCallCheck$1(this,McDbMLine),_defineProperty(_assertThisInitialized$1(h=p.call(this,t)),"vertices",[]),_defineProperty(_assertThisInitialized$1(h),"styleName",""),_defineProperty(_assertThisInitialized$1(h),"justification",-1),_defineProperty(_assertThisInitialized$1(h),"scale",10),_defineProperty(_assertThisInitialized$1(h),"isClosed",!1),_defineProperty(_assertThisInitialized$1(h),"currentStyle",null),_defineProperty(_assertThisInitialized$1(h),"segmentRelations",{}),h}return _createClass$1(McDbMLine,[{key:"setSegmentRelation",value:function setSegmentRelation(t,h,p){this.assertWrite(),this.segmentRelations[t]||(this.segmentRelations[t]={});var x=p.map((function(t){var h=_slicedToArray$1(t,2),p=h[0],x=h[1];return[p.clone(),x.clone()]})),M=this.segmentRelations[t][h]||[],k=x.filter((function(t){var h=_slicedToArray$1(t,2),p=h[0],x=h[1];return!M.some((function(t){var h=_slicedToArray$1(t,2),M=h[0],k=h[1];return p.isEqualTo(M)&&x.isEqualTo(k)||p.isEqualTo(k)&&x.isEqualTo(M)}))}));M.length>0?(M.push.apply(M,_toConsumableArray(k)),this.segmentRelations[t][h]=M):this.segmentRelations[t][h]=k}},{key:"getSegmentRelation",value:function getSegmentRelation(t,h){return this.segmentRelations&&this.segmentRelations[t]?void 0!==h?this.segmentRelations[t][h]||null:this.segmentRelations[t]:null}},{key:"getAllSegmentRelations",value:function getAllSegmentRelations(){return this.segmentRelations?this.segmentRelations:{}}},{key:"setAllSegmentRelations",value:function setAllSegmentRelations(t){var h=this;for(var p in this.assertWrite(),this.segmentRelations||(this.segmentRelations={}),t){var x=Number(p);this.segmentRelations[x]||(this.segmentRelations[x]={});var M=function _loop(){var p=Number(k),M=t[x][p].map((function(t){var h=_slicedToArray$1(t,2),p=h[0],x=h[1];return[p.clone(),x.clone()]})),I=h.segmentRelations[x][p]||[],N=M.filter((function(t){var h=_slicedToArray$1(t,2),p=h[0],x=h[1];return!I.some((function(t){var h=_slicedToArray$1(t,2),M=h[0],k=h[1];return p.isEqualTo(M)&&x.isEqualTo(k)||p.isEqualTo(k)&&x.isEqualTo(M)}))}));I.length>0?(I.push.apply(I,_toConsumableArray(N)),h.segmentRelations[x][p]=I):h.segmentRelations[x][p]=N};for(var k in t[x])M()}}},{key:"mergeSegmentRelation",value:function mergeSegmentRelation(t,h,p,x){this.assertWrite();var M=this.getSegmentRelation(t,h);if(M&&0!==M.length){var k=function excludeRelationFromRelations(t,h){if(!t||0===t.length)return t;var p=_slicedToArray$1(h,2),x=p[0],M=p[1],k=M.x-x.x,I=M.y-x.y,N=M.z-x.z,V=k*k+I*I+N*N;if(0===V)return t;var ee=1e-10;function projectPointToParam(t){var h=t.x-x.x,p=t.y-x.y,M=t.z-x.z;return(h*k+p*I+M*N)/V}function paramToRealPoint(t){return new rn(x.x+k*t,x.y+I*t,x.z+N*t)}function getSplitIntervals(t,h){var p=[];if(t>h){var x=[h,t];t=x[0],h=x[1]}return h<-1e-10||t>1+ee?(p.push([t,h]),p):(t<-1e-10&&p.push([t,0]),h>1+ee&&p.push([1,h]),p)}var te,re=[],ne=_createForOfIteratorHelper$2(t);try{for(ne.s();!(te=ne.n()).done;){var ie=_slicedToArray$1(te.value,2),ae=ie[0],oe=ie[1],se=projectPointToParam(ae),ce=projectPointToParam(oe),ue=getSplitIntervals(Math.min(se,ce),Math.max(se,ce));if(0!==ue.length){var le,he=_createForOfIteratorHelper$2(ue);try{for(he.s();!(le=he.n()).done;){var fe=_slicedToArray$1(le.value,2),de=fe[0],pe=fe[1];if(Math.abs(pe-de)>ee){var me=paramToRealPoint(de),ge=paramToRealPoint(pe);re.push([me,ge])}}}catch(ve){he.e(ve)}finally{he.f()}}}}catch(ve){ne.e(ve)}finally{ne.f()}return re}(M,[p.clone(),x.clone()]);this.segmentRelations[t]||(this.segmentRelations[t]={}),this.segmentRelations[t][h]=k}}},{key:"clearSegmentRelation",value:function clearSegmentRelation(t,h){this.assertWrite(),this.segmentRelations[t]&&(void 0!==h?this.segmentRelations[t][h]&&delete this.segmentRelations[t][h]:delete this.segmentRelations[t])}},{key:"elementOffsets",get:function get(){var t,h=this,p=((null===(t=this.currentStyle)||void 0===t?void 0:t.elements)||[]).map((function(t){return t.offset*h.scale}));if(p.length>0){for(var x=[],M=_toConsumableArray(p).sort((function(t,h){return h-t})),k=0,I=M.length-1;k<=I;){if(k===I){x.push(M[k]);break}x.push(M[k++]),x.push(M[I--])}return x}return p}},{key:"create",value:function create(t){return new McDbMLine(t)}},{key:"getTypeName",value:function getTypeName(){return"McDbMLine"}},{key:"dwgInFields",value:function dwgInFields(t){this.vertices=t.readPoints("vertices").val,this.styleName=t.readString("styleName").val,this.justification=t.readLong("justification").val,this.scale=t.readDouble("scale").val;try{var h=t.readLong("isClosed").val;this.isClosed=1===h}catch(Vf){this.isClosed=!1}return!0}},{key:"dwgOutFields",value:function dwgOutFields(t){return t.writePoints("vertices",this.vertices),t.writeString("styleName",this.styleName),t.writeLong("justification",this.justification),t.writeDouble("scale",this.scale),t.writeLong("isClosed",this.isClosed?1:0),!0}},{key:"moveGripPointsAt",value:function moveGripPointsAt(t,h,p,x){if(this.assertWrite(),t>=0&&t<this.vertices.length){var M=this.vertices[t].clone();this.vertices[t].x+=h,this.vertices[t].y+=p,this.vertices[t].z+=x,this.handleSegmentRelationsAfterMove(t,M)}}},{key:"handleSegmentRelationsAfterMove",value:function handleSegmentRelationsAfterMove(t,h){if(t>0){var p=t-1;if(this.segmentRelations[p]){var x=this.vertices[p],M=h.sub(x).normalize(),k=this.vertices[t].sub(x).normalize();M.isEqualTo(k)||this.clearSegmentRelation(p)}}if(t<this.vertices.length-1){var I=t;if(this.segmentRelations[I]){var N=this.vertices[t+1],V=N.sub(h).normalize(),ee=N.sub(this.vertices[t]).normalize();V.isEqualTo(ee)||this.clearSegmentRelation(I)}}}},{key:"getGripPoints",value:function getGripPoints(){var t=new ln;return this.vertices.forEach((function(h){t.append(h)})),t}},{key:"worldDraw",value:function worldDraw(t){var h,p,x=this;if(!(this.vertices.length<2)&&0!==this.styleName.length&&(this.currentStyle=function readDbString(t,h){var p=t.getNamedObjectsDictionary().getAt("McDbMLineStyleDictionary");if(!p.isNull()){var x=p.getMcDbDictionary();if(x){var M=x.getAt(h);if(M.isNull())return;var k=M.getMcDbXrecord();if(k){var I=k.getData();try{return JSON.parse(I.AtString(0).val)}catch(N){return}}}}}(t.getDatabase(),this.styleName),this.styleName!==ti||this.currentStyle||(this.currentStyle=this.getDefaultStyle()),this.currentStyle)){null===(h=this.currentStyle)||void 0===h||h.elements.sort((function(t,h){return h.offset-t.offset}));for(var M=[],k=(null===(p=this.currentStyle)||void 0===p?void 0:p.elements)||[],I=0,N=k.length-1;I<=N;){if(I===N&&this.currentStyle){M.push(this.currentStyle.elements[I]);break}M.push(k[I++]),M.push(k[N--])}this.currentStyle.elements=M;var V=this.elementOffsets.map((function(t){return x.getOffsetPolylinePoints(t)}));this.isClosed||(this.drawCaps(t,V,this.currentStyle.startCaps,!0),this.drawCaps(t,V,this.currentStyle.endCaps,!1)),this.drawMlines(t,V),this.currentStyle.displayJoints&&this.drawJoints(t,V),this.currentStyle.fill.enabled&&this.drawFill(t,V)}}},{key:"getSegmentByPoint",value:function getSegmentByPoint(t){var h,p=this;if(this.vertices.length<2)return null;if(!this.currentStyle&&(this.styleName===ti&&(this.currentStyle=this.getDefaultStyle()),!this.currentStyle))return null;this.currentStyle.elements.sort((function(t,h){return h.offset-t.offset}));for(var x=[],M=(null===(h=this.currentStyle)||void 0===h?void 0:h.elements)||[],k=0,I=M.length-1;k<=I;){if(k===I&&this.currentStyle){x.push(this.currentStyle.elements[k]);break}x.push(M[k++]),x.push(M[I--])}this.currentStyle.elements=x;for(var N=this.elementOffsets.map((function(t){return p.getOffsetPolylinePoints(t)})),V=-1,ee=-1,te=null,re=Number.MAX_VALUE,ne=0;ne<N.length;ne++)for(var ie=N[ne],ae=0;ae<ie.length-1;ae++){var oe=ie[ae],se=ie[ae+1];if(oe&&se){var ce=new Bt(oe,se).getClosestPointTo(t,!1);if(ce&&ce.ret){var ue=ce.val,le=ue.distanceTo(t);if(le<re){var he=ue.distanceTo(oe),fe=ue.distanceTo(se),de=oe.distanceTo(se);Math.abs(he+fe-de)<.001&&(re=le,V=ae,ee=ne,te=ue.clone())}}}}if(V>=0&&ee>=0&&te){var pe=N.map((function(t){return V<t.length-1?[t[V],t[V+1]]:[]}));return{segmentIndex:V,elementIndex:ee,clickPoint:te,allOffsetLines:pe}}return null}},{key:"getSegmentByIndex",value:function getSegmentByIndex(t){var h,p=this;if(this.vertices.length<2||t<0||t>=this.vertices.length-1)return null;if(!this.currentStyle&&(this.styleName===ti&&(this.currentStyle=this.getDefaultStyle()),!this.currentStyle))return null;this.currentStyle.elements.sort((function(t,h){return h.offset-t.offset}));for(var x=[],M=(null===(h=this.currentStyle)||void 0===h?void 0:h.elements)||[],k=0,I=M.length-1;k<=I;){if(k===I&&this.currentStyle){x.push(this.currentStyle.elements[k]);break}x.push(M[k++]),x.push(M[I--])}this.currentStyle.elements=x;var N=this.elementOffsets.map((function(t){return p.getOffsetPolylinePoints(t)})),V=this.vertices[t],ee=this.vertices[t+1],te=new rn((V.x+ee.x)/2,(V.y+ee.y)/2,(V.z+ee.z)/2),re=N.map((function(h){return t<h.length-1?[h[t],h[t+1]]:[]}));return{segmentIndex:t,elementIndex:0,clickPoint:te,allOffsetLines:re}}},{key:"getOffsetPolylinePoints",value:function getOffsetPolylinePoints(h){if(this.vertices.length<2)return[];for(var p=this.calculateAlignedOffset(h),x=[],M=0;M<this.vertices.length-1;M++)this.vertices[M+1]&&x.push(new Bt(this.vertices[M],this.vertices[M+1]));this.isClosed&&this.vertices.length>=2&&x.push(new Bt(this.vertices[this.vertices.length-1],this.vertices[0]));for(var k=[],I=0;I<x.length;I++){var N=x[I],V=N.endPoint.sub(N.startPoint).normalize(),ee=V.perpVector().normalize(),te=N.startPoint.clone().addvec(V.mult(N.startPoint.distanceTo(N.endPoint)/2)).clone().addvec(ee.mult(p)),re=Math.abs(p),ne=N.offsetCurves(re,te);ne.length()>0?k.push(ne.aryVal[0]):k.push(N.clone())}var ie=[];if(this.isClosed&&k.length>=3){var ae,oe=k.length-1,se=k[oe].IntersectWith(k[0],t.McDb.Intersect.kExtendBoth);ae=se.length()>0?se.at(0):new rn((k[oe].endPoint.x+k[0].startPoint.x)/2,(k[oe].endPoint.y+k[0].startPoint.y)/2,(k[oe].endPoint.z+k[0].startPoint.z)/2),ie.push(ae);for(var ce=0;ce<k.length-1;ce++){var ue=k[ce].IntersectWith(k[ce+1],t.McDb.Intersect.kExtendBoth);ue.length()>0?ie.push(ue.at(0)):ie.push(k[ce].endPoint)}ie.push(ae)}else{ie.push(k[0].startPoint);for(var le=0;le<k.length;le++){var he=(le+1)%k.length;if(le===k.length-1&&!this.isClosed){ie.push(k[le].endPoint);break}var fe=k[le].IntersectWith(k[he],t.McDb.Intersect.kExtendBoth);if(fe.length()>0?ie.push(fe.at(0)):ie.push(k[le].endPoint),le===k.length-1&&this.isClosed)break}}return ie}},{key:"calculateAlignedOffset",value:function calculateAlignedOffset(t){if(!this.currentStyle||0===this.currentStyle.elements.length)return t;var h=Math.max.apply(Math,_toConsumableArray(this.elementOffsets)),p=Math.min.apply(Math,_toConsumableArray(this.elementOffsets)),x=(h+p)/2;switch(this.justification){case-1:return t;case 0:return t-h;case 1:return t-x;case 2:return t-p;default:return t-x}}},{key:"drawMlines",value:function drawMlines(t,h){var p=this;!this.currentStyle||this.vertices.length<2||this.currentStyle.elements.forEach((function(x,M){p.drawOffsetLine(t,h[M],x,M)}))}},{key:"drawOffsetLine",value:function drawOffsetLine(t,h,p,x){var M=this;if(h&&!(h.length<2)){var k=ei(p.color);t.trueColor=k;for(var I=!1,N=0;N<h.length-1;N++){if(this.getSegmentRelation(N,x)){I=!0;break}}if(!I){var V=new Gt;return h.forEach((function(t){return V.addVertexAt(t)})),this.isClosed&&(V.isClosed=!0),t.drawEntity(V),void t.drawOsnapEntity(V)}for(var ee=function _loop2(){var p=h[te],k=h[te+1],I=M.getSegmentRelation(te,x);if(I&&I.length>0){if(I=function mergeClippingRegions(t){if(!t||t.length<=1)return t;var h=_slicedToArray$1(t[0],2),p=h[0],x=h[1],M=p.clone(),k=x.clone(),I=k.x-M.x,N=k.y-M.y,V=k.z-M.z,ee=I*I+N*N+V*V;if(0===ee)return[];function projectPointToParam(t){var h=t.x-M.x,p=t.y-M.y,x=t.z-M.z;return(h*I+p*N+x*V)/ee}function paramToRealPoint(t){return new rn(M.x+I*t,M.y+N*t,M.z+V*t)}var te,re=[],ne=_createForOfIteratorHelper$2(t);try{for(ne.s();!(te=ne.n()).done;){var ie=_slicedToArray$1(te.value,2),ae=ie[0],oe=ie[1],se=projectPointToParam(ae),ce=projectPointToParam(oe),ue=Math.min(se,ce),le=Math.max(se,ce);Math.abs(le-ue)>1e-10&&re.push({tStart:ue,tEnd:le})}}catch(_e){ne.e(_e)}finally{ne.f()}re.sort((function(t,h){return t.tStart-h.tStart}));for(var he=[],fe=0,de=re;fe<de.length;fe++){var pe=de[fe];!he.length||pe.tStart>he[he.length-1].tEnd+1e-10?he.push({tStart:pe.tStart,tEnd:pe.tEnd}):he[he.length-1].tEnd=Math.max(he[he.length-1].tEnd,pe.tEnd)}for(var me=[],ge=0,ve=he;ge<ve.length;ge++){var ye=ve[ge],be=ye.tStart,xe=ye.tEnd,Me=paramToRealPoint(be),we=paramToRealPoint(xe);me.push([Me,we])}return me}(I),I.some((function(t){var h=_slicedToArray$1(t,2),x=h[0],M=h[1];return x.isEqualTo(p)&&M.isEqualTo(k)||x.isEqualTo(k)&&M.isEqualTo(p)})))return 0;var N=k.sub(p),V=p.distanceTo(k);if(V<1e-6)return 0;var ee=[[0,1]];I.forEach((function(t){var h=_slicedToArray$1(t,2),x=h[0],M=h[1],k=function projectPointToParam(t){return t.sub(p).dotProduct(N)/(V*V)},I=k(x),te=k(M),re=Math.max(0,Math.min(I,te)),ne=Math.min(1,Math.max(I,te));if(ne-re>1e-10)for(var ie=ee.length-1;ie>=0;ie--){var ae=_slicedToArray$1(ee[ie],2),oe=ae[0],se=ae[1];re<=oe&&ne>=se?ee.splice(ie,1):re>oe&&ne<se?ee.splice(ie,1,[oe,re],[ne,se]):re<=oe&&ne>oe&&ne<se?ee[ie]=[ne,se]:re>oe&&re<se&&ne>=se&&(ee[ie]=[oe,re])}}));for(var re=function paramToPoint(t){return new rn(p.x+N.x*t,p.y+N.y*t,p.z+N.z*t)},ne=0,ie=ee;ne<ie.length;ne++){var ae=_slicedToArray$1(ie[ne],2),oe=ae[0],se=ae[1];if(se-oe>1e-10){var ce=re(oe),ue=re(se),le=new Bt(ce,ue);t.drawEntity(le),t.drawOsnapEntity(le)}}}else{var he=new Bt(p,k);t.drawEntity(he),t.drawOsnapEntity(he)}},te=0;te<h.length-1;te++)ee()}}},{key:"drawFill",value:function drawFill(t,h){if(this.currentStyle&&this.currentStyle.fill.enabled&&!(this.vertices.length<2)&&!(h.length<2)){var p=this.elementOffsets.indexOf(Math.max.apply(Math,_toConsumableArray(this.elementOffsets))),x=this.elementOffsets.indexOf(Math.min.apply(Math,_toConsumableArray(this.elementOffsets))),M=_toConsumableArray(h[p]),k=_toConsumableArray(h[x]).reverse(),I=new ln;if(this.isClosed){for(var N=0;N<M.length-1;N++)I.append(M[N]);for(var V=0;V<k.length-1;V++)I.append(k[V]);var ee=I.at(0),te=I.at(I.length()-1);ee.isEqualTo(te)||I.append(ee.clone())}else M.forEach((function(t){return I.append(t)})),k.forEach((function(t){return I.append(t)}));var re=new McDbHatch;re.appendLoop(I);var ne=ei(this.currentStyle.fill.color);re.trueColor=ne,t.drawEntity(re)}}},{key:"drawCaps",value:function drawCaps(h,p,x,M){var k=this;if(this.currentStyle){var I,N,V=Math.max.apply(Math,_toConsumableArray(this.elementOffsets)),ee=Math.min.apply(Math,_toConsumableArray(this.elementOffsets)),te=this.elementOffsets.indexOf(V),re=this.elementOffsets.indexOf(ee);if(M){var ne;I=p[te][0],N=p[re][0],p.forEach((function(h){var x;if("number"==typeof(null===(x=k.currentStyle)||void 0===x?void 0:x.startCaps.angle)){var M=h[0],V=h[1],ee=new Bt(I,N),te=I;if(-1===k.justification){var re=k.elementOffsets.findIndex((function(t){return Math.abs(t)<1e-4}));te=re>=0&&p[re]?p[re][0]:ee.getPointAtParam(.5).val}else 0===k.justification?te=I:2===k.justification?te=N:1===k.justification&&(te=ee.getPointAtParam(.5).val);ee.rotate(te,THREE.MathUtils.degToRad(k.currentStyle.startCaps.angle-90));var ne=ee.IntersectWith(new Bt(M,V),t.McDb.Intersect.kExtendBoth);ne.length()>0&&(h[0]=ne.at(0))}})),"number"==typeof(null===(ne=this.currentStyle)||void 0===ne?void 0:ne.startCaps.angle)&&(I=p[te][0],N=p[re][0])}else{var ie,ae=p[te].length-1,oe=p[re].length-1;I=p[te][ae],N=p[re][oe],p.forEach((function(h){var x;if("number"==typeof(null===(x=k.currentStyle)||void 0===x?void 0:x.endCaps.angle)){var M=h[h.length-2],V=h[h.length-1],ee=new Bt(I,N),te=I;if(-1===k.justification){var re=k.elementOffsets.findIndex((function(t){return Math.abs(t)<1e-4}));te=re>=0&&p[re]?p[re][p[re].length-1]:ee.getPointAtParam(.5).val}else 0===k.justification?te=I:2===k.justification?te=N:1===k.justification&&(te=ee.getPointAtParam(.5).val);ee.rotate(te,THREE.MathUtils.degToRad(k.currentStyle.endCaps.angle-90));var ne=ee.IntersectWith(new Bt(M,V),t.McDb.Intersect.kExtendBoth);ne.length()>0&&(h[h.length-1]=ne.at(0))}})),"number"==typeof(null===(ie=this.currentStyle)||void 0===ie?void 0:ie.endCaps.angle)&&(I=p[te][ae],N=p[re][oe])}var se=new rn((I.x+N.x)/2,(I.y+N.y)/2,0),ce=I.sub(se).normalize().perpVector(),ue=se.distanceTo(I);if(x.line){var le=ei(this.currentStyle.elements[te].color),he=ei(this.currentStyle.elements[re].color);h.trueColor=le;var fe=new Bt(I,se);h.drawEntity(fe);var de=new Bt(N,se);h.trueColor=he,h.drawEntity(de)}if(x.outerArc){var pe=ei(this.currentStyle.elements[te].color),me=ei(this.currentStyle.elements[re].color);this.drawCapArc(h,I,se.clone().addvec(M?ce.clone().mult(ue):ce.clone().negate().mult(ue)),N,M?pe:me)}if(x.innerArc){var ge=this.elementOffsets.map((function(t,h){var p;return{offset:t,index:h,color:null===(p=k.currentStyle)||void 0===p?void 0:p.elements[h].color}})),ve=_toConsumableArray(ge).sort((function(t,h){return h.offset-t.offset}))[0],ye=_toConsumableArray(ge).sort((function(t,h){return t.offset-h.offset}))[0],be=[ve.index,ye.index],xe=ge.filter((function(t){return!be.includes(t.index)}));if(xe.sort((function(t,h){return t.offset-h.offset})),xe.length>0)for(var Me=_toConsumableArray(xe),we=function _loop3(){var t=Me.reduce((function(t,h){return h.offset>t.offset?h:t}),Me[0]),x=Me.reduce((function(t,h){return h.offset<t.offset?h:t}),Me[0]),I=M?p[t.index][0]:p[t.index][p[t.index].length-1],N=M?p[x.index][0]:p[x.index][p[x.index].length-1],V=new rn((I.x+N.x)/2,(I.y+N.y)/2,0),ee=I.distanceTo(N)/2,te=N.sub(V).normalize().perpVector().normalize(),re=V.clone().addvec(M?te.negate().mult(ee):te.mult(ee)),ne=ei(k.currentStyle.elements[t.index].color),ie=ei(k.currentStyle.elements[x.index].color);k.drawCapArc(h,I,re,N,M?ne:ie),Me=Me.filter((function(h){return h.index!==t.index&&h.index!==x.index}))};Me.length>1;)we()}}}},{key:"drawCapArc",value:function drawCapArc(t,h,p,x,M){var k=new Xt;k.computeArc(h.x,h.y,p.x,p.y,x.x,x.y),t.trueColor=M,t.drawEntity(k)}},{key:"getDefaultStyle",value:function getDefaultStyle(){return{name:"STANDARD",description:"",elements:[{offset:.5,color:256,lineType:"ByLayer"},{offset:0,color:256,lineType:"ByLayer"}],startCaps:{line:!1,outerArc:!1,innerArc:!1,angle:90},endCaps:{line:!1,outerArc:!1,innerArc:!1,angle:90},fill:{enabled:!1,color:256},displayJoints:!1}}},{key:"setStyleName",value:function setStyleName(t){this.assertWrite(),this.styleName=t}},{key:"getStyleName",value:function getStyleName(){return this.styleName}},{key:"setJustification",value:function setJustification(t){this.assertWrite(),t>=-1&&t<=2&&(this.justification=t)}},{key:"getJustification",value:function getJustification(){return this.justification}},{key:"setScale",value:function setScale(t){this.assertWrite(),t>0&&(this.scale=t)}},{key:"getScale",value:function getScale(){return this.scale}},{key:"addVertex",value:function addVertex(t){this.assertWrite(),this.vertices.push(t.clone())}},{key:"insertVertexAt",value:function insertVertexAt(t,h){return this.assertWrite(),!(t<0||t>this.vertices.length)&&(this.vertices.splice(t,0,h.clone()),!0)}},{key:"getVertices",value:function getVertices(){return this.vertices}},{key:"getVertexCount",value:function getVertexCount(){return this.vertices.length}},{key:"getVertexAt",value:function getVertexAt(t){return t>=0&&t<this.vertices.length?this.vertices[t].clone():null}},{key:"setVertexAt",value:function setVertexAt(t,h){this.assertWrite(),t>=0&&t<this.vertices.length&&(this.vertices[t]=h.clone())}},{key:"removeVertexAt",value:function removeVertexAt(t){this.assertWrite(),t>=0&&t<this.vertices.length&&this.vertices.splice(t,1)}},{key:"clearVertices",value:function clearVertices(){this.assertWrite(),this.vertices=[]}},{key:"drawJoints",value:function drawJoints(t,h){if(this.currentStyle&&!(this.vertices.length<3)&&!(h.length<2)){for(var p=0;p<h.length;p++)if(!h[p]||h[p].length<this.vertices.length)return;var x=this.elementOffsets.indexOf(Math.max.apply(Math,_toConsumableArray(this.elementOffsets))),M=this.elementOffsets.indexOf(Math.min.apply(Math,_toConsumableArray(this.elementOffsets)));if(2!==h.length||x!==M)for(var k=1;k<this.vertices.length-1;k++){for(var I=0,N=0,V=0,ee=[],te=0;te<h.length;te++)if(te<h.length&&k<h[te].length){var re=h[te][k];re&&(I+=re.x,N+=re.y,V++,ee.push({pt:re,index:te}))}if(0!==V)for(var ne=new rn(I/V,N/V,0),ie=0,ae=ee;ie<ae.length;ie++){var oe=ae[ie],se=oe.pt,ce=oe.index,ue=ei(this.currentStyle.elements[ce].color);t.trueColor=ue;var le=new Bt(ne,se);t.drawEntity(le)}}else for(var he=1;he<this.vertices.length-1;he++){var fe=h[0][he],de=h[1][he];if(fe&&de){var pe=new Bt(fe,de),me=ei(this.currentStyle.elements[0].color);t.trueColor=me,t.drawEntity(pe)}}}}},{key:"setIsClosed",value:function setIsClosed(t){this.assertWrite(),this.isClosed=t}},{key:"getIsClosed",value:function getIsClosed(){return this.isClosed}}]),McDbMLine}(sr);function __awaiter(t,h,p,x){return new(p||(p=Promise))((function(M,k){function fulfilled(t){try{step(x.next(t))}catch(Vf){k(Vf)}}function rejected(t){try{step(x.throw(t))}catch(Vf){k(Vf)}}function step(t){t.done?M(t.value):function adopt(t){return t instanceof p?t:new p((function(h){h(t)}))}(t.value).then(fulfilled,rejected)}step((x=x.apply(t,h||[])).next())}))}function __generator(t,h){var p,x,M,k,I={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return k={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k;function verb(N){return function(V){return function step(N){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,N[0]&&(I=0)),I;)try{if(p=1,x&&(M=2&N[0]?x.return:N[0]?x.throw||((M=x.return)&&M.call(x),0):x.next)&&!(M=M.call(x,N[1])).done)return M;switch(x=0,M&&(N=[2&N[0],M.value]),N[0]){case 0:case 1:M=N;break;case 4:return I.label++,{value:N[1],done:!1};case 5:I.label++,x=N[1],N=[0];continue;case 7:N=I.ops.pop(),I.trys.pop();continue;default:if(!(M=I.trys,(M=M.length>0&&M[M.length-1])||6!==N[0]&&2!==N[0])){I=0;continue}if(3===N[0]&&(!M||N[1]>M[0]&&N[1]<M[3])){I.label=N[1];break}if(6===N[0]&&I.label<M[1]){I.label=M[1],M=N;break}if(M&&I.label<M[2]){I.label=M[2],I.ops.push(N);break}M[2]&&I.ops.pop(),I.trys.pop();continue}N=h.call(t,I)}catch(Vf){N=[6,Vf],x=0}finally{p=M=0}if(5&N[0])throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}([N,V])}}}function __spreadArray(t,h,p){if(p||2===arguments.length)for(var x,M=0,k=h.length;M<k;M++)!x&&M in h||(x||(x=Array.prototype.slice.call(h,0,M)),x[M]=h[M]);return t.concat(x||Array.prototype.slice.call(h))}"function"==typeof SuppressedError&&SuppressedError;var ii="4.5.0";function wait(t,h){return new Promise((function(p){return setTimeout(p,t,h)}))}function isPromise(t){return!!t&&"function"==typeof t.then}function awaitIfAsync(t,h){try{var p=t();isPromise(p)?p.then((function(t){return h(!0,t)}),(function(t){return h(!1,t)})):h(!0,p)}catch(x){h(!1,x)}}function mapWithBreaks(t,h,p){return void 0===p&&(p=16),__awaiter(this,void 0,void 0,(function(){var x,M,k,I;return __generator(this,(function(N){switch(N.label){case 0:x=Array(t.length),M=Date.now(),k=0,N.label=1;case 1:return k<t.length?(x[k]=h(t[k],k),(I=Date.now())>=M+p?(M=I,[4,new Promise((function(t){var h=new MessageChannel;h.port1.onmessage=function(){return t()},h.port2.postMessage(null)}))]):[3,3]):[3,4];case 2:N.sent(),N.label=3;case 3:return++k,[3,1];case 4:return[2,x]}}))}))}function suppressUnhandledRejectionWarning(t){return t.then(void 0,(function(){})),t}function toInt(t){return parseInt(t)}function toFloat(t){return parseFloat(t)}function replaceNaN(t,h){return"number"==typeof t&&isNaN(t)?h:t}function countTruthy(t){return t.reduce((function(t,h){return t+(h?1:0)}),0)}function round(t,h){if(void 0===h&&(h=1),Math.abs(h)>=1)return Math.round(t/h)*h;var p=1/h;return Math.round(t*p)/p}function x64Add(t,h){var p=t[0]>>>16,x=65535&t[0],M=t[1]>>>16,k=65535&t[1],I=h[0]>>>16,N=65535&h[0],V=h[1]>>>16,ee=0,te=0,re=0,ne=0;re+=(ne+=k+(65535&h[1]))>>>16,ne&=65535,te+=(re+=M+V)>>>16,re&=65535,ee+=(te+=x+N)>>>16,te&=65535,ee+=p+I,ee&=65535,t[0]=ee<<16|te,t[1]=re<<16|ne}function x64Multiply(t,h){var p=t[0]>>>16,x=65535&t[0],M=t[1]>>>16,k=65535&t[1],I=h[0]>>>16,N=65535&h[0],V=h[1]>>>16,ee=65535&h[1],te=0,re=0,ne=0,ie=0;ne+=(ie+=k*ee)>>>16,ie&=65535,re+=(ne+=M*ee)>>>16,ne&=65535,re+=(ne+=k*V)>>>16,ne&=65535,te+=(re+=x*ee)>>>16,re&=65535,te+=(re+=M*V)>>>16,re&=65535,te+=(re+=k*N)>>>16,re&=65535,te+=p*ee+x*V+M*N+k*I,te&=65535,t[0]=te<<16|re,t[1]=ne<<16|ie}function x64Rotl(t,h){var p=t[0];32===(h%=64)?(t[0]=t[1],t[1]=p):h<32?(t[0]=p<<h|t[1]>>>32-h,t[1]=t[1]<<h|p>>>32-h):(h-=32,t[0]=t[1]<<h|p>>>32-h,t[1]=p<<h|t[1]>>>32-h)}function x64LeftShift(t,h){0!==(h%=64)&&(h<32?(t[0]=t[1]>>>32-h,t[1]=t[1]<<h):(t[0]=t[1]<<h-32,t[1]=0))}function x64Xor(t,h){t[0]^=h[0],t[1]^=h[1]}var ai=[4283543511,3981806797],oi=[3301882366,444984403];function x64Fmix(t){var h=[0,t[0]>>>1];x64Xor(t,h),x64Multiply(t,ai),h[1]=t[0]>>>1,x64Xor(t,h),x64Multiply(t,oi),h[1]=t[0]>>>1,x64Xor(t,h)}var si=[2277735313,289559509],ci=[1291169091,658871167],ui=[0,5],li=[0,1390208809],hi=[0,944331445];function x64hash128(t,h){var p=function getUTF8Bytes(t){for(var h=new Uint8Array(t.length),p=0;p<t.length;p++){var x=t.charCodeAt(p);if(x>127)return(new TextEncoder).encode(t);h[p]=x}return h}(t);h=h||0;var x,M=[0,p.length],k=M[1]%16,I=M[1]-k,N=[0,h],V=[0,h],ee=[0,0],te=[0,0];for(x=0;x<I;x+=16)ee[0]=p[x+4]|p[x+5]<<8|p[x+6]<<16|p[x+7]<<24,ee[1]=p[x]|p[x+1]<<8|p[x+2]<<16|p[x+3]<<24,te[0]=p[x+12]|p[x+13]<<8|p[x+14]<<16|p[x+15]<<24,te[1]=p[x+8]|p[x+9]<<8|p[x+10]<<16|p[x+11]<<24,x64Multiply(ee,si),x64Rotl(ee,31),x64Multiply(ee,ci),x64Xor(N,ee),x64Rotl(N,27),x64Add(N,V),x64Multiply(N,ui),x64Add(N,li),x64Multiply(te,ci),x64Rotl(te,33),x64Multiply(te,si),x64Xor(V,te),x64Rotl(V,31),x64Add(V,N),x64Multiply(V,ui),x64Add(V,hi);ee[0]=0,ee[1]=0,te[0]=0,te[1]=0;var re=[0,0];switch(k){case 15:re[1]=p[x+14],x64LeftShift(re,48),x64Xor(te,re);case 14:re[1]=p[x+13],x64LeftShift(re,40),x64Xor(te,re);case 13:re[1]=p[x+12],x64LeftShift(re,32),x64Xor(te,re);case 12:re[1]=p[x+11],x64LeftShift(re,24),x64Xor(te,re);case 11:re[1]=p[x+10],x64LeftShift(re,16),x64Xor(te,re);case 10:re[1]=p[x+9],x64LeftShift(re,8),x64Xor(te,re);case 9:re[1]=p[x+8],x64Xor(te,re),x64Multiply(te,ci),x64Rotl(te,33),x64Multiply(te,si),x64Xor(V,te);case 8:re[1]=p[x+7],x64LeftShift(re,56),x64Xor(ee,re);case 7:re[1]=p[x+6],x64LeftShift(re,48),x64Xor(ee,re);case 6:re[1]=p[x+5],x64LeftShift(re,40),x64Xor(ee,re);case 5:re[1]=p[x+4],x64LeftShift(re,32),x64Xor(ee,re);case 4:re[1]=p[x+3],x64LeftShift(re,24),x64Xor(ee,re);case 3:re[1]=p[x+2],x64LeftShift(re,16),x64Xor(ee,re);case 2:re[1]=p[x+1],x64LeftShift(re,8),x64Xor(ee,re);case 1:re[1]=p[x],x64Xor(ee,re),x64Multiply(ee,si),x64Rotl(ee,31),x64Multiply(ee,ci),x64Xor(N,ee)}return x64Xor(N,M),x64Xor(V,M),x64Add(N,V),x64Add(V,N),x64Fmix(N),x64Fmix(V),x64Add(N,V),x64Add(V,N),("00000000"+(N[0]>>>0).toString(16)).slice(-8)+("00000000"+(N[1]>>>0).toString(16)).slice(-8)+("00000000"+(V[0]>>>0).toString(16)).slice(-8)+("00000000"+(V[1]>>>0).toString(16)).slice(-8)}function loadSources(t,h,p,x){var M=Object.keys(t).filter((function(t){return function excludes(t,h){return!function includes(t,h){for(var p=0,x=t.length;p<x;++p)if(t[p]===h)return!0;return!1}(t,h)}(p,t)})),k=suppressUnhandledRejectionWarning(mapWithBreaks(M,(function(p){return function loadSource(t,h){var p=suppressUnhandledRejectionWarning(new Promise((function(p){var x=Date.now();awaitIfAsync(t.bind(null,h),(function(){for(var t=[],h=0;h<arguments.length;h++)t[h]=arguments[h];var M=Date.now()-x;if(!t[0])return p((function(){return{error:t[1],duration:M}}));var k=t[1];if(function isFinalResultLoaded(t){return"function"!=typeof t}(k))return p((function(){return{value:k,duration:M}}));p((function(){return new Promise((function(t){var h=Date.now();awaitIfAsync(k,(function(){for(var p=[],x=0;x<arguments.length;x++)p[x]=arguments[x];var k=M+Date.now()-h;if(!p[0])return t({error:p[1],duration:k});t({value:p[1],duration:k})}))}))}))}))})));return function getComponent(){return p.then((function(t){return t()}))}}(t[p],h)}),x));return function getComponents(){return __awaiter(this,void 0,void 0,(function(){var t,h,p,I;return __generator(this,(function(N){switch(N.label){case 0:return[4,k];case 1:return[4,mapWithBreaks(N.sent(),(function(t){return suppressUnhandledRejectionWarning(t())}),x)];case 2:return t=N.sent(),[4,Promise.all(t)];case 3:for(h=N.sent(),p={},I=0;I<M.length;++I)p[M[I]]=h[I];return[2,p]}}))}))}}function isTrident(){var t=window,h=navigator;return countTruthy(["MSCSSMatrix"in t,"msSetImmediate"in t,"msIndexedDB"in t,"msMaxTouchPoints"in h,"msPointerEnabled"in h])>=4}function isChromium(){var t=window,h=navigator;return countTruthy(["webkitPersistentStorage"in h,"webkitTemporaryStorage"in h,0===h.vendor.indexOf("Google"),"webkitResolveLocalFileSystemURL"in t,"BatteryManager"in t,"webkitMediaStream"in t,"webkitSpeechGrammar"in t])>=5}function isWebKit(){var t=window;return countTruthy(["ApplePayError"in t,"CSSPrimitiveValue"in t,"Counter"in t,0===navigator.vendor.indexOf("Apple"),"RGBColor"in t,"WebKitMediaKeys"in t])>=4}function isDesktopWebKit(){var t=window,h=t.HTMLElement,p=t.Document;return countTruthy(["safari"in t,!("ongestureend"in t),!("TouchEvent"in t),!("orientation"in t),h&&!("autocapitalize"in h.prototype),p&&"pointerLockElement"in p.prototype])>=4}function isSafariWebKit(){var t=window;return function isFunctionNative(t){return/^function\s.*?\{\s*\[native code]\s*}$/.test(String(t))}(t.print)&&"[object WebPageNamespace]"===String(t.browser)}function isGecko(){var t,h,p=window;return countTruthy(["buildID"in navigator,"MozAppearance"in(null!==(h=null===(t=document.documentElement)||void 0===t?void 0:t.style)&&void 0!==h?h:{}),"onmozfullscreenchange"in p,"mozInnerScreenX"in p,"CSSMozDocumentRule"in p,"CanvasCaptureMediaStream"in p])>=4}function isWebKit616OrNewer(){var t=window,h=navigator,p=t.CSS,x=t.HTMLButtonElement;return countTruthy([!("getStorageUpdates"in h),x&&"popover"in x.prototype,"CSSCounterStyleRule"in t,p.supports("font-size-adjust: ex-height 0.5"),p.supports("text-transform: full-width")])>=4}function isAndroid(){var t=isChromium(),h=isGecko(),p=window,x=navigator,M="connection";return t?countTruthy([!("SharedWorker"in p),x[M]&&"ontypechange"in x[M],!("sinkId"in new window.Audio)])>=2:!!h&&countTruthy(["onorientationchange"in p,"orientation"in p,/android/i.test(navigator.appVersion)])>=2}function makeInnerError(t){var h=new Error(t);return h.name=t,h}function withIframe(t,h,p){var x,M,k;return void 0===p&&(p=50),__awaiter(this,void 0,void 0,(function(){var I,N;return __generator(this,(function(V){switch(V.label){case 0:I=document,V.label=1;case 1:return I.body?[3,3]:[4,wait(p)];case 2:return V.sent(),[3,1];case 3:N=I.createElement("iframe"),V.label=4;case 4:return V.trys.push([4,,10,11]),[4,new Promise((function(t,p){var x=!1,resolve=function(){x=!0,t()};N.onload=resolve,N.onerror=function(t){x=!0,p(t)};var M=N.style;M.setProperty("display","block","important"),M.position="absolute",M.top="0",M.left="0",M.visibility="hidden",h&&"srcdoc"in N?N.srcdoc=h:N.src="about:blank",I.body.appendChild(N);var checkReadyState=function(){var t,h;x||("complete"===(null===(h=null===(t=N.contentWindow)||void 0===t?void 0:t.document)||void 0===h?void 0:h.readyState)?resolve():setTimeout(checkReadyState,10))};checkReadyState()}))];case 5:V.sent(),V.label=6;case 6:return(null===(M=null===(x=N.contentWindow)||void 0===x?void 0:x.document)||void 0===M?void 0:M.body)?[3,8]:[4,wait(p)];case 7:return V.sent(),[3,6];case 8:return[4,t(N,N.contentWindow)];case 9:return[2,V.sent()];case 10:return null===(k=N.parentNode)||void 0===k||k.removeChild(N),[7];case 11:return[2]}}))}))}function selectorToElement(t){for(var h=function parseSimpleCssSelector(t){for(var h,p,x="Unexpected syntax '".concat(t,"'"),M=/^\s*([a-z-]*)(.*)$/i.exec(t),k=M[1]||void 0,I={},N=/([.:#][\w-]+|\[.+?\])/gi,addAttribute=function(t,h){I[t]=I[t]||[],I[t].push(h)};;){var V=N.exec(M[2]);if(!V)break;var ee=V[0];switch(ee[0]){case".":addAttribute("class",ee.slice(1));break;case"#":addAttribute("id",ee.slice(1));break;case"[":var te=/^\[([\w-]+)([~|^$*]?=("(.*?)"|([\w-]+)))?(\s+[is])?\]$/.exec(ee);if(!te)throw new Error(x);addAttribute(te[1],null!==(p=null!==(h=te[4])&&void 0!==h?h:te[5])&&void 0!==p?p:"");break;default:throw new Error(x)}}return[k,I]}(t),p=h[0],x=h[1],M=document.createElement(null!=p?p:"div"),k=0,I=Object.keys(x);k<I.length;k++){var N=I[k],V=x[N].join(" ");"style"===N?addStyleString(M.style,V):M.setAttribute(N,V)}return M}function addStyleString(t,h){for(var p=0,x=h.split(";");p<x.length;p++){var M=x[p],k=/^\s*([\w-]+)\s*:\s*(.+?)(\s*!([\w-]+))?\s*$/.exec(M);if(k){var I=k[1],N=k[2],V=k[4];t.setProperty(I,N,V||"")}}}var fi=["monospace","sans-serif","serif"],di=["sans-serif-thin","ARNO PRO","Agency FB","Arabic Typesetting","Arial Unicode MS","AvantGarde Bk BT","BankGothic Md BT","Batang","Bitstream Vera Sans Mono","Calibri","Century","Century Gothic","Clarendon","EUROSTILE","Franklin Gothic","Futura Bk BT","Futura Md BT","GOTHAM","Gill Sans","HELV","Haettenschweiler","Helvetica Neue","Humanst521 BT","Leelawadee","Letter Gothic","Levenim MT","Lucida Bright","Lucida Sans","Menlo","MS Mincho","MS Outlook","MS Reference Specialty","MS UI Gothic","MT Extra","MYRIAD PRO","Marlett","Meiryo UI","Microsoft Uighur","Minion Pro","Monotype Corsiva","PMingLiU","Pristina","SCRIPTINA","Segoe UI Light","Serifa","SimHei","Small Fonts","Staccato222 BT","TRAJAN PRO","Univers CE 55 Medium","Vrinda","ZWAdobeF"];function canvasToString(t){return t.toDataURL()}var pi,mi,gi=2500;function getUnstableScreenFrame(){var t=this;return function watchScreenFrame(){if(void 0===mi){var checkScreenFrame=function(){var t=getCurrentScreenFrame();isFrameSizeNull(t)?mi=setTimeout(checkScreenFrame,gi):(pi=t,mi=void 0)};checkScreenFrame()}}(),function(){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(h){switch(h.label){case 0:return isFrameSizeNull(t=getCurrentScreenFrame())?pi?[2,__spreadArray([],pi,!0)]:function getFullscreenElement(){var t=document;return t.fullscreenElement||t.msFullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||null}()?[4,(p=document,(p.exitFullscreen||p.msExitFullscreen||p.mozCancelFullScreen||p.webkitExitFullscreen).call(p))]:[3,2]:[3,2];case 1:h.sent(),t=getCurrentScreenFrame(),h.label=2;case 2:return isFrameSizeNull(t)||(pi=t),[2,t]}var p}))}))}}function getCurrentScreenFrame(){var t=screen;return[replaceNaN(toFloat(t.availTop),null),replaceNaN(toFloat(t.width)-toFloat(t.availWidth)-replaceNaN(toFloat(t.availLeft),0),null),replaceNaN(toFloat(t.height)-toFloat(t.availHeight)-replaceNaN(toFloat(t.availTop),0),null),replaceNaN(toFloat(t.availLeft),null)]}function isFrameSizeNull(t){for(var h=0;h<4;++h)if(t[h])return!1;return!0}function getBlockedSelectors(t){var h;return __awaiter(this,void 0,void 0,(function(){var p,x,M,k,I,N,V;return __generator(this,(function(ee){switch(ee.label){case 0:for(p=document,x=p.createElement("div"),M=new Array(t.length),k={},forceShow(x),V=0;V<t.length;++V)"DIALOG"===(I=selectorToElement(t[V])).tagName&&I.show(),forceShow(N=p.createElement("div")),N.appendChild(I),x.appendChild(N),M[V]=I;ee.label=1;case 1:return p.body?[3,3]:[4,wait(50)];case 2:return ee.sent(),[3,1];case 3:p.body.appendChild(x);try{for(V=0;V<t.length;++V)M[V].offsetParent||(k[t[V]]=!0)}finally{null===(h=x.parentNode)||void 0===h||h.removeChild(x)}return[2,k]}}))}))}function forceShow(t){t.style.setProperty("visibility","hidden","important"),t.style.setProperty("display","block","important")}function doesMatch$5(t){return matchMedia("(inverted-colors: ".concat(t,")")).matches}function doesMatch$4(t){return matchMedia("(forced-colors: ".concat(t,")")).matches}function doesMatch$3(t){return matchMedia("(prefers-contrast: ".concat(t,")")).matches}function doesMatch$2(t){return matchMedia("(prefers-reduced-motion: ".concat(t,")")).matches}function doesMatch$1(t){return matchMedia("(prefers-reduced-transparency: ".concat(t,")")).matches}function doesMatch(t){return matchMedia("(dynamic-range: ".concat(t,")")).matches}var vi=Math,fallbackFn=function(){return 0};var yi={default:[],apple:[{font:"-apple-system-body"}],serif:[{fontFamily:"serif"}],sans:[{fontFamily:"sans-serif"}],mono:[{fontFamily:"monospace"}],min:[{fontSize:"1px"}],system:[{fontFamily:"system-ui"}]};var bi=function isAnyParentCrossOrigin(){for(var t=window;;){var h=t.parent;if(!h||h===t)return!1;try{if(h.location.origin!==t.location.origin)return!0}catch(p){if(p instanceof Error&&"SecurityError"===p.name)return!0;throw p}t=h}};var xi=new Set([10752,2849,2884,2885,2886,2928,2929,2930,2931,2932,2960,2961,2962,2963,2964,2965,2966,2967,2968,2978,3024,3042,3088,3089,3106,3107,32773,32777,32777,32823,32824,32936,32937,32938,32939,32968,32969,32970,32971,3317,33170,3333,3379,3386,33901,33902,34016,34024,34076,3408,3410,3411,3412,3413,3414,3415,34467,34816,34817,34818,34819,34877,34921,34930,35660,35661,35724,35738,35739,36003,36004,36005,36347,36348,36349,37440,37441,37443,7936,7937,7938]),Mi=new Set([34047,35723,36063,34852,34853,34854,34229,36392,36795,38449]),_i=["FRAGMENT_SHADER","VERTEX_SHADER"],Ci=["LOW_FLOAT","MEDIUM_FLOAT","HIGH_FLOAT","LOW_INT","MEDIUM_INT","HIGH_INT"],Si="WEBGL_debug_renderer_info";function getWebGLContext(t){if(t.webgl)return t.webgl.context;var h,p=document.createElement("canvas");p.addEventListener("webglCreateContextError",(function(){return h=void 0}));for(var x=0,M=["webgl","experimental-webgl"];x<M.length;x++){var k=M[x];try{h=p.getContext(k)}catch(I){}if(h)break}return t.webgl={context:h},h}function getShaderPrecision(t,h,p){var x=t.getShaderPrecisionFormat(t[h],t[p]);return x?[x.rangeMin,x.rangeMax,x.precision]:[]}function getConstantsFromPrototype(t){return Object.keys(t.__proto__).filter(isConstantLike)}function isConstantLike(t){return"string"==typeof t&&!t.match(/[^A-Z0-9_x]/)}function shouldAvoidDebugRendererInfo(){return isGecko()}function isValidParameterGetter(t){return"function"==typeof t.getParameter}var Ti={fonts:function getFonts(){var t=this;return withIframe((function(h,p){var x=p.document;return __awaiter(t,void 0,void 0,(function(){var t,h,p,M,k,I,N,V,ee,te,re;return __generator(this,(function(ne){for((t=x.body).style.fontSize="48px",(h=x.createElement("div")).style.setProperty("visibility","hidden","important"),p={},M={},k=function(t){var p=x.createElement("span"),M=p.style;return M.position="absolute",M.top="0",M.left="0",M.fontFamily=t,p.textContent="mmMwWLliI0O&1",h.appendChild(p),p},I=function(t,h){return k("'".concat(t,"',").concat(h))},N=function(){for(var t={},_loop_1=function(h){t[h]=fi.map((function(t){return I(h,t)}))},h=0,p=di;h<p.length;h++){_loop_1(p[h])}return t},V=function(t){return fi.some((function(h,x){return t[x].offsetWidth!==p[h]||t[x].offsetHeight!==M[h]}))},ee=function(){return fi.map(k)}(),te=N(),t.appendChild(h),re=0;re<fi.length;re++)p[fi[re]]=ee[re].offsetWidth,M[fi[re]]=ee[re].offsetHeight;return[2,di.filter((function(t){return V(te[t])}))]}))}))}))},domBlockers:function getDomBlockers(t){var h=(void 0===t?{}:t).debug;return __awaiter(this,void 0,void 0,(function(){var t,p,x,M,k;return __generator(this,(function(I){switch(I.label){case 0:return function isApplicable(){return isWebKit()||isAndroid()}()?(t=function getFilters(){var t=atob;return{abpIndo:["#Iklan-Melayang","#Kolom-Iklan-728","#SidebarIklan-wrapper",'[title="ALIENBOLA" i]',t("I0JveC1CYW5uZXItYWRz")],abpvn:[".quangcao","#mobileCatfish",t("LmNsb3NlLWFkcw=="),'[id^="bn_bottom_fixed_"]',"#pmadv"],adBlockFinland:[".mainostila",t("LnNwb25zb3JpdA=="),".ylamainos",t("YVtocmVmKj0iL2NsaWNrdGhyZ2guYXNwPyJd"),t("YVtocmVmXj0iaHR0cHM6Ly9hcHAucmVhZHBlYWsuY29tL2FkcyJd")],adBlockPersian:["#navbar_notice_50",".kadr",'TABLE[width="140px"]',"#divAgahi",t("YVtocmVmXj0iaHR0cDovL2cxLnYuZndtcm0ubmV0L2FkLyJd")],adBlockWarningRemoval:["#adblock-honeypot",".adblocker-root",".wp_adblock_detect",t("LmhlYWRlci1ibG9ja2VkLWFk"),t("I2FkX2Jsb2NrZXI=")],adGuardAnnoyances:[".hs-sosyal","#cookieconsentdiv",'div[class^="app_gdpr"]',".as-oil",'[data-cypress="soft-push-notification-modal"]'],adGuardBase:[".BetterJsPopOverlay",t("I2FkXzMwMFgyNTA="),t("I2Jhbm5lcmZsb2F0MjI="),t("I2NhbXBhaWduLWJhbm5lcg=="),t("I0FkLUNvbnRlbnQ=")],adGuardChinese:[t("LlppX2FkX2FfSA=="),t("YVtocmVmKj0iLmh0aGJldDM0LmNvbSJd"),"#widget-quan",t("YVtocmVmKj0iLzg0OTkyMDIwLnh5eiJd"),t("YVtocmVmKj0iLjE5NTZobC5jb20vIl0=")],adGuardFrench:["#pavePub",t("LmFkLWRlc2t0b3AtcmVjdGFuZ2xl"),".mobile_adhesion",".widgetadv",t("LmFkc19iYW4=")],adGuardGerman:['aside[data-portal-id="leaderboard"]'],adGuardJapanese:["#kauli_yad_1",t("YVtocmVmXj0iaHR0cDovL2FkMi50cmFmZmljZ2F0ZS5uZXQvIl0="),t("Ll9wb3BJbl9pbmZpbml0ZV9hZA=="),t("LmFkZ29vZ2xl"),t("Ll9faXNib29zdFJldHVybkFk")],adGuardMobile:[t("YW1wLWF1dG8tYWRz"),t("LmFtcF9hZA=="),'amp-embed[type="24smi"]',"#mgid_iframe1",t("I2FkX2ludmlld19hcmVh")],adGuardRussian:[t("YVtocmVmXj0iaHR0cHM6Ly9hZC5sZXRtZWFkcy5jb20vIl0="),t("LnJlY2xhbWE="),'div[id^="smi2adblock"]',t("ZGl2W2lkXj0iQWRGb3hfYmFubmVyXyJd"),"#psyduckpockeball"],adGuardSocial:[t("YVtocmVmXj0iLy93d3cuc3R1bWJsZXVwb24uY29tL3N1Ym1pdD91cmw9Il0="),t("YVtocmVmXj0iLy90ZWxlZ3JhbS5tZS9zaGFyZS91cmw/Il0="),".etsy-tweet","#inlineShare",".popup-social"],adGuardSpanishPortuguese:["#barraPublicidade","#Publicidade","#publiEspecial","#queTooltip",".cnt-publi"],adGuardTrackingProtection:["#qoo-counter",t("YVtocmVmXj0iaHR0cDovL2NsaWNrLmhvdGxvZy5ydS8iXQ=="),t("YVtocmVmXj0iaHR0cDovL2hpdGNvdW50ZXIucnUvdG9wL3N0YXQucGhwIl0="),t("YVtocmVmXj0iaHR0cDovL3RvcC5tYWlsLnJ1L2p1bXAiXQ=="),"#top100counter"],adGuardTurkish:["#backkapat",t("I3Jla2xhbWk="),t("YVtocmVmXj0iaHR0cDovL2Fkc2Vydi5vbnRlay5jb20udHIvIl0="),t("YVtocmVmXj0iaHR0cDovL2l6bGVuemkuY29tL2NhbXBhaWduLyJd"),t("YVtocmVmXj0iaHR0cDovL3d3dy5pbnN0YWxsYWRzLm5ldC8iXQ==")],bulgarian:[t("dGQjZnJlZW5ldF90YWJsZV9hZHM="),"#ea_intext_div",".lapni-pop-over","#xenium_hot_offers"],easyList:[".yb-floorad",t("LndpZGdldF9wb19hZHNfd2lkZ2V0"),t("LnRyYWZmaWNqdW5reS1hZA=="),".textad_headline",t("LnNwb25zb3JlZC10ZXh0LWxpbmtz")],easyListChina:[t("LmFwcGd1aWRlLXdyYXBbb25jbGljayo9ImJjZWJvcy5jb20iXQ=="),t("LmZyb250cGFnZUFkdk0="),"#taotaole","#aafoot.top_box",".cfa_popup"],easyListCookie:[".ezmob-footer",".cc-CookieWarning","[data-cookie-number]",t("LmF3LWNvb2tpZS1iYW5uZXI="),".sygnal24-gdpr-modal-wrap"],easyListCzechSlovak:["#onlajny-stickers",t("I3Jla2xhbW5pLWJveA=="),t("LnJla2xhbWEtbWVnYWJvYXJk"),".sklik",t("W2lkXj0ic2tsaWtSZWtsYW1hIl0=")],easyListDutch:[t("I2FkdmVydGVudGll"),t("I3ZpcEFkbWFya3RCYW5uZXJCbG9jaw=="),".adstekst",t("YVtocmVmXj0iaHR0cHM6Ly94bHR1YmUubmwvY2xpY2svIl0="),"#semilo-lrectangle"],easyListGermany:["#SSpotIMPopSlider",t("LnNwb25zb3JsaW5rZ3J1ZW4="),t("I3dlcmJ1bmdza3k="),t("I3Jla2xhbWUtcmVjaHRzLW1pdHRl"),t("YVtocmVmXj0iaHR0cHM6Ly9iZDc0Mi5jb20vIl0=")],easyListItaly:[t("LmJveF9hZHZfYW5udW5jaQ=="),".sb-box-pubbliredazionale",t("YVtocmVmXj0iaHR0cDovL2FmZmlsaWF6aW9uaWFkcy5zbmFpLml0LyJd"),t("YVtocmVmXj0iaHR0cHM6Ly9hZHNlcnZlci5odG1sLml0LyJd"),t("YVtocmVmXj0iaHR0cHM6Ly9hZmZpbGlhemlvbmlhZHMuc25haS5pdC8iXQ==")],easyListLithuania:[t("LnJla2xhbW9zX3RhcnBhcw=="),t("LnJla2xhbW9zX251b3JvZG9z"),t("aW1nW2FsdD0iUmVrbGFtaW5pcyBza3lkZWxpcyJd"),t("aW1nW2FsdD0iRGVkaWt1b3RpLmx0IHNlcnZlcmlhaSJd"),t("aW1nW2FsdD0iSG9zdGluZ2FzIFNlcnZlcmlhaS5sdCJd")],estonian:[t("QVtocmVmKj0iaHR0cDovL3BheTRyZXN1bHRzMjQuZXUiXQ==")],fanboyAnnoyances:["#ac-lre-player",".navigate-to-top","#subscribe_popup",".newsletter_holder","#back-top"],fanboyAntiFacebook:[".util-bar-module-firefly-visible"],fanboyEnhancedTrackers:[".open.pushModal","#issuem-leaky-paywall-articles-zero-remaining-nag","#sovrn_container",'div[class$="-hide"][zoompage-fontsize][style="display: block;"]',".BlockNag__Card"],fanboySocial:["#FollowUs","#meteored_share","#social_follow",".article-sharer",".community__social-desc"],frellwitSwedish:[t("YVtocmVmKj0iY2FzaW5vcHJvLnNlIl1bdGFyZ2V0PSJfYmxhbmsiXQ=="),t("YVtocmVmKj0iZG9rdG9yLXNlLm9uZWxpbmsubWUiXQ=="),"article.category-samarbete",t("ZGl2LmhvbGlkQWRz"),"ul.adsmodern"],greekAdBlock:[t("QVtocmVmKj0iYWRtYW4ub3RlbmV0LmdyL2NsaWNrPyJd"),t("QVtocmVmKj0iaHR0cDovL2F4aWFiYW5uZXJzLmV4b2R1cy5nci8iXQ=="),t("QVtocmVmKj0iaHR0cDovL2ludGVyYWN0aXZlLmZvcnRobmV0LmdyL2NsaWNrPyJd"),"DIV.agores300","TABLE.advright"],hungarian:["#cemp_doboz",".optimonk-iframe-container",t("LmFkX19tYWlu"),t("W2NsYXNzKj0iR29vZ2xlQWRzIl0="),"#hirdetesek_box"],iDontCareAboutCookies:['.alert-info[data-block-track*="CookieNotice"]',".ModuleTemplateCookieIndicator",".o--cookies--container","#cookies-policy-sticky","#stickyCookieBar"],icelandicAbp:[t("QVtocmVmXj0iL2ZyYW1ld29yay9yZXNvdXJjZXMvZm9ybXMvYWRzLmFzcHgiXQ==")],latvian:[t("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiAxMjBweDsgaGVpZ2h0OiA0MHB4OyBvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7Il0="),t("YVtocmVmPSJodHRwOi8vd3d3LnNhbGlkemluaS5sdi8iXVtzdHlsZT0iZGlzcGxheTogYmxvY2s7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDMxcHg7IG92ZXJmbG93OiBoaWRkZW47IHBvc2l0aW9uOiByZWxhdGl2ZTsiXQ==")],listKr:[t("YVtocmVmKj0iLy9hZC5wbGFuYnBsdXMuY28ua3IvIl0="),t("I2xpdmVyZUFkV3JhcHBlcg=="),t("YVtocmVmKj0iLy9hZHYuaW1hZHJlcC5jby5rci8iXQ=="),t("aW5zLmZhc3R2aWV3LWFk"),".revenue_unit_item.dable"],listeAr:[t("LmdlbWluaUxCMUFk"),".right-and-left-sponsers",t("YVtocmVmKj0iLmFmbGFtLmluZm8iXQ=="),t("YVtocmVmKj0iYm9vcmFxLm9yZyJd"),t("YVtocmVmKj0iZHViaXp6bGUuY29tL2FyLz91dG1fc291cmNlPSJd")],listeFr:[t("YVtocmVmXj0iaHR0cDovL3Byb21vLnZhZG9yLmNvbS8iXQ=="),t("I2FkY29udGFpbmVyX3JlY2hlcmNoZQ=="),t("YVtocmVmKj0id2Vib3JhbWEuZnIvZmNnaS1iaW4vIl0="),".site-pub-interstitiel",'div[id^="crt-"][data-criteo-id]'],officialPolish:["#ceneo-placeholder-ceneo-12",t("W2hyZWZePSJodHRwczovL2FmZi5zZW5kaHViLnBsLyJd"),t("YVtocmVmXj0iaHR0cDovL2Fkdm1hbmFnZXIudGVjaGZ1bi5wbC9yZWRpcmVjdC8iXQ=="),t("YVtocmVmXj0iaHR0cDovL3d3dy50cml6ZXIucGwvP3V0bV9zb3VyY2UiXQ=="),t("ZGl2I3NrYXBpZWNfYWQ=")],ro:[t("YVtocmVmXj0iLy9hZmZ0cmsuYWx0ZXgucm8vQ291bnRlci9DbGljayJd"),t("YVtocmVmXj0iaHR0cHM6Ly9ibGFja2ZyaWRheXNhbGVzLnJvL3Ryay9zaG9wLyJd"),t("YVtocmVmXj0iaHR0cHM6Ly9ldmVudC4ycGVyZm9ybWFudC5jb20vZXZlbnRzL2NsaWNrIl0="),t("YVtocmVmXj0iaHR0cHM6Ly9sLnByb2ZpdHNoYXJlLnJvLyJd"),'a[href^="/url/"]'],ruAd:[t("YVtocmVmKj0iLy9mZWJyYXJlLnJ1LyJd"),t("YVtocmVmKj0iLy91dGltZy5ydS8iXQ=="),t("YVtocmVmKj0iOi8vY2hpa2lkaWtpLnJ1Il0="),"#pgeldiz",".yandex-rtb-block"],thaiAds:["a[href*=macau-uta-popup]",t("I2Fkcy1nb29nbGUtbWlkZGxlX3JlY3RhbmdsZS1ncm91cA=="),t("LmFkczMwMHM="),".bumq",".img-kosana"],webAnnoyancesUltralist:["#mod-social-share-2","#social-tools",t("LmN0cGwtZnVsbGJhbm5lcg=="),".zergnet-recommend",".yt.btn-link.btn-md.btn"]}}(),p=Object.keys(t),[4,getBlockedSelectors((k=[]).concat.apply(k,p.map((function(h){return t[h]}))))]):[2,void 0];case 1:return x=I.sent(),h&&function printDebug(t,h){for(var p=0,x=Object.keys(t);p<x.length;p++){var M=x[p];"\n".concat(M,":");for(var k=0,I=t[M];k<I.length;k++){var N=I[k];"\n  ".concat(h[N]?"":""," ").concat(N)}}}(t,x),(M=p.filter((function(h){var p=t[h];return countTruthy(p.map((function(t){return x[t]})))>.6*p.length}))).sort(),[2,M]}}))}))},fontPreferences:function getFontPreferences(){return function withNaturalFonts(t,h){void 0===h&&(h=4e3);return withIframe((function(p,x){var M=x.document,k=M.body,I=k.style;I.width="".concat(h,"px"),I.webkitTextSizeAdjust=I.textSizeAdjust="none",isChromium()?k.style.zoom="".concat(1/x.devicePixelRatio):isWebKit()&&(k.style.zoom="reset");var N=M.createElement("div");return N.textContent=__spreadArray([],Array(h/20<<0),!0).map((function(){return"word"})).join(" "),k.appendChild(N),t(M,k)}),'<!doctype html><html><head><meta name="viewport" content="width=device-width, initial-scale=1">')}((function(t,h){for(var p={},x={},M=0,k=Object.keys(yi);M<k.length;M++){var I=k[M],N=yi[I],V=N[0],ee=void 0===V?{}:V,te=N[1],re=void 0===te?"mmMwWLliI0fiflO&1":te,ne=t.createElement("span");ne.textContent=re,ne.style.whiteSpace="nowrap";for(var ie=0,ae=Object.keys(ee);ie<ae.length;ie++){var oe=ae[ie],se=ee[oe];void 0!==se&&(ne.style[oe]=se)}p[I]=ne,h.append(t.createElement("br"),ne)}for(var ce=0,ue=Object.keys(yi);ce<ue.length;ce++){x[I=ue[ce]]=p[I].getBoundingClientRect().width}return x}))},audio:function getAudioFingerprint(){return function doesBrowserPerformAntifingerprinting$1(){return isWebKit()&&isWebKit616OrNewer()&&isSafariWebKit()}()?-4:function getUnstableAudioFingerprint(){var t=window,h=t.OfflineAudioContext||t.webkitOfflineAudioContext;if(!h)return-2;if(function doesBrowserSuspendAudioContext(){return isWebKit()&&!isDesktopWebKit()&&!function isWebKit606OrNewer(){var t=window;return countTruthy(["DOMRectList"in t,"RTCPeerConnectionIceEvent"in t,"SVGGeometryElement"in t,"ontransitioncancel"in t])>=3}()}())return-1;var p=4500,x=new h(1,5e3,44100),M=x.createOscillator();M.type="triangle",M.frequency.value=1e4;var k=x.createDynamicsCompressor();k.threshold.value=-50,k.knee.value=40,k.ratio.value=12,k.attack.value=0,k.release.value=.25,M.connect(k),k.connect(x.destination),M.start(0);var I=function startRenderingAudio(t){var h=3,p=500,x=500,M=5e3,finalize=function(){},k=new Promise((function(k,I){var N=!1,V=0,ee=0;t.oncomplete=function(t){return k(t.renderedBuffer)};var startRunningTimeout=function(){setTimeout((function(){return I(makeInnerError("timeout"))}),Math.min(x,ee+M-Date.now()))},tryRender=function(){try{var x=t.startRendering();switch(isPromise(x)&&suppressUnhandledRejectionWarning(x),t.state){case"running":ee=Date.now(),N&&startRunningTimeout();break;case"suspended":document.hidden||V++,N&&V>=h?I(makeInnerError("suspended")):setTimeout(tryRender,p)}}catch(M){I(M)}};tryRender(),finalize=function(){N||(N=!0,ee>0&&startRunningTimeout())}}));return[k,finalize]}(x),N=I[0],V=I[1],ee=suppressUnhandledRejectionWarning(N.then((function(t){return function getHash(t){for(var h=0,p=0;p<t.length;++p)h+=Math.abs(t[p]);return h}(t.getChannelData(0).subarray(p))}),(function(t){if("timeout"===t.name||"suspended"===t.name)return-3;throw t})));return function(){return V(),ee}}()},screenFrame:function getScreenFrame(){var t=this;if(isWebKit()&&isWebKit616OrNewer()&&isSafariWebKit())return function(){return Promise.resolve(void 0)};var h=getUnstableScreenFrame();return function(){return __awaiter(t,void 0,void 0,(function(){var t,p;return __generator(this,(function(x){switch(x.label){case 0:return[4,h()];case 1:return t=x.sent(),[2,[(p=function(t){return null===t?null:round(t,10)})(t[0]),p(t[1]),p(t[2]),p(t[3])]]}}))}))}},canvas:function getCanvasFingerprint(){return function getUnstableCanvasFingerprint(t){var h,p,x,M=!1,k=function makeCanvasContext(){var t=document.createElement("canvas");return t.width=1,t.height=1,[t,t.getContext("2d")]}(),I=k[0],N=k[1];!function isSupported(t,h){return!(!h||!t.toDataURL)}(I,N)?p=x="unsupported":(M=function doesSupportWinding(t){return t.rect(0,0,10,10),t.rect(2,2,6,6),!t.isPointInPath(5,5,"evenodd")}(N),t?p=x="skipped":(h=function renderImages(t,h){!function renderTextImage(t,h){t.width=240,t.height=60,h.textBaseline="alphabetic",h.fillStyle="#f60",h.fillRect(100,1,62,20),h.fillStyle="#069",h.font='11pt "Times New Roman"';var p="Cwm fjordbank gly ".concat(String.fromCharCode(55357,56835));h.fillText(p,2,15),h.fillStyle="rgba(102, 204, 0, 0.2)",h.font="18pt Arial",h.fillText(p,4,45)}(t,h);var p=canvasToString(t),x=canvasToString(t);if(p!==x)return["unstable","unstable"];!function renderGeometryImage(t,h){t.width=122,t.height=110,h.globalCompositeOperation="multiply";for(var p=0,x=[["#f2f",40,40],["#2ff",80,40],["#ff2",60,80]];p<x.length;p++){var M=x[p],k=M[0],I=M[1],N=M[2];h.fillStyle=k,h.beginPath(),h.arc(I,N,40,0,2*Math.PI,!0),h.closePath(),h.fill()}h.fillStyle="#f9c",h.arc(60,60,60,0,2*Math.PI,!0),h.arc(60,60,20,0,2*Math.PI,!0),h.fill("evenodd")}(t,h);var M=canvasToString(t);return[M,p]}(I,N),p=h[0],x=h[1]));return{winding:M,geometry:p,text:x}}(function doesBrowserPerformAntifingerprinting(){return isWebKit()&&isWebKit616OrNewer()&&isSafariWebKit()}())},osCpu:function getOsCpu(){return navigator.oscpu},languages:function getLanguages(){var t=navigator,h=[],p=t.language||t.userLanguage||t.browserLanguage||t.systemLanguage;if(void 0!==p&&h.push([p]),Array.isArray(t.languages))isChromium()&&function isChromium86OrNewer(){var t=window;return countTruthy([!("MediaSettingsRange"in t),"RTCEncodedAudioFrame"in t,""+t.Intl=="[object Intl]",""+t.Reflect=="[object Reflect]"])>=3}()||h.push(t.languages);else if("string"==typeof t.languages){var x=t.languages;x&&h.push(x.split(","))}return h},colorDepth:function getColorDepth(){return window.screen.colorDepth},deviceMemory:function getDeviceMemory(){return replaceNaN(toFloat(navigator.deviceMemory),void 0)},screenResolution:function getScreenResolution(){if(!(isWebKit()&&isWebKit616OrNewer()&&isSafariWebKit()))return function getUnstableScreenResolution(){var t=screen,parseDimension=function(t){return replaceNaN(toInt(t),null)},h=[parseDimension(t.width),parseDimension(t.height)];return h.sort().reverse(),h}()},hardwareConcurrency:function getHardwareConcurrency(){return replaceNaN(toInt(navigator.hardwareConcurrency),void 0)},timezone:function getTimezone(){var t,h=null===(t=window.Intl)||void 0===t?void 0:t.DateTimeFormat;if(h){var p=(new h).resolvedOptions().timeZone;if(p)return p}var x=-function getTimezoneOffset(){var t=(new Date).getFullYear();return Math.max(toFloat(new Date(t,0,1).getTimezoneOffset()),toFloat(new Date(t,6,1).getTimezoneOffset()))}();return"UTC".concat(x>=0?"+":"").concat(x)},sessionStorage:function getSessionStorage(){try{return!!window.sessionStorage}catch(t){return!0}},localStorage:function getLocalStorage(){try{return!!window.localStorage}catch(Vf){return!0}},indexedDB:function getIndexedDB(){if(!isTrident()&&!function isEdgeHTML(){var t=window,h=navigator;return countTruthy(["msWriteProfilerMark"in t,"MSStream"in t,"msLaunchUri"in h,"msSaveBlob"in h])>=3&&!isTrident()}())try{return!!window.indexedDB}catch(Vf){return!0}},openDatabase:function getOpenDatabase(){return!!window.openDatabase},cpuClass:function getCpuClass(){return navigator.cpuClass},platform:function getPlatform(){var t=navigator.platform;return"MacIntel"===t&&isWebKit()&&!isDesktopWebKit()?function isIPad(){if("iPad"===navigator.platform)return!0;var t=screen,h=t.width/t.height;return countTruthy(["MediaSource"in window,!!Element.prototype.webkitRequestFullscreen,h>.65&&h<1.53])>=2}()?"iPad":"iPhone":t},plugins:function getPlugins(){var t=navigator.plugins;if(t){for(var h=[],p=0;p<t.length;++p){var x=t[p];if(x){for(var M=[],k=0;k<x.length;++k){var I=x[k];M.push({type:I.type,suffixes:I.suffixes})}h.push({name:x.name,description:x.description,mimeTypes:M})}}return h}},touchSupport:function getTouchSupport(){var t,h=navigator,p=0;void 0!==h.maxTouchPoints?p=toInt(h.maxTouchPoints):void 0!==h.msMaxTouchPoints&&(p=h.msMaxTouchPoints);try{document.createEvent("TouchEvent"),t=!0}catch(x){t=!1}return{maxTouchPoints:p,touchEvent:t,touchStart:"ontouchstart"in window}},vendor:function getVendor(){return navigator.vendor||""},vendorFlavors:function getVendorFlavors(){for(var t=[],h=0,p=["chrome","safari","__crWeb","__gCrWeb","yandex","__yb","__ybro","__firefox__","__edgeTrackingPreventionStatistics","webkit","oprt","samsungAr","ucweb","UCShellJava","puffinDevice"];h<p.length;h++){var x=p[h],M=window[x];M&&"object"==typeof M&&t.push(x)}return t.sort()},cookiesEnabled:function areCookiesEnabled(){var t=document;try{t.cookie="cookietest=1; SameSite=Strict;";var h=-1!==t.cookie.indexOf("cookietest=");return t.cookie="cookietest=1; SameSite=Strict; expires=Thu, 01-Jan-1970 00:00:01 GMT",h}catch(Vf){return!1}},colorGamut:function getColorGamut(){for(var t=0,h=["rec2020","p3","srgb"];t<h.length;t++){var p=h[t];if(matchMedia("(color-gamut: ".concat(p,")")).matches)return p}},invertedColors:function areColorsInverted(){return!!doesMatch$5("inverted")||!doesMatch$5("none")&&void 0},forcedColors:function areColorsForced(){return!!doesMatch$4("active")||!doesMatch$4("none")&&void 0},monochrome:function getMonochromeDepth(){if(matchMedia("(min-monochrome: 0)").matches){for(var t=0;t<=100;++t)if(matchMedia("(max-monochrome: ".concat(t,")")).matches)return t;throw new Error("Too high value")}},contrast:function getContrastPreference(){return doesMatch$3("no-preference")?0:doesMatch$3("high")||doesMatch$3("more")?1:doesMatch$3("low")||doesMatch$3("less")?-1:doesMatch$3("forced")?10:void 0},reducedMotion:function isMotionReduced(){return!!doesMatch$2("reduce")||!doesMatch$2("no-preference")&&void 0},reducedTransparency:function isTransparencyReduced(){return!!doesMatch$1("reduce")||!doesMatch$1("no-preference")&&void 0},hdr:function isHDR(){return!!doesMatch("high")||!doesMatch("standard")&&void 0},math:function getMathFingerprint(){var t,h=vi.acos||fallbackFn,p=vi.acosh||fallbackFn,x=vi.asin||fallbackFn,M=vi.asinh||fallbackFn,k=vi.atanh||fallbackFn,I=vi.atan||fallbackFn,N=vi.sin||fallbackFn,V=vi.sinh||fallbackFn,ee=vi.cos||fallbackFn,te=vi.cosh||fallbackFn,re=vi.tan||fallbackFn,ne=vi.tanh||fallbackFn,ie=vi.exp||fallbackFn,ae=vi.expm1||fallbackFn,oe=vi.log1p||fallbackFn;return{acos:h(.12312423423423424),acosh:p(1e308),acoshPf:(t=1e154,vi.log(t+vi.sqrt(t*t-1))),asin:x(.12312423423423424),asinh:M(1),asinhPf:function(t){return vi.log(t+vi.sqrt(t*t+1))}(1),atanh:k(.5),atanhPf:function(t){return vi.log((1+t)/(1-t))/2}(.5),atan:I(.5),sin:N(-1e300),sinh:V(1),sinhPf:function(t){return vi.exp(t)-1/vi.exp(t)/2}(1),cos:ee(10.000000000123),cosh:te(1),coshPf:function(t){return(vi.exp(t)+1/vi.exp(t))/2}(1),tan:re(-1e300),tanh:ne(1),tanhPf:function(t){return(vi.exp(2*t)-1)/(vi.exp(2*t)+1)}(1),exp:ie(1),expm1:ae(1),expm1Pf:function(t){return vi.exp(t)-1}(1),log1p:oe(10),log1pPf:function(t){return vi.log(1+t)}(10),powPI:function(t){return vi.pow(vi.PI,t)}(-100)}},pdfViewerEnabled:function isPdfViewerEnabled(){return navigator.pdfViewerEnabled},architecture:function getArchitecture(){var t=new Float32Array(1),h=new Uint8Array(t.buffer);return t[0]=1/0,t[0]=t[0]-t[0],h[3]},applePay:function getApplePayState(){var t=window.ApplePaySession;if("function"!=typeof(null==t?void 0:t.canMakePayments))return-1;if(bi())return-3;try{return t.canMakePayments()?1:0}catch(h){return function getStateFromError(t){if(t instanceof Error&&"InvalidAccessError"===t.name&&/\bfrom\b.*\binsecure\b/i.test(t.message))return-2;throw t}(h)}},privateClickMeasurement:function getPrivateClickMeasurement(){var t,h=document.createElement("a"),p=null!==(t=h.attributionSourceId)&&void 0!==t?t:h.attributionsourceid;return void 0===p?void 0:String(p)},audioBaseLatency:function getAudioContextBaseLatency(){var t;return isAndroid()||isWebKit()?window.AudioContext&&null!==(t=(new AudioContext).baseLatency)&&void 0!==t?t:-1:-2},webGlBasics:function getWebGlBasics(t){var h,p,x,M,k,I,N=getWebGLContext(t.cache);if(!N)return-1;if(!isValidParameterGetter(N))return-2;var V=shouldAvoidDebugRendererInfo()?null:N.getExtension(Si);return{version:(null===(h=N.getParameter(N.VERSION))||void 0===h?void 0:h.toString())||"",vendor:(null===(p=N.getParameter(N.VENDOR))||void 0===p?void 0:p.toString())||"",vendorUnmasked:V?null===(x=N.getParameter(V.UNMASKED_VENDOR_WEBGL))||void 0===x?void 0:x.toString():"",renderer:(null===(M=N.getParameter(N.RENDERER))||void 0===M?void 0:M.toString())||"",rendererUnmasked:V?null===(k=N.getParameter(V.UNMASKED_RENDERER_WEBGL))||void 0===k?void 0:k.toString():"",shadingLanguageVersion:(null===(I=N.getParameter(N.SHADING_LANGUAGE_VERSION))||void 0===I?void 0:I.toString())||""}},webGlExtensions:function getWebGlExtensions(t){var h=getWebGLContext(t.cache);if(!h)return-1;if(!isValidParameterGetter(h))return-2;var p=h.getSupportedExtensions(),x=h.getContextAttributes(),M=[],k=[],I=[],N=[],V=[];if(x)for(var ee=0,te=Object.keys(x);ee<te.length;ee++){var re=te[ee];k.push("".concat(re,"=").concat(x[re]))}for(var ne=0,ie=getConstantsFromPrototype(h);ne<ie.length;ne++){var ae=h[fe=ie[ne]];I.push("".concat(fe,"=").concat(ae).concat(xi.has(ae)?"=".concat(h.getParameter(ae)):""))}if(p)for(var oe=0,se=p;oe<se.length;oe++){var ce=se[oe];if(!(ce===Si&&shouldAvoidDebugRendererInfo()||"WEBGL_polygon_mode"===ce&&(isChromium()||isWebKit()))){var ue=h.getExtension(ce);if(ue)for(var le=0,he=getConstantsFromPrototype(ue);le<he.length;le++){var fe;ae=ue[fe=he[le]];N.push("".concat(fe,"=").concat(ae).concat(Mi.has(ae)?"=".concat(h.getParameter(ae)):""))}else M.push(ce)}}for(var de=0,pe=_i;de<pe.length;de++)for(var me=pe[de],ge=0,ve=Ci;ge<ve.length;ge++){var ye=ve[ge],be=getShaderPrecision(h,me,ye);V.push("".concat(me,".").concat(ye,"=").concat(be.join(",")))}return N.sort(),I.sort(),{contextAttributes:k,parameters:I,shaderPrecisions:V,extensions:p,extensionParameters:N,unsupportedExtensions:M}}};var Ai="$ if upgrade to Pro: https://fpjs.dev/pro";function getConfidence(t){var h=function getOpenConfidenceScore(t){if(isAndroid())return.4;if(isWebKit())return!isDesktopWebKit()||isWebKit616OrNewer()&&isSafariWebKit()?.3:.5;var h="value"in t.platform?t.platform.value:"";if(/^Win/.test(h))return.6;if(/^Mac/.test(h))return.5;return.7}(t),p=function deriveProConfidenceScore(t){return round(.99+.01*t,1e-4)}(h);return{score:h,comment:Ai.replace(/\$/g,"".concat(p))}}function hashComponents(t){return x64hash128(function componentsToCanonicalString(t){for(var h="",p=0,x=Object.keys(t).sort();p<x.length;p++){var M=x[p],k=t[M],I="error"in k?"error":JSON.stringify(k.value);h+="".concat(h?"|":"").concat(M.replace(/([:|\\])/g,"\\$1"),":").concat(I)}return h}(t))}function prepareForSources(t){return void 0===t&&(t=50),function requestIdleCallbackIfAvailable(t,h){void 0===h&&(h=1/0);var p=window.requestIdleCallback;return p?new Promise((function(t){return p.call(window,(function(){return t()}),{timeout:h})})):wait(Math.min(t,h))}(t,2*t)}function makeAgent(t,h){Date.now();return{get:function(p){return __awaiter(this,void 0,void 0,(function(){var x,M;return __generator(this,(function(k){switch(k.label){case 0:return Date.now(),[4,t()];case 1:return x=k.sent(),M=function makeLazyGetResult(t){var h;return{get visitorId(){return void 0===h&&(h=hashComponents(this.components)),h},set visitorId(t){h=t},confidence:getConfidence(t),components:t,version:ii}}(x),h||null==p||p.debug,[2,M]}}))}))}}}function load(t){var h;return void 0===t&&(t={}),__awaiter(this,void 0,void 0,(function(){var p,x,M;return __generator(this,(function(k){switch(k.label){case 0:return(null===(h=t.monitoring)||void 0===h||h)&&function monitor(){if(!(window.__fpjs_d_m||Math.random()>=.001))try{var t=new XMLHttpRequest;t.open("get","https://m1.openfpcdn.io/fingerprintjs/v".concat(ii,"/npm-monitoring"),!0),t.send()}catch(h){}}(),p=t.delayFallback,x=t.debug,[4,prepareForSources(p)];case 1:return k.sent(),M=function loadBuiltinSources(t){return loadSources(Ti,t,[])}({cache:{},debug:x}),[2,makeAgent(M,x)]}}))}))}var Di=function getCanvasId(t){var h=null;if("string"==typeof t&&t.length>0){if(!(h=document.querySelector(t)))return t.replace(/^#/,"")}else t instanceof HTMLCanvasElement&&(h=t);if(h)return h.id||(h.id=Math.random().toString(16).slice(2)),h.id},ki=function createMxDraw(t,p,x,M,k){return new Promise((function(I,N){try{h.MxFun.createMxObject({canvasId:Di(t),isCPPMxCAD:!0,mapBox:x,callback:function callback(t){t.initRendererParam({webgl2:!0!==M}),t.setViewMovementMethod(void 0===p||p),k&&k.callEvent("init_before_mxdraw",t),t.addEvent("initObject",(function(){t.isWebgl2(),I(t)}))}})}catch(Vf){N(Vf)}}))},Pi=function createMxCadCppObject(t,h,p,x,M,k,I,N){var V=t.CreateMxDraw(h,p,x,M,k,I);return N?N.init(V):N=new Wr(V),V.McObject=N,V.McObject};function Mx_About(){}var Li,Ei=function(){var p=_asyncToGenerator(ie.mark((function _callee(p,x){var M,k,I,N,V,ee,te,re,ne,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we,_e,Ce,Se,Te,Ae;return ie.wrap((function _callee$(ie){for(;;)switch(ie.prev=ie.next){case 0:if(h.store.state.MxFun){ie.next=3;break}return ie.next=3,h.loadCoreCode();case 3:return k=(M=p||{}).openParameter,I=M.networkFonts,N=M.fontspath,V=M.locateFile,ee=M.wasmBinary,te=M.canvas,re=M.onOpenFileComplete,ne=M.fileUrl,oe=M.onInit,se=M.middlePan,ce=M.registdata,ue=M.registfile,le=M.authorized_service,he=M.viewBackgroundColor,fe=M.map,de=M.multipleSelect,pe=M.enableUndo,me=M.enableIntelliSelect,ge=M.browse,ve=M.webgl1,ie.next=6,loadMxCADassembly((function(){}),V,ee,N,I,x);case 6:return h.MxFun.initMxCpp(t.MxCpp),Mt.init(),h.MxFun.setIniset({EnableIntelliSelect:void 0===me||me}),void 0!==pe&&t.MxCpp.App.IniSet({EnableUndo:pe}),he&&t.MxCpp.App.setDefaultViewBackgroundColor(he.red,he.green,he.blue),oe&&oe(),x&&x.callEvent("init"),ie.next=15,ki(te,se,fe,ve,x);case 15:if(ye=ie.sent,void 0!==de&&ye.setMultipleSelect(de),he&&ye.setViewColor(he.red<<16|he.green<<8|he.blue),x&&x.callEvent("init_mxdraw",ye),be=h.MxFun.getMxFunTHREE(),xe=new be.Vector2,ye.getRenderer().getSize(xe),Me=Pi(t.MxCpp.App.getImp(),xe.width,xe.height,ye.getCanvas().id,ye.isWebgl2(),ye.getId(),!!fe,x),1==(we=t.MxCpp.App.getImp().getCodeVersion())||2==we){ie.next=35;break}if(!(ce&&ce.length>0)){ie.next=29;break}Me.initRegist(ce),ie.next=35;break;case 29:return _e=ue,ue&&ue.length>0||(_e="mxkey.json.frontpage.json"),ie.next=33,ae(_e);case 33:(Ce=ie.sent)&&Ce.registdata?(Me.initRegist(Ce.registdata),le?"same_current_page_url"==le&&Ce.authorized_service&&Ce.authorized_service.length>0?Me.iniAuthorizedService(Ce.authorized_service):Me.iniAuthorizedService(le):Ce.authorized_service&&Ce.authorized_service.length>0&&Me.iniAuthorizedService(Ce.authorized_service)):le&&Me.iniAuthorizedService(le);case 35:if(3!=we){ie.next=48;break}if((Se=localStorage.getItem("_mx_tmp_id_"))&&0!=Se.length){ie.next=47;break}return window.__fpjs_d_m=!0,ie.next=42,load();case 42:return Te=ie.sent,ie.next=45,Te.get();case 45:Se=ie.sent.visitorId,localStorage.setItem("_mx_tmp_id_",Se);case 47:t.MxCpp.App.getImp().addFontsLoadOnInitialization(Se,-121);case 48:return ye.initMxCpp(Me),ye.addEvent("openFileComplete",(function(){re&&re(Me)})),Me&&(!0===ge||1===ge?(Me.setBrowse(!0),void 0===se&&(se=0)):2==ge&&(void 0===se&&(se=0),h.MxFun.setIniset({ForbiddenDynInput:!0,EnableCADEntityGripEdit:0})),void 0!==se&&Me.mxdraw.setMouseMiddlePan(se),Me.callEvent("init_mxcad",Me)),ne&&(Ae=0,k&&k&&(Ae=k),Me.openWebFile(ne,void 0,!0,k,Ae)),ie.abrupt("return",Me);case 53:case"end":return ie.stop()}}),_callee)})));return function createMxCad(t,h){return p.apply(this,arguments)}}(),Ii=function(t){return t[t.kByLayer=1]="kByLayer",t[t.kByBlock=2]="kByBlock",t[t.kByColor=3]="kByColor",t[t.kByACI=4]="kByACI",t[t.kByPen=5]="kByPen",t[t.kForeground=6]="kForeground",t[t.kLayerOff=7]="kLayerOff",t[t.kLayerFrozen=8]="kLayerFrozen",t[t.kNone=9]="kNone",t}(Ii||{}),Bi=function(t){return t[t.kByblock=0]="kByblock",t[t.kRed=1]="kRed",t[t.kYellow=2]="kYellow",t[t.kGreen=3]="kGreen",t[t.KCyan=4]="KCyan",t[t.kBlue=5]="kBlue",t[t.kMagenta=6]="kMagenta",t[t.kWhite=7]="kWhite",t[t.kBylayer=256]="kBylayer",t}(Bi||{}),Oi=function getColorUtils(){if(!Li){var t=h.MxFun.getMxFunTHREE();Li=new t.Color}for(var p,x=arguments.length,M=new Array(x),k=0;k<x;k++)M[k]=arguments[k];if(function isRGB(t){return 3===t.length}(M))(p=Li).setRGB.apply(p,M);else if(function isColor(t){return"object"===_typeof$1(t[0])&&t[0].isColor}(M)){var I;(I=Li).set.apply(I,M)}else if(function isNumber(t){return"number"==typeof t[0]&&1===t.length}(M)){var N;(N=Li).set.apply(N,M)}else if(function isString(t){return"string"==typeof t[0]&&1===t.length}(M)){var V;(V=Li).set.apply(V,M)}return Li},Ri=function createMcCmColor(){for(var t=new Cr,h=arguments.length,p=new Array(h),x=0;x<h;x++)p[x]=arguments[x];return Fi.apply(void 0,[t].concat(p)),t},Fi=function setMcCmColor(h){for(var p=arguments.length,x=new Array(p>1?p-1:0),M=1;M<p;M++)x[M-1]=arguments[M];if(function isTHREEColorAges(t){return t.length>1||"object"===_typeof$1(t[0])&&t[0].isColor||"string"==typeof t[0]||"number"==typeof t[0]}(x)){var k=Oi.apply(void 0,x),I=k.r,N=k.g,V=k.b;h.red=255*I,h.green=255*N,h.blue=255*V}(function isMcCmColor(t){return"object"===_typeof$1(t[0])&&!(t[0]&&t[0].isColor)})(x)&&(h=Object.assign(h,x[0])),function setColorIndex(h){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.MxCpp.App.mcedRGB2Index(h.red,h.green,h.blue,!1);-1===p?h.method=3:h.setColorIndex(p),7===p?h.method=4:0===p?h.method=2:256===p?h.method=1:-1!==p&&(h.method=4),h.colorIndex=p}(h)};function drawText(){return _drawText.apply(this,arguments)}function _drawText(){return _drawText=_asyncToGenerator(ie.mark((function _callee(){var h,p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce;return ie.wrap((function _callee$(ie){for(;;)switch(ie.prev=ie.next){case 0:return k=function createText(){var k=new Ot;return k.height=h||100,k.textString=p||"",k.position=x||new rn,k.trueColor=new Cr(t.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor()),k.rotation=M||0,k},(I=new Pt).setMessage(""),ie.next=5,I.go();case 5:if(N=ie.sent){ie.next=8;break}return ie.abrupt("return");case 8:return p=N,(V=new St).clearLastInputPoint(),V.setMessage(""),V.setUserDraw((function(t,h){x=t,h.drawMcDbEntity(k())})),ie.next=15,V.go();case 15:if(ee=ie.sent){ie.next=18;break}return ie.abrupt("return");case 18:return x=ee,(te=new Tt).setBasePt(x),te.setMessage(_ML_String("Mx_Text_Height","")),te.setUserDraw((function(t,p){x&&(h=t.distanceTo(x)),p.drawMcDbEntity(k())})),ie.next=25,te.go();case 25:if(re=ie.sent){ie.next=28;break}return ie.abrupt("return");case 28:return h=re,(ne=new At).setBasePt(x),ne.clearLastInputPoint(),ne.setMessage(_ML_String("Mx_Text_Angle","")),ne.setUserDraw((function(t,h){x&&(M=angleTo(t.x,t.y,x.x,x.y)),h.drawMcDbEntity(k())})),ie.next=36,ne.go();case 36:return null!==(ae=ie.sent)&&8===ne.getDetailedResult()&&(M=ae),oe=k(),se=t.MxCpp.getCurrentMxCAD(),ce=se.drawEntity(oe),se.updateDisplay(),ie.abrupt("return",ce);case 43:case"end":return ie.stop()}}),_callee)}))),_drawText.apply(this,arguments)}function _construct(t,h,p){return _construct=function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}()?Reflect.construct.bind():function _construct(t,h,p){var x=[null];x.push.apply(x,h);var M=new(Function.bind.apply(t,x));return p&&_setPrototypeOf$1(M,p.prototype),M},_construct.apply(null,arguments)}function _createForOfIteratorHelper$1(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray$1(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray$1(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray$1(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function createParallelLines(t,h){var p=t.endPoint.sub(t.startPoint).normalize(),x=new nn(-p.y,p.x,0).mult(h),M=t.startPoint.clone().addvec(x),k=t.endPoint.clone().addvec(x),I=t.startPoint.clone().subvec(x),N=t.endPoint.clone().subvec(x);return[new Bt(M,k),new Bt(I,N)]}function createOffsetShapes(t,h,p){var x=function getOffsetCircle(t){return[_construct(Vt,_toConsumableArray(t.center.toVector3().toArray()).concat([Math.max(0,t.radius-h)])),_construct(Vt,_toConsumableArray(t.center.toVector3().toArray()).concat([t.radius+h]))]};if(t instanceof Gt&&p){var M=selectLineSegmentFromPolylineByPoint(t,p,.1)||{},k=M.start,I=M.end,N=M.bulge;if(!k||!I)return[];if(N&&0!==N){var V=function calculateCenter(t,h,p){var x=t.distanceTo(h)/2,M=x*p,k=(x*x+M*M)/(2*M),I=(t.x+h.x)/2,N=(t.y+h.y)/2;return new rn(I,N).addvec(h.clone().sub(t).perpVector().normalize().mult(k-M))}(k,I,N);return x(_construct(Vt,_toConsumableArray(V.toVector3().toArray()).concat([V.distanceTo(k)])))}return createParallelLines(new Bt(k,I),h)}if(t instanceof Bt){var ee=_slicedToArray$1(createParallelLines(t,h),2);return[ee[0],ee[1]]}return t instanceof Vt||t instanceof Xt?x(t):[]}function findTangentCircles(h,p,x,M,k){var I,N=createOffsetShapes(h,x,M),V=createOffsetShapes(p,x,k),ee=[],te=_createForOfIteratorHelper$1(N);try{for(te.s();!(I=te.n()).done;){var re,ne=I.value,ie=_createForOfIteratorHelper$1(V);try{var ae=function _loop(){var h=re.value,p=[],x=ne instanceof Vt&&h instanceof Vt?t.McDb.Intersect.kOnBothOperands:t.McDb.Intersect.kExtendBoth;ne.IntersectWith(h,x).forEach((function(t){p.push(t)})),ee.push.apply(ee,p)};for(ie.s();!(re=ie.n()).done;)ae()}catch(oe){ie.e(oe)}finally{ie.f()}}}catch(oe){te.e(oe)}finally{te.f()}return ee}var Ni=function threePointsToDetermineTheCenterOfTheCircle(t){var h=_slicedToArray$1(t,3),p=h[0],x=h[1],M=h[2],k=p.x,I=p.y,N=p.z,V=x.x,ee=x.y,te=x.z,re=M.x,ne=M.y,ie=M.z,ae=I*te-ee*N-I*ie+ne*N+ee*ie-ne*te,oe=-(k*te-V*N-k*ie+re*N+V*ie-re*te),se=k*ee-V*I-k*ne+re*I+V*ne-re*ee,ce=-(k*ee*ie-k*ne*te-V*I*ie+V*ne*N+re*I*te-re*ee*N),ue=2*(V-k),le=2*(ee-I),he=2*(te-N),fe=k*k+I*I+N*N-V*V-ee*ee-te*te,de=2*(re-k),pe=2*(ne-I),me=2*(ie-N),ge=k*k+I*I+N*N-re*re-ne*ne-ie*ie;return new rn(-(oe*he*ge-oe*me*fe-le*se*ge+le*me*ce+pe*se*fe-pe*he*ce)/(ae*le*me-ae*pe*he-ue*oe*me+ue*pe*se+de*oe*he-de*le*se),(ae*he*ge-ae*me*fe-ue*se*ge+ue*me*ce+de*se*fe-de*he*ce)/(ae*le*me-ae*pe*he-ue*oe*me+ue*pe*se+de*oe*he-de*le*se),-(ae*le*ge-ae*pe*fe-ue*oe*ge+ue*pe*ce+de*oe*fe-de*le*ce)/(ae*le*me-ae*pe*he-ue*oe*me+ue*pe*se+de*oe*he-de*le*se))};function drawCircle(){return _drawCircle.apply(this,arguments)}function _drawCircle(){return _drawCircle=_asyncToGenerator(ie.mark((function _callee(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce;return ie.wrap((function _callee$(ue){for(;;)switch(ue.prev=ue.next){case 0:p=new St,x=new Vt,M=t.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),x.trueColor=new Cr(M),(oe=new bt).AddMcDbEntityTypes("ARC,LINE,LWPOLYLINE,CIRCLE"),se=ie.mark((function _loop2(){var M,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we,_e,Ce,Se,Te,Ae,De,ke,Le,Ee;return ie.wrap((function _loop2$(ie){for(;;)switch(ie.prev=ie.next){case 0:if(void 0===k&&(p.setKeyWords("[(3P)/(2P)/(T)]"),k="default"),"default"!==k){ie.next=47;break}if(N){ie.next=19;break}return p.setMessage("\n"),ie.next=6,p.go();case 6:if(M=ie.sent,!p.isKeyWordPicked("3P")){ie.next=10;break}return k="3P",ie.abrupt("return",0);case 10:if(!p.isKeyWordPicked("2P")){ie.next=13;break}return k="2P",ie.abrupt("return",0);case 13:if(!p.isKeyWordPicked("T")){ie.next=16;break}return k="T",ie.abrupt("return",0);case 16:if(M){ie.next=18;break}return ie.abrupt("return",{v:void 0});case 18:N=M;case 19:if(V){ie.next=44;break}return(se=new Tt).setBasePt(N),void 0===I&&(se.setKeyWords("[(D)]"),I=!0),se.setMessage(_ML_String("McDbCircle_Radius",""+(I?"":""))),se.setUserDraw((function(t,h){if(N){var p=new Vt(N.x,N.y,N.z,I?N.distanceTo(t):N.distanceTo(t)/2);h.drawMcDbEntity(p),h.drawLine(p.center.toVector3(),t.toVector3())}})),ie.next=27,se.go();case 27:if(ce=ie.sent,!se.isKeyWordPicked("D")){ie.next=40;break}return I=!1,se.clearLastInputPoint(),se.setBasePt(N),se.setMessage(_ML_String("McDbCircle_Diameter","")),se.setKeyWords(""),ie.next=36,se.go();case 36:if(ue=ie.sent){ie.next=39;break}return ie.abrupt("return",{v:void 0});case 39:V=ue/2;case 40:if(V){ie.next=44;break}if(ce){ie.next=43;break}return ie.abrupt("return",{v:void 0});case 43:V=ce;case 44:return x.center=N,x.radius=V,ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(x,!0)});case 47:if("3P"!==k){ie.next=77;break}if(ee){ie.next=56;break}return p.setMessage(""),p.setKeyWords(""),ie.next=53,p.go();case 53:if(ee=ie.sent){ie.next=56;break}return ie.abrupt("return",{v:void 0});case 56:if(te){ie.next=65;break}return p.setMessage(""),p.setKeyWords(""),p.setUserDraw((function(t,h){ee&&h.drawLine(ee.toVector3(),t.toVector3())})),ie.next=62,p.go();case 62:if(te=ie.sent){ie.next=65;break}return ie.abrupt("return",{v:void 0});case 65:if(re){ie.next=74;break}return p.setMessage(""),p.setKeyWords(""),p.setUserDraw((function(t,h){if(ee&&te){var p=Ni([ee,te,t]);if(p){var x=new Vt(p.x,p.y,p.z,p.distanceTo(ee));h.drawMcDbEntity(x)}}})),ie.next=71,p.go();case 71:if(re=ie.sent){ie.next=74;break}return ie.abrupt("return",{v:void 0});case 74:return le=Ni([ee,te,re]),he=new Vt(le.x,le.y,le.z,le.distanceTo(ee)),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(he,!0)});case 77:if("2P"!==k){ie.next=98;break}if(ne){ie.next=86;break}return p.setMessage(""),p.setKeyWords(""),ie.next=83,p.go();case 83:if(ne=ie.sent){ie.next=86;break}return ie.abrupt("return",{v:void 0});case 86:if(ae){ie.next=95;break}return p.setMessage(""),p.setKeyWords(""),p.setUserDraw((function(t,h){ne&&(N=new rn((t.x+ne.x)/2,(t.y+ne.y)/2,(t.z+ne.z)/2),V=N.distanceTo(ne),h.drawMcDbEntity(new Vt(N.x,N.y,N.z,V)))})),ie.next=92,p.go();case 92:if(ae=ie.sent){ie.next=95;break}return ie.abrupt("return",{v:void 0});case 95:return N=new rn((ae.x+ne.x)/2,(ae.y+ne.y)/2,(ae.z+ne.z)/2),V=N.distanceTo(ne),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(new Vt(N.x,N.y,N.z,V),!0)});case 98:if("T"!==k){ie.next=156;break}return p.setMessage(""),p.setKeyWords(""),ie.next=103,p.go();case 103:if(fe=ie.sent){ie.next=106;break}return ie.abrupt("return",{v:void 0});case 106:if(de=Mt.findEntAtPoint(fe.x,fe.y,fe.z,-1,oe),pe=de.getMcDbCurve()){ie.next=110;break}return ie.abrupt("return",0);case 110:return p.setMessage(""),p.clearLastInputPoint(),ie.next=114,p.go();case 114:if(me=ie.sent){ie.next=117;break}return ie.abrupt("return",{v:void 0});case 117:if(ge=Mt.findEntAtPoint(me.x,me.y,me.z,-1,oe),ve=ge.getMcDbCurve()){ie.next=121;break}return ie.abrupt("return",0);case 121:return(ye=new Tt).setMessage(""),ie.next=125,ye.go();case 125:if(be=ie.sent){ie.next=128;break}return ie.abrupt("return",{v:void 0});case 128:if((xe=findTangentCircles(pe,ve,be,fe,me))&&0!==xe.length){ie.next=131;break}return ie.abrupt("return",{v:void 0});case 131:if(1!==xe.length){ie.next=137;break}return Me=_slicedToArray$1(xe,1),we=Me[0],_e=new Vt(we.x,we.y,we.z,be),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(_e)});case 137:return(Ce=new St).clearLastInputPoint(),Ce.setMessage(""),Se=function getCenter(t){var h=xe.map((function(h){return h.distanceTo(t)})),p=Math.min.apply(Math,_toConsumableArray(h)),x=h.indexOf(p);return xe[x]},Ce.setUserDraw((function(t,h){var p=Se(t);h.drawCircle(p.toVector3(),be)})),ie.next=144,Ce.go();case 144:if(Te=ie.sent,Ce.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=147;break}return ie.abrupt("return",{v:void 0});case 147:if(Te){ie.next=153;break}return Ae=_slicedToArray$1(xe,1),De=Ae[0],ke=new Vt(De.x,De.y,De.z,be),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(ke)});case 153:return Le=Se(Te),Ee=new Vt(Le.x,Le.y,Le.z,be),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(Ee)});case 156:case"end":return ie.stop()}}),_loop2)}));case 7:return ue.delegateYield(se(),"t0",9);case 9:if(0!==(ce=ue.t0)){ue.next=12;break}return ue.abrupt("continue",7);case 12:if(!ce){ue.next=14;break}return ue.abrupt("return",ce.v);case 14:ue.next=7;break;case 16:case"end":return ue.stop()}}),_callee)}))),_drawCircle.apply(this,arguments)}h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Circle",drawCircle)}));var Vi,Gi=null;function drawLine(){return _drawLine.apply(this,arguments)}function _drawLine(){return _drawLine=_asyncToGenerator(ie.mark((function _callee(){var p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee$(ne){for(;;)switch(ne.prev=ne.next){case 0:return(p=new St).setLastInputPoint,p.setMessage("\n:"),ne.next=5,p.go();case 5:if(x=ne.sent,M=x,p.getDetailedResult()===h.DetailedResult.kMouseRightIn&&(x=Gi),x){ne.next=10;break}return ne.abrupt("return");case 10:p.setMessage("\n:"),k=0,I=[];case 13:return k>=2?p.setKeyWords("[(E)/(C)/(U)]"):k>0?p.setKeyWords("[(E)/(U)]"):p.setKeyWords(""),p.setBasePt(x),ne.next=18,p.go();case 18:if(N=ne.sent,!p.isKeyWordPicked("C")){ne.next=26;break}return Gi=x,V=new Bt(M,x),t.MxCpp.getCurrentMxCAD().drawEntity(V),ne.abrupt("return");case 26:if(!p.isKeyWordPicked("E")){ne.next=30;break}return ne.abrupt("return");case 30:if(!p.isKeyWordPicked("U")){ne.next=40;break}if(0!=I.length){ne.next=33;break}return ne.abrupt("continue",13);case 33:return ee=I[I.length-1],I.pop(),k--,x=ee.prvPoint,Gi=x,ee.id.erase(),ne.abrupt("continue",13);case 40:if(N){ne.next=42;break}return ne.abrupt("return");case 42:te=new Bt(x,N),k++,re=t.MxCpp.getCurrentMxCAD().drawEntity(te),I.push({id:re,prvPoint:x}),x=N,Gi=N,ne.next=13;break;case 50:case"end":return ne.stop()}}),_callee)}))),_drawLine.apply(this,arguments)}function Mx_Point(){return _Mx_Point.apply(this,arguments)}function _Mx_Point(){return(_Mx_Point=_asyncToGenerator(ie.mark((function _callee2(){var h,p;return ie.wrap((function _callee2$(x){for(;;)switch(x.prev=x.next){case 0:(h=new St).setMessage("");case 2:return h.clearLastInputPoint(),x.next=6,h.go();case 6:if(null!=(p=x.sent)){x.next=9;break}return x.abrupt("break",12);case 9:t.MxCpp.getCurrentMxCAD().drawEntity(new Kt(p)),x.next=2;break;case 12:case"end":return x.stop()}}),_callee2)})))).apply(this,arguments)}function MxDb_Spline(){return _MxDb_Spline.apply(this,arguments)}function _MxDb_Spline(){return(_MxDb_Spline=_asyncToGenerator(ie.mark((function _callee3(){var h,p,x,M,k;return ie.wrap((function _callee3$(I){for(;;)switch(I.prev=I.next){case 0:return(h=new St).setMessage("\n:"),I.next=4,h.go();case 4:if(p=I.sent){I.next=7;break}return I.abrupt("return");case 7:h.setMessage("\n:"),(x=new ln).append(p);case 10:return h.setBasePt(p),1==x.length()?h.setUseBasePt(!0):(h.setUseBasePt(!1),h.setUserDraw((function(t,h){var p=new ln;p.copy(x),p.append(t);var M=new tr;M.setFitPoints({degree:3,fitTolerance:1e-6,tangentsExist:!1,startTangent:nn.kIdentity,endTangent:nn.kIdentity,fitPoints:p}),h.drawMcDbEntity(M)}))),I.next=15,h.go();case 15:if(M=I.sent){I.next=18;break}return I.abrupt("break",22);case 18:x.append(M),p=M,I.next=10;break;case 22:x.length()>2&&((k=new tr).setFitPoints({degree:3,fitTolerance:1e-6,tangentsExist:!1,startTangent:nn.kIdentity,endTangent:nn.kIdentity,fitPoints:x}),t.MxCpp.getCurrentMxCAD().drawEntity(k));case 23:case"end":return I.stop()}}),_callee3)})))).apply(this,arguments)}function drawMText(){return _drawMText.apply(this,arguments)}function _drawMText(){return _drawMText=_asyncToGenerator(ie.mark((function _callee(){var h,p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce;return ie.wrap((function _callee$(ie){for(;;)switch(ie.prev=ie.next){case 0:return k=function createMText(){var k=new Nt;return k.textHeight=h||100,k.contents=p||"",k.location=x||new rn,k.trueColor=new Cr(t.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor()),k.rotation=M||0,k},(I=new Pt).setMessage(""),ie.next=5,I.go();case 5:if(N=ie.sent){ie.next=8;break}return ie.abrupt("return");case 8:return p=N,(V=new St).clearLastInputPoint(),V.setMessage(""),V.setUserDraw((function(t,h){x=t,h.drawMcDbEntity(k())})),ie.next=15,V.go();case 15:if(ee=ie.sent){ie.next=18;break}return ie.abrupt("return");case 18:return x=ee,(te=new Tt).setBasePt(x),te.setMessage(_ML_String("Mx_Text_Height","")),te.setUserDraw((function(t,p){x&&(h=t.distanceTo(x)),p.drawMcDbEntity(k())})),ie.next=25,te.go();case 25:if(re=ie.sent){ie.next=28;break}return ie.abrupt("return");case 28:return h=re,(ne=new At).setBasePt(x),ne.clearLastInputPoint(),ne.setMessage(_ML_String("Mx_MText_Angle","")),ne.setUserDraw((function(t,h){x&&(M=angleTo(t.x,t.y,x.x,x.y)),h.drawMcDbEntity(k())})),ie.next=36,ne.go();case 36:return null!==(ae=ie.sent)&&8===ne.getDetailedResult()&&(M=ae),oe=k(),se=t.MxCpp.getCurrentMxCAD(),ce=se.drawEntity(oe),se.updateDisplay(),ie.abrupt("return",ce);case 43:case"end":return ie.stop()}}),_callee)}))),_drawMText.apply(this,arguments)}function CMxDrawPolylineDragArcDraw_CalcArcBulge(h,p,x){if(h.isEqualTo(p))return 0;var M=h.c().addvec(p.c().sub(h).mult(.5)),k=p.c().sub(h);k.rotateBy(Math.PI/2,nn.kZAxis);var I=new Bt(M,M.c().addvec(k)),N=x.c();N.rotateBy(Math.PI/2,nn.kZAxis);var V=new Bt(h,h.c().addvec(N)),ee=I.IntersectWith(V,t.McDb.Intersect.kExtendBoth);if(ee.isEmpty())return 0;var te=ee.at(0),re=te.distanceTo(h);k.normalize(),k.mult(re);var ne=te.c().addvec(k),ie=te.c().subvec(k),ae=ne.c().sub(h),oe=ie.c().sub(h),se=ne;return ae.angleTo1(x)>oe.angleTo1(x)&&(se=ie),Mt.calcBulge(h,se,p).val}function drawPolyLine(){return _drawPolyLine.apply(this,arguments)}function _drawPolyLine(){return _drawPolyLine=_asyncToGenerator(ie.mark((function _callee(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce,ue,le,he,fe,de;return ie.wrap((function _callee$(pe){for(;;)switch(pe.prev=pe.next){case 0:return(p=new St).setMessage("\n:"),pe.next=4,p.go();case 4:if(null!==(x=pe.sent)){pe.next=7;break}return pe.abrupt("return");case 7:M=[],(I={}).dStartWidth=k=0,I.dEndWidth=k,I.pt=x,I.dBulge=0,M.push(I),N=!1,V=!0,ee=!1,te=k,re=k,ne=[],ae=t.MxCpp.getCurrentMxCAD(),h.MxFun.acutPrintf("\n  {0}",k+""),oe=!1,se=function onKeydown(t){"Control"===t.key&&(oe=!0)},ce=function onkeyup(){return oe=!1},window.addEventListener("keydown",se),window.addEventListener("keyup",ce),ue=ie.mark((function _loop(){var t,p,I,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we,_e,Ce,Se,Te,Ae,De,ke,Le,Ee,Ie,Be,Oe,Re,Fe,Ne,Ve,Ge,je,Ue,ze,We,He,$e,Xe,qe,Ke,Ye,Ze,Je,Qe,et,tt,rt,nt,it,ot,st,ct,ut,lt,ht,ft,dt,pt,mt,gt,vt,yt,bt,xt,wt,_t,Ct,Dt,kt,Pt,Lt,Et,It,Bt,Ot,Rt,Ft,Nt,Vt,jt,Ut,zt,Wt,Ht,$t,qt,Kt,Yt,Zt,Jt,Qt,er,tr,rr,nr,ir,ar,or,sr,cr,ur,lr,hr,fr,dr,pr,mr,gr,vr,yr,br,xr,Mr,wr,_r,Cr,Sr,Tr,Ar,Dr,kr,Pr,Lr,Er,Ir,Br,Or;return ie.wrap((function _loop$(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!V){ie.next=107;break}return t=_ML_String("ID_ARX_PL2",":"),p="[(A)/(W)/(L)/(H)]",M.length>=3?p=ee?"[(U)/(A)/(W)/(L)/(H)]":"[(U)/(A)/(W)/(L)/(H)/(C)]":M.length>=2&&(p="[(U)/(A)/(W)/(H)/(L)]"),(I=new St).setMessage(t),I.setKeyWords(p),se=M[M.length-1],I.setUserDraw((function(t,h){var p=new Gt;p.addVertexAt(se.pt,se.dBulge,se.dStartWidth,se.dEndWidth),p.addVertexAt(t),h.drawMcDbEntity(p)})),ie.next=11,I.go();case 11:if(null===(ce=ie.sent)){ie.next=22;break}(ue={}).dStartWidth=te,ue.dEndWidth=re,ue.pt=ce,ue.dBulge=0,M.push(ue),M.length>=2&&((le=new Gt).addVertexAt(M[M.length-2].pt,0,M[M.length-2].dStartWidth,M[M.length-2].dEndWidth),le.addVertexAt(M[M.length-1].pt),ne.push(ae.drawEntity(le))),ie.next=105;break;case 22:if(I.getStatus()!=h.MrxDbgUiPrBaseReturn.kKeyWord){ie.next=104;break}if(!I.isKeyWordPicked("A")){ie.next=27;break}V=!1,ie.next=102;break;case 27:if(!I.isKeyWordPicked("W")){ie.next=49;break}return(he=new Tt).setMessage(_ML_String("ID_ARX_PLGETSTARTWIDTH","")),ie.next=32,he.go();case 32:if(null!==ie.sent){ie.next=35;break}return ie.abrupt("return",0);case 35:return te=he.value(),he.setMessage(_ML_String("ID_ARX_PLGETVERITXWIDTH","")),ie.next=39,he.go();case 39:if(null!==ie.sent){ie.next=42;break}return ie.abrupt("return",0);case 42:re=he.value(),k=re,M[M.length-1].dStartWidth=te,M[M.length-1].dEndWidth=re,te=re,ie.next=102;break;case 49:if(!I.isKeyWordPicked("H")){ie.next=71;break}return(fe=new Tt).setMessage(_ML_String("ID_ARX_PLGETSTARTWIDTH","")),ie.next=54,fe.go();case 54:if(null!==ie.sent){ie.next=57;break}return ie.abrupt("return",0);case 57:return te=2*fe.value(),fe.setMessage(_ML_String("ID_ARX_PLGETVERITXWIDTH","")),ie.next=61,fe.go();case 61:if(null!==ie.sent){ie.next=64;break}return ie.abrupt("return",0);case 64:re=2*fe.value(),k=re,M[M.length-1].dStartWidth=te,M[M.length-1].dEndWidth=re,te=re,ie.next=102;break;case 71:if(!I.isKeyWordPicked("C")){ie.next=76;break}return N=!0,ie.abrupt("return",0);case 76:if(!I.isKeyWordPicked("U")){ie.next=80;break}M.length>1&&(M.pop(),ne[ne.length-1].erase(),ne.pop(),M.length>0&&I.setLastInputPoint(M[M.length-1].pt)),ie.next=102;break;case 80:if(!I.isKeyWordPicked("L")){ie.next=102;break}return pe=nn.kXAxis,I.setMessage(""),I.setKeyWords(""),ie.next=86,I.go();case 86:if(ge=ie.sent){ie.next=89;break}return ie.abrupt("return",{v:void 0});case 89:ve=M[M.length-1].pt,ye=ge.distanceTo(ve),(be=null===(de=M[M.length-2])||void 0===de?void 0:de.pt)&&(pe=be.sub(ve)),me=ve.clone().addvec(pe.normalize().mult(-ye)),(xe={}).dStartWidth=te,xe.dEndWidth=re,xe.pt=me,xe.dBulge=0,M.push(xe),I.setLastInputPoint(me),M.length>=2&&((Me=new Gt).addVertexAt(M[M.length-2].pt,0,M[M.length-2].dStartWidth,M[M.length-2].dEndWidth),Me.addVertexAt(M[M.length-1].pt),ne.push(ae.drawEntity(Me)));case 102:ie.next=105;break;case 104:return ie.abrupt("return",0);case 105:ie.next=495;break;case 107:return we=_ML_String("NO1_ID_ARX_PL5","( Ctrl )"),_e="[(A)/(S)/(CE)/(D)/(L)/(R)/(W)/(H)]",M.length>=3?_e=ee?"[(A)/(S)/(CE)/(D)/(U)/(L)/(R)/(W)/(H)]":"[(A)/(S)/(CE)/(D)/(U)/(L)/(R)/(W)/(H)/(C)]":M.length>=2&&(_e="[(A)/(S)/(CE)/(D)/(U)/(L)/(R)/(W)/(H)]"),(Ce=new St).setMessage(we),Ce.setKeyWords(_e),Se=new nn,M.length<2?Se.copy(nn.kXAxis):(Te=M.length,Ae=M[Te-2].pt,De=M[Te-2].dBulge,ke=M[Te-1].pt,IsZero(De)?Se=new rn(ke.x,ke.y,0).sub(new rn(Ae.x,Ae.y,0)):((Le=new Gt).addVertexAt(Ae,De),Le.addVertexAt(ke),(Ee=Le.getFirstDeriv(new rn(ke.x,ke.y,0))).ret?Se=Ee.val:Se.copy(nn.kXAxis))),Ie=M[M.length-1],Ce.setUserDraw((function(t,h){var p=CMxDrawPolylineDragArcDraw_CalcArcBulge(Ie.pt,t,oe?Se.clone().negate():Se),x=new Gt;x.addVertexAt(Ie.pt,p,Ie.dStartWidth,Ie.dEndWidth),x.addVertexAt(t),h.drawMcDbEntity(x)})),ie.next=119,Ce.go();case 119:if(null===(Be=ie.sent)){ie.next=132;break}(Oe={}).dStartWidth=te,Oe.dEndWidth=re,Oe.dBulge=0,Oe.pt=Be,M[M.length-1].dBulge=CMxDrawPolylineDragArcDraw_CalcArcBulge(Ie.pt,Oe.pt,oe?Se.clone().negate():Se),M.push(Oe),(Re=M.length)>=2&&((Fe=new Gt).addVertexAt(M[Re-2].pt,M[Re-2].dBulge,M[Re-2].dStartWidth,M[Re-2].dEndWidth),Fe.addVertexAt(M[Re-1].pt),ne.push(ae.drawEntity(Fe))),ie.next=495;break;case 132:if(Ce.getStatus()!=h.MrxDbgUiPrBaseReturn.kKeyWord){ie.next=494;break}if(!Ce.isKeyWordPicked("A")){ie.next=215;break}return(Ne=new At).setBasePt(Ie.pt),Ne.setMessage(_ML_String("ID_ARX_PLGET_I_ANGLE","")),ie.next=139,Ne.go();case 139:if(null!==(Ve=ie.sent)){ie.next=142;break}return ie.abrupt("return",0);case 142:return Ce.setMessage("( Ctrl )"),Ce.setKeyWords("[(CE)/(R)]"),Ce.setLastInputPoint(Ie.pt),Ge=M[M.length-1].pt,je=function getBulge(t){var h=Math.PI/2-Ve/2,p=new rn((t.x+Ge.x)/2,(t.y+Ge.y)/2),x=p.distanceTo(Ge),M=x/Math.sin(h),k=x/Math.tan(h),I=p.sub(Ge).rotateBy(Math.PI/2).normalize().mult(oe?-M-k:M-k),N=p.addvec(I);return Mt.calcBulge(Ge,N,t).val},Ce.setUserDraw((function(t,h){var p=je(t),x=new Gt;x.addVertexAt(Ie.pt,p,Ie.dStartWidth,Ie.dEndWidth),x.addVertexAt(t),h.drawMcDbEntity(x)})),ie.next=150,Ce.go();case 150:if(Ue=ie.sent,!Ce.isKeyWordPicked("CE")){ie.next=174;break}return Ce.setMessage(""),Ce.setKeyWords(""),Ce.setBasePt(Ge),Ce.setUserDraw((function(t,h){var p=t.distanceTo(Ge),x=t.addvec(t.sub(Ge).rotateBy(Ve).normalize().mult(p)),M=je(x),k=new Gt;k.addVertexAt(Ie.pt,M,Ie.dStartWidth,Ie.dEndWidth),k.addVertexAt(x),h.drawMcDbEntity(k)})),ie.next=158,Ce.go();case 158:if(ze=ie.sent){ie.next=161;break}return ie.abrupt("return",0);case 161:return We=ze.distanceTo(Ge),He=ze.addvec(ze.sub(Ge).rotateBy(Ve).normalize().mult(We)),($e={}).dStartWidth=te,$e.dEndWidth=re,$e.dBulge=0,$e.pt=He,M[M.length-1].dBulge=je(He),M.push($e),(Xe=M.length)>=2&&((qe=new Gt).addVertexAt(M[Xe-2].pt,M[Xe-2].dBulge,M[Xe-2].dStartWidth,M[Xe-2].dEndWidth),qe.addVertexAt(M[Xe-1].pt),ne.push(ae.drawEntity(qe))),Ce.setLastInputPoint(He),ie.abrupt("return",1);case 174:if(!Ce.isKeyWordPicked("R")){ie.next=204;break}return(Ke=new Tt).setMessage(""),Ke.setKeyWords(""),ie.next=180,Ke.go();case 180:if("number"==typeof(Ye=ie.sent)){ie.next=183;break}return ie.abrupt("return",0);case 183:return Ze=Ye*Math.sin(Ve/2),Ce.setBasePt(Ge),Ce.setMessage("(Ctrl)"),Ce.setKeyWords(""),Ce.setUserDraw((function(t,h){var p=Ge.clone().addvec(t.sub(Ge).normalize().mult(2*Ze)),x=je(p),M=new Gt;M.addVertexAt(Ie.pt,x,Ie.dStartWidth,Ie.dEndWidth),M.addVertexAt(p),h.drawMcDbEntity(M)})),ie.next=190,Ce.go();case 190:if(Je=ie.sent){ie.next=193;break}return ie.abrupt("return",0);case 193:return Qe=Ge.clone().addvec(Je.sub(Ge).normalize().mult(2*Ze)),(et={}).dStartWidth=te,et.dEndWidth=re,et.dBulge=0,et.pt=Qe,M[M.length-1].dBulge=je(Qe),M.push(et),(tt=M.length)>=2&&((rt=new Gt).addVertexAt(M[tt-2].pt,M[tt-2].dBulge,M[tt-2].dStartWidth,M[tt-2].dEndWidth),rt.addVertexAt(M[tt-1].pt),ne.push(ae.drawEntity(rt))),ie.abrupt("return",1);case 204:if(Ue){ie.next=206;break}return ie.abrupt("return",0);case 206:(nt={}).dStartWidth=te,nt.dEndWidth=re,nt.dBulge=0,nt.pt=Ue,M[M.length-1].dBulge=je(Ue),M.push(nt),(it=M.length)>=2&&((ot=new Gt).addVertexAt(M[it-2].pt,M[it-2].dBulge,M[it-2].dStartWidth,M[it-2].dEndWidth),ot.addVertexAt(M[it-1].pt),ne.push(ae.drawEntity(ot)));case 215:if(!Ce.isKeyWordPicked("CE")){ie.next=311;break}return Ce.setMessage(""),Ce.setKeyWords(""),Ce.setUserDraw((function(){})),ie.next=221,Ce.go();case 221:if(st=ie.sent){ie.next=224;break}return ie.abrupt("return",{v:void 0});case 224:return ct=Ie.pt,ut=st.distanceTo(ct),Ce.setLastInputPoint(ct),Ce.setMessage("( Ctrl )"),Ce.setKeyWords("[(A)/(L)]"),Ce.clearLastInputPoint(),Ce.setUserDraw((function(t,h){h.drawLine(t.toVector3(),st.toVector3());var p=st.clone().addvec(t.sub(st).normalize().mult(ut)),x=st.sub(ct).angleTo2(st.sub(p),nn.kZAxis),M=new rn((ct.x+p.x)/2,(ct.y+p.y)/2),k=st.sub(M).normalize().mult(-ut),I=st.clone().addvec((oe?x<Math.PI:x>Math.PI)?k.negate():k),N=Mt.calcBulge(ct,I,p).val,V=new Gt;V.addVertexAt(Ie.pt,N,Ie.dStartWidth,Ie.dEndWidth),V.addVertexAt(p),h.drawMcDbEntity(V)})),ie.next=233,Ce.go();case 233:if(lt=ie.sent,!Ce.isKeyWordPicked("A")){ie.next=261;break}return(ht=new At).setBasePt(st),ht.setMessage(_ML_String("ID_ARX_PLGET_I_ANGLE","( Ctrl ")),ht.setKeyWords(""),ht.setUserDraw((function(t,h){var p=nn.kXAxis.clone().angleTo2(t.sub(st),nn.kZAxis),x=oe?2*Math.PI-p/2:p/2,M=ct.sub(st).rotateBy(x).normalize().mult(ut),k=ct.sub(st).rotateBy(p).normalize().mult(ut),I=st.clone().addvec(M),N=st.clone().addvec(k),V=Mt.calcBulge(ct,I,N).val,ee=new Gt;ee.addVertexAt(Ie.pt,V,Ie.dStartWidth,Ie.dEndWidth),ee.addVertexAt(N),h.drawMcDbEntity(ee)})),ie.next=242,ht.go();case 242:if(null!==(ft=ie.sent)){ie.next=245;break}return ie.abrupt("return",0);case 245:return dt=oe?2*Math.PI-ft/2:ft/2,pt=ct.sub(st).rotateBy(dt).normalize().mult(ut),mt=ct.sub(st).rotateBy(ft).normalize().mult(ut),gt=st.clone().addvec(pt),vt=st.clone().addvec(mt),yt=Mt.calcBulge(ct,gt,vt).val,(bt={}).dStartWidth=te,bt.dEndWidth=re,bt.dBulge=0,bt.pt=vt,M[M.length-1].dBulge=yt,M.push(bt),(xt=M.length)>=2&&((wt=new Gt).addVertexAt(M[xt-2].pt,M[xt-2].dBulge,M[xt-2].dStartWidth,M[xt-2].dEndWidth),wt.addVertexAt(M[xt-1].pt),ne.push(ae.drawEntity(wt))),ie.abrupt("return",1);case 261:if(!Ce.isKeyWordPicked("L")){ie.next=292;break}return(_t=new Tt).setMessage("( Ctrl )"),_t.setKeyWords(""),_t.setBasePt(ct),_t.setUserDraw((function(t,h){var p=t.distanceTo(ct);if(!(p>2*ut)){var x=2*Math.asin(p/2/ut),M=ct.sub(st).normalize().mult(ut),k=st.clone().addvec(M.clone().rotateBy(oe?Math.PI-x/2:x/2)),I=st.clone().addvec(M.clone().rotateBy(x)),N=Mt.calcBulge(ct,k,I).val,V=new Gt;V.addVertexAt(Ie.pt,N,Ie.dStartWidth,Ie.dEndWidth),V.addVertexAt(I),h.drawMcDbEntity(V)}})),ie.next=269,_t.go();case 269:if("number"==typeof(Ct=ie.sent)){ie.next=272;break}return ie.abrupt("return",0);case 272:if(!(Ct>2*ut)){ie.next=276;break}return h.MxFun.acutPrintf("* *"),Ce.setLastInputPoint(ct),ie.abrupt("return",1);case 276:return Dt=2*Math.asin(Ct/2/ut),kt=ct.sub(st).normalize().mult(ut),Pt=st.clone().addvec(kt.clone().rotateBy(oe?Math.PI-Dt/2:Dt/2)),Lt=st.clone().addvec(kt.clone().rotateBy(Dt)),Et=Mt.calcBulge(ct,Pt,Lt).val,(It={}).dStartWidth=te,It.dEndWidth=re,It.dBulge=0,It.pt=Lt,M[M.length-1].dBulge=Et,M.push(It),(Bt=M.length)>=2&&((Ot=new Gt).addVertexAt(M[Bt-2].pt,M[Bt-2].dBulge,M[Bt-2].dStartWidth,M[Bt-2].dEndWidth),Ot.addVertexAt(M[Bt-1].pt),ne.push(ae.drawEntity(Ot))),Ce.setLastInputPoint(Lt),ie.abrupt("return",1);case 292:if(lt){ie.next=294;break}return ie.abrupt("return",{v:void 0});case 294:return Rt=st.clone().addvec(lt.sub(st).normalize().mult(ut)),Ft=st.sub(ct).angleTo2(st.sub(Rt),nn.kZAxis),Nt=new rn((ct.x+Rt.x)/2,(ct.y+Rt.y)/2),Vt=st.sub(Nt).normalize().mult(-ut),jt=st.clone().addvec((oe?Ft<Math.PI:Ft>Math.PI)?Vt.negate():Vt),Ut=Mt.calcBulge(ct,jt,Rt).val,(zt={}).dStartWidth=te,zt.dEndWidth=re,zt.dBulge=0,zt.pt=Rt,M[M.length-1].dBulge=Ut,M.push(zt),(Wt=M.length)>=2&&((Ht=new Gt).addVertexAt(M[Wt-2].pt,M[Wt-2].dBulge,M[Wt-2].dStartWidth,M[Wt-2].dEndWidth),Ht.addVertexAt(M[Wt-1].pt),ne.push(ae.drawEntity(Ht))),Ce.setLastInputPoint(Rt),ie.abrupt("return",1);case 311:if(!Ce.isKeyWordPicked("R")){ie.next=383;break}return($t=new Tt).setMessage(_ML_String("ID_ARX_PLGETSTARTRADIUS","")),$t.setKeyWords(""),ie.next=317,$t.go();case 317:if(null!==(qt=ie.sent)){ie.next=320;break}return ie.abrupt("return",0);case 320:return Kt=Ie.pt,Ce.setLastInputPoint(Kt),Ce.setMessage("( Ctrl )"),Ce.setKeyWords("[(A)]"),Ce.setUserDraw((function(t,h){if(qt){var p=t.distanceTo(Kt);if(!(p>2*qt)){var x=Math.acos(p/2/qt),M=Kt.clone().addvec(t.sub(Kt).rotateBy(x).normalize().mult(qt)),k=M.clone().addvec(new rn((Kt.x+t.x)/2,(Kt.y+t.y)/2).sub(M).normalize().mult(oe?-qt:qt)),I=Mt.calcBulge(Kt,k,t).val,N=new Gt;N.addVertexAt(Ie.pt,I,Ie.dStartWidth,Ie.dEndWidth),N.addVertexAt(t),h.drawMcDbEntity(N)}}})),ie.next=327,Ce.go();case 327:if(Yt=ie.sent,!Ce.isKeyWordPicked("A")){ie.next=363;break}return(Zt=new At).setMessage(_ML_String("ID_ARX_PLGET_I_ANGLE","")),Zt.setKeyWords(""),Zt.setBasePt(Kt),ie.next=335,Zt.go();case 335:if("number"==typeof(Jt=ie.sent)){ie.next=338;break}return ie.abrupt("return",0);case 338:return Qt=Math.sin(Jt/2)*qt*2,Ce.setMessage("( Ctrl )"),Ce.setKeyWords(""),Ce.setBasePt(Kt),Ce.setUserDraw((function(t,h){if(qt){var p=t.sub(Kt).normalize(),x=Kt.clone().addvec(p.clone().mult(Qt)),M=x.clone().addvec(p.clone().negate().rotateBy(-(Math.PI/2-Jt/2)).mult(qt)),k=M.clone().addvec(M.sub(new rn((Kt.x+x.x)/2,(Kt.y+x.y)/2)).normalize().mult(oe?qt:-qt)),I=Mt.calcBulge(Kt,k,x).val,N=new Gt;N.addVertexAt(Ie.pt,I,Ie.dStartWidth,Ie.dEndWidth),N.addVertexAt(x),h.drawMcDbEntity(N)}})),ie.next=345,Ce.go();case 345:if(er=ie.sent){ie.next=348;break}return ie.abrupt("return",0);case 348:return tr=er.sub(Kt).normalize(),rr=Kt.clone().addvec(tr.clone().mult(Qt)),nr=rr.clone().addvec(tr.clone().negate().rotateBy(-(Math.PI/2-Jt/2)).mult(qt)),ir=nr.clone().addvec(nr.sub(new rn((Kt.x+rr.x)/2,(Kt.y+rr.y)/2)).normalize().mult(oe?qt:-qt)),ar=Mt.calcBulge(Kt,ir,rr).val,(or={}).dStartWidth=te,or.dEndWidth=re,or.dBulge=0,or.pt=rr,M[M.length-1].dBulge=ar,M.push(or),(sr=M.length)>=2&&((cr=new Gt).addVertexAt(M[sr-2].pt,M[sr-2].dBulge,M[sr-2].dStartWidth,M[sr-2].dEndWidth),cr.addVertexAt(M[sr-1].pt),ne.push(ae.drawEntity(cr))),ie.abrupt("return",1);case 363:if(Yt){ie.next=365;break}return ie.abrupt("return",0);case 365:if(!((ur=Yt.distanceTo(Kt))>2*qt)){ie.next=369;break}return h.MxFun.acutPrintf(" **"),ie.abrupt("return",1);case 369:return lr=Math.acos(ur/2/qt),hr=Kt.clone().addvec(Yt.sub(Kt).rotateBy(lr).normalize().mult(qt)),fr=hr.clone().addvec(new rn((Kt.x+Yt.x)/2,(Kt.y+Yt.y)/2).sub(hr).normalize().mult(oe?-qt:qt)),dr=Mt.calcBulge(Kt,fr,Yt).val,(pr={}).dStartWidth=te,pr.dEndWidth=re,pr.dBulge=0,pr.pt=Yt,M[M.length-1].dBulge=dr,M.push(pr),(mr=M.length)>=2&&((gr=new Gt).addVertexAt(M[mr-2].pt,M[mr-2].dBulge,M[mr-2].dStartWidth,M[mr-2].dEndWidth),gr.addVertexAt(M[mr-1].pt),ne.push(ae.drawEntity(gr))),ie.abrupt("return",1);case 383:if(!Ce.isKeyWordPicked("H")){ie.next=404;break}return(vr=new Tt).setMessage(_ML_String("ID_ARX_PLGETSTARTWIDTH","")),ie.next=388,vr.go();case 388:if(null!==ie.sent){ie.next=391;break}return ie.abrupt("return",0);case 391:return te=2*vr.value(),vr.setMessage(_ML_String("ID_ARX_PLGETVERITXWIDTH","")),ie.next=395,vr.go();case 395:if(null!==ie.sent){ie.next=398;break}return ie.abrupt("return",0);case 398:return re=2*vr.value(),k=re,M[M.length-1].dStartWidth=te,M[M.length-1].dEndWidth=re,te=re,ie.abrupt("return",1);case 404:if(!Ce.isKeyWordPicked("D")){ie.next=433;break}return Ce.setMessage(""),Ce.setKeyWords(""),Ce.setLastInputPoint(Ie.pt),Ce.setUserDraw((function(t,h){h.drawLine(t.toVector3(),Ie.pt.toVector3())})),ie.next=411,Ce.go();case 411:if(yr=ie.sent){ie.next=414;break}return ie.abrupt("return",0);case 414:return br=yr.sub(Ie.pt),Ce.setLastInputPoint(Ie.pt),Ce.setBasePt(Ie.pt),Ce.setMessage("( Ctrl )"),Ce.setKeyWords(""),Ce.setUserDraw((function(t,h){var p=CMxDrawPolylineDragArcDraw_CalcArcBulge(Ie.pt,t,oe?br.clone().negate():br),x=new Gt;x.addVertexAt(Ie.pt,p,Ie.dStartWidth,Ie.dEndWidth),x.addVertexAt(t),h.drawMcDbEntity(x)})),ie.next=422,Ce.go();case 422:return xr=ie.sent,(Mr={}).dStartWidth=te,Mr.dEndWidth=re,Mr.dBulge=0,Mr.pt=xr,M[M.length-1].dBulge=CMxDrawPolylineDragArcDraw_CalcArcBulge(Ie.pt,Mr.pt,oe?br.clone().negate():br),M.push(Mr),(wr=M.length)>=2&&((_r=new Gt).addVertexAt(M[wr-2].pt,M[wr-2].dBulge,M[wr-2].dStartWidth,M[wr-2].dEndWidth),_r.addVertexAt(M[wr-1].pt),ne.push(ae.drawEntity(_r))),ie.abrupt("return",1);case 433:if(!Ce.isKeyWordPicked("L")){ie.next=437;break}V=!0,ie.next=492;break;case 437:if(!Ce.isKeyWordPicked("S")){ie.next=463;break}return Cr=new rn(M[M.length-1].pt.x,M[M.length-1].pt.y,0),(Sr=new St).setMessage(_ML_String("NO1_ID_SPECIFY_ARC2","")),Sr.setBasePt(Cr),ie.next=444,Sr.go();case 444:if(null!==(Tr=ie.sent)){ie.next=447;break}return ie.abrupt("return",0);case 447:return(Ar=new St).setMessage(_ML_String("ID_CIRCULAR_ENDPOINT","( Ctrl )")),Ar.setUserDraw((function(t,h){var p=new Xt;p.computeArc(Cr.x,Cr.y,Tr.x,Tr.y,t.x,t.y);var x=Tr;oe&&(x=p.center.clone().addvec(p.center.clone().sub(x)),p.computeArc(Cr.x,Cr.y,x.x,x.y,t.x,t.y)),h.drawMcDbEntity(p)})),ie.next=452,Ar.go();case 452:if(null===(Dr=ie.sent)){ie.next=460;break}kr=Tr,oe&&((Pr=new Xt).computeArc(Cr.x,Cr.y,kr.x,kr.y,Dr.x,Dr.y),kr=Pr.center.clone().addvec(Pr.center.clone().sub(kr))),(Lr=Mt.calcBulge(Cr,kr,Dr)).ret?((Er={}).dStartWidth=te,Er.dEndWidth=re,Er.pt=Dr,Er.dBluge=0,M[M.length-1].dBulge=Lr.val,M.push(Er),(Ir=M.length)>=2&&((Br=new Gt).addVertexAt(M[Ir-2].pt,M[Ir-2].dBulge,M[Ir-2].dStartWidth,M[Ir-2].dEndWidth),Br.addVertexAt(M[Ir-1].pt),ne.push(ae.drawEntity(Br)))):h.MxFun.acutPrintf(_ML_String("ID_ENDPOINT_INVALID1","\n  **")),ie.next=461;break;case 460:return ie.abrupt("return",0);case 461:ie.next=492;break;case 463:if(!Ce.isKeyWordPicked("W")){ie.next=485;break}return(Or=new Tt).setMessage(_ML_String("ID_ARX_PLGETSTARTWIDTH","")),ie.next=468,Or.go();case 468:if(null!==ie.sent){ie.next=471;break}return ie.abrupt("return",0);case 471:return te=Or.value(),Or.setMessage(_ML_String("ID_ARX_PLGETVERITXWIDTH","")),ie.next=475,Or.go();case 475:if(null!==ie.sent){ie.next=478;break}return ie.abrupt("return",0);case 478:re=Or.value(),k=re,M[M.length-1].dStartWidth=te,M[M.length-1].dEndWidth=re,te=re,ie.next=492;break;case 485:if(!Ce.isKeyWordPicked("C")){ie.next=491;break}return M[M.length-1].dBulge=CMxDrawPolylineDragArcDraw_CalcArcBulge(Ie.pt,x,oe?Se.clone().negate():Se),N=!0,ie.abrupt("return",0);case 491:Ce.isKeyWordPicked("U")&&M.length>1&&(M.pop(),ne[ne.length-1].erase(),ne.pop(),M.length>0&&Ce.setLastInputPoint(M[M.length-1].pt));case 492:ie.next=495;break;case 494:return ie.abrupt("return",0);case 495:case"end":return ie.stop()}}),_loop)}));case 29:return pe.delegateYield(ue(),"t0",31);case 31:if(0!==(le=pe.t0)){pe.next=34;break}return pe.abrupt("break",40);case 34:if(1!==le){pe.next=36;break}return pe.abrupt("continue",29);case 36:if(!le){pe.next=38;break}return pe.abrupt("return",le.v);case 38:pe.next=29;break;case 40:for(ee&&(N=!0),he=0;he<ne.length;he++)ne[he].erase();if(!(M.length>1)){pe.next=47;break}for(fe=new Gt,de=0;de<M.length;de++)fe.addVertexAt(M[de].pt,M[de].dBulge,M[de].dStartWidth,M[de].dEndWidth);return fe.isClosed=N,pe.abrupt("return",ae.drawEntity(fe));case 47:window.removeEventListener("keydown",se),window.removeEventListener("keyup",ce);case 49:case"end":return pe.stop()}}),_callee)}))),_drawPolyLine.apply(this,arguments)}function computeRegularPolygonVertices(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rn,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rn,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,x=[];p=Math.max(3,p),x.push(h);for(var M=2*Math.PI/p,k=1;k<p;k++){var I=Math.cos(M*k),N=Math.sin(M*k),V=t.clone(),ee=h.clone(),te=ee.x-V.x,re=ee.y-V.y,ne=te*I-re*N+V.x,ie=te*N+re*I+V.y,ae=new rn(ne,ie);x.push(ae)}return x}function computePolygonVerticesFromMidpoint(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rn,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rn,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,x=h.x,M=h.y,k=t.x,I=t.y,N=Math.max(3,p),V=Math.sqrt(Math.pow(x-k,2)+Math.pow(M-I,2))/Math.cos(Math.PI/N),ee=Math.atan2(M-I,x-k)-Math.PI/N,te=[],re=0;re<N;re++){var ne=ee+2*re*Math.PI/N,ie=k+V*Math.cos(ne),ae=I+V*Math.sin(ne);te.push(new rn(ie,ae))}return te}function computePolygonVerticesFromEdge(t,h,p){for(var x=h.x-t.x,M=h.y-t.y,k=Math.sqrt(x*x+M*M),I=Math.atan2(M,x),N=2*Math.PI/Math.max(3,p),V=[t,h],ee=0;ee<p;ee++){var te=t.x+k*Math.cos(I+ee*N),re=t.y+k*Math.sin(I+ee*N);t=new rn(te,re),V.push(t)}return V}function drawPolygon(){return _drawPolygon.apply(this,arguments)}function _drawPolygon(){return _drawPolygon=_asyncToGenerator(ie.mark((function _callee2(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se;return ie.wrap((function _callee2$(ce){for(;;)switch(ce.prev=ce.next){case 0:if(V=new St,p){ce.next=11;break}return(ee=new Dt).setMessage("\n <5>"),ce.next=6,ee.go();case 6:if(p=ce.sent,ee.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ce.next=9;break}return ce.abrupt("return");case 9:ee.getStatus()===h.MrxDbgUiPrBaseReturn.kNone&&(p=5),ee.clearLastInputPoint();case 11:te=function(){var h=_asyncToGenerator(ie.mark((function _callee(){var h;return ie.wrap((function _callee$(x){for(;;)switch(x.prev=x.next){case 0:if(h=function createStarEndPointPolygon(t){var h=new Gt;return computePolygonVerticesFromEdge(k,t,p||5).forEach((function(t){h.addVertexAt(t)})),h.isClosed=!0,h},k){x.next=10;break}return V.setMessage("\n"),V.setKeyWords(""),x.next=6,V.go();case 6:if(k=x.sent){x.next=9;break}return x.abrupt("return");case 9:V.setUserDraw((function(t,p){p.drawMcDbEntity(h(t))}));case 10:if(I){x.next=15;break}return V.setMessage("\n"),x.next=14,V.go();case 14:I=x.sent;case 15:if(I){x.next=17;break}return x.abrupt("return");case 17:t.MxCpp.getCurrentMxCAD().drawEntity(h(I));case 18:case"end":return x.stop()}}),_callee)})));return function drawToEdgePolygon(){return h.apply(this,arguments)}}(),ce.next=16;break;case 15:return ce.abrupt("return",ce.sent);case 16:if(V.setMessage("\n"),V.setKeyWords("[(E)]"),V.setCursorType(h.MxCursorType.kCross),x){ce.next=23;break}return ce.next=22,V.go();case 22:x=ce.sent;case 23:if(x){ce.next=28;break}if(!V.isKeyWordPicked("e")){ce.next=27;break}return ce.next=27,te();case 27:return ce.abrupt("return");case 28:if("boolean"==typeof M){ce.next=38;break}return V.setMessage("\n"),V.setKeyWords("[(I)/(C)]"),V.clearLastInputPoint(),ce.next=34,V.go();case 34:if(V.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ce.next=36;break}return ce.abrupt("return");case 36:V.isKeyWordPicked("i")&&(M=!1),V.isKeyWordPicked("c")&&(M=!0);case 38:if(re=function createMcDbPolyline(h){var k=t.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),I=new Gt;return I.trueColor=new Cr(k),(M?computePolygonVerticesFromMidpoint(x,h,p):computeRegularPolygonVertices(x,h,p)).forEach((function(t){I.addVertexAt(t)})),I.isClosed=!0,I},ae=new nn,N){ce.next=52;break}return(oe=new Tt).setBasePt(x),oe.setUserDraw((function(t,h){h.drawMcDbEntity(re(t)),x&&(ae=t.sub(x))})),oe.setMessage(_ML_String("McDbPolyline_Radius","\n")),oe.setKeyWords(""),ce.next=48,oe.go();case 48:if(se=ce.sent){ce.next=51;break}return ce.abrupt("return");case 51:N=se;case 52:ae=ae.normalize().mult(N),ne=x.clone().addvec(ae),t.MxCpp.getCurrentMxCAD().drawEntity(re(ne),!0);case 55:case"end":return ce.stop()}}),_callee2)}))),_drawPolygon.apply(this,arguments)}function calculateEndPoint(t,h,p,x,M,k){var I=p-t,N=x-h,V=M/k,ee=I*Math.cos(V)-N*Math.sin(V),te=I*Math.sin(V)+N*Math.cos(V);return new rn(ee+=t,te+=h)}function findArcCenterWithRadius(t,h,p){var x=Math.sqrt(Math.pow(p,2)-(Math.pow(t.x-h.x,2)+Math.pow(t.y-h.y,2))/4),M=(t.x+h.x)/2,k=(t.y+h.y)/2;return new rn(M-x*(h.y-t.y)/Math.sqrt(Math.pow(t.x-h.x,2)+Math.pow(t.y-h.y,2)),k-x*(t.x-h.x)/Math.sqrt(Math.pow(t.x-h.x,2)+Math.pow(t.y-h.y,2)))}function findEndPoint(t,h,p,x){var M=h+p;return new rn(t.x+x*Math.cos(M),t.y+x*Math.sin(M))}function calculateChordLength(t,h,p){var x=Math.sqrt(Math.pow(h.x-t.x,2)+Math.pow(h.y-t.y,2)),M=h.x-t.x,k=h.y-t.y,I=p.x-t.x,N=p.y-t.y,V=M*I+k*N,ee=M*N-k*I,te=Math.atan2(ee,V);return 2*x*Math.sin(te/2)}function drawArc(){return _drawArc.apply(this,arguments)}function _drawArc(){return _drawArc=_asyncToGenerator(ie.mark((function _callee2(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye;return ie.wrap((function _callee2$(be){for(;;)switch(be.prev=be.next){case 0:p=t.MxCpp.getCurrentMxCAD(),x=new St,M=new Xt,ne=function draw(){},ae="\n:",oe="[(C)]",se=!1,ce=function keydown(t){t.ctrlKey&&(se=!0)},ue=function keyup(){se=!1},le=function onEventCtrlDown(){window.removeEventListener("keydown",ce),window.removeEventListener("keyup",ue),window.addEventListener("keydown",ce),window.addEventListener("keyup",ue)},he=new Bt,(fe=new Cr).setRGB(255,211,13),he.trueColor=fe,he.linetype="ACAD_ISO02W100",de=!1,me=function drawCenterArc(t,h){se?(M.startAngle=te,M.endAngle=ee):(M.startAngle=ee,M.endAngle=te),M.radius=re,M.center=V,he.endPoint=t,h.drawMcDbEntity(M),h.drawMcDbEntity(he)},ge=function draw3PArc(t){M.computeArc(k.x,k.y,I.x,I.y,N.x,N.y),t.drawMcDbEntity(M)},ve=ie.mark((function _loop(){var ce,ue,fe,ve,ye,be,xe;return ie.wrap((function _loop$(Me){for(;;)switch(Me.prev=Me.next){case 0:return x.setUserDraw(ne),x.setMessage(ae),x.setKeyWords(oe),Me.next=5,x.go();case 5:if(ce=Me.sent,!x.isKeyWordPicked("C")){Me.next=30;break}if(pe="C",de=!0,!k){Me.next=27;break}return x.setMessage("\n"),x.setKeyWords(""),Me.next=14,x.go();case 14:if(ue=Me.sent){Me.next=17;break}return Me.abrupt("return",{v:void 0});case 17:V=ue,ae="\n( ctrl )",oe="[(A)/(L)/(R)]",x.setLastInputPoint(V),he.startPoint=V,re=V.distanceTo(k),ne=function draw(t,h){ee=angleTo(V.x,V.y,k.x,k.y)-Math.PI,te=angleTo(V.x,V.y,t.x,t.y)-Math.PI,he.endPoint=t,me(t,h)},le(),Me.next=29;break;case 27:ae="\n",oe="";case 29:return Me.abrupt("return",0);case 30:if(!de){Me.next=124;break}if(!x.isKeyWordPicked("R")){Me.next=55;break}if("E"!==pe){Me.next=41;break}return fe=0,ve=function(){var t=_asyncToGenerator(ie.mark((function _callee(){return ie.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return x.setLastInputPoint(k),x.setMessage("\n( ctrl )"),x.setKeyWords(""),x.setLastInputPoint(k),he.startPoint=k,le(),ne=function draw(t,h){fe<0?(he.endPoint=t,h.drawMcDbEntity(he),fe=0):(re=t.distanceTo(k),V=findArcCenterWithRadius(k,N,re),ee=angleTo(V.x,V.y,k.x,k.y)-Math.PI,te=angleTo(V.x,V.y,N.x,N.y)-Math.PI,me(t,h),fe=calculateChordLength(V,k,N))},x.setUserDraw(ne),t.next=10,x.go();case 10:if(t.sent){t.next=13;break}return t.abrupt("return",!0);case 13:if(!((fe=calculateChordLength(V,k,N))<0)){t.next=20;break}return h.MxFun.acutPrintf("\n"+fe),fe=0,t.next=19,ve();case 19:return t.abrupt("return",t.sent);case 20:p.drawEntity(M);case 21:case"end":return t.stop()}}),_callee)})));return function run(){return t.apply(this,arguments)}}(),Me.next=37,ve();case 37:return Me.t0=Me.sent,Me.abrupt("return",{v:Me.t0});case 41:return x.setLastInputPoint(V),x.setMessage(_ML_String("draw_arc_id","<"+M.radius+">")),x.setKeyWords(""),x.setUserDraw((function(t,h){he.startPoint=V,he.endPoint=t,h.drawMcDbEntity(he)})),Me.next=47,x.go();case 47:if(ye=Me.sent){Me.next=50;break}return Me.abrupt("return",{v:void 0});case 50:re=ye.distanceTo(V),ae="\n( ctrl )",oe="[(A)/(L)/(R)]",le();case 54:return Me.abrupt("return",0);case 55:if(!x.isKeyWordPicked("A")){Me.next=74;break}if("C"!==pe&&"L"!==pe){Me.next=66;break}return ae="( ctrl )",oe="[(R)]",ee=Math.PI+angleTo(V.x,V.y,k.x,k.y),x.setLastInputPoint(V),he.startPoint=V,re||(re=V.distanceTo(k)),ne=function draw(t,h){var p,x,M,I,ne,ie,ae,oe,se=angleTo(V.x,V.y,t.x,t.y)-Math.PI;N=findEndPoint(V,ee,se,re),p=V,M=N,I=ee,ne={x:(x=k).x-p.x,y:x.y-p.y},ie={x:M.x-p.x,y:M.y-p.y},ae=Math.atan2(ne.y,ne.x),(oe=Math.atan2(ie.y,ie.x)-ae)<0&&(oe+=2*Math.PI),te=I+oe,me(t,h)},le(),Me.abrupt("return",0);case 66:if("E"!==pe){Me.next=74;break}return ae="( ctrl )",oe="",x.setLastInputPoint(k),he.startPoint=k,ne=function draw(t,h){var p=angleTo(k.x,k.y,t.x,t.y)-Math.PI;V=findArcCenter(k,N,p),re=V.distanceTo(k),ee=angleTo(V.x,V.y,k.x,k.y)-Math.PI,te=angleTo(V.x,V.y,N.x,N.y)-Math.PI,me(t,h)},le(),Me.abrupt("return",0);case 74:if(!x.isKeyWordPicked("L")){Me.next=83;break}return pe="L",ae="\n( ctrl )",oe="[(R)]",x.setLastInputPoint(k),he.startPoint=k,ne=function draw(t,h){var p=t.distanceTo(k);if(p>2*re)return he.endPoint=t,void h.drawMcDbEntity(he);N=calculateEndPoint(V.x,V.y,k.x,k.y,p,M.radius),te=angleTo(V.x,V.y,N.x,N.y)-Math.PI,me(t,h)},le(),Me.abrupt("return",0);case 83:if(!x.isKeyWordPicked("D")){Me.next=98;break}return x.setMessage("\n( ctrl "),x.setKeyWords(""),x.setLastInputPoint(k),he.startPoint=k,be=new Gt,le(),x.setUserDraw((function(t,h){var p=t.sub(k),x=CMxDrawPolylineDragArcDraw_CalcArcBulge(se?k:N,se?N:k,p);(be=new Gt).addVertexAt(k,x),be.addVertexAt(N),he.endPoint=t,h.drawMcDbEntity(be),h.drawMcDbEntity(he)})),Me.next=93,x.go();case 93:if(Me.sent){Me.next=96;break}return Me.abrupt("return",{v:void 0});case 96:return p.drawEntity(be),Me.abrupt("return",{v:void 0});case 98:if(ce){Me.next=100;break}return Me.abrupt("return",{v:void 0});case 100:if("L"!==pe){Me.next=106;break}if(!(ce.distanceTo(k)>2*re)){Me.next=106;break}return x.clearLastInputPoint(),h.MxFun.acutPrintf("\n"+re),Me.abrupt("return",0);case 106:if(V){Me.next=111;break}return V=ce,ae="\n",ne=function draw(t,h){h.drawLine(t.toVector3(),V.toVector3())},Me.abrupt("return",0);case 111:if(k){Me.next=122;break}return k=ce,ee=angleTo(V.x,V.y,k.x,k.y)-Math.PI,re=k.distanceTo(V),ae="\n( ctrl )",oe="[(A)/(L)/(R)]",x.setLastInputPoint(V),he.startPoint=V,ne=function draw(t,h){te=angleTo(V.x,V.y,t.x,t.y)-Math.PI,me(t,h)},le(),Me.abrupt("return",0);case 122:return p.drawEntity(M),Me.abrupt("return",{v:void 0});case 124:if(!x.isKeyWordPicked("E")){Me.next=146;break}return pe="E",x.clearLastInputPoint(),x.setMessage("\n"),x.setKeyWords(""),he.startPoint=k,x.setUserDraw((function(t,h){he.endPoint=t,h.drawMcDbEntity(he)})),Me.next=134,x.go();case 134:if(xe=Me.sent){Me.next=137;break}return Me.abrupt("return",{v:void 0});case 137:return N=xe,de=!0,ae="\n( ctrl )",oe="[(A)/(D)/(R)]",x.setLastInputPoint(N),he.startPoint=N,ne=function draw(t,h){re=(V=t).distanceTo(k),ee=angleTo(V.x,V.y,k.x,k.y)-Math.PI,te=angleTo(V.x,V.y,N.x,N.y)-Math.PI,me(t,h)},le(),Me.abrupt("return",0);case 146:if(ce){Me.next=148;break}return Me.abrupt("return",{v:void 0});case 148:if(k){Me.next=155;break}return k=ce,ae="\n",oe="[(C)/(E)]",ne=function draw(t,h){h.drawLine(k.toVector3(),t.toVector3())},x.clearLastInputPoint(),Me.abrupt("return",0);case 155:if(I){Me.next=161;break}return I=ce,ae="\n",oe="",ne=function draw(t,h){N=t,ge(h)},Me.abrupt("return",0);case 161:return ne(I,{drawMcDbEntity:function drawMcDbEntity(h){t.MxCpp.getCurrentMxCAD().drawEntity(h,!0)}}),Me.abrupt("return",{v:void 0});case 163:case"end":return Me.stop()}}),_loop)}));case 19:return be.delegateYield(ve(),"t0",21);case 21:if(0!==(ye=be.t0)){be.next=24;break}return be.abrupt("continue",19);case 24:if(!ye){be.next=26;break}return be.abrupt("return",ye.v);case 26:be.next=19;break;case 28:case"end":return be.stop()}}),_callee2)}))),_drawArc.apply(this,arguments)}function drawEllipticalArc(){return _drawEllipticalArc.apply(this,arguments)}function _drawEllipticalArc(){return _drawEllipticalArc=_asyncToGenerator(ie.mark((function _callee(){var h,p,x,M,k,I,N,V,ee;return ie.wrap((function _callee$(te){for(;;)switch(te.prev=te.next){case 0:M=1,k=0,I=2*Math.PI,0,N=function createEllipse(){var t=new qt;return t.center=h,t.majorAxis=p,t.minorAxis=x,t.radiusRatio=M,t.startAngle=k,t.endAngle=I,t.rotate(h,0),t},V=ie.mark((function _loop(){var V,ee,te,re,ne,ae,oe,se,ce,ue,le,he;return ie.wrap((function _loop$(ie){for(;;)switch(ie.prev=ie.next){case 0:return(V=new St).setMessage(""),V.setKeyWords("[(C)]"),ie.next=5,V.go();case 5:if(ee=ie.sent,te=0,re=null,!V.isKeyWordPicked("C")){ie.next=29;break}return V.setMessage(""),V.setKeyWords(""),V.clearLastInputPoint(),ie.next=14,V.go();case 14:if(ne=ie.sent){ie.next=17;break}return ie.abrupt("return",{v:void 0});case 17:return h=ne,V.setMessage(""),V.setBasePt(h),ie.next=22,V.go();case 22:if(re=ie.sent){ie.next=25;break}return ie.abrupt("return",{v:void 0});case 25:p=x=h.sub(re),te=h.distanceTo(re),ie.next=42;break;case 29:if(ee){ie.next=31;break}return ie.abrupt("return",{v:void 0});case 31:return V.setBasePt(ee),V.setMessage(""),V.setKeyWords(""),ie.next=36,V.go();case 36:if(re=ie.sent){ie.next=39;break}return ie.abrupt("return",{v:void 0});case 39:h=new rn((ee.x+re.x)/2,(ee.y+re.y)/2),p=x=ee.sub(re),te=ee.distanceTo(re)/2;case 42:return(ae=new Tt).setMessage(_ML_String("McDbEllipse_lengh","")),ae.setKeyWords("[(R)]"),ae.setBasePt(h),ae.setUserDraw((function(t,p){var x=h.distanceTo(t)/2;M=x/te;var k=N();p.drawMcDbEntity(k)})),ie.next=49,ae.go();case 49:if(oe=ie.sent,!ae.isKeyWordPicked("R")){ie.next=63;break}return ae.setMessage(_ML_String("McDbEllipse_Rotation","")),ae.setKeyWords(""),ae.setBasePt(h),ae.setUserDraw((function(t,p){var x=Math.abs(t.x-h.x),k=Math.abs(t.y-h.y);M=x/(x+k);var I=N();p.drawMcDbEntity(I)})),ie.next=57,ae.go();case 57:if(se=ie.sent){ie.next=60;break}return ie.abrupt("return",{v:void 0});case 60:8===ae.getDetailedResult()&&(M=se),ie.next=67;break;case 63:if(oe){ie.next=65;break}return ie.abrupt("return",{v:void 0});case 65:M=oe/2/te;case 67:if(re){ie.next=69;break}return ie.abrupt("return",{v:void 0});case 69:return ce=Math.atan2(p.y,p.x)-Math.PI/2,ae.setMessage(_ML_String("McDbEllipse_startAngle","")),ae.setKeyWords(""),ae.setBasePt(h),ae.setUserDraw((function(t,p){var x=Math.atan2(t.y-h.y,t.x-h.x);k=(x-ce+2*Math.PI)%(2*Math.PI);var M=N();p.drawMcDbEntity(M)})),ie.next=76,ae.go();case 76:if(ue=ie.sent){ie.next=79;break}return ie.abrupt("return",{v:void 0});case 79:return 8===ae.getDetailedResult()&&(k=ue),ae.clearLastInputPoint(),ae.setBasePt(h),ae.setMessage(_ML_String("McDbEllipse_endAngle","")),ae.setKeyWords("[(I)]"),ae.setUserDraw((function(t,p){var x=Math.atan2(t.y-h.y,t.x-h.x);(I=(x-ce+2*Math.PI)%(2*Math.PI))<k&&(I+=2*Math.PI);var M=N();p.drawMcDbEntity(M)})),ie.next=87,ae.go();case 87:if(le=ie.sent,!ae.isKeyWordPicked("I")){ie.next=99;break}return ae.setMessage(_ML_String("McDbEllipse_IncludedAngle","")),ae.setKeyWords(""),ae.setUserDraw((function(t,p){I=angleTo(h.x,h.y,t.x,t.y);var x=N();p.drawMcDbEntity(x)})),ie.next=94,ae.go();case 94:if(he=ie.sent){ie.next=97;break}return ie.abrupt("return",{v:void 0});case 97:return 8===ae.getDetailedResult()&&(I=he),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(N())});case 99:if(le){ie.next=101;break}return ie.abrupt("return",{v:void 0});case 101:return 8===ae.getDetailedResult()&&(I=le),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(N())});case 103:case"end":return ie.stop()}}),_loop)}));case 6:return te.delegateYield(V(),"t0",8);case 8:if(!(ee=te.t0)){te.next=11;break}return te.abrupt("return",ee.v);case 11:te.next=6;break;case 13:case"end":return te.stop()}}),_callee)}))),_drawEllipticalArc.apply(this,arguments)}function drawMxDbEllipse(){return _drawMxDbEllipse.apply(this,arguments)}function _drawMxDbEllipse(){return(_drawMxDbEllipse=_asyncToGenerator(ie.mark((function _callee2(){var p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee2$(ne){for(;;)switch(ne.prev=ne.next){case 0:p=new St,I=1,N=0,V=2*Math.PI,p.setMessage("\n"),p.setKeyWords("[(A)/(C)]"),ee=function createEllipse(){var t=new qt;return t.center=x,t.majorAxis=M,t.minorAxis=k,t.radiusRatio=I,t.startAngle=N,t.endAngle=V,t},te=ie.mark((function _loop2(){var te,re,ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye;return ie.wrap((function _loop2$(ie){for(;;)switch(ie.prev=ie.next){case 0:return te=!1,re=!1,ne=!1,ie.next=5,p.go();case 5:if(ae=ie.sent,!p.isKeyWordPicked("A")){ie.next=17;break}return p.setMessage("\n"),p.setKeyWords("[(C)]"),ie.next=11,p.go();case 11:if(oe=ie.sent,p.isKeyWordPicked("C")&&(ne=!0),oe||ne){ie.next=15;break}return ie.abrupt("return",{v:void 0});case 15:oe&&(ae=oe),te=!0;case 17:if(!p.isKeyWordPicked("C")&&!ne){ie.next=27;break}return p.setMessage("\n"),p.setKeyWords(""),ie.next=22,p.go();case 22:if(se=ie.sent){ie.next=25;break}return ie.abrupt("return",{v:void 0});case 25:x=ae=se,re=!0;case 27:if(ae||te||re){ie.next=29;break}return ie.abrupt("return",{v:void 0});case 29:return p.setUserDraw((function(t,h){h.drawMcDbLine(ae.x,ae.y,ae.z,t.x,t.y,t.z)})),p.setMessage(re?"\n":"\n"),p.setKeyWords(""),ie.next=34,p.go();case 34:if(ce=ie.sent){ie.next=37;break}return ie.abrupt("return",{v:void 0});case 37:return x=re?ae:new rn((ae.x+ce.x)/2,(ae.y+ce.y)/2),(ue=new Tt).setBasePt(x),le=ae.distanceTo(ce)/2,k=M=ae.sub(ce),he=function drawEllipse(t,h){var p=ee(),M=new Bt(x,t);M.trueColor=new Cr,M.trueColor.setRGB(255,255,0),h.drawMcDbEntity(M),h.drawMcDbEntity(p)},ue.setUserDraw((function(t,h){var p=x.distanceTo(t)/2;I=p/le,he(t,h)})),ue.setMessage(_ML_String("EllipticalArc_length","")),ue.setKeyWords(""),ie.next=48,ue.go();case 48:if(fe=ie.sent){ie.next=51;break}return ie.abrupt("return",{v:void 0});case 51:if(ue.getDetailedResult()===h.DetailedResult.kCoordIn&&(I=fe/2/le),ue.setLastInputPoint(x),!te){ie.next=86;break}return ue.setMessage(_ML_String("EllipticalArc_startAngle","")),ue.setKeyWords(""),de=Math.atan2(M.y,M.x)-Math.PI/2,ue.setUserDraw((function(t,h){var p=Math.atan2(t.y-x.y,t.x-x.x);N=(p-de+2*Math.PI)%(2*Math.PI),he(t,h)})),ie.next=60,ue.go();case 60:if(pe=ie.sent){ie.next=63;break}return ie.abrupt("return",{v:void 0});case 63:return ue.getDetailedResult()==h.DetailedResult.kCoordIn&&(N=pe),ue.setLastInputPoint(x),ue.setMessage(_ML_String("EllipticalArc_endAngle","")),ue.setKeyWords("[(I)]"),ue.setUserDraw((function(t,h){var p=Math.atan2(t.y-x.y,t.x-x.x);(V=(p-de+2*Math.PI)%(2*Math.PI))<N&&(V+=2*Math.PI),he(t,h)})),ie.next=70,ue.go();case 70:if(me=ie.sent,!ue.isKeyWordPicked("I")){ie.next=83;break}return ue.setMessage("\n"),ue.setKeyWords(""),ue.setUserDraw((function(t,h){V=angleTo(x.x,x.y,t.x,t.y)-Math.PI,he(t,h)})),ie.next=77,ue.go();case 77:if(ge=ie.sent){ie.next=80;break}return ie.abrupt("return",{v:void 0});case 80:return ue.getDetailedResult()===h.DetailedResult.kCoordIn&&(V=ge),ve=ee(),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(ve)});case 83:if(me){ie.next=85;break}return ie.abrupt("return",{v:void 0});case 85:ue.getDetailedResult()===h.DetailedResult.kCoordIn&&(V=me);case 86:return ye=ee(),ie.abrupt("return",{v:t.MxCpp.getCurrentMxCAD().drawEntity(ye)});case 88:case"end":return ie.stop()}}),_loop2)}));case 8:return ne.delegateYield(te(),"t0",10);case 10:if(!(re=ne.t0)){ne.next=13;break}return ne.abrupt("return",re.v);case 13:ne.next=8;break;case 15:case"end":return ne.stop()}}),_callee2)})))).apply(this,arguments)}function Mx_Erase(){return _Mx_Erase.apply(this,arguments)}function _Mx_Erase(){return(_Mx_Erase=_asyncToGenerator(ie.mark((function _callee2(){var t,h;return ie.wrap((function _callee2$(p){for(;;)switch(p.prev=p.next){case 0:if(!((t=Mt.getCurrentSelect()).length>0)){p.next=4;break}return t.forEach((function(t){t.erase()})),p.abrupt("return");case 4:return h=new _t,p.next=7,h.userSelect("\n");case 7:if(p.sent){p.next=9;break}return p.abrupt("return");case 9:h.forEach((function(t){t.erase()}));case 10:case"end":return p.stop()}}),_callee2)})))).apply(this,arguments)}function MxGetMcDbEntityBoundingBox(t){var h=void 0,p=void 0;return t.forEach((function(t){var x=t.getMcDbEntity();if(null!=x){var M=x.getBoundingBox();M.ret&&(h&&p?(h.x>M.minPt.x&&(h.x=M.minPt.x),h.y>M.minPt.y&&(h.y=M.minPt.y),p.x<M.maxPt.x&&(p.x=M.maxPt.x),p.y<M.maxPt.y&&(p.y=M.maxPt.y)):(h=new THREE.Vector3(M.minPt.x,M.minPt.y,0),p=new THREE.Vector3(M.maxPt.x,M.maxPt.y,0)))}})),h&&p?{minPt:h,maxPt:p}:void 0}function Mx_Copy(){return _Mx_Copy.apply(this,arguments)}function _Mx_Copy(){return _Mx_Copy=_asyncToGenerator(ie.mark((function _callee3(){var h,p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee3$(ne){for(;;)switch(ne.prev=ne.next){case 0:if(!((h=Mt.getCurrentSelect()).length>0)){ne.next=4;break}return ne.abrupt("break",15);case 4:return p=new _t,ne.next=7,p.userSelect("\n");case 7:if(ne.sent){ne.next=9;break}return ne.abrupt("return");case 9:if(0!=(h=p.getIds()).length){ne.next=12;break}return ne.abrupt("return");case 12:return ne.abrupt("break",15);case 15:return h.length>=10&&(k=MxGetMcDbEntityBoundingBox(h))&&(x=k.minPt,M=k.maxPt),(I=new St).setMessage("\n"),ne.next=20,I.go();case 20:if(N=ne.sent){ne.next=23;break}return ne.abrupt("return");case 23:I.setMessage(""),I.setBasePt(N),I.setUseBasePt(!0),I.setUserDraw((function(p,k){if(x&&M){var I=p.x-N.x,V=p.y-N.y,ee=new THREE.Vector3(x.x+I,M.y+V,0),te=new THREE.Vector3(M.x+I,x.y+V,0),re=new THREE.Vector3(ee.x,te.y,0),ne=new THREE.Vector3(te.x,ee.y,0);ee=t.MxCoordConvert.cad2doc2(ee.x,ee.y,ee.z),te=t.MxCoordConvert.cad2doc2(te.x,te.y,te.z),re=t.MxCoordConvert.cad2doc2(re.x,re.y,re.z),ne=t.MxCoordConvert.cad2doc2(ne.x,ne.y,ne.z),k.drawLine(ne,ee),k.drawLine(ee,re),k.drawLine(re,te),k.drawLine(te,ne)}for(var ie=0;ie<h.length&&ie<10;ie++){var ae=h[ie].clone();ae&&(ae.move(N,p),k.drawMcDbEntity(ae))}}));case 27:return ne.next=30,I.go();case 30:if(V=ne.sent){ne.next=33;break}return ne.abrupt("return");case 33:ee=0;case 34:if(!(ee<h.length)){ne.next=43;break}if(te=h[ee].clone()){ne.next=38;break}return ne.abrupt("continue",40);case 38:(re=t.MxCpp.getCurrentMxCAD().drawEntity(te).getMcDbEntity())&&(re instanceof zt?re.needToUpdateDimBlock(!1):re instanceof jt&&h[ee].getMcDbEntity().copyAttribute(re),re.move(N,V));case 40:ee++,ne.next=34;break;case 43:ne.next=27;break;case 45:case"end":return ne.stop()}}),_callee3)}))),_Mx_Copy.apply(this,arguments)}function Mx_Move(){return _Mx_Move.apply(this,arguments)}function _Mx_Move(){return _Mx_Move=_asyncToGenerator(ie.mark((function _callee4(){var h,p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee4$(ne){for(;;)switch(ne.prev=ne.next){case 0:if(!((h=Mt.getCurrentSelect()).length>0)){ne.next=4;break}return ne.abrupt("break",15);case 4:return p=new _t,ne.next=7,p.userSelect("\n");case 7:if(ne.sent){ne.next=9;break}return ne.abrupt("return");case 9:if(0!=(h=p.getIds()).length){ne.next=12;break}return ne.abrupt("return");case 12:return ne.abrupt("break",15);case 15:return h.length>=10&&(k=MxGetMcDbEntityBoundingBox(h))&&(x=k.minPt,M=k.maxPt),(I=new St).setMessage(""),I.clearLastInputPoint(),ne.next=21,I.go();case 21:if(N=ne.sent){ne.next=24;break}return ne.abrupt("return");case 24:return I.setMessage(""),I.setBasePt(N),I.setUseBasePt(!0),V=function highlight(t){for(var p=0;p<h.length;p++){var x=h[p].getMcDbEntity();x&&x.highlight(t)}},V(!0),I.setUserDraw((function(p,k){if(x&&M){var I=p.x-N.x,V=p.y-N.y,ee=new THREE.Vector3(x.x+I,M.y+V,0),te=new THREE.Vector3(M.x+I,x.y+V,0),re=new THREE.Vector3(ee.x,te.y,0),ne=new THREE.Vector3(te.x,ee.y,0);ee=t.MxCoordConvert.cad2doc2(ee.x,ee.y,ee.z),te=t.MxCoordConvert.cad2doc2(te.x,te.y,te.z),re=t.MxCoordConvert.cad2doc2(re.x,re.y,re.z),ne=t.MxCoordConvert.cad2doc2(ne.x,ne.y,ne.z),k.drawLine(ne,ee),k.drawLine(ee,re),k.drawLine(re,te),k.drawLine(te,ne)}for(var ie=0;ie<h.length&&ie<10;ie++){var ae=h[ie].clone();ae&&(N&&ae.move(N,p),k.drawMcDbEntity(ae))}})),ne.next=32,I.go();case 32:if(ee=ne.sent){ne.next=35;break}return ne.abrupt("return",V(!1));case 35:V(!1),te=0;case 37:if(!(te<h.length)){ne.next=46;break}if(re=h[te].getMcDbObject()){ne.next=41;break}return ne.abrupt("continue",43);case 41:re.move(N,ee),re instanceof zt&&re.needToUpdateDimBlock(!1);case 43:te++,ne.next=37;break;case 46:case"end":return ne.stop()}}),_callee4)}))),_Mx_Move.apply(this,arguments)}function Mx_Rotate(){return _Mx_Rotate.apply(this,arguments)}function _Mx_Rotate(){return _Mx_Rotate=_asyncToGenerator(ie.mark((function _callee5(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe;return ie.wrap((function _callee5$(se){for(;;)switch(se.prev=se.next){case 0:if(!((p=Mt.getCurrentSelect()).length>0)){se.next=4;break}return se.abrupt("break",15);case 4:return x=new _t,se.next=7,x.userSelect("\n");case 7:if(se.sent){se.next=9;break}return se.abrupt("return");case 9:if(0!=(p=x.getIds()).length){se.next=12;break}return se.abrupt("return");case 12:return se.abrupt("break",15);case 15:return(I=MxGetMcDbEntityBoundingBox(p))&&(M=I.minPt,k=I.maxPt),(N=new St).setMessage(""),se.next=21,N.go();case 21:if(null!=(V=se.sent)){se.next=24;break}return se.abrupt("return");case 24:ee=!1,te=0,(re=new At).setMessage(_ML_String("Entity_Rotate_Angle","")),re.setKeyWords("[(C)/(R)]"),re.setBasePt(V),re.setUseBasePt(!0),ne=function highlight(t){for(var h=0;h<p.length;h++){var x=p[h].getMcDbEntity();x&&x.highlight(t)}},ne(!0),se.prev=33,ae=ie.mark((function _loop(){var x,I,N,ae,oe,se,ce,ue,le,he,fe,de;return ie.wrap((function _loop$(ie){for(;;)switch(ie.prev=ie.next){case 0:return re.setUserDraw((function(h,x){var I=V,N=h.sub(I).angleTo2(nn.kXAxis,nn.kNegateZAxis)-te,ee=new sn;if(ee.setToRotation(N,nn.kZAxis,I),M&&k){var re=new rn(M.x,k.y,0),ne=new rn(k.x,M.y,0),ie=new rn(re.x,ne.y,0),ae=new rn(ne.x,re.y,0);re.transformBy(ee),ne.transformBy(ee),ie.transformBy(ee),ae.transformBy(ee),re=t.MxCoordConvert.cad2doc(re),ne=t.MxCoordConvert.cad2doc(ne),ie=t.MxCoordConvert.cad2doc(ie),ae=t.MxCoordConvert.cad2doc(ae),x.drawLine(ae.toVector3(),re.toVector3()),x.drawLine(re.toVector3(),ie.toVector3()),x.drawLine(ie.toVector3(),ne.toVector3()),x.drawLine(ne.toVector3(),ae.toVector3())}ee.setToRotation(N,nn.kZAxis,I);for(var oe=0;oe<p.length&&oe<10;oe++){var se=p[oe].clone();se&&(se.transformBy(ee),x.drawMcDbEntity(se))}})),ie.next=3,re.go();case 3:if(x=ie.sent,!re.isKeyWordPicked("C")){ie.next=8;break}return ee=!0,ne(!1),ie.abrupt("return",0);case 8:if(!re.isKeyWordPicked("R")){ie.next=22;break}return(I=new Tt).setMessage(_ML_String("Entity_Rotate_Ref_Angle",":<"+(te/(Math.PI/180)).toFixed(3)+">")),I.setKeyWords(""),I.setUseBasePt(!1),N=0,I.setUserDraw((function(t){if(V){var h=t.sub(V);N=h.angleTo2(nn.kXAxis,nn.kNegateZAxis)}})),ie.next=17,I.go();case 17:if("number"==typeof(ae=ie.sent)){ie.next=20;break}return ie.abrupt("return",{v:ne(!1)});case 20:return I.getDetailedResult()===h.DetailedResult.kCoordIn?te=THREE.MathUtils.degToRad(ae):0!==N&&(te=N),ie.abrupt("return",0);case 22:if("number"==typeof x){ie.next=24;break}return ie.abrupt("return",{v:ne(!1)});case 24:if(oe=V,(se=new sn).setToRotation(x-te,nn.kZAxis,oe),ce=function isMcDbEntity(t){return t instanceof Et},!ee){ie.next=42;break}ue=[],le=0;case 31:if(!(le<p.length)){ie.next=39;break}if(he=p[le].clone()){ie.next=35;break}return ie.abrupt("continue",36);case 35:ce(he)&&(he.transformBy(se),ue.push(t.MxCpp.getCurrentMxCAD().drawEntity(he)));case 36:le++,ie.next=31;break;case 39:return ie.abrupt("return",{v:ue});case 42:ne(!1),fe=0;case 44:if(!(fe<p.length)){ie.next=52;break}if(de=p[fe].getMcDbObject()){ie.next=48;break}return ie.abrupt("continue",49);case 48:de.transformBy(se);case 49:fe++,ie.next=44;break;case 52:return ie.abrupt("return",{v:p});case 53:case"end":return ie.stop()}}),_loop)}));case 35:return se.delegateYield(ae(),"t0",37);case 37:if(0!==(oe=se.t0)){se.next=40;break}return se.abrupt("continue",35);case 40:if(!oe){se.next=42;break}return se.abrupt("return",oe.v);case 42:se.next=35;break;case 44:se.next=50;break;case 46:se.prev=46,se.t1=se.catch(33),ne(!1);case 50:case"end":return se.stop()}}),_callee5,null,[[33,46]])}))),_Mx_Rotate.apply(this,arguments)}function Mx_Scale(){return _Mx_Scale.apply(this,arguments)}function _Mx_Scale(){return _Mx_Scale=_asyncToGenerator(ie.mark((function _callee6(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe;return ie.wrap((function _callee6$(ie){for(;;)switch(ie.prev=ie.next){case 0:if(!((p=Mt.getCurrentSelect()).length>0)){ie.next=4;break}return ie.abrupt("break",15);case 4:return x=new _t,ie.next=7,x.userSelect("\n");case 7:if(ie.sent){ie.next=9;break}return ie.abrupt("return");case 9:if(0!=(p=x.getIds()).length){ie.next=12;break}return ie.abrupt("return");case 12:return ie.abrupt("break",15);case 15:if(I=MxGetMcDbEntityBoundingBox(p)){ie.next=18;break}return ie.abrupt("return");case 18:return M=I.minPt,k=I.maxPt,N=k.x-M.x,V=k.y-M.y,(ee=(N+V)/3)<1e-5&&(ee=1),(te=new St).setMessage(""),ie.next=28,te.go();case 28:if(re=ie.sent){ie.next=31;break}return ie.abrupt("return");case 31:ne=0,ae=!1,oe=function draw(h,x){if(re){var I=new rn(h),N=new rn(re),V=I.distanceTo(N);if(!(V<1e-5)){(ne=V/ee)>1e5&&(ne=1e5);var te=new sn;if(te.setToScaling(ne,N),M&&k){var ie=new rn(M.x,k.y,0),ae=new rn(k.x,M.y,0),oe=new rn(ie.x,ae.y,0),se=new rn(ae.x,ie.y,0);ie.transformBy(te),ae.transformBy(te),oe.transformBy(te),se.transformBy(te),ie=t.MxCoordConvert.cad2doc(ie),ae=t.MxCoordConvert.cad2doc(ae),oe=t.MxCoordConvert.cad2doc(oe),se=t.MxCoordConvert.cad2doc(se),x.drawLine(se.toVector3(),ie.toVector3()),x.drawLine(ie.toVector3(),oe.toVector3()),x.drawLine(oe.toVector3(),ae.toVector3()),x.drawLine(ae.toVector3(),se.toVector3())}te.setToScaling(ne,N);for(var ce=0;ce<p.length&&ce<10;ce++){var ue=p[ce].clone();ue&&(ue.transformBy(te),x.drawMcDbEntity(ue))}}}},se=function highlight(t){for(var h=0;h<p.length;h++){var x=p[h].getMcDbEntity();x&&x.highlight(t)}},se(!0),ie.prev=36;case 37:return(ce=new Tt).setMessage(""),ce.setKeyWords("[(C)/(R)]"),ce.setBasePt(re),ce.setUseBasePt(!0),ce.setUserDraw(oe),ie.next=46,ce.go();case 46:if(ue=ie.sent,!ce.isKeyWordPicked("C")){ie.next=51;break}return ae=!0,se(!1),ie.abrupt("continue",37);case 51:if(!ce.isKeyWordPicked("R")){ie.next=77;break}return(le=new Tt).setMessage(""),le.setBasePt(re),ie.next=57,le.go();case 57:if(he=ie.sent){ie.next=60;break}return ie.abrupt("return",se(!1));case 60:return ee=he,le.setMessage(""),le.setKeyWords("[(P)]"),le.setBasePt(re),le.setUserDraw(oe),ie.next=67,le.go();case 67:if(fe=ie.sent,!le.isKeyWordPicked("P")){ie.next=74;break}return(de=new Tt).setMessage(""),ie.next=73,de.go();case 73:fe=ie.sent;case 74:if(fe){ie.next=76;break}return ie.abrupt("return",se(!1));case 76:ue=fe/he;case 77:if(ue){ie.next=79;break}return ie.abrupt("return",se(!1));case 79:if(ce.getDetailedResult()===h.DetailedResult.kCoordIn&&(ne=ue),ne>1e5&&(ne=1e5),(pe=new sn).setToScaling(ne,re),!ae){ie.next=98;break}me=[],ge=function isMcDbEntity(t){return t instanceof Et},ve=0;case 87:if(!(ve<p.length)){ie.next=95;break}if(ye=p[ve].clone()){ie.next=91;break}return ie.abrupt("continue",92);case 91:ge(ye)&&(ye.transformBy(pe),me.push(t.MxCpp.getCurrentMxCAD().drawEntity(ye)));case 92:ve++,ie.next=87;break;case 95:return ie.abrupt("return",me);case 98:se(!1),be=0;case 100:if(!(be<p.length)){ie.next=108;break}if(xe=p[be].getMcDbObject()){ie.next=104;break}return ie.abrupt("continue",105);case 104:xe.transformBy(pe);case 105:be++,ie.next=100;break;case 108:return ie.abrupt("return",p);case 109:ie.next=37;break;case 111:ie.next=117;break;case 113:ie.prev=113,ie.t0=ie.catch(36),se(!1);case 117:case"end":return ie.stop()}}),_callee6,null,[[36,113]])}))),_Mx_Scale.apply(this,arguments)}function Mx_WindowZoom(){return _Mx_WindowZoom.apply(this,arguments)}function _Mx_WindowZoom(){return _Mx_WindowZoom=_asyncToGenerator(ie.mark((function _callee7(){var p,x,M,k;return ie.wrap((function _callee7$(I){for(;;)switch(I.prev=I.next){case 0:return(p=new St).disableAllTrace(),p.setMessage("\n"),p.setDynamicInputType(h.DynamicInputType.kDynTip),I.next=6,p.go();case 6:if(null!=(x=I.sent)){I.next=9;break}return I.abrupt("return");case 9:return M=t.MxCpp.getCurrentMxCAD(),p.setUserDraw((function(h,p){p.drawRect(t.MxCoordConvert.cad2doc1(x),t.MxCoordConvert.cad2doc1(h))})),I.next=13,p.go();case 13:if(null!=(k=I.sent)){I.next=16;break}return I.abrupt("return");case 16:M.zoomW(x,k);case 17:case"end":return I.stop()}}),_callee7)}))),_Mx_WindowZoom.apply(this,arguments)}function Mx_ZoomE(){return _Mx_ZoomE.apply(this,arguments)}function _Mx_ZoomE(){return(_Mx_ZoomE=_asyncToGenerator(ie.mark((function _callee8(){return ie.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:t.MxCpp.getCurrentMxCAD().zoomAll(!0);case 1:case"end":return h.stop()}}),_callee8)})))).apply(this,arguments)}function Mx_Plan90CW(){return _Mx_Plan90CW.apply(this,arguments)}function _Mx_Plan90CW(){return(_Mx_Plan90CW=_asyncToGenerator(ie.mark((function _callee9(){var p;return ie.wrap((function _callee9$(x){for(;;)switch(x.prev=x.next){case 0:p=h.MxFun.getCurrentDraw().getViewAngle(),p+=.5*Math.PI,t.MxCpp.getCurrentMxCAD().zoomAngle(p);case 4:case"end":return x.stop()}}),_callee9)})))).apply(this,arguments)}h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Line",drawLine),h.MxFun.addCommand("Mx_Point",Mx_Point),h.MxFun.addCommand("Mx_About",Mx_About),h.MxFun.addCommand("Mx_Spline",MxDb_Spline)})),h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Pline",drawPolyLine)})),h.MxFun.addCommand("Mx_Polygon",drawPolygon),h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Arc",drawArc)})),h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_EllipseArc",drawEllipticalArc),h.MxFun.addCommand("Mx_Ellipse",drawMxDbEllipse)}));var ji=!1,Ui=!0;function Mx_Offset(){return _Mx_Offset.apply(this,arguments)}function _Mx_Offset(){return _Mx_Offset=_asyncToGenerator(ie.mark((function _callee11(){var p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee11$(ne){for(;;)switch(ne.prev=ne.next){case 0:(p=new bt).AddMcDbEntityTypes("LINE,CIRCLE,LWPOLYLINE,ARC"),x=new St,M=!1,k=function(){var k=_asyncToGenerator(ie.mark((function _callee10(){var k,I,N,V=arguments;return ie.wrap((function _callee10$(ee){for(;;)switch(ee.prev=ee.next){case 0:k=V.length>0&&void 0!==V[0]&&V[0],I=ie.mark((function _loop2(){var I,N,V,ee,te,re;return ie.wrap((function _loop2$(ne){for(;;)switch(ne.prev=ne.next){case 0:if(!((ee=Mt.getCurrentSelect()).length>0&&k)){ne.next=5;break}V=ee,ne.next=8;break;case 5:return ne.next=7,Mt.selectEnt("\n",p,!1,(function(t){t.setKeyWords("[(E)/(U)]"),I=t}),(function(t){N=t}));case 7:V=ne.sent;case 8:if(!I){ne.next=15;break}if(!I.isKeyWordPicked("E")){ne.next=11;break}return ne.abrupt("return",{v:void 0});case 11:if(!I.isKeyWordPicked("U")){ne.next=13;break}return ne.abrupt("return",0);case 13:if(I.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ne.next=15;break}return ne.abrupt("return",{v:void 0});case 15:if(0!=V.length){ne.next=17;break}return ne.abrupt("return",0);case 17:te=ie.mark((function _loop3(){var p,I,ee,te;return ie.wrap((function _loop3$(re){for(;;)switch(re.prev=re.next){case 0:return x.setDynamicInputType(h.DynamicInputType.kXYCoordInput),k?x.setMessage("\n"+(M?" <>":"")):x.setMessage("\n"),x.setKeyWords(M?"[(E)/(U)]":"[(E)/(M)/(U)]"),x.disableAllTrace(),x.setUserDraw((function(t,h){var p=V.map((function(t){return t.clone()}))[0];if(p){var x=Vi;if(k){var M=p.getClosestPointTo(t,!0);if(!M.ret)return;N=M.val,x=t.distanceTo(N)}if(x){var I=p.offsetCurves(x,t);I.empty()||I.forEach((function(t){t instanceof Et&&h.drawMcDbEntity(t)}))}}})),re.next=7,x.go();case 7:if(p=re.sent,!x.isKeyWordPicked("E")){re.next=10;break}return re.abrupt("return",{v:{v:void 0}});case 10:if(!x.isKeyWordPicked("M")){re.next=13;break}return M=!0,re.abrupt("return",0);case 13:if(!x.isKeyWordPicked("U")){re.next=15;break}return re.abrupt("return",{v:1});case 15:if(p){re.next=17;break}return re.abrupt("return",{v:{v:void 0}});case 17:if(I=V[0].getMcDbCurve()){re.next=20;break}return re.abrupt("return",{v:{v:void 0}});case 20:if(!k){re.next=25;break}if((ee=I.getClosestPointTo(p,!0)).ret){re.next=24;break}return re.abrupt("return",{v:{v:void 0}});case 24:Vi=p.distanceTo(ee.val);case 25:if(Vi){re.next=27;break}return re.abrupt("return",{v:{v:void 0}});case 27:if(!(te=I.offsetCurves(Vi,p)).empty()){re.next=30;break}return re.abrupt("return",{v:{v:void 0}});case 30:if(te.forEach((function(h){h instanceof Et&&(Ui&&null!=I&&I.layer&&(h.layer=I.layer),Ui||(h.layer=t.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyLayerName()),t.MxCpp.getCurrentMxCAD().drawEntity(h))})),M){re.next=34;break}return ji&&V[0].erase(!0),re.abrupt("return",1);case 34:case"end":return re.stop()}}),_loop3)}));case 19:return ne.delegateYield(te(),"t0",21);case 21:if(0!==(re=ne.t0)){ne.next=24;break}return ne.abrupt("continue",19);case 24:if(1!==re){ne.next=26;break}return ne.abrupt("break",30);case 26:if(!re){ne.next=28;break}return ne.abrupt("return",re.v);case 28:ne.next=19;break;case 30:case"end":return ne.stop()}}),_loop2)}));case 2:return ee.delegateYield(I(),"t0",4);case 4:if(0!==(N=ee.t0)){ee.next=7;break}return ee.abrupt("continue",2);case 7:if(1!==N){ee.next=9;break}return ee.abrupt("continue",2);case 9:if(!N){ee.next=11;break}return ee.abrupt("return",N.v);case 11:ee.next=2;break;case 13:case"end":return ee.stop()}}),_callee10)})));return function callOffsetObj(){return k.apply(this,arguments)}}();case 5:return(I=new Tt).setMessage("\n<".concat((Vi||0).toFixed(3),">")),I.setKeyWords("[(T)/(E)/(L))]"),ne.next=11,I.go();case 11:if(N=ne.sent,!I.isKeyWordPicked("T")&&I.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ne.next=16;break}return ne.next=15,k(!0);case 15:return ne.abrupt("return");case 16:if(!I.isKeyWordPicked("E")){ne.next=33;break}return(V=new kt).setMessage("?<".concat(ji?"":"",">")),V.setKeyWords("[(Y)/(N)]"),ne.next=22,V.go();case 22:if(ee=ne.sent,V.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ne.next=25;break}return ne.abrupt("return");case 25:if(V.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ne.next=27;break}return ne.abrupt("continue",5);case 27:if("y"!==(null==ee?void 0:ee.toLocaleLowerCase())){ne.next=30;break}return ji=!0,ne.abrupt("continue",5);case 30:if("n"!==(null==ee?void 0:ee.toLocaleLowerCase())){ne.next=33;break}return ji=!1,ne.abrupt("continue",5);case 33:if(!I.isKeyWordPicked("L")){ne.next=51;break}return(te=new kt).setMessage("<".concat(Ui?"":"",">")),te.setKeyWords("[(C)/(S)]"),ne.next=39,te.go();case 39:if(re=ne.sent,te.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ne.next=42;break}return ne.abrupt("return");case 42:if(te.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ne.next=45;break}return Ui=!0,ne.abrupt("continue",5);case 45:if("c"!==(null==re?void 0:re.toLocaleLowerCase())){ne.next=48;break}return Ui=!1,ne.abrupt("continue",5);case 48:if("s"!==(null==re?void 0:re.toLocaleUpperCase())){ne.next=51;break}return Ui=!0,ne.abrupt("continue",5);case 51:if(N&&(Vi=N),Vi){ne.next=54;break}return ne.abrupt("return");case 54:return ne.next=56,k();case 56:return ne.abrupt("break",59);case 59:case"end":return ne.stop()}}),_callee11)}))),_Mx_Offset.apply(this,arguments)}function Mx_Regen(){t.MxCpp.getCurrentMxCAD().regen()}function Mx_Mirror(){return _Mx_Mirror.apply(this,arguments)}function _Mx_Mirror(){return _Mx_Mirror=_asyncToGenerator(ie.mark((function _callee12(){var p,x,M,k,I,N,V,ee,te,re,ne,ae;return ie.wrap((function _callee12$(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Mt.userSelect("");case 2:if(0!=(p=ie.sent).length){ie.next=6;break}return h.MxFun.acutPrintf("\n "),ie.abrupt("return");case 6:return(k=MxGetMcDbEntityBoundingBox(p))&&(x=k.minPt,M=k.maxPt),(I=new St).setMessage(""),ie.next=12,I.go();case 12:if(null!=(N=ie.sent)){ie.next=15;break}return ie.abrupt("return");case 15:return I.setMessage(""),I.setBasePt(N),I.setUseBasePt(!0),I.setUserDraw((function(h,k){if(x&&M){var I=new sn;I.setMirror(N,h);var V=new rn(x.x,M.y,0),ee=new rn(M.x,x.y,0),te=new rn(V.x,ee.y,0),re=new rn(ee.x,V.y,0);V.transformBy(I),ee.transformBy(I),te.transformBy(I),re.transformBy(I),V=t.MxCoordConvert.cad2doc(V),ee=t.MxCoordConvert.cad2doc(ee),te=t.MxCoordConvert.cad2doc(te),re=t.MxCoordConvert.cad2doc(re),k.drawLine(re.toVector3(),V.toVector3()),k.drawLine(V.toVector3(),te.toVector3()),k.drawLine(te.toVector3(),ee.toVector3()),k.drawLine(ee.toVector3(),re.toVector3())}for(var ne=0;ne<p.length&&ne<10;ne++){var ie=p[ne].clone();ie&&(ie.mirror(N,h),k.drawMcDbEntity(ie))}})),I.setDynamicInputType(h.DynamicInputType.kXYCoordInput),ie.next=22,I.go();case 22:if(V=ie.sent){ie.next=25;break}return ie.abrupt("return");case 25:return(ee=new kt).clearLastInputPoint(),ee.setMessage("<N>"),ee.setKeyWords("[(Y)/(N)]"),ie.next=31,ee.go();case 31:if(te=ie.sent,ee.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=34;break}return ie.abrupt("return");case 34:re=0;case 35:if(!(re<p.length)){ie.next=44;break}if(ne=p[re].clone()){ie.next=39;break}return ie.abrupt("continue",41);case 39:ne.mirror(N,V),t.MxCpp.getCurrentMxCAD().drawEntity(ne);case 41:re++,ie.next=35;break;case 44:if("y"===(null==te?void 0:te.toLocaleLowerCase()))for(ae=0;ae<p.length;ae++)p[ae].erase();case 45:case"end":return ie.stop()}}),_callee12)}))),_Mx_Mirror.apply(this,arguments)}var zi=function copyAttribute(t,h){t.layer=h.layer,t.trueColor=h.trueColor,t.colorIndex=h.colorIndex,t.linetype=h.linetype,t.visible=h.visible,t.textStyle=h.textStyle,t.lineweight=h.lineweight,t.drawOrder=h.drawOrder,t.linetypeScale=h.linetypeScale},Wi=!1;function Mx_Chamfer(){return _Mx_Chamfer.apply(this,arguments)}function _Mx_Chamfer(){return _Mx_Chamfer=_asyncToGenerator(ie.mark((function _callee15(){var p,x,M,k,I,N,V,ee,te,re,ne,ae;return ie.wrap((function _callee15$(oe){for(;;)switch(oe.prev=oe.next){case 0:p=Number(localStorage.getItem("mx_chamfer_dist")),x=Number(localStorage.getItem("mx_chamfer_dist1")),"number"!=typeof p&&(p=0),"number"!=typeof x&&(x=0),M=0,k=0,I=!1,N=!0,V=!1,h.MxFun.acutPrintf("\n(".concat(N?"":"",") ").concat(I?" = "+p.toFixed(4)+",  = "+Math.trunc(k/(Math.PI/180)):"1 = "+p.toFixed(4)+", 2 = "+x.toFixed(4),"\n")),ee=function(){var t=_asyncToGenerator(ie.mark((function _callee13(){var t,M,k;return ie.wrap((function _callee13$(N){for(;;)switch(N.prev=N.next){case 0:return(t=new Tt).setDynamicInputType(h.DynamicInputType.kXYCoordInput),t.setMessage("<".concat(p.toFixed(4),">")),t.setKeyWords(""),N.next=6,t.go();case 6:if("number"==typeof(M=N.sent)){N.next=9;break}return N.abrupt("return");case 9:return p=M,t.setMessage("<".concat(x.toFixed(4),">")),t.setKeyWords(""),N.next=14,t.go();case 14:if("number"==typeof(k=N.sent)){N.next=17;break}return N.abrupt("return");case 17:return x=k,localStorage.setItem("mx_chamfer_dist",p.toString()),localStorage.setItem("mx_chamfer_dist1",x.toString()),I=!1,N.abrupt("return",[p,x]);case 22:case"end":return N.stop()}}),_callee13)})));return function getChamferDists(){return t.apply(this,arguments)}}(),te=function(){var t=_asyncToGenerator(ie.mark((function _callee14(){var t,p,x,N;return ie.wrap((function _callee14$(V){for(;;)switch(V.prev=V.next){case 0:return(t=new Tt).setMessage("<".concat(M.toFixed(4),">")),t.setKeyWords(""),t.clearLastInputPoint(),V.next=6,t.go();case 6:if("number"==typeof(p=V.sent)){V.next=9;break}return V.abrupt("return");case 9:return M=p,(x=new At).setMessage("<".concat(Math.trunc(k/(Math.PI/180)),">")),x.setKeyWords(""),t.clearLastInputPoint(),V.next=16,x.go();case 16:if("number"==typeof(N=V.sent)){V.next=19;break}return V.abrupt("return");case 19:return k=x.getDetailedResult()===h.DetailedResult.kCoordIn?N*(Math.PI/180):N,I=!0,V.abrupt("return",[M,k]);case 22:case"end":return V.stop()}}),_callee14)})));return function getChamferAngle(){return t.apply(this,arguments)}}(),re=function calculateChamferDist2(h,p,x,M){var k=h.startPoint.clone(),I=p.startPoint.clone(),N=p.endPoint.clone(),V=I.clone().addvec(I.sub(k).normalize().mult(-x)),ee=V.sub(I).rotateBy(-M).mult(-x),te=V.clone().addvec(ee),re=new Bt(V,te),ne=new Bt(I,N.clone().addvec(I.sub(N).normalize().mult(-x))),ie=re.IntersectWith(ne,t.McDb.Intersect.kExtendBoth);if(!ie.isEmpty())return ie.at(0).distanceTo(I)},ne=ie.mark((function _loop4(){var ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we,_e,Ce,Se,Te,Ae,De,ke,Le,Ee,Ie,Be,Oe,Re,Fe,Ne,Ve,Ge,je,Ue,ze,We,He,$e,Xe;return ie.wrap((function _loop4$(ie){for(;;)switch(ie.prev=ie.next){case 0:return(ne=new Lt).setDynamicInputType(h.DynamicInputType.kNoInput),(ae=new bt).AddMcDbEntityTypes("LINE,LWPOLYLINE"),ne.setFilter(ae),ne.setMessage(""),ne.setKeyWords("[(U)/(P)/(D)/(A)/(T)/(E)/(M)]"),ie.next=9,ne.go();case 9:if(oe=ie.sent,!ne.isKeyWordPicked("U")){ie.next=12;break}return ie.abrupt("return",0);case 12:if(!ne.isKeyWordPicked("P")){ie.next=77;break}case 13:return(se=new Lt).setDynamicInputType(h.DynamicInputType.kNoInput),(new bt).AddMcDbEntityTypes("LWPOLYLINE"),se.setMessage(""),se.setKeyWords("[(D)/(A)/(M)]"),ce=function createNewEnts(t){var V=t.getMcDbEntity();if(V instanceof Gt){var ee=V.numVerts();if(ee<3)return h.MxFun.acutPrintf("\n");var te=p,ne=x;if(I){var ie=V.getPointAt(0).val,ae=V.getPointAt(1).val,oe=V.getPointAt(2).val;te=M;var se=re(new Bt(ie,ae),new Bt(ae,oe),M,k);if("number"!=typeof se)return h.MxFun.acutPrintf("\n");ne=se}var ce=new Gt;ce.isClosed=V.isClosed;for(var ue=[],le=function addChamferLine(t,h){var p=function getChamferPoints(t,h){var p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=t.sub(h).normalize().mult(p?-ne:-te),M=t.clone().addvec(x),k=h.sub(t).normalize().mult(p?-te:-ne);return[M,h.clone().addvec(k)]}(t,h,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),x=_slicedToArray$1(p,2),M=x[0],k=x[1];N?(ce.addVertexAt(M),ce.addVertexAt(k)):ue.push(M,k)},he=0;he<ee;he++){var fe=V.getPointAt(he).val,de=V.getPointAt(he+1).val;if(V.isClosed)he!==ee-1&&le(fe,de);else if(0===he){ce.addVertexAt(fe);var pe=de.sub(fe).normalize().mult(-te),me=de.clone().addvec(pe);ce.addVertexAt(de.clone().addvec(pe)),ue.unshift(me)}else if(he===ee-2){var ge=fe.sub(de).normalize().mult(-ne),ve=fe.clone().addvec(ge);ce.addVertexAt(ve),ce.addVertexAt(de),ue.push(ve)}else he!==ee-1&&le(fe,de,!0)}if(V.isClosed&&le(V.getPointAt(ee-1).val,V.getPointAt(0).val),N)return zi(ce,V),ce;var ye=[],be=[];return V.isClosed&&ue.unshift(ue[ue.length-1]),ue.forEach((function(t){if(ye.push(t),2===ye.length){var h=new Bt(ye[0],ye[1]);zi(h,V),be.push(h),ye=[]}})),be}},ie.next=23,se.go();case 23:if(ue=ie.sent,!se.isKeyWordPicked("D")){ie.next=30;break}return ie.next=27,ee();case 27:if(ie.sent){ie.next=29;break}return ie.abrupt("return",{v:void 0});case 29:return ie.abrupt("continue",13);case 30:if(!se.isKeyWordPicked("A")){ie.next=36;break}return ie.next=33,te();case 33:if(ie.sent){ie.next=35;break}return ie.abrupt("return",{v:void 0});case 35:return ie.abrupt("continue",13);case 36:if(!se.isKeyWordPicked("M")){ie.next=39;break}return V=!0,ie.abrupt("continue",13);case 39:if(se.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=41;break}return ie.abrupt("return",{v:void 0});case 41:if(ue){ie.next=43;break}return ie.abrupt("continue",13);case 43:if(ue.isValid()){ie.next=45;break}return ie.abrupt("continue",13);case 45:if(le=ce(ue)){ie.next=52;break}if(!V){ie.next=51;break}return ie.abrupt("continue",13);case 51:return ie.abrupt("return",{v:void 0});case 52:if(he=ue.getMcDbEntity()){ie.next=59;break}if(!V){ie.next=58;break}return ie.abrupt("continue",13);case 58:return ie.abrupt("return",{v:void 0});case 59:if(!(le instanceof Gt)){ie.next=68;break}if(he instanceof Gt){ie.next=62;break}return ie.abrupt("return",{v:void 0});case 62:for(fe=he.numVerts(),de=0;de<fe;de++)he.removeVertexAt(0);for(pe=le.numVerts(),me=0;me<pe;me++)ge=le.getWidthsAt(me),ve=ge.val1,ye=ge.val2,he.addVertexAt(le.getPointAt(me).val,le.getBulgeAt(me),ve,ye);ie.next=70;break;case 68:le.forEach((function(h){t.MxCpp.getCurrentMxCAD().drawEntity(h)})),he.visible=!0;case 70:if(!V){ie.next=74;break}return ie.abrupt("continue",13);case 74:return ie.abrupt("return",{v:void 0});case 75:ie.next=13;break;case 77:if(!ne.isKeyWordPicked("D")){ie.next=83;break}return ie.next=80,ee();case 80:if(ie.sent){ie.next=82;break}return ie.abrupt("return",{v:void 0});case 82:return ie.abrupt("return",0);case 83:if(!ne.isKeyWordPicked("A")){ie.next=89;break}return ie.next=86,te();case 86:if(ie.sent){ie.next=88;break}return ie.abrupt("return",{v:void 0});case 88:return ie.abrupt("return",0);case 89:if(!ne.isKeyWordPicked("T")){ie.next=108;break}return(be=new kt).setMessage("<".concat(N?"":"",">")),be.setKeyWords("[(T)/(N)]"),ie.next=95,be.go();case 95:if(xe=ie.sent,be.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=98;break}return ie.abrupt("return",{v:void 0});case 98:if(be.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ie.next=100;break}return ie.abrupt("return",0);case 100:if(xe){ie.next=102;break}return ie.abrupt("return",{v:void 0});case 102:if("t"!==xe.toLocaleLowerCase()){ie.next=105;break}return N=!0,ie.abrupt("return",0);case 105:if("n"!==xe.toLocaleLowerCase()){ie.next=108;break}return N=!1,ie.abrupt("return",0);case 108:if(!ne.isKeyWordPicked("E")){ie.next=127;break}return(Me=new kt).setMessage("<".concat(I?"":"",">")),Me.setKeyWords("[(D)/(A)]"),ie.next=114,Me.go();case 114:if(we=ie.sent,Me.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=117;break}return ie.abrupt("return",{v:void 0});case 117:if(Me.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ie.next=119;break}return ie.abrupt("return",0);case 119:if("string"==typeof we){ie.next=121;break}return ie.abrupt("return",{v:void 0});case 121:if("d"!==we.toLocaleLowerCase()){ie.next=124;break}return I=!1,ie.abrupt("return",0);case 124:if("a"!==we.toLocaleLowerCase()){ie.next=127;break}return I=!0,ie.abrupt("return",0);case 127:if(!ne.isKeyWordPicked("M")){ie.next=130;break}return V=!0,ie.abrupt("return",0);case 130:if(ne.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=132;break}return ie.abrupt("return",{v:void 0});case 132:if(oe){ie.next=134;break}return ie.abrupt("return",0);case 134:if(oe.isValid()){ie.next=136;break}return ie.abrupt("return",0);case 136:if(_e=ne.pickPoint(),Ce=oe.getMcDbEntity()){ie.next=140;break}return ie.abrupt("return",0);case 140:if((Se=new bt).AddMcDbEntityTypes("LINE,LWPOLYLINE"),Ce instanceof Bt&&Ce.highlight(!0),!(Ce instanceof Gt)){ie.next=147;break}if(Te=selectLineSegmentFromPolylineByPoint(Ce,_e,h.MxFun.viewCoordLong2Cad(2))){ie.next=147;break}return ie.abrupt("return",0);case 147:Ae=!1,De=function showWarning(t){Ae&&(h.MxFun.acutPrintf(t),Ae=!1)},ke=function exit(){Ae=!0,Ce.highlight(!1)},Le=function calculateAndApplyChamferBetweenTwoLines(h,p,x,M,k){var I,V,ee=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(h){t.MxCpp.getCurrentMxCAD().drawEntity(h)},te=h,re=p;if(h instanceof Gt&&Te){var ne=Te,ie=ne.start,ae=ne.end;h=new Bt(ie,ae)}if(p instanceof Gt){if(!(V=selectLineSegmentFromPolylineByPoint(p,x,1)))return ke();var oe=V,se=oe.start,ce=oe.end;p=new Bt(se,ce)}if(p=p.clone(),h=h.clone(),!p||!h)return ke();if(p instanceof Bt&&h instanceof Bt){if(p.startPoint.isEqualTo(h.startPoint)&&p.endPoint.isEqualTo(h.endPoint))return void De("\n");var ue=p.IntersectWith(h,t.McDb.Intersect.kOnBothOperands),le=ue.isEmpty();if(!le){var he=ue.at(0);if((h.startPoint.isEqualTo(he)||h.endPoint.isEqualTo(he)||p.startPoint.isEqualTo(he)||p.endPoint.isEqualTo(he))&&0===M&&0===k)return{apply:function apply(){}}}var fe=h.IntersectWith(p,t.McDb.Intersect.kExtendBoth);if(fe.isEmpty())return void De("\n");var de=fe.at(0),pe=function isChamferTooLarge(t,h,p,x,I,N){var V=!1;return(V=le?Math.max(p.distanceTo(de),x.distanceTo(de))<M&&M>0||Math.max(I.distanceTo(de),N.distanceTo(de))<k&&k>0:(t?p.distanceTo(de):x.distanceTo(de))<M&&M>0||(h?I.distanceTo(de):N.distanceTo(de))<k&&k>0)&&De("\n"),V};return I=function apply(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getHandle()===h.getHandle();if(t instanceof Bt&&h instanceof Bt){var I=isSegmentStartCloserToPoint(t.startPoint,t.endPoint,de,_e),ne=isSegmentStartCloserToPoint(h.startPoint,h.endPoint,de,x);if(pe(I,ne,t.startPoint,t.endPoint,h.startPoint,h.endPoint))return;var ie=createChamferedLinesFromSegments(t,h,de,I,ne,M,k,N);return ie&&ee(ie),!0}var ae=function processPolylineChamferClosure(t,h,x,I,V,te){var re=t.numVerts();if(p||(t.isClosed=!1),V){var ne=V.start,ie=V.end,ae=V.endIndex,oe=V.startIndex,se=V.isClosed,ce=[],ue=function getPointInfo(t,h){var p=t.getBulgeAt(h),x=t.getPointAt(h).val,M=t.getWidthsAt(h);return{point:x,bulge:p,startWidth:M.val1,endWidth:M.val2}},le=isSegmentStartCloserToPoint(ne.clone(),ie.clone(),de,x);if(h instanceof Bt){if(p)return void De("\n ");var he=isSegmentStartCloserToPoint(h.startPoint.clone(),h.endPoint.clone(),de,I);if(pe(le,he,ne,ie,h.startPoint,h.endPoint))return;var fe=h.clone(),me=createChamferedLinesFromSegments(new Bt(ne.clone(),ie.clone()),fe,de,le,he,M,k,N);if(le){for(var ge=se?t.numVerts():ae,ve=0;ve<ge;ve++)ce.push(ue(t,ve));me?N?(ce.push({point:me.startPoint}),ce.push({point:me.endPoint})):ee(me):ce.push({point:de}),he?ce.push({point:fe.startPoint.clone()}):ce.push({point:fe.endPoint.clone()})}else{var ye=t.numVerts();if(se)ce.push(ue(t,0));else for(var be=ae;be<ye;be++)ce.push(ue(t,be));me?N?(ce.unshift({point:me.startPoint}),ce.unshift({point:me.endPoint})):ee(me):ce.unshift({point:de}),he?ce.unshift({point:h.startPoint.clone()}):ce.unshift({point:h.endPoint.clone()})}}else{if(!(h instanceof Gt&&te))return!1;var xe=te.start,Me=te.end,we=te.startIndex,_e=te.endIndex,Ce=te.isClosed,Se=isSegmentStartCloserToPoint(xe,Me,de,I);if(pe(le,Se,ne,ie,xe,Me))return;var Te=createChamferedLinesFromSegments(new Bt(ne,ie),new Bt(xe,Me),de,le,Se,M,k,N);if(p){var Ae=t.numVerts(),ke=h.numVerts(),Le=we-oe;if((0===oe||oe===Ae-(se?1:2))&&(0===we||we===ke-(Ce?1:2))&&Ae>(se||Ce?2:4))return Te?N?0===oe||0===we?(0===oe?(t.setPointAt(0,Te.startPoint),se||Ce?t.addVertexAt(Te.endPoint):t.setPointAt(Ae-1,Te.endPoint)):(t.setPointAt(0,Te.endPoint),se||Ce?t.addVertexAt(Te.startPoint):t.setPointAt(Ae-1,Te.startPoint)),t.isClosed=!0):N&&(t.setPointAt(Ae-1,se?Te.endPoint:Te.startPoint),t.addVertexAt(se?Te.startPoint:Te.endPoint)):ee(Te):N&&(t.setPointAt(0,de),t.removeVertexAt(Ae-1),t.isClosed=!0),!0;if(Math.abs(Le)>2)return void De("\n ");h=h.clone()}if(!(h instanceof Gt))return;if(le){for(var Ee=0;Ee<=oe;Ee++)ce.push(ue(t,Ee));if(Te?N?(ce.push({point:Te.startPoint}),ce.push({point:Te.endPoint})):ee(Te):ce.push({point:de}),Se)for(var Ie=we;Ie>=0;Ie--)ce.push(ue(h,Ie));else if(Ce)ce.push(ue(h,0));else for(var Be=h.numVerts(),Oe=_e;Oe<Be;Oe++)ce.push(ue(h,Oe))}else{var Re=t.numVerts();if(se)ce.push(ue(t,0));else for(var Fe=ae;Fe<Re;Fe++)ce.push(ue(t,Fe));if(Te?N?(ce.unshift({point:Te.startPoint}),ce.unshift({point:Te.endPoint})):ee(Te):ce.unshift({point:de}),Se)for(var Ne=we;Ne>=0;Ne--)ce.unshift(ue(h,Ne));else if(Ce)ce.unshift(ue(h,0));else for(var Ve=h.numVerts(),Ge=_e;Ge<Ve;Ge++)ce.unshift(ue(h,Ge))}}if(N){for(var je=0;je<re;je++)t.removeVertexAt(0);ce.forEach((function(h){var p=h.point,x=h.bulge,M=h.startWidth,k=h.endWidth;t.addVertexAt(p,x,M,k)})),h.erase()}return!0}};return t instanceof Gt&&Te?ae(t,h,_e,x,Te,V):!!(h instanceof Gt&&V)&&ae(h,t,x,_e,V,Te)},{apply:I,line1:h,line2:p}}},ne.setUserDraw((function(t,h){var M=Ce.clone(),k=Mt.findEntAtPoint(t.x,t.y,t.z,-1,Se);if(!k)return ke();if(!k.isValid())return ke();var I=k.getMcDbEntity();if(!I)return ke();var V=null==I?void 0:I.clone();if(!V)return ke();var ee=Le(M,V,t,Wi?0:p,Wi?0:x,(function(t){h.drawMcDbEntity(t)}))||{},te=ee.line1,re=ee.line2,ne=ee.apply,ie=ne&&ne(M,V,Ce.getHandle()===I.getHandle());if(te&&re&&ie){M.drawOrder=Ce.drawOrder+I.drawOrder+102,te.drawOrder=Ce.drawOrder+I.drawOrder+101,re.drawOrder=Ce.drawOrder+I.drawOrder+101;var ae=new THREE.Color(Number(Ce.trueColor.getColorValue(Ce.layerId))),oe=ae.clone();N&&(darkenColor(oe,.5),h.setColor(oe)),h.drawMcDbEntity(te),h.drawMcDbEntity(re),h.setColor(ae),h.drawMcDbEntity(M)}}));case 152:return ne.setMessage("shift"),ne.setKeyWords("[(D)/(A)/(M)]"),ie.next=157,ne.go();case 157:if(Ee=ie.sent,!ne.isKeyWordPicked("D")){ie.next=164;break}return ie.next=161,ee();case 161:if(ie.sent){ie.next=163;break}return ie.abrupt("return",{v:void 0});case 163:return ie.abrupt("continue",152);case 164:if(!ne.isKeyWordPicked("A")){ie.next=170;break}return ie.next=167,te();case 167:if(ie.sent){ie.next=169;break}return ie.abrupt("return",{v:void 0});case 169:return ie.abrupt("continue",152);case 170:if(!ne.isKeyWordPicked("M")){ie.next=173;break}return V=!0,ie.abrupt("continue",152);case 173:if(ne.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=175;break}return ie.abrupt("return",{v:void 0});case 175:if(Ee){ie.next=177;break}return ie.abrupt("return",{v:ke()});case 177:if(Ee.isValid()){ie.next=179;break}return ie.abrupt("return",{v:ke()});case 179:if(Ie=Ee.getMcDbEntity()){ie.next=182;break}return ie.abrupt("return",{v:ke()});case 182:if(Be=Ce,Oe=ne.pickPoint(),Re=Be.clone()){ie.next=191;break}if(!V){ie.next=190;break}return ie.abrupt("continue",152);case 190:return ie.abrupt("return",{v:ke()});case 191:if(Fe=Be.clone()){ie.next=198;break}if(!V){ie.next=197;break}return ie.abrupt("continue",152);case 197:return ie.abrupt("return",{v:ke()});case 198:if(!(Ne=Re.IntersectWith(Fe,t.McDb.Intersect.kOnBothOperands)).isEmpty()){ie.next=205;break}if(!V){ie.next=204;break}return ie.abrupt("continue",152);case 204:return ie.abrupt("return",{v:ke()});case 205:if(Ve=p,Ge=x,!I){ie.next=219;break}if(je=Ne.at(0),"number"==typeof(Ue=re(new Bt(_e,je),new Bt(je,Oe),M,k))){ie.next=217;break}if(h.MxFun.acutPrintf("\n"),!V){ie.next=216;break}return ie.abrupt("continue",152);case 216:return ie.abrupt("return",{v:ke()});case 217:Ve=M,Ge=Ue;case 219:if(ze=Le(Be,Ie,Oe,Wi?0:Ve,Wi?0:Ge)||{},We=ze.line1,He=ze.line2,$e=ze.apply,!(We&&He&&areLinesCollinear(We,He))){ie.next=223;break}return h.MxFun.acutPrintf(" "),ie.abrupt("return",{v:ke()});case 223:if(!$e){ie.next=232;break}if(Xe=$e(),!V||void 0!==Xe){ie.next=229;break}return ie.abrupt("continue",152);case 229:return ie.abrupt("break",240);case 230:ie.next=238;break;case 232:if(t.MxCpp.App.MxCADAssist.MxChamfer(oe.id,Ee.id,_e.x,_e.y,Oe.x,Oe.y,Ve,Ge,N),!V){ie.next=237;break}return ie.abrupt("continue",152);case 237:return ie.abrupt("break",240);case 238:ie.next=152;break;case 240:if(Ce instanceof Bt&&Ce.highlight(!1),!V){ie.next=245;break}return ie.abrupt("return",0);case 245:return ke(),ie.abrupt("return",1);case 247:case"end":return ie.stop()}}),_loop4)}));case 14:return oe.delegateYield(ne(),"t0",16);case 16:if(0!==(ae=oe.t0)){oe.next=19;break}return oe.abrupt("continue",14);case 19:if(1!==ae){oe.next=21;break}return oe.abrupt("break",25);case 21:if(!ae){oe.next=23;break}return oe.abrupt("return",ae.v);case 23:oe.next=14;break;case 25:case"end":return oe.stop()}}),_callee15)}))),_Mx_Chamfer.apply(this,arguments)}function Mx_Fillet(){return _Mx_Fillet.apply(this,arguments)}function _Mx_Fillet(){return _Mx_Fillet=_asyncToGenerator(ie.mark((function _callee17(){var p,x,M,k,I,N,V,ee;return ie.wrap((function _callee17$(te){for(;;)switch(te.prev=te.next){case 0:p=Number(localStorage.getItem("Mx_Fillet_radius"))||0,x="false"!==localStorage.getItem("Mx_Fillet_isPruning"),M=!1,h.MxFun.acutPrintf("\n:  = ".concat(x?"":"",",  = ").concat(p.toFixed(4))),k=function(){var t=_asyncToGenerator(ie.mark((function _callee16(){var t,x;return ie.wrap((function _callee16$(M){for(;;)switch(M.prev=M.next){case 0:return(t=new Tt).setDynamicInputType(h.DynamicInputType.kDistanceInput),t.setKeyWords("<".concat(p.toFixed(4),">")),M.next=5,t.go();case 5:if(x=M.sent,t.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){M.next=8;break}return M.abrupt("return");case 8:if(t.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){M.next=10;break}return M.abrupt("return",p);case 10:if("number"==typeof x){M.next=12;break}return M.abrupt("return");case 12:return p=x,localStorage.setItem("Mx_Fillet_radius",p.toString()),M.abrupt("return",p);case 15:case"end":return M.stop()}}),_callee16)})));return function getRadius(){return t.apply(this,arguments)}}(),I=new Lt,(N=new bt).AddMcDbEntityTypes("LINE,LWPOLYLINE"),V=ie.mark((function _loop5(){var V,ee,te,re,ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we;return ie.wrap((function _loop5$(_e){for(;;)switch(_e.prev=_e.next){case 0:return I.setDynamicInputType(h.DynamicInputType.kNoInput),I.setFilter(N),I.setMessage(""),I.setKeyWords("[(U)/(P)/(R)/(T)/(M)]"),_e.next=6,I.go();case 6:if(V=_e.sent,I.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){_e.next=9;break}return _e.abrupt("return",{v:void 0});case 9:if(!I.isKeyWordPicked("U")){_e.next=11;break}return _e.abrupt("return",0);case 11:if(!I.isKeyWordPicked("P")){_e.next=24;break}ee=ie.mark((function _loop6(){var N,V,ee,te,re,ne,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we,_e,Ce,Se;return ie.wrap((function _loop6$(ie){for(;;)switch(ie.prev=ie.next){case 0:return I.setMessage(""),I.setKeyWords("[(R)]"),(N=new bt).AddMcDbEntityTypes("LWPOLYLINE"),I.setFilter(N),ie.next=7,I.go();case 7:if(V=ie.sent,I.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=10;break}return ie.abrupt("return",{v:{v:void 0}});case 10:if(!I.isKeyWordPicked("R")){ie.next=17;break}return ie.next=13,k();case 13:if(ie.t0=_typeof$1(ie.sent),"number"===ie.t0){ie.next=16;break}return ie.abrupt("return",{v:{v:void 0}});case 16:return ie.abrupt("return",0);case 17:if(V){ie.next=19;break}return ie.abrupt("return",{v:{v:void 0}});case 19:if(V.isValid()){ie.next=21;break}return ie.abrupt("return",{v:{v:void 0}});case 21:if((ee=V.getMcDbEntity())instanceof Gt){ie.next=24;break}return ie.abrupt("return",{v:{v:void 0}});case 24:te=ee.numVerts(),re=0,ne=0,ae=[],ee.isClosed||te--;case 29:if(!(re<te)){ie.next=82;break}if(re++,ne>te-1&&(ne=0),oe=ee.getPointAt(ne),se=oe.val){ie.next=39;break}if(!M){ie.next=38;break}return ie.abrupt("return",1);case 38:return ie.abrupt("return",{v:{v:void 0}});case 39:if(++ne>te-1&&(ne=0),ce=ee.getPointAt(ne),ue=ce.val){ie.next=48;break}if(!M){ie.next=47;break}return ie.abrupt("return",1);case 47:return ie.abrupt("return",{v:{v:void 0}});case 48:if(++ne>te-1&&(ne=0),le=ee.getPointAt(ne),he=le.val){ie.next=57;break}if(!M){ie.next=56;break}return ie.abrupt("return",1);case 56:return ie.abrupt("return",{v:{v:void 0}});case 57:if(ne=re,fe=createLineSegmentRoundJoin(p,new Bt(se,ue),new Bt(ue,he),ue,!0,!1,x)){ie.next=61;break}return ie.abrupt("return",{v:{v:void 0}});case 61:if(de=fe.arc,pe=fe.segmentLine,me=fe.bulge,pe){ie.next=64;break}return ie.abrupt("return",{v:{v:void 0}});case 64:if(!x){ie.next=78;break}if(ge=ee.getWidthsAt(re),ve=ge.ret,ye=ge.val1,be=ge.val2,ve){ie.next=74;break}if(!ee.isClosed){ie.next=73;break}if(xe=ee.getWidthsAt(0),Me=xe.ret,we=xe.val1,_e=xe.val2,Me){ie.next=71;break}return ie.abrupt("continue",29);case 71:ae.push({width:we,width1:_e,bulge:me,point:pe.startPoint}),ae.unshift({width:we,width1:_e,bulge:ee.getBulgeAt(0),point:pe.endPoint});case 73:return ie.abrupt("continue",29);case 74:ae.push({width:ye,width1:be,bulge:me,point:pe.startPoint}),ae.push({width:ye,width1:be,bulge:ee.getBulgeAt(re),point:pe.endPoint}),ie.next=80;break;case 78:zi(de,ee),t.MxCpp.getCurrentMxCAD().drawEntity(de);case 80:ie.next=29;break;case 82:if(x){for(Ce=ee.numVerts(),Se=0;Se<Ce;Se++)ee.removeVertexAt(0);ae.forEach((function(t){var h=t.point,p=t.bulge,x=t.width,M=t.width1;ee.addVertexAt(h,p,x,M)}))}if(!M){ie.next=87;break}return ie.abrupt("return",0);case 87:return ie.abrupt("return",{v:{v:void 0}});case 88:case"end":return ie.stop()}}),_loop6)}));case 13:return _e.delegateYield(ee(),"t0",15);case 15:if(0!==(te=_e.t0)){_e.next=18;break}return _e.abrupt("continue",13);case 18:if(1!==te){_e.next=20;break}return _e.abrupt("continue",13);case 20:if(!te){_e.next=22;break}return _e.abrupt("return",te.v);case 22:_e.next=13;break;case 24:if(!I.isKeyWordPicked("R")){_e.next=31;break}return _e.next=27,k();case 27:if(_e.t1=_typeof$1(_e.sent),"number"===_e.t1){_e.next=30;break}return _e.abrupt("return",{v:void 0});case 30:return _e.abrupt("return",0);case 31:if(!I.isKeyWordPicked("T")){_e.next=53;break}return(re=new kt).setDynamicInputType(h.DynamicInputType.kNoInput),re.setMessage("<".concat(x?"":"",">")),re.setKeyWords("[(T)/(N)]"),_e.next=38,re.go();case 38:if(ne=_e.sent,re.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){_e.next=41;break}return _e.abrupt("return",{v:void 0});case 41:if(re.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){_e.next=43;break}return _e.abrupt("return",0);case 43:if("string"==typeof ne){_e.next=45;break}return _e.abrupt("return",{v:void 0});case 45:if("t"!==ne.toLocaleLowerCase()){_e.next=49;break}return x=!0,localStorage.setItem("Mx_Fillet_isPruning","true"),_e.abrupt("return",0);case 49:if("n"!==ne.toLocaleLowerCase()){_e.next=53;break}return x=!1,localStorage.setItem("Mx_Fillet_isPruning","false"),_e.abrupt("return",0);case 53:if(!I.isKeyWordPicked("M")){_e.next=56;break}return M=!0,_e.abrupt("return",0);case 56:if(V){_e.next=58;break}return _e.abrupt("return",0);case 58:if(V.isValid()){_e.next=60;break}return _e.abrupt("return",0);case 60:if(ae=I.pickPoint(),(oe=new bt).AddMcDbEntityTypes("LINE,LWPOLYLINE"),(new Lt).setFilter(oe),se=V.getMcDbEntity()){_e.next=68;break}return _e.abrupt("return",0);case 68:if(se instanceof Bt&&se.highlight(!0),!(se instanceof Gt)){_e.next=73;break}if(ce=selectLineSegmentFromPolylineByPoint(se,ae,h.MxFun.viewCoordLong2Cad(2))){_e.next=73;break}return _e.abrupt("return",0);case 73:(ue=new Lt).setFilter(oe),le=!1,he=function showWarning(t){le&&(h.MxFun.acutPrintf(t),le=!1)},fe=function exit(){le=!0,se.highlight(!1)},de=function calculateAndApplyFilletBetweenTwoLines(h,M,k){var I,N,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(h){t.MxCpp.getCurrentMxCAD().drawEntity(h)},ee=h,te=M;if(h instanceof Gt&&ce){var re=ce,ne=re.start,ie=re.end;h=new Bt(ne,ie)}if(M instanceof Gt){if(!(N=selectLineSegmentFromPolylineByPoint(M,k,1)))return fe();var oe=N,se=oe.start,ue=oe.end;M=new Bt(se,ue)}if(M=M.clone(),h=h.clone(),!M||!h)return fe();if(M instanceof Bt&&h instanceof Bt){if(M.startPoint.isEqualTo(h.startPoint)&&M.endPoint.isEqualTo(h.endPoint))return void he("\n");var le=M.IntersectWith(h,t.McDb.Intersect.kOnBothOperands),de=le.isEmpty();if(!de){var pe=le.at(0);if((h.startPoint.isEqualTo(pe)||h.endPoint.isEqualTo(pe)||M.startPoint.isEqualTo(pe)||M.endPoint.isEqualTo(pe))&&0===p)return{apply:function apply(){}}}var me=h.IntersectWith(M,t.McDb.Intersect.kExtendBoth);if(me.isEmpty())return void he("\n");var ge=me.at(0),ve=function isChamferTooLarge(t,h,p,x,M,k,I){var N=!1;return(N=de?Math.max(p.distanceTo(ge),x.distanceTo(ge))<I&&I>0||Math.max(M.distanceTo(ge),k.distanceTo(ge))<I&&I>0:(t?p.distanceTo(ge):x.distanceTo(ge))<I&&I>0||(h?M.distanceTo(ge):k.distanceTo(ge))<I&&I>0)&&he("\n"),N};return I=function apply(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getHandle()===h.getHandle();if(t instanceof Bt&&h instanceof Bt){var I=isSegmentStartCloserToPoint(t.startPoint,t.endPoint,ge,ae),re=isSegmentStartCloserToPoint(h.startPoint,h.endPoint,ge,k),ne=createLineSegmentRoundJoin(p,t,h,ge,I,re,x,Wi);if(!ne)return void he("\n");var ie=ne.arc,oe=ne.chamferDist;if(ve(I,re,t.startPoint,t.endPoint,h.startPoint,h.endPoint,oe))return;return ie&&V(ie),!0}var se=function processPolylineChamferClosure(t,h,k,I,N,ee){var te=t.numVerts();if(M||(t.isClosed=!1),N){var re=N.start,ne=N.end,ie=N.endIndex,ae=N.startIndex,oe=N.isClosed,se=[],ce=function getPointInfo(t,h){var p=t.getBulgeAt(h),x=t.getPointAt(h).val,M=t.getWidthsAt(h);return{point:x,bulge:p,startWidth:M.val1,endWidth:M.val2}},ue=isSegmentStartCloserToPoint(re.clone(),ne.clone(),ge,k);if(h instanceof Bt){if(M)return void he("\n ");var le=isSegmentStartCloserToPoint(h.startPoint.clone(),h.endPoint.clone(),ge,I),fe=h.clone(),de=createLineSegmentRoundJoin(p,new Bt(re.clone(),ne.clone()),fe,ge,ue,le,x,Wi);if(!de)return void he("\n");var pe=de.chamferDist,me=de.bulge,ye=de.segmentLine,be=de.arc;if(ve(ue,le,re,ne,h.startPoint,h.endPoint,pe))return;if(ue){for(var xe=oe?t.numVerts():ie,Me=0;Me<xe;Me++)se.push(ce(t,Me));ye?x?(se.push({point:ye.startPoint,bulge:me}),se.push({point:ye.endPoint})):V(be):se.push({point:ge}),le?se.push({point:fe.startPoint.clone()}):se.push({point:fe.endPoint.clone()})}else{var we=t.numVerts();if(oe)se.push(ce(t,0));else for(var _e=ie;_e<we;_e++)se.push(ce(t,_e));ye?x?(se.unshift({point:ye.startPoint}),se.unshift({point:ye.endPoint,bulge:-me})):V(ye):se.unshift({point:ge}),le?se.unshift({point:h.startPoint.clone()}):se.unshift({point:h.endPoint.clone()})}}else{if(!(h instanceof Gt&&ee))return!1;var Ce=ee.start,Se=ee.end,Te=ee.startIndex,Ae=ee.endIndex,De=ee.isClosed,ke=isSegmentStartCloserToPoint(Ce,Se,ge,I),Le=createLineSegmentRoundJoin(p,new Bt(re,ne),new Bt(Ce,Se),ge,ue,ke,x,Wi);if(!Le)return void he("\n");var Ee=Le.arc,Ie=Le.segmentLine,Be=Le.bulge,Oe=Le.chamferDist;if(ve(ue,ke,re,ne,Ce,Se,Oe))return;if(M){var Re=t.numVerts(),Fe=h.numVerts(),Ne=Te-ae;if((0===ae||ae===Re-(oe?1:2))&&(0===Te||Te===Fe-(De?1:2))&&Re>(oe||De?2:4))return Ie?x?0===ae||0===Te?(0===ae?(t.setPointAt(0,Ie.startPoint),oe||De?t.addVertexAt(Ie.endPoint,-Be):(t.setPointAt(Re-1,Ie.endPoint),t.setBulgeAt(Re-1,Be))):(t.setPointAt(0,Ie.endPoint),oe||De?t.addVertexAt(Ie.startPoint,Be):(t.setPointAt(Re-1,Ie.startPoint),t.setBulgeAt(Re-1,Be))),t.isClosed=!0):x&&(t.setPointAt(Re-1,oe?Ie.endPoint:Ie.startPoint),t.setBulgeAt(Re-1,oe?-Be:Be),t.addVertexAt(oe?Ie.startPoint:Ie.endPoint)):V(Ee):x&&(t.setPointAt(0,ge),t.removeVertexAt(Re-1),t.isClosed=!0),!0;if(Math.abs(Ne)>2)return void he("\n ");h=h.clone()}if(!(h instanceof Gt))return;if(ue){for(var Ve=0;Ve<=ae;Ve++)se.push(ce(t,Ve));if(Ie?x?(se.push({point:Ie.startPoint,bulge:Be}),se.push({point:Ie.endPoint})):V(Ee):se.push({point:ge}),ke)for(var Ge=Te;Ge>=0;Ge--)se.push(ce(h,Ge));else if(De)se.push(ce(h,0));else for(var je=h.numVerts(),Ue=Ae;Ue<je;Ue++)se.push(ce(h,Ue))}else{var ze=t.numVerts();if(oe)se.push(ce(t,0));else for(var We=ie;We<ze;We++)se.push(ce(t,We));if(Ie?x?(se.unshift({point:Ie.startPoint}),se.unshift({point:Ie.endPoint,bulge:-Be})):V(Ee):se.unshift({point:ge}),ke)for(var He=Te;He>=0;He--)se.unshift(ce(h,He));else if(De)se.unshift(ce(h,0));else for(var $e=h.numVerts(),Xe=Ae;Xe<$e;Xe++)se.unshift(ce(h,Xe))}}if(x){for(var qe=0;qe<te;qe++)t.removeVertexAt(0);se.forEach((function(h){var p=h.point,x=h.bulge,M=h.startWidth,k=h.endWidth;t.addVertexAt(p,x,M,k)})),h.erase()}return!0}};return t instanceof Gt&&ce?se(t,h,ae,k,ce,N):!!(h instanceof Gt&&N)&&se(h,t,k,ae,N,ce)},{apply:I,line1:h,line2:M}}},ue.setUserDraw((function(t,h){var p=se.clone(),M=Mt.findEntAtPoint(t.x,t.y,t.z,-1,oe);if(!M)return fe();if(!M.isValid())return fe();var k=M.getMcDbEntity();if(!k)return fe();var I=null==k?void 0:k.clone();if(!I)return fe();var N=de(p,I,t,(function(t){h.drawMcDbEntity(t)}))||{},V=N.line1,ee=N.line2,te=N.apply,re=te&&te(p,I,se.getHandle()===k.getHandle());if(V&&ee&&re){p.drawOrder=se.drawOrder+k.drawOrder+102,V.drawOrder=se.drawOrder+k.drawOrder+101,ee.drawOrder=se.drawOrder+k.drawOrder+101;var ne=new THREE.Color(Number(se.trueColor.getColorValue(se.layerId))),ie=ne.clone();x&&(darkenColor(ie,.5),h.setColor(ie)),h.drawMcDbEntity(V),h.drawMcDbEntity(ee),h.setColor(ne),h.drawMcDbEntity(p)}}));case 80:return ue.setMessage(""),ue.setKeyWords("[(R)]"),_e.next=85,ue.go();case 85:if(pe=_e.sent,!ue.isKeyWordPicked("R")){_e.next=93;break}return _e.next=89,k();case 89:if(_e.t2=_typeof$1(_e.sent),"number"===_e.t2){_e.next=92;break}return _e.abrupt("return",{v:void 0});case 92:return _e.abrupt("continue",80);case 93:if(pe){_e.next=95;break}return _e.abrupt("return",{v:fe()});case 95:if(pe.isValid()){_e.next=97;break}return _e.abrupt("return",{v:fe()});case 97:if(me=pe.getMcDbEntity()){_e.next=100;break}return _e.abrupt("return",{v:fe()});case 100:if(ge=se,ve=ue.pickPoint(),ye=de(ge,me,ve)||{},be=ye.line1,xe=ye.line2,Me=ye.apply,!(be&&xe&&areLinesCollinear(be,xe))){_e.next=106;break}return h.MxFun.acutPrintf(" "),_e.abrupt("return",{v:fe()});case 106:if(!Me){_e.next=115;break}if(we=Me(),!M||void 0!==we){_e.next=112;break}return _e.abrupt("continue",80);case 112:return _e.abrupt("break",123);case 113:_e.next=121;break;case 115:if(t.MxCpp.App.MxCADAssist.MxFillet(V.id,pe.id,ae.x,ae.y,ve.x,ve.y,p,x),!M){_e.next=120;break}return _e.abrupt("continue",80);case 120:return _e.abrupt("break",123);case 121:_e.next=80;break;case 123:if(fe(),!M){_e.next=128;break}return _e.abrupt("return",0);case 128:return _e.abrupt("return",1);case 129:case"end":return _e.stop()}}),_loop5)}));case 9:return te.delegateYield(V(),"t0",11);case 11:if(0!==(ee=te.t0)){te.next=14;break}return te.abrupt("continue",9);case 14:if(1!==ee){te.next=16;break}return te.abrupt("break",20);case 16:if(!ee){te.next=18;break}return te.abrupt("return",ee.v);case 18:te.next=9;break;case 20:case"end":return te.stop()}}),_callee17)}))),_Mx_Fillet.apply(this,arguments)}window.addEventListener("keydown",(function onKeydown(t){Wi=t.shiftKey})),window.addEventListener("keyup",(function onKeyup(t){Wi=t.shiftKey}));var Hi=function(){var t=_asyncToGenerator(ie.mark((function _callee(){var t,p,x,M;return ie.wrap((function _callee$(k){for(;;)switch(k.prev=k.next){case 0:t=[];case 1:return(p=new St).setMessage(0===t.length?"":""),p.setKeyWords(0===t.length?"":"[(U)]"),p.setUserDraw((function(h,p){var x=new Gt;t.forEach((function(t){x.addVertexAt(t)})),x.addVertexAt(h),p.drawMcDbEntity(x)})),k.next=8,p.go();case 8:if(x=k.sent,!p.isKeyWordPicked("U")){k.next=13;break}return(M=t.pop())&&p.setLastInputPoint(M),k.abrupt("continue",1);case 13:if(p.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){k.next=15;break}return k.abrupt("return",!1);case 15:if(p.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){k.next=17;break}return k.abrupt("break",22);case 17:if(x){k.next=19;break}return k.abrupt("return",t);case 19:t.push(x),k.next=1;break;case 22:return k.abrupt("return",t);case 23:case"end":return k.stop()}}),_callee)})));return function getHurdleSelectionPoints(){return t.apply(this,arguments)}}();function Mx_Trim(){return _Mx_Trim.apply(this,arguments)}function _Mx_Trim(){return(_Mx_Trim=_asyncToGenerator(ie.mark((function _callee18(){var p,x,M,k,I,N,V,ee,te;return ie.wrap((function _callee18$(re){for(;;)switch(re.prev=re.next){case 0:if((p=new bt).AddMcDbEntityTypes("LINE,LWPOLYLINE,ELLIPSE,ARC,CIRCLE,SPLINE,XLINE"),0!==(k=Mt.getCurrentSelect(p)).length){re.next=12;break}return re.next=6,Mt.userSelect("<>",p,(function(t,h){x=h,M=t}));case 6:if(k=re.sent,x.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){re.next=9;break}return re.abrupt("return");case 9:if(x.getStatus()===h.MrxDbgUiPrBaseReturn.kNone&&0===k.length&&(M.allSelect(p),M.forEach((function(t){k.push(t)}))),0!==k.length){re.next=12;break}return re.abrupt("return");case 12:if((I=new cn).copyFormAryId(k),(N=new t.MxCpp.mxcadassemblyimp.MxDrawTrimAssist).Init(I.imp)){re.next=17;break}return re.abrupt("return");case 17:V=!0,ee=ie.mark((function _loop7(){var t,h,x,M;return ie.wrap((function _loop7$(k){for(;;)switch(k.prev=k.next){case 0:if((t=new _t).isSelectHighlight=!1,!V){k.next=10;break}return t.isWhileSelect=!1,k.next=6,t.userSelect("",p,(function(t){(h=t).setKeyWords("[(F)/(C)]")}));case 6:if(k.sent){k.next=8;break}return k.abrupt("return",0);case 8:k.next=15;break;case 10:return t.isWhileSelect=!1,k.next=13,t.fenceSelect("",p,(function(t){(h=t).setKeyWords("[(F)/(C)]")}));case 13:if(k.sent){k.next=15;break}return k.abrupt("return",0);case 15:if(!h.isKeyWordPicked("F")){k.next=20;break}return V=!1,k.abrupt("return",1);case 20:if(!h.isKeyWordPicked("C")){k.next=23;break}return V=!0,k.abrupt("return",1);case 23:if(0!=(x=t.getIds()).length){k.next=26;break}return k.abrupt("return",1);case 26:M=t.getSelectPoint(),I.copyFormAryId(x),N.DoTrim(I.imp,M.pt1.x,M.pt1.y,M.pt2.x,M.pt2.y);case 29:case"end":return k.stop()}}),_loop7)}));case 19:return re.delegateYield(ee(),"t0",21);case 21:if(0!==(te=re.t0)){re.next=24;break}return re.abrupt("break",28);case 24:if(1!==te){re.next=26;break}return re.abrupt("continue",19);case 26:re.next=19;break;case 28:N.UnInit();case 29:case"end":return re.stop()}}),_callee18)})))).apply(this,arguments)}function Mx_Extend(){return _Mx_Extend.apply(this,arguments)}function _Mx_Extend(){return _Mx_Extend=_asyncToGenerator(ie.mark((function _callee19(){var p,x,M,k,I,N,V,ee,te,re,ne,ae,oe,se,ce;return ie.wrap((function _callee19$(ue){for(;;)switch(ue.prev=ue.next){case 0:if(p=new bt,x=!1,I=!1,p.AddMcDbEntityTypes("LINE,LWPOLYLINE,ARC"),0!==(N=Mt.getCurrentSelect(p)).length){ue.next=15;break}return ue.next=9,Mt.userSelect("<>",p,(function(t,h){M=h,k=t}));case 9:if(N=ue.sent,M.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ue.next=12;break}return ue.abrupt("return");case 12:if(M.getStatus()===h.MrxDbgUiPrBaseReturn.kNone&&0===N.length&&(k.allSelect(p),k.forEach((function(t){N.push(t)}))),0!==N.length){ue.next=15;break}return ue.abrupt("return");case 15:if((V=new cn).copyFormAryId(N),(ee=new t.MxCpp.mxcadassemblyimp.MxDrawExtendAssist).Init(V.imp)){ue.next=20;break}return ue.abrupt("return");case 20:if((te=new t.MxCpp.mxcadassemblyimp.MxDrawTrimAssist).Init(V.imp)){ue.next=23;break}return ue.abrupt("return");case 23:re=[],ne=!1,ae=function onKeydown2(t){ne="Shift"===t.key},window.addEventListener("keydown",ae),oe=function onkeyup(){return ne=!1},window.addEventListener("keyup",oe),se=ie.mark((function _loop8(){var M,k,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye;return ie.wrap((function _loop8$(ie){for(;;)switch(ie.prev=ie.next){case 0:return(M=new _t).isWhileSelect=!1,M.isSelectHighlight=!1,ie.next=5,M.userSelect(" Shift ",p,(function(t){(k=t).setKeyWords("[(F)/(C)/(E)".concat(re.length>0?"/(U)":"","]"))}));case 5:if(ie.sent){ie.next=7;break}return ie.abrupt("return",0);case 7:if(!k.isKeyWordPicked("F")){ie.next=18;break}return ie.next=10,Hi();case 10:if(ae=ie.sent){ie.next=13;break}return ie.abrupt("return",0);case 13:return oe=new Gt,ae.forEach((function(t){oe.addVertexAt(t)})),re.push([N,N.map((function(t){return t.clone()}))]),N.forEach((function(h){var p=h.getMcDbEntity();if(p instanceof It){var x=p.IntersectWith(oe,t.McDb.Intersect.kOnBothOperands);x.isEmpty()||x.forEach((function(t){V.copyFormAryId([h]),ne?te.DoTrim(V.imp,t.x,t.y,t.x,t.y):ee.DoExtend(V.imp,t.x,t.y,t.x,t.y)}))}})),ie.abrupt("return",1);case 18:if(!k.isKeyWordPicked("C")){ie.next=21;break}return x=!0,ie.abrupt("return",1);case 21:if(!k.isKeyWordPicked("E")){ie.next=39;break}return(se=new kt).setMessage("<".concat(I?"":"",">")),se.setKeyWords("[(E)/(N)]"),ie.next=27,se.go();case 27:if(ce=se.keyWordPicked(),se.getStatus()!==h.MrxDbgUiPrBaseReturn.kCancel){ie.next=30;break}return ie.abrupt("return",{v:void 0});case 30:if(se.getStatus()!==h.MrxDbgUiPrBaseReturn.kNone){ie.next=32;break}return ie.abrupt("return",1);case 32:if(se.getStatus()!==h.MrxDbgUiPrBaseReturn.kKeyWord){ie.next=39;break}if("E"!==ce){ie.next=36;break}return I=!0,ie.abrupt("return",1);case 36:if("N"!==ce){ie.next=39;break}return I=!1,ie.abrupt("return",1);case 39:if(!k.isKeyWordPicked("U")){ie.next=46;break}return ue=re.pop()||[],le=_slicedToArray$1(ue,2),he=le[0],fe=le[1],null==he||he.forEach((function(t){t.erase()})),de=t.MxCpp.getCurrentMxCAD(),null==fe||fe.forEach((function(t){t instanceof Et&&de.drawEntity(t)})),ie.abrupt("return",1);case 46:if(0!=(pe=M.getIds()).length){ie.next=49;break}return ie.abrupt("return",1);case 49:if(me=M.getSelectPoint(),!x){ie.next=61;break}return ge=me.pt1,ve=me.pt2,(ye=new Gt).addVertexAt(ge),ye.addVertexAt(new rn(ge.x,ve.y)),ye.addVertexAt(ve),ye.addVertexAt(new rn(ve.x,ge.y)),ye.isClosed=!0,re.push([N,N.map((function(t){return t.clone()}))]),N.forEach((function(h){var p=h.getMcDbEntity();if(p instanceof It){var x=p.IntersectWith(ye,t.McDb.Intersect.kOnBothOperands);x.isEmpty()||x.forEach((function(t){V.copyFormAryId([h]),ne?te.DoTrim(V.imp,t.x,t.y,t.x,t.y):ee.DoExtend(V.imp,t.x,t.y,t.x,t.y)}))}})),ie.abrupt("return",1);case 61:re.push([pe,N.map((function(t){return t.clone()}))]),V.copyFormAryId(pe),ne?te.DoTrim(V.imp,me.pt1.x,me.pt1.y,me.pt2.x,me.pt2.y):ee.DoExtend(V.imp,me.pt1.x,me.pt1.y,me.pt2.x,me.pt2.y);case 64:case"end":return ie.stop()}}),_loop8)}));case 30:return ue.delegateYield(se(),"t0",32);case 32:if(0!==(ce=ue.t0)){ue.next=35;break}return ue.abrupt("break",41);case 35:if(1!==ce){ue.next=37;break}return ue.abrupt("continue",30);case 37:if(!ce){ue.next=39;break}return ue.abrupt("return",ce.v);case 39:ue.next=30;break;case 41:window.removeEventListener("keydown",ae),window.removeEventListener("keyup",oe),te.UnInit(),ee.UnInit();case 45:case"end":return ue.stop()}}),_callee19)}))),_Mx_Extend.apply(this,arguments)}function Mx_Explode(){return _Mx_Explode.apply(this,arguments)}function _Mx_Explode(){return(_Mx_Explode=_asyncToGenerator(ie.mark((function _callee20(){var h,p,x;return ie.wrap((function _callee20$(M){for(;;)switch(M.prev=M.next){case 0:return(h=new bt).AddMcDbEntityTypes("INSERT,MTEXT,ROTATEDDIMENSION,ALIGNEDDIMENSION,DIMENSION,LWPOLYLINE,CUSTOMENTITY,ACAD_PROXY_ENTITY"),M.next=4,Mt.userSelect("",h);case 4:if(0!=(p=M.sent).length){M.next=7;break}return M.abrupt("return");case 7:(x=new cn).copyFormAryId(p),t.MxCpp.App.MxCADAssist.MxExplode(x.imp);case 10:case"end":return M.stop()}}),_callee20)})))).apply(this,arguments)}function Mx_Join(){return _Mx_Join.apply(this,arguments)}function _Mx_Join(){return(_Mx_Join=_asyncToGenerator(ie.mark((function _callee21(){var h,p,x;return ie.wrap((function _callee21$(M){for(;;)switch(M.prev=M.next){case 0:return(h=new bt).AddMcDbEntityTypes("LWPOLYLINE,ARC,LINE"),M.next=4,Mt.userSelect("",h);case 4:if(0!=(p=M.sent).length){M.next=7;break}return M.abrupt("return");case 7:(x=new cn).copyFormAryId(p),t.MxCpp.App.MxCADAssist.MxJoin(x.imp);case 10:case"end":return M.stop()}}),_callee21)})))).apply(this,arguments)}function Mx_Break(){return _Mx_Break.apply(this,arguments)}function _Mx_Break(){return(_Mx_Break=_asyncToGenerator(ie.mark((function _callee22(){var p,x,M,k,I,N,V;return ie.wrap((function _callee22$(ee){for(;;)switch(ee.prev=ee.next){case 0:return(p=new bt).AddMcDbEntityTypes("LWPOLYLINE,ARC,LINE,CIRCLE"),(x=new Lt).setFilter(p),x.setMessage(""),ee.next=7,x.go();case 7:if((M=ee.sent).isValid()){ee.next=10;break}return ee.abrupt("return");case 10:if(k=M.getMcDbCurve()){ee.next=13;break}return ee.abrupt("return");case 13:I=x.pickPoint(),k.highlight(!0),N=ie.mark((function _loop9(){var p,x,M,N,V,ee,te,re,ne,ae,oe,se,ce,ue,le,he;return ie.wrap((function _loop9$(ie){for(;;)switch(ie.prev=ie.next){case 0:return(p=new St).setMessage("\n"),p.setKeyWords("[(F)/(D)/(M)/(I)]"),p.setUserDraw((function(t,h){var p=null==k?void 0:k.clone();if(p&&p instanceof It){var x=[];x.push(I),x.push(t);var M=p.splitCurves(x);M.empty()||M.forEach((function(t,p){p%2==0&&h.drawMcDbEntity(t)}))}})),ie.next=6,p.go();case 6:if(x=ie.sent,!p.isKeyWordPicked("F")){ie.next=17;break}return p.setMessage(""),p.setKeyWords(""),ie.next=12,p.go();case 12:if(M=ie.sent){ie.next=15;break}return ie.abrupt("return",{v:void 0});case 15:return I=M,ie.abrupt("return",0);case 17:if(N=!1,!p.isKeyWordPicked("D")){ie.next=33;break}return(V=new Tt).setMessage(""),V.setKeyWords(""),ie.next=24,V.go();case 24:if("number"==typeof(ee=ie.sent)){ie.next=27;break}return ie.abrupt("return",{v:void 0});case 27:if(I=k.getStartPoint().val,te=k.getPointAtDist(ee),re=te.val,te.ret){ie.next=31;break}return ie.abrupt("return",{v:h.MxFun.acutPrintf("\n")});case 31:x=re,N=!0;case 33:if(!p.isKeyWordPicked("M")){ie.next=40;break}if(I=k.getStartPoint().val,ne=k.getPointAtDist(k.getLength().val/2),ae=ne.val,ne.ret){ie.next=38;break}return ie.abrupt("return",{v:void 0});case 38:x=ae,N=!0;case 40:if(!p.isKeyWordPicked("I")){ie.next=56;break}return ie.next=43,Mt.userSelect("");case 43:if(oe=ie.sent,se=k.clone(),ce=[],oe.forEach((function(h){if(se instanceof It){var p=h.clone();if(p instanceof It){var x=se.IntersectWith(p,t.McDb.Intersect.kOnBothOperands);x.isEmpty()||x.forEach((function(t){return ce.push(t)}))}}})),0!==ce.length){ie.next=49;break}return ie.abrupt("return",{v:h.MxFun.acutPrintf("\n")});case 49:if(!(ue=k.splitCurves(ce)).empty()){ie.next=53;break}return k.highlight(!1),ie.abrupt("return",{v:void 0});case 53:return ue.forEach((function(h){h instanceof Et&&(k&&zi(h,k),t.MxCpp.getCurrentMxCAD().drawEntity(h))})),k.erase(),ie.abrupt("return",1);case 56:if(x){ie.next=59;break}return k.highlight(!1),ie.abrupt("return",{v:void 0});case 59:if((le=[]).push(I),le.push(x),!(he=k.splitCurves(le)).empty()){ie.next=66;break}return k.highlight(!1),ie.abrupt("return",{v:void 0});case 66:return he.forEach((function(h,p){h instanceof Et&&(k&&zi(h,k),(p%2==0||N)&&t.MxCpp.getCurrentMxCAD().drawEntity(h))})),k.erase(),ie.abrupt("return",1);case 69:case"end":return ie.stop()}}),_loop9)}));case 16:return ee.delegateYield(N(),"t0",18);case 18:if(0!==(V=ee.t0)){ee.next=21;break}return ee.abrupt("continue",16);case 21:if(1!==V){ee.next=23;break}return ee.abrupt("break",27);case 23:if(!V){ee.next=25;break}return ee.abrupt("return",V.v);case 25:ee.next=16;break;case 27:case"end":return ee.stop()}}),_callee22)})))).apply(this,arguments)}function Mx_DrawOrderTopmost(){return _Mx_DrawOrderTopmost.apply(this,arguments)}function _Mx_DrawOrderTopmost(){return(_Mx_DrawOrderTopmost=_asyncToGenerator(ie.mark((function _callee23(){var h,p,x;return ie.wrap((function _callee23$(M){for(;;)switch(M.prev=M.next){case 0:return h=new _t,M.next=3,h.userSelect("\n");case 3:if(M.sent){M.next=5;break}return M.abrupt("return");case 5:p=t.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder(),x=p.maxDrawOrder+1,h.forEach((function(t){var h=t.getMcDbEntity();h&&(h.drawOrder=x)}));case 8:case"end":return M.stop()}}),_callee23)})))).apply(this,arguments)}function Mx_DrawOrderButtomost(){return _Mx_DrawOrderButtomost.apply(this,arguments)}function _Mx_DrawOrderButtomost(){return(_Mx_DrawOrderButtomost=_asyncToGenerator(ie.mark((function _callee24(){var h,p,x;return ie.wrap((function _callee24$(M){for(;;)switch(M.prev=M.next){case 0:return h=new _t,M.next=3,h.userSelect("\n");case 3:if(M.sent){M.next=5;break}return M.abrupt("return");case 5:p=t.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder(),x=p.minDrawOrder-1,h.forEach((function(t){var h=t.getMcDbEntity();h&&(h.drawOrder=x)}));case 8:case"end":return M.stop()}}),_callee24)})))).apply(this,arguments)}function Mx_DrawOrderTop(){return _Mx_DrawOrderTop.apply(this,arguments)}function _Mx_DrawOrderTop(){return(_Mx_DrawOrderTop=_asyncToGenerator(ie.mark((function _callee25(){var t,h,p,x,M;return ie.wrap((function _callee25$(k){for(;;)switch(k.prev=k.next){case 0:return t=new _t,k.next=3,t.userSelect("\n");case 3:if(k.sent){k.next=5;break}return k.abrupt("return");case 5:if(!t.isNull()){k.next=7;break}return k.abrupt("return");case 7:return(h=new Lt).setMessage(""),k.next=11,h.go();case 11:if(!(p=k.sent).isNull()){k.next=14;break}return k.abrupt("return");case 14:if(x=p.getMcDbEntity()){k.next=17;break}return k.abrupt("return");case 17:M=x.drawOrder+1,t.forEach((function(t){var h=t.getMcDbEntity();h&&(h.drawOrder=M)}));case 19:case"end":return k.stop()}}),_callee25)})))).apply(this,arguments)}function Mx_DrawOrderButtom(){return _Mx_DrawOrderButtom.apply(this,arguments)}function _Mx_DrawOrderButtom(){return(_Mx_DrawOrderButtom=_asyncToGenerator(ie.mark((function _callee26(){var t,h,p,x,M;return ie.wrap((function _callee26$(k){for(;;)switch(k.prev=k.next){case 0:return t=new _t,k.next=3,t.userSelect("\n");case 3:if(k.sent){k.next=5;break}return k.abrupt("return");case 5:if(!t.isNull()){k.next=7;break}return k.abrupt("return");case 7:return(h=new Lt).setMessage(""),k.next=11,h.go();case 11:if(!(p=k.sent).isNull()){k.next=14;break}return k.abrupt("return");case 14:if(x=p.getMcDbEntity()){k.next=17;break}return k.abrupt("return");case 17:M=x.drawOrder-1,t.forEach((function(t){var h=t.getMcDbEntity();h&&(h.drawOrder=M)}));case 19:case"end":return k.stop()}}),_callee26)})))).apply(this,arguments)}var $i="mx_clip_file_data",Xi=1;function openClipboardDatabase(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xi;return new Promise((function(h,p){var x=indexedDB.open("mx_clipboard",t);x.onerror=function(t){p(new Error("Error opening database: "+t))},x.onupgradeneeded=function(t){var h=t.target.result;h.objectStoreNames.contains($i)||h.createObjectStore($i)},x.onsuccess=function(t){var p=t.target.result;h(p)}}))}var qi="_mxcad_clipboard_file.mxweb";function Mx_CopyClipboardImp(t){return _Mx_CopyClipboardImp.apply(this,arguments)}function _Mx_CopyClipboardImp(){return(_Mx_CopyClipboardImp=_asyncToGenerator(ie.mark((function _callee27(p){var x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee27$(ne){for(;;)switch(ne.prev=ne.next){case 0:if(0!=(x=Mt.getCurrentSelect(null,!0,!1)).length){ne.next=4;break}return h.MxFun.acutPrintf("\n "),ne.abrupt("return");case 4:if(M=t.MxCpp.getCurrentDatabase(),k=new Ir,M.wblock(k,x)){ne.next=9;break}return h.MxFun.acutPrintf("\n "),ne.abrupt("return");case 9:if(k.saveAs(qi)){ne.next=12;break}return h.MxFun.acutPrintf("\n "),ne.abrupt("return");case 12:return p&&x.forEach((function(t){t.erase()})),I=window.MX_WASM_FS,N=I.readFile(qi),I.unlink(qi),ne.next=18,openClipboardDatabase();case 18:V=ne.sent,ee=V.transaction($i,"readwrite"),te=ee.objectStore($i),(re=te.put(N,"data")).onsuccess=function(t){},re.onerror=function(t){};case 24:case"end":return ne.stop()}}),_callee27)})))).apply(this,arguments)}function Mx_CopyClipboard(){Mx_CopyClipboardImp(!1)}function Mx_CutClipboard(){Mx_CopyClipboardImp(!0)}function Mx_PasteClipboard(){return _Mx_PasteClipboard.apply(this,arguments)}function _Mx_PasteClipboard(){return _Mx_PasteClipboard=_asyncToGenerator(ie.mark((function _callee29(){var p,x,M,k,I,N,V,ee,te,re;return ie.wrap((function _callee29$(ne){for(;;)switch(ne.prev=ne.next){case 0:return x=function _getClipboardDataToFi(t,h){return new Promise(function(){var p=_asyncToGenerator(ie.mark((function _callee28(p){var x,M,k,I;return ie.wrap((function _callee28$(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,openClipboardDatabase();case 2:x=N.sent,M=x.transaction(t,"readonly"),k=M.objectStore(t),(I=k.get("data")).onerror=function(){p(void 0)},I.onsuccess=function(){var t=I.result;window.MX_WASM_FS.writeFile(h,t),p(!0)};case 8:case"end":return N.stop()}}),_callee28)})));return function(t){return p.apply(this,arguments)}}())},p=t.MxCpp.getCurrentMxCAD(),ne.next=4,x($i,qi);case 4:if(ne.sent){ne.next=7;break}return h.MxFun.acutPrintf("\n "),ne.abrupt("return");case 7:if((M=new Ir).readFile(qi)){ne.next=11;break}return h.MxFun.acutPrintf("\n "),ne.abrupt("return");case 11:if(window.MX_WASM_FS.unlink(qi),k=t.MxCpp.getCurrentDatabase(),!(I=k.insert(M,"")).isNull()){ne.next=17;break}return ne.abrupt("return");case 17:return(N=I.getMcDbBlockTableRecord())&&(V=N.getBoundingBox()).ret&&(N.origin=V.minPt.addvec(V.maxPt.sub(V.minPt).mult(.5))),(ee=new jt).blockTableRecordId=I,(te=new St).setMessage(""),te.setUserDraw((function(t,h){ee.position=t,h.drawMcDbEntity(ee)})),ne.next=26,te.go();case 26:if(re=ne.sent){ne.next=29;break}return ne.abrupt("return");case 29:if(ee.position=re,p.drawEntity(ee).isValid){ne.next=34;break}return ne.abrupt("return");case 34:case"end":return ne.stop()}}),_callee29)}))),_Mx_PasteClipboard.apply(this,arguments)}h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Erase",Mx_Erase),h.MxFun.addCommand("Mx_Copy",Mx_Copy,h.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT),h.MxFun.addCommand("Mx_Move",Mx_Move,h.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT),h.MxFun.addCommand("Mx_Rotate",Mx_Rotate,h.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT),h.MxFun.addCommand("Mx_Scale",Mx_Scale,h.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT),h.MxFun.addCommand("Mx_WindowZoom",Mx_WindowZoom),h.MxFun.addCommand("Mx_ZoomE",Mx_ZoomE),h.MxFun.addCommand("Mx_Plan90CW",Mx_Plan90CW),h.MxFun.addCommand("Mx_Offset",Mx_Offset),h.MxFun.addCommand("Mx_Regen",Mx_Regen),h.MxFun.addCommand("Mx_Mirror",Mx_Mirror,h.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT),h.MxFun.addCommand("Mx_Chamfer",Mx_Chamfer),h.MxFun.addCommand("Mx_Fillet",Mx_Fillet),h.MxFun.addCommand("Mx_Trim",Mx_Trim),h.MxFun.addCommand("Mx_Extend",Mx_Extend),h.MxFun.addCommand("Mx_Explode",Mx_Explode),h.MxFun.addCommand("Mx_Join",Mx_Join),h.MxFun.addCommand("Mx_Break",Mx_Break),h.MxFun.addCommand("Mx_DrawOrderTopmost",Mx_DrawOrderTopmost),h.MxFun.addCommand("Mx_DrawOrderButtomost",Mx_DrawOrderButtomost),h.MxFun.addCommand("Mx_DrawOrderTop",Mx_DrawOrderTop),h.MxFun.addCommand("Mx_DrawOrderButtom",Mx_DrawOrderButtom),h.MxFun.addCommand("Mx_CopyClipboard",Mx_CopyClipboard),h.MxFun.addCommand("Mx_PasteClipboard",Mx_PasteClipboard),h.MxFun.addCommand("Mx_CutClipboard",Mx_CutClipboard)}));var Ki=function getQuadrant(t,h){return[h.x>=t.x&&h.y>=t.y,h.x<t.x&&h.y>=t.y,h.x<t.x&&h.y<t.y,h.x>=t.x&&h.y<t.y]};function calculateRoundedRectangleVertices(t,h,p){if(0===h&&0===p)return t;var x=_slicedToArray$1(t,4),M=x[0],k=x[1],I=x[2],N=x[3],V=M.distanceTo(N),ee=M.distanceTo(k),te=_slicedToArray$1(Ki(M,I),4);te[0];var re=te[1],ne=te[2],ie=te[3],ae=re||ne?-h:h,oe=ne||ie?-p:p;return V-2*Math.abs(ae)<=0||ee-2*Math.abs(oe)<=0?t:[new rn(M.x+ae,M.y,M.z),new rn(M.x,M.y+oe,M.z),new rn(k.x,k.y-oe,k.z),new rn(k.x+ae,k.y,k.z),new rn(I.x-ae,I.y,I.z),new rn(I.x,k.y-oe,I.z),new rn(N.x,N.y+oe,N.z),new rn(N.x-ae,N.y,N.z)]}var Yi=function rotatePoint(t,h,p){var x=Math.cos(p),M=Math.sin(p),k=h.x-t.x,I=h.y-t.y,N=k*x-I*M+t.x,V=k*M+I*x+t.y,ee=h.z;return new rn(N,V,ee)},Zi=function getRectPoints(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=new rn((t.x+h.x)/2,(t.y+h.y)/2,(t.z+h.z)/2),M=new rn(t.x,h.y,t.z),k=new rn(h.x,t.y,h.z);return[t,Yi(x,M,p),h,Yi(x,k,p)]},Ji=function(){var h=_asyncToGenerator(ie.mark((function _callee3(){var h,p,x,M,k,I,N,V,ee,te,re,ne,ae,oe;return ie.wrap((function _callee3$(se){for(;;)switch(se.prev=se.next){case 0:h=new St,p=0,x=0,M=0,k=0,I=0,N=0,V=200,ee=0,te=0,re=0,ne="default",ae=ie.mark((function _loop(){var ae,oe,se,ce,ue,le,he;return ie.wrap((function _loop$(fe){for(;;)switch(fe.prev=fe.next){case 0:return ae=function(){var t=_asyncToGenerator(ie.mark((function _callee(t,h){var p;return ie.wrap((function _callee$(x){for(;;)switch(x.prev=x.next){case 0:return(p=new Tt).setMessage(_ML_String(t,h)),x.next=4,p.go();case 4:if(x.sent){x.next=7;break}throw"error getLength";case 7:return x.abrupt("return",p.value());case 8:case"end":return x.stop()}}),_callee)})));return function getLength(h,p){return t.apply(this,arguments)}}(),h.setUserDraw((function(){})),h.clearLastInputPoint(),h.setMessage("\n"),h.setKeyWords("[(C)/(E)/(F)/(T)/(W)]"),fe.next=7,h.go();case 7:if(oe=fe.sent,ce=new Gt,fe.prev=9,!h.isKeyWordPicked("C")){fe.next=19;break}return fe.next=13,ae("ID_ARX_RECTANG_CHAMFEr1LENGTH","\n:");case 13:return p=fe.sent,fe.next=16,ae("ID_ARX_RECTANG_CHAMFEr2LENGTH","\n");case 16:return x=fe.sent,ne="chamfer",fe.abrupt("return",0);case 19:if(!h.isKeyWordPicked("E")){fe.next=24;break}return fe.next=22,ae("ID_ARX_RECTANG_ELEVATION","\n");case 22:return M=fe.sent,fe.abrupt("return",0);case 24:if(!h.isKeyWordPicked("F")){fe.next=30;break}return fe.next=27,ae("ID_ARX_RECTANG_RADIUS","\n");case 27:return k=fe.sent,ne="angleRounded",fe.abrupt("return",0);case 30:if(!h.isKeyWordPicked("T")){fe.next=35;break}return fe.next=33,ae("ID_ARX_RECTANG_THICKNESS","\n");case 33:return I=fe.sent,fe.abrupt("return",0);case 35:if(!h.isKeyWordPicked("W")){fe.next=40;break}return fe.next=38,ae("ID_ARX_RECTANG_WIDTH","\n");case 38:return N=fe.sent,fe.abrupt("return",0);case 40:fe.next=45;break;case 42:return fe.prev=42,fe.t0=fe.catch(9),fe.abrupt("return",1);case 45:if(oe){fe.next=47;break}return fe.abrupt("return",{v:void 0});case 47:return ue=function getRect(t,h){var M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ce=new Gt,t.z=h.z=I;var V=Zi(t,h,M),ee=new rn((t.x+h.x)/2,(t.y+h.y)/2,(t.z+h.z)/2),te=V;if("chamfer"===ne&&(te=calculateRoundedRectangleVertices(Zi(t,h),p,x)),"angleRounded"===ne&&0!==k){te=calculateRoundedRectangleVertices(Zi(t,h),k,k);var re=_slicedToArray$1(Ki(t,h),4);re[0];var ie=re[1],ae=re[2],oe=re[3];if(8===te.length){var ue=function addArc(t,h,p){var x=CMxDrawPolylineDragArcDraw_CalcArcBulge(t,h,new nn(p));ce.addVertexAt(t,x),ce.addVertexAt(h,0)},le=new nn(-1,0),he=new nn(0,1),fe=new nn(1,0),de=new nn(0,-1);oe&&(he.y=-1,fe.x=1,de.y=1),ie&&(le.x=1,he.y=1,fe.x=-1,de.y=-1),ae&&(le.x=1,he.y=-1,fe.x=-1,de.y=1),ue(te[0],te[1],le),ue(te[2],te[3],he),ue(te[4],te[5],fe),ue(te[6],te[7],de)}else te.forEach((function(t){ce.addVertexAt(t,0)}))}else te.forEach((function(t){ce.addVertexAt(t,0,N,N)}));return"chamfer"!==ne&&"angleRounded"!==ne||ce.rotate(ee,M),ce.isClosed=!0,ce.constantWidth=N,se=h,ce},le=function userDrawPoint1Rect(t,h){oe&&(ce=ue(oe,t,re),h.drawMcDbEntity(ce))},h.setUserDraw(le),he=function(){var p=_asyncToGenerator(ie.mark((function _callee2(){var p,x,k,N,ne,fe,de,pe,me;return ie.wrap((function _callee2$(ie){for(;;)switch(ie.prev=ie.next){case 0:return h.setMessage("\n"),h.setKeyWords("[(A)/(D)/(R)]"),ie.next=4,h.go();case 4:if(p=ie.sent,x=function userDrawPoint2Rect(t,h){var x=_slicedToArray$1(Ki(oe,t),4),M=x[0],k=x[1],N=x[2],V=x[3];M&&(p=new rn(oe.x+ee,oe.y+te,I)),k&&(p=new rn(oe.x-ee,oe.y+te,I)),N&&(p=new rn(oe.x-ee,oe.y-te,I)),V&&(p=new rn(oe.x+ee,oe.y-te,I)),p&&(ce=ue(oe,p,re),h.drawMcDbEntity(ce))},!h.isKeyWordPicked("A")){ie.next=40;break}return h.setUserDraw((function(){})),(k=new Dt).setMessage("<"+V+">"),ie.next=12,k.go();case 12:if(N=ie.sent){ie.next=15;break}return ie.abrupt("return");case 15:return V=N,(ne=new kt).setMessage(""),ne.setKeyWords("[(L)/(W)]"),ie.next=21,ne.go();case 21:if(null!==(fe=ie.sent)){ie.next=24;break}return ie.abrupt("return");case 24:if("w"!==fe){ie.next=31;break}return ie.next=27,ae("ID_ARX_RECTANG_AREA_WIDTH","");case 27:ee=ie.sent,te=V/ee,ie.next=35;break;case 31:return ie.next=33,ae("ID_ARX_RECTANG_AREA_LENGTH","");case 33:te=ie.sent,ee=V/te;case 35:p=new rn(oe.x+ee,oe.y+te,I),ce=ue(oe,p,re),t.MxCpp.getCurrentMxCAD().drawEntity(ce,!0),ie.next=98;break;case 40:if(!h.isKeyWordPicked("D")){ie.next=62;break}return ie.prev=41,ie.next=44,ae("ID_ARX_RECTANG_AREA_WIDTH","");case 44:return ee=ie.sent,ie.next=47,ae("ID_ARX_RECTANG_AREA_LENGTH","");case 47:te=ie.sent,ie.next=53;break;case 50:return ie.prev=50,ie.t0=ie.catch(41),ie.abrupt("return");case 53:return h.clearLastInputPoint(),h.setUserDraw(x),ie.next=57,he();case 57:if(void 0!==ie.sent){ie.next=60;break}return ie.abrupt("return");case 60:ie.next=98;break;case 62:if(!h.isKeyWordPicked("R")){ie.next=97;break}return h.setMessage("\n"),h.setKeyWords("[(P)]"),h.setUserDraw((function(t,h){re=angleTo(t.x,t.y,oe.x,oe.y),(ce=ue(oe,se)).rotate(oe,re),h.drawMcDbEntity(ce)})),ie.next=68,h.go();case 68:if(de=ie.sent,!h.isKeyWordPicked("P")){ie.next=87;break}return h.clearLastInputPoint(),h.setUserDraw((function(){})),h.setMessage("\n"),ie.next=75,h.go();case 75:if(pe=ie.sent){ie.next=78;break}return ie.abrupt("return");case 78:return h.setUserDraw((function(t,h){h.drawLine(t.toVector3(),pe.toVector3())})),ie.next=81,h.go();case 81:if(me=ie.sent){ie.next=84;break}return ie.abrupt("return");case 84:re=angleTo(pe.x,pe.y,me.x,me.y),ie.next=89;break;case 87:if(de){ie.next=89;break}return ie.abrupt("return");case 89:return h.setUserDraw(le),ie.next=92,he();case 92:if(void 0!==ie.sent){ie.next=95;break}return ie.abrupt("return");case 95:ie.next=98;break;case 97:p&&t.MxCpp.getCurrentMxCAD().drawEntity(ce,!0);case 98:ce.setxDataDouble("BG",M);case 99:case"end":return ie.stop()}}),_callee2,null,[[41,50]])})));return function run(){return p.apply(this,arguments)}}(),fe.next=53,he();case 53:if(void 0!==fe.sent){fe.next=56;break}return fe.abrupt("return",1);case 56:case"end":return fe.stop()}}),_loop,null,[[9,42]])}));case 13:return se.delegateYield(ae(),"t0",15);case 15:if(0!==(oe=se.t0)){se.next=18;break}return se.abrupt("continue",13);case 18:if(1!==oe){se.next=20;break}return se.abrupt("break",24);case 20:if(!oe){se.next=22;break}return se.abrupt("return",oe.v);case 22:se.next=13;break;case 24:case"end":return se.stop()}}),_callee3)})));return function drawRectang(){return h.apply(this,arguments)}}();function _objectDestructuringEmpty(t){if(null==t)throw new TypeError("Cannot destructure "+t)}h.MxFun.on("init",(function(){h.MxFun.addCommand("Mx_Rectang",Ji)}));var Qi=function(){function MxMap(t){_classCallCheck$1(this,MxMap),_defineProperty(this,"imp",{}),_defineProperty(this,"map",void 0),_defineProperty(this,"originLngLatLike",[0,0]),_defineProperty(this,"originCAD",[0,0]),_defineProperty(this,"meterInCADUnits",1),_defineProperty(this,"modelAltitude",0),_defineProperty(this,"loadOldEditionMethod",!1),_defineProperty(this,"mxcad",void 0),this.mxcad=t||new Wr}var t;return _createClass$1(MxMap,[{key:"setLoadOldEditionMethod",value:function setLoadOldEditionMethod(){this.loadOldEditionMethod=!0}},{key:"getMxDrawObject",value:function getMxDrawObject(){return this.mxcad.getMxDrawObject()}},{key:"initMapbox",value:function initMapbox(t){this.map=t}},{key:"getMapbox",value:function getMapbox(){return this.map}},{key:"mercatorCoord2CAD",value:function mercatorCoord2CAD(t,h){var p=new THREE.Vector3(t,h,0);return p.applyMatrix4(this.imp.matMapToCad),p}},{key:"mercatorCoordToCAD",value:function mercatorCoordToCAD(t,h){var p=new THREE.Vector3(t,h,0);return p.applyMatrix4(this.imp.matMapToCad),p}},{key:"cadToMercatorCoord",value:function cadToMercatorCoord(t){return t.applyMatrix4(this.imp.matCadToMap),t}},{key:"lnglatToCAD",value:function lnglatToCAD(t,h){var p=this.lnglat_to_mercator(t,h);return this.mercatorCoord2CAD(p.x,p.y)}},{key:"cadTolnglat",value:function cadTolnglat(t){var h=this.cadToMercatorCoord(t);return this.mercator_to_lnglat(h.x,h.y,0)}},{key:"map_meters_to_lnglat",value:function map_meters_to_lnglat(t,h){return h=h/20037508.3427892*180,[t=t/20037508.3427892*180,h=180/Math.PI*(2*Math.atan(Math.exp(h*Math.PI/180))-Math.PI/2)]}},{key:"map_lnglat_to_meters",value:function map_lnglat_to_meters(t,h){var p=20037508.3427892*t/180,x=Math.log(Math.tan((90+h)*Math.PI/360))/(Math.PI/180);return[p,x=20037508.3427892*x/180]}},{key:"lnglat_to_mercator",value:function lnglat_to_mercator(t,h){var p=this.map.lnglat_to_mercator(t,h);return new THREE.Vector3(p.x,p.y,0)}},{key:"mercator_to_lnglat",value:function mercator_to_lnglat(t,h,p){var x=this.map.mercator_to_lnglat(t,h,p);return[x.lng,x.lat]}},{key:"outOfChina",value:function outOfChina(t,h){return!(t>73.66&&t<135.05&&h>3.86&&h<53.55)}},{key:"cadLongToMercatorCoord",value:function cadLongToMercatorCoord(t){var h=new THREE.Vector3(0,0,0),p=new THREE.Vector3(t,0,0);return h.applyMatrix4(this.imp.matCadToMap),p.applyMatrix4(this.imp.matCadToMap),h.distanceTo(p)}},{key:"setCoordinatePointAlignment",value:function setCoordinatePointAlignment(t,h,p){this.originCAD=h,this.originLngLatLike=t,this.meterInCADUnits=p}},{key:"create",value:(t=_asyncToGenerator(ie.mark((function _callee2(t,p){var x,M,k,I,N,V;return ie.wrap((function _callee2$(ee){for(;;)switch(ee.prev=ee.next){case 0:this.map=t,void 0!==p.middlePan&&this.map.dragPan.useMouseMiddle(p.middlePan),void 0===p.viewBackgroundColor&&(p.viewBackgroundColor={red:255,green:255,blue:255}),x=this,M=t.mercatorCoordinate_from_LngLat(x.originLngLatLike,x.modelAltitude),k=M.meterInMercatorCoordinateUnits(),(I=x.imp).map=t,I.elevation=this.modelAltitude,I.mapOrigin=new THREE.Vector3(M.x,M.y,M.z),I.cadOrigin=new THREE.Vector3(this.originCAD[0],this.originCAD[1],0),I.mapLenInCADUnits=x.meterInCADUnits*k,V={id:"3d-model",type:"custom",renderingMode:"3d",onAdd:function onAdd(t,M){return _asyncToGenerator(ie.mark((function _callee(){var k,V;return ie.wrap((function _callee$(ee){for(;;)switch(ee.prev=ee.next){case 0:try{I.canvas=t.getCanvas(),I.gl=M,I.canvasContainer=t.getCanvasContainer(),x.loadOldEditionMethod?((V=p).mapBox=I,V.isAutoResize=!0,V.callback=function(t,h){_objectDestructuringEmpty(h),t.addEvent("loadComplete",(function(){x.map.triggerRepaint()})),t.emit("viewchange"),N=t},h.MxFun.createMxObject(V)):(p.map=I,k=p.onOpenFileComplete,p.onOpenFileComplete=function(t){k&&k(t),x.map.triggerRepaint(),N=t.mxdraw},p.onInit=function(){h.MxFun.setIniset({MapBox:!0})},Ei(p,x.mxcad))}catch(Vf){}case 1:case"end":return ee.stop()}}),_callee)})))()},render:function render(t,h){I.map.repaint=!1,I.render&&I.render(t,h)}},t.addLayer(V),t.on("resize",(function(){I.onResize&&I.onResize()})),t.on("move",(function(){var t;null===(t=N)||void 0===t||t.emit("viewchange")}));case 16:case"end":return ee.stop()}}),_callee2,this)}))),function create(h,p){return t.apply(this,arguments)})}]),MxMap}();function _createForOfIteratorHelper(t,h){var p="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!p){if(Array.isArray(t)||(p=function _unsupportedIterableToArray2(t,h){if(!t)return;if("string"==typeof t)return _arrayLikeToArray2(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);"Object"===p&&t.constructor&&(p=t.constructor.name);if("Map"===p||"Set"===p)return Array.from(t);if("Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return _arrayLikeToArray2(t,h)}(t))||h&&t&&"number"==typeof t.length){p&&(t=p);var x=0,M=function F(){};return{s:M,n:function n(){return x>=t.length?{done:!0}:{done:!1,value:t[x++]}},e:function e(t){throw t},f:M}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var k,I=!0,N=!1;return{s:function s(){p=p.call(t)},n:function n(){var t=p.next();return I=t.done,t},e:function e(t){N=!0,k=t},f:function f(){try{I||null==p.return||p.return()}finally{if(N)throw k}}}}function _arrayLikeToArray2(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}Object.freeze=function(t){return t};var ea=Object.create||function(){function F(){}return function(t){return F.prototype=t,new F}}();var ta=/\{ *([\w_-]+) *\}/g;var ra=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},na=3.141592653589793,ia=6378245,oa=.006693421622965943,sa=3e3*na/180;function lonLatToTileNumbers(t,h,p){var x=na/180*h,M=Math.pow(2,p);return[parseInt((t+180)/360*M),parseInt((1-Math.asinh(Math.tan(x))/na)/2*M)]}function bd09_To_gps84(t,h){if(ra(t)){var p=t[0];h=t[1],t=p}if(t instanceof Object){p=t.lng;h=t.lat,t=p}var x=function bd09_To_gcj02(t,h){var p=t-.0065,x=h-.006,M=Math.sqrt(p*p+x*x)-2e-5*Math.sin(x*sa),k=Math.atan2(x,p)-3e-6*Math.cos(p*sa),I=M*Math.cos(k),N=M*Math.sin(k);return{lng:I,lat:N}}(t,h);return gcj02_To_gps84(x.lng,x.lat)}function gps84_To_bd09(t,h){if(ra(t)){var p=t[0];h=t[1],t=p}if(t instanceof Object){p=t.lng;h=t.lat,t=p}var x=gps84_To_gcj02(t,h);return function gcj02_To_bd09(t,h){var p=Math.sqrt(t*t+h*h)+2e-5*Math.sin(h*sa),x=Math.atan2(h,t)+3e-6*Math.cos(t*sa),M=p*Math.cos(x)+.0065,k=p*Math.sin(x)+.006;return{lng:M,lat:k}}(x.lng,x.lat)}function gps84_To_gcj02(t,h){if(ra(t)){var p=t[0];h=t[1],t=p}if(t instanceof Object){p=t.lng;h=t.lat,t=p}var x=transformLat$1(t-105,h-35),M=transformLng$1(t-105,h-35),k=h/180*na,I=Math.sin(k);I=1-oa*I*I;var N=Math.sqrt(I);return x=180*x/(ia*(1-oa)/(I*N)*na),{lng:t+(M=180*M/(ia/N*Math.cos(k)*na)),lat:h+x}}function gcj02_To_gps84(t,h){if(ra(t)){var p=t[0];h=t[1],t=p}if(t instanceof Object){p=t.lng;h=t.lat,t=p}var x=function transform$1(t,h){var p=transformLat$1(t-105,h-35),x=transformLng$1(t-105,h-35),M=h/180*na,k=Math.sin(M);k=1-oa*k*k;var I=Math.sqrt(k);p=180*p/(ia*(1-oa)/(k*I)*na),x=180*x/(ia/I*Math.cos(M)*na);var N=h+p,V=t+x,ee={lng:V,lat:N};return ee}(t,h);return{lng:2*t-x.lng,lat:2*h-x.lat}}function transformLat$1(t,h){var p=2*t-100+3*h+.2*h*h+.1*t*h+.2*Math.sqrt(Math.abs(t));return p+=2*(20*Math.sin(6*t*na)+20*Math.sin(2*t*na))/3,p+=2*(20*Math.sin(h*na)+40*Math.sin(h/3*na))/3,p+=2*(160*Math.sin(h/12*na)+320*Math.sin(h*na/30))/3}function transformLng$1(t,h){var p=300+t+2*h+.1*t*t+.1*t*h+.1*Math.sqrt(Math.abs(t));return p+=2*(20*Math.sin(6*t*na)+20*Math.sin(2*t*na))/3,p+=2*(20*Math.sin(t*na)+40*Math.sin(t/3*na))/3,p+=2*(150*Math.sin(t/12*na)+300*Math.sin(t/30*na))/3}function Extend(t,h){for(var p in h)h.hasOwnProperty(p)&&(t[p]=h[p]);return t}function Xa(t){return"string"==typeof t}var ca=void 0,ua=null;function H(t,h){isNaN(t)&&(t=Ib(t),t=isNaN(t)?0:t),Xa(t)&&(t=parseFloat(t)),isNaN(h)&&(h=Ib(h),h=isNaN(h)?0:h),Xa(h)&&(h=parseFloat(h)),this.lng=t,this.lat=h}function Q(t,h){this.x=t||0,this.y=h||0,this.x=this.x,this.y=this.y}function fc(){}function R(){}H.TL=function(t){return t&&180>=t.lng&&-180<=t.lng&&74>=t.lat&&-74<=t.lat},H.prototype.lb=function(t){return t&&this.lat==t.lat&&this.lng==t.lng},Q.prototype.lb=function(t){return t&&t.x==this.x&&t.y==this.y},fc.prototype.nh=function(){aa("lngLatToPoint")},fc.prototype.wi=function(){aa("pointToLngLat")},R.prototype=new fc,Extend(R,{$O:6370996.81,lG:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],Au:[75,60,45,30,15,0],fP:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],iG:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],Z1:function Z1(t,h){return t&&h&&(t=this.Fb(t))?(p=this.Tk(t.lng),x=this.Tk(t.lat),(h=this.Fb(h))?this.Pe(p,this.Tk(h.lng),x,this.Tk(h.lat)):0):0;var p,x},Vo:function Vo(t,h){return t&&h?(t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),h.lng=this.JD(h.lng,-180,180),h.lat=this.ND(h.lat,-74,74),this.Pe(this.Tk(t.lng),this.Tk(h.lng),this.Tk(t.lat),this.Tk(h.lat))):0},Fb:function Fb(t){if(t===ua||t===ca)return new H(0,0);var h,p;h=new H(Math.abs(t.lng),Math.abs(t.lat));for(var x=0;x<this.lG.length;x++)if(h.lat>=this.lG[x]){p=this.fP[x];break}return new H((t=this.gK(t,p)).lng.toFixed(6),t.lat.toFixed(6))},Eb:function Eb(t){if(t===ua||t===ca||180<t.lng||-180>t.lng||90<t.lat||-90>t.lat)return new H(0,0);var h,p;t.lng=this.JD(t.lng,-180,180),t.lat=this.ND(t.lat,-74,74),h=new H(t.lng,t.lat);for(var x=0;x<this.Au.length;x++)if(h.lat>=this.Au[x]){p=this.iG[x];break}if(!p)for(x=0;x<this.Au.length;x++)if(h.lat<=-this.Au[x]){p=this.iG[x];break}return new H((t=this.gK(t,p)).lng.toFixed(2),t.lat.toFixed(2))},gK:function gK(t,h){if(t&&h){var p=h[0]+h[1]*Math.abs(t.lng),x=Math.abs(t.lat)/h[9];x=h[2]+h[3]*x+h[4]*x*x+h[5]*x*x*x+h[6]*x*x*x*x+h[7]*x*x*x*x*x+h[8]*x*x*x*x*x*x;return new H(p=p*(0>t.lng?-1:1),x=x*(0>t.lat?-1:1))}},Pe:function Pe(t,h,p,x){return this.$O*Math.acos(Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos(h-t))},Tk:function Tk(t){return Math.PI*t/180},Z3:function Z3(t){return 180*t/Math.PI},ND:function ND(t,h,p){return h!=ua&&(t=Math.max(t,h)),p!=ua&&(t=Math.min(t,p)),t},JD:function JD(t,h,p){for(;t>p;)t-=p-h;for(;t<h;)t+=p-h;return t}}),Extend(R.prototype,{Jm:function Jm(t){return R.Eb(t)},nh:function nh(t){return new Q((t=R.Eb(t)).lng,t.lat)},qh:function qh(t){return R.Fb(t)},wi:function wi(t){return t=new H(t.x,t.y),R.Fb(t)},fc:function fc(t,h,p,x,M){if(t)return t=this.Jm(t,M),h=this.Lc(h),new Q(Math.round((t.lng-p.lng)/h+x.width/2),Math.round((p.lat-t.lat)/h+x.height/2))},zb:function zb(t,h,p,x,M){if(t)return h=this.Lc(h),this.qh(new H(p.lng+h*(t.x-x.width/2),p.lat-h*(t.y-x.height/2)),M)},Lc:function Lc(t){return Math.pow(2,18-t)}});var la=R.prototype;!function S(t,h){for(var p in h)t[p]=h[p]}(la,{lngLatToPoint:la.nh,pointToLngLat:la.wi});var ha={Point:H,Pixel:Q,MercatorProjection:R},fa=function(){function TransformClassBaidu(t,h){_classCallCheck$1(this,TransformClassBaidu),this.levelMax=t,this.levelMin=h,this.projection=new ha.MercatorProjection}return _createClass$1(TransformClassBaidu,[{key:"_getRetain",value:function _getRetain(t){return Math.pow(2,t-18)}},{key:"getResolution",value:function getResolution(t,h){return Math.pow(2,18-h)*Math.cos(t)}},{key:"lnglatToPoint",value:function lnglatToPoint(t,h){var p=new ha.Point(t,h),x=this.projection.lngLatToPoint(p);return{pointX:x.x,pointY:x.y}}},{key:"pointToLnglat",value:function pointToLnglat(t,h){var p=new ha.Pixel(t,h),x=this.projection.pointToLngLat(p);return{lng:x.lng,lat:x.lat}}},{key:"_lngToTileX",value:function _lngToTileX(t,h){var p=this.lnglatToPoint(t,0);return Math.floor(p.pointX*this._getRetain(h)/256)}},{key:"_latToTileY",value:function _latToTileY(t,h){var p=this.lnglatToPoint(0,t);return Math.floor(p.pointY*this._getRetain(h)/256)}},{key:"lnglatToTile",value:function lnglatToTile(t,h,p){return[this._lngToTileX(t,p),this._latToTileY(h,p)]}},{key:"_lngToPixelX",value:function _lngToPixelX(t,h){var p=this._lngToTileX(t,h),x=this.lnglatToPoint(t,0);return Math.floor(x.pointX*this._getRetain(h)-256*p)}},{key:"_latToPixelY",value:function _latToPixelY(t,h){var p=this._latToTileY(t,h),x=this.lnglatToPoint(0,t);return Math.floor(x.pointY*this._getRetain(h)-256*p)}},{key:"lnglatToPixel",value:function lnglatToPixel(t,h,p){return{pixelX:this._lngToPixelX(t,p),pixelY:this._latToPixelY(h,p)}}},{key:"_pixelXToLng",value:function _pixelXToLng(t,h,p){var x=(256*h+t)/this._getRetain(p);return this.pointToLnglat(x,0).lng}},{key:"_pixelYToLat",value:function _pixelYToLat(t,h,p){var x=(256*h+t)/this._getRetain(p);return this.pointToLnglat(0,x).lat}},{key:"pixelToLnglat",value:function pixelToLnglat(t,h,p,x,M){var k=(256*p+t)/this._getRetain(M),I=(256*x+h)/this._getRetain(M),N=this.pointToLnglat(k,I);return[N.lng,N.lat]}}]),TransformClassBaidu}();function _classCallCheck(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,h){for(var p=0;p<h.length;p++){var x=h[p];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(t,x.key,x)}}function _createClass(t,h,p){return h&&_defineProperties(t.prototype,h),p&&_defineProperties(t,p),Object.defineProperty(t,"prototype",{writable:!1}),t}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _setPrototypeOf(t,h){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,h){return t.__proto__=h,t},_setPrototypeOf(t,h)}function _arrayLikeToArray(t,h){(null==h||h>t.length)&&(h=t.length);for(var p=0,x=new Array(h);p<h;p++)x[p]=t[p];return x}function _slicedToArray(t,h){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,h){var p=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=p){var x,M,k=[],I=!0,N=!1;try{for(p=p.call(t);!(I=(x=p.next()).done)&&(k.push(x.value),!h||k.length!==h);I=!0);}catch(V){N=!0,M=V}finally{try{I||null==p.return||p.return()}finally{if(N)throw M}}return k}}(t,h)||function _unsupportedIterableToArray(t,h){if(t){if("string"==typeof t)return _arrayLikeToArray(t,h);var p=Object.prototype.toString.call(t).slice(8,-1);return"Object"===p&&t.constructor&&(p=t.constructor.name),"Map"===p||"Set"===p?Array.from(t):"Arguments"===p||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?_arrayLikeToArray(t,h):void 0}}(t,h)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var da=1e-6,pa="undefined"!=typeof Float32Array?Float32Array:Array;function transformMat4(t,h,p){var x=h[0],M=h[1],k=h[2],I=h[3];return t[0]=p[0]*x+p[4]*M+p[8]*k+p[12]*I,t[1]=p[1]*x+p[5]*M+p[9]*k+p[13]*I,t[2]=p[2]*x+p[6]*M+p[10]*k+p[14]*I,t[3]=p[3]*x+p[7]*M+p[11]*k+p[15]*I,t}function transformVector(t,h){var p=transformMat4([],h,t);return function scale$1(t,h,p){return t[0]=h[0]*p,t[1]=h[1]*p,t[2]=h[2]*p,t[3]=h[3]*p,t}(p,p,1/p[3]),p}function multiply(t,h,p){var x=h[0],M=h[1],k=h[2],I=h[3],N=h[4],V=h[5],ee=h[6],te=h[7],re=h[8],ne=h[9],ie=h[10],ae=h[11],oe=h[12],se=h[13],ce=h[14],ue=h[15],le=p[0],he=p[1],fe=p[2],de=p[3];return t[0]=le*x+he*N+fe*re+de*oe,t[1]=le*M+he*V+fe*ne+de*se,t[2]=le*k+he*ee+fe*ie+de*ce,t[3]=le*I+he*te+fe*ae+de*ue,le=p[4],he=p[5],fe=p[6],de=p[7],t[4]=le*x+he*N+fe*re+de*oe,t[5]=le*M+he*V+fe*ne+de*se,t[6]=le*k+he*ee+fe*ie+de*ce,t[7]=le*I+he*te+fe*ae+de*ue,le=p[8],he=p[9],fe=p[10],de=p[11],t[8]=le*x+he*N+fe*re+de*oe,t[9]=le*M+he*V+fe*ne+de*se,t[10]=le*k+he*ee+fe*ie+de*ce,t[11]=le*I+he*te+fe*ae+de*ue,le=p[12],he=p[13],fe=p[14],de=p[15],t[12]=le*x+he*N+fe*re+de*oe,t[13]=le*M+he*V+fe*ne+de*se,t[14]=le*k+he*ee+fe*ie+de*ce,t[15]=le*I+he*te+fe*ae+de*ue,t}function translate(t,h,p){var x,M,k,I,N,V,ee,te,re,ne,ie,ae,oe=p[0],se=p[1],ce=p[2];return h===t?(t[12]=h[0]*oe+h[4]*se+h[8]*ce+h[12],t[13]=h[1]*oe+h[5]*se+h[9]*ce+h[13],t[14]=h[2]*oe+h[6]*se+h[10]*ce+h[14],t[15]=h[3]*oe+h[7]*se+h[11]*ce+h[15]):(x=h[0],M=h[1],k=h[2],I=h[3],N=h[4],V=h[5],ee=h[6],te=h[7],re=h[8],ne=h[9],ie=h[10],ae=h[11],t[0]=x,t[1]=M,t[2]=k,t[3]=I,t[4]=N,t[5]=V,t[6]=ee,t[7]=te,t[8]=re,t[9]=ne,t[10]=ie,t[11]=ae,t[12]=x*oe+N*se+re*ce+h[12],t[13]=M*oe+V*se+ne*ce+h[13],t[14]=k*oe+ee*se+ie*ce+h[14],t[15]=I*oe+te*se+ae*ce+h[15]),t}function scale(t,h,p){var x=p[0],M=p[1],k=p[2];return t[0]=h[0]*x,t[1]=h[1]*x,t[2]=h[2]*x,t[3]=h[3]*x,t[4]=h[4]*M,t[5]=h[5]*M,t[6]=h[6]*M,t[7]=h[7]*M,t[8]=h[8]*k,t[9]=h[9]*k,t[10]=h[10]*k,t[11]=h[11]*k,t[12]=h[12],t[13]=h[13],t[14]=h[14],t[15]=h[15],t}Math.hypot||(Math.hypot=function(){for(var t=0,h=arguments.length;h--;)t+=arguments[h]*arguments[h];return Math.sqrt(t)}),function create$2(){var t=new pa(4);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}();var ma=function perspectiveNO(t,h,p,x,M){var k,I=1/Math.tan(h/2);return t[0]=I/p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=M&&M!==1/0?(k=1/(x-M),t[10]=(M+x)*k,t[14]=2*M*x*k):(t[10]=-1,t[14]=-2*x),t};function equals$1(t,h){var p=t[0],x=t[1],M=t[2],k=t[3],I=t[4],N=t[5],V=t[6],ee=t[7],te=t[8],re=t[9],ne=t[10],ie=t[11],ae=t[12],oe=t[13],se=t[14],ce=t[15],ue=h[0],le=h[1],he=h[2],fe=h[3],de=h[4],pe=h[5],me=h[6],ge=h[7],ve=h[8],ye=h[9],be=h[10],xe=h[11],Me=h[12],we=h[13],_e=h[14],Ce=h[15];return Math.abs(p-ue)<=da*Math.max(1,Math.abs(p),Math.abs(ue))&&Math.abs(x-le)<=da*Math.max(1,Math.abs(x),Math.abs(le))&&Math.abs(M-he)<=da*Math.max(1,Math.abs(M),Math.abs(he))&&Math.abs(k-fe)<=da*Math.max(1,Math.abs(k),Math.abs(fe))&&Math.abs(I-de)<=da*Math.max(1,Math.abs(I),Math.abs(de))&&Math.abs(N-pe)<=da*Math.max(1,Math.abs(N),Math.abs(pe))&&Math.abs(V-me)<=da*Math.max(1,Math.abs(V),Math.abs(me))&&Math.abs(ee-ge)<=da*Math.max(1,Math.abs(ee),Math.abs(ge))&&Math.abs(te-ve)<=da*Math.max(1,Math.abs(te),Math.abs(ve))&&Math.abs(re-ye)<=da*Math.max(1,Math.abs(re),Math.abs(ye))&&Math.abs(ne-be)<=da*Math.max(1,Math.abs(ne),Math.abs(be))&&Math.abs(ie-xe)<=da*Math.max(1,Math.abs(ie),Math.abs(xe))&&Math.abs(ae-Me)<=da*Math.max(1,Math.abs(ae),Math.abs(Me))&&Math.abs(oe-we)<=da*Math.max(1,Math.abs(oe),Math.abs(we))&&Math.abs(se-_e)<=da*Math.max(1,Math.abs(se),Math.abs(_e))&&Math.abs(ce-Ce)<=da*Math.max(1,Math.abs(ce),Math.abs(Ce))}function add(t,h,p){return t[0]=h[0]+p[0],t[1]=h[1]+p[1],t}function assert(t,h){if(!t)throw new Error(h||"viewport-mercator-project: assertion failed.")}!function(){var t=function create$1(){var t=new pa(2);return pa!=Float32Array&&(t[0]=0,t[1]=0),t}()}(),function(){var t=function create(){var t=new pa(3);return pa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();var ga=Math.PI,va=ga/4,ya=ga/180,ba=180/ga,xa=4003e4,Ma=1.5;function zoomToScale$1(t){return Math.pow(2,t)}function lngLatToWorld(t,h){var p=_slicedToArray(t,2),x=p[0],M=p[1];assert(Number.isFinite(x)&&Number.isFinite(h)),assert(Number.isFinite(M)&&M>=-90&&M<=90,"invalid latitude");var k=M*ya;return[(h*=512)*(x*ya+ga)/(2*ga),h*(ga-Math.log(Math.tan(va+.5*k)))/(2*ga)]}function worldToLngLat(t,h){var p=_slicedToArray(t,2),x=p[0],M=p[1],k=x/(h*=512)*(2*ga)-ga,I=2*(Math.atan(Math.exp(ga-M/h*(2*ga)))-va);return[k*ba,I*ba]}function getViewMatrix(t){var h=t.height,p=t.pitch,x=t.bearing,M=t.altitude,k=t.center,I=void 0===k?null:k,N=t.flipY,V=void 0!==N&&N,ee=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return translate(ee,ee,[0,0,-M]),scale(ee,ee,[1,1,1/h]),function rotateX(t,h,p){var x=Math.sin(p),M=Math.cos(p),k=h[4],I=h[5],N=h[6],V=h[7],ee=h[8],te=h[9],re=h[10],ne=h[11];return h!==t&&(t[0]=h[0],t[1]=h[1],t[2]=h[2],t[3]=h[3],t[12]=h[12],t[13]=h[13],t[14]=h[14],t[15]=h[15]),t[4]=k*M+ee*x,t[5]=I*M+te*x,t[6]=N*M+re*x,t[7]=V*M+ne*x,t[8]=ee*M-k*x,t[9]=te*M-I*x,t[10]=re*M-N*x,t[11]=ne*M-V*x,t}(ee,ee,-p*ya),function rotateZ(t,h,p){var x=Math.sin(p),M=Math.cos(p),k=h[0],I=h[1],N=h[2],V=h[3],ee=h[4],te=h[5],re=h[6],ne=h[7];return h!==t&&(t[8]=h[8],t[9]=h[9],t[10]=h[10],t[11]=h[11],t[12]=h[12],t[13]=h[13],t[14]=h[14],t[15]=h[15]),t[0]=k*M+ee*x,t[1]=I*M+te*x,t[2]=N*M+re*x,t[3]=V*M+ne*x,t[4]=ee*M-k*x,t[5]=te*M-I*x,t[6]=re*M-N*x,t[7]=ne*M-V*x,t}(ee,ee,x*ya),V&&scale(ee,ee,[1,-1,1]),I&&translate(ee,ee,function negate(t,h){return t[0]=-h[0],t[1]=-h[1],t[2]=-h[2],t}([],I)),ee}function getProjectionMatrix(t){var h=t.width,p=t.height,x=t.pitch,M=function getProjectionParameters(t){var h=t.width,p=t.height,x=t.altitude,M=void 0===x?Ma:x,k=t.pitch,I=void 0===k?0:k,N=t.nearZMultiplier,V=void 0===N?1:N,ee=t.farZMultiplier,te=void 0===ee?1:ee,re=I*ya,ne=Math.atan(.5/M),ie=Math.sin(ne)*M/Math.sin(Math.PI/2-re-ne),ae=Math.cos(Math.PI/2-re)*ie+M;return{fov:2*Math.atan(p/2/M),aspect:h/p,focalDistance:M,near:V,far:ae*te}}({width:h,height:p,altitude:t.altitude,pitch:x,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),k=M.fov,I=M.aspect,N=M.near,V=M.far;return ma([],k,I,N,V)}function pixelsToWorld(t,h){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=_slicedToArray(t,3),M=x[0],k=x[1],I=x[2];if(assert(Number.isFinite(M)&&Number.isFinite(k),"invalid pixel coordinate"),Number.isFinite(I))return transformVector(h,[M,k,I,1]);var N=transformVector(h,[M,k,0,1]),V=transformVector(h,[M,k,1,1]),ee=N[2],te=V[2];return function lerp(t,h,p,x){var M=h[0],k=h[1];return t[0]=M+x*(p[0]-M),t[1]=k+x*(p[1]-k),t}([],N,V,ee===te?0:((p||0)-ee)/(te-ee))}var wa=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_a=function(){function Viewport(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=t.width,p=t.height,x=t.viewMatrix,M=void 0===x?wa:x,k=t.projectionMatrix,I=void 0===k?wa:k;_classCallCheck(this,Viewport),this.width=h||1,this.height=p||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=M,this.projectionMatrix=I;var N=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];multiply(N,N,this.projectionMatrix),multiply(N,N,this.viewMatrix),this.viewProjectionMatrix=N;var V=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];scale(V,V,[this.width/2,-this.height/2,1]),translate(V,V,[1,-1,0]),multiply(V,V,this.viewProjectionMatrix);var ee=function invert(t,h){var p=h[0],x=h[1],M=h[2],k=h[3],I=h[4],N=h[5],V=h[6],ee=h[7],te=h[8],re=h[9],ne=h[10],ie=h[11],ae=h[12],oe=h[13],se=h[14],ce=h[15],ue=p*N-x*I,le=p*V-M*I,he=p*ee-k*I,fe=x*V-M*N,de=x*ee-k*N,pe=M*ee-k*V,me=te*oe-re*ae,ge=te*se-ne*ae,ve=te*ce-ie*ae,ye=re*se-ne*oe,be=re*ce-ie*oe,xe=ne*ce-ie*se,Me=ue*xe-le*be+he*ye+fe*ve-de*ge+pe*me;return Me?(Me=1/Me,t[0]=(N*xe-V*be+ee*ye)*Me,t[1]=(M*be-x*xe-k*ye)*Me,t[2]=(oe*pe-se*de+ce*fe)*Me,t[3]=(ne*de-re*pe-ie*fe)*Me,t[4]=(V*ve-I*xe-ee*ge)*Me,t[5]=(p*xe-M*ve+k*ge)*Me,t[6]=(se*he-ae*pe-ce*le)*Me,t[7]=(te*pe-ne*he+ie*le)*Me,t[8]=(I*be-N*ve+ee*me)*Me,t[9]=(x*ve-p*be-k*me)*Me,t[10]=(ae*de-oe*he+ce*ue)*Me,t[11]=(re*he-te*de-ie*ue)*Me,t[12]=(N*ge-I*ye-V*me)*Me,t[13]=(p*ye-x*ge+M*me)*Me,t[14]=(oe*le-ae*fe-se*ue)*Me,t[15]=(te*fe-re*le+ne*ue)*Me,t):null}([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],V);if(!ee)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=V,this.pixelUnprojectionMatrix=ee,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return _createClass(Viewport,[{key:"equals",value:function equals$1$1(t){return t instanceof Viewport&&(t.width===this.width&&t.height===this.height&&equals$1(t.projectionMatrix,this.projectionMatrix)&&equals$1(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function project(t){var h=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,p=void 0===h||h,x=function worldToPixels(t,h){var p=_slicedToArray(t,3),x=p[0],M=p[1],k=p[2],I=void 0===k?0:k;return assert(Number.isFinite(x)&&Number.isFinite(M)&&Number.isFinite(I)),transformVector(h,[x,M,I,1])}(this.projectPosition(t),this.pixelProjectionMatrix),M=_slicedToArray(x,2),k=M[0],I=M[1],N=p?I:this.height-I;return 2===t.length?[k,N]:[k,N,x[2]]}},{key:"unproject",value:function unproject(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=h.topLeft,x=void 0===p||p,M=h.targetZ,k=_slicedToArray(t,3),I=k[0],N=k[1],V=k[2],ee=x?N:this.height-N,te=M&&M*this.pixelsPerMeter,re=pixelsToWorld([I,ee,V],this.pixelUnprojectionMatrix,te),ne=_slicedToArray(this.unprojectPosition(re),3),ie=ne[0],ae=ne[1],oe=ne[2];return Number.isFinite(V)?[ie,ae,oe]:Number.isFinite(M)?[ie,ae,M]:[ie,ae]}},{key:"projectPosition",value:function projectPosition(t){var h=_slicedToArray(this.projectFlat(t),2);return[h[0],h[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function unprojectPosition(t){var h=_slicedToArray(this.unprojectFlat(t),2);return[h[0],h[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function projectFlat(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}},{key:"unprojectFlat",value:function unprojectFlat(t){return arguments.length>1&&void 0!==arguments[1]||this.scale,t}}]),Viewport}();function fitBounds(t){var h=t.width,p=t.height,x=t.bounds,M=t.minExtent,k=void 0===M?0:M,I=t.maxZoom,N=void 0===I?24:I,V=t.padding,ee=void 0===V?0:V,te=t.offset,re=void 0===te?[0,0]:te,ne=_slicedToArray(x,2),ie=_slicedToArray(ne[0],2),ae=ie[0],oe=ie[1],se=_slicedToArray(ne[1],2),ce=se[0],ue=se[1];if(Number.isFinite(ee)){ee={top:ee,bottom:ee,left:ee,right:ee}}else assert(Number.isFinite(ee.top)&&Number.isFinite(ee.bottom)&&Number.isFinite(ee.left)&&Number.isFinite(ee.right));var le=new Ca({width:h,height:p,longitude:0,latitude:0,zoom:0}),he=le.project([ae,ue]),fe=le.project([ce,oe]),de=[Math.max(Math.abs(fe[0]-he[0]),k),Math.max(Math.abs(fe[1]-he[1]),k)],pe=[h-ee.left-ee.right-2*Math.abs(re[0]),p-ee.top-ee.bottom-2*Math.abs(re[1])];assert(pe[0]>0&&pe[1]>0);var me=pe[0]/de[0],ge=pe[1]/de[1],ve=(ee.right-ee.left)/2/me,ye=(ee.bottom-ee.top)/2/ge,be=[(fe[0]+he[0])/2+ve,(fe[1]+he[1])/2+ye],xe=le.unproject(be),Me=le.zoom+Math.log2(Math.abs(Math.min(me,ge)));return{longitude:xe[0],latitude:xe[1],zoom:Math.min(Me,N)}}var Ca=function(t){function WebMercatorViewport(){var t,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=h.width,x=h.height,M=h.latitude,k=void 0===M?0:M,I=h.longitude,N=void 0===I?0:I,V=h.zoom,ee=void 0===V?0:V,te=h.pitch,re=void 0===te?0:te,ne=h.bearing,ie=void 0===ne?0:ne,ae=h.altitude,oe=void 0===ae?1.5:ae,se=h.nearZMultiplier,ce=h.farZMultiplier;_classCallCheck(this,WebMercatorViewport),p=p||1,x=x||1;var ue=zoomToScale$1(ee);oe=Math.max(.75,oe);var le=lngLatToWorld([N,k],ue);le[2]=0;var he=getProjectionMatrix({width:p,height:x,pitch:re,bearing:ie,altitude:oe,nearZMultiplier:se||1/x,farZMultiplier:ce||1.01}),fe=getViewMatrix({height:x,center:le,pitch:re,bearing:ie,altitude:oe,flipY:!0});return(t=function _possibleConstructorReturn(t,h){if(h&&("object"===_typeof(h)||"function"==typeof h))return h;if(void 0!==h)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,_getPrototypeOf(WebMercatorViewport).call(this,{width:p,height:x,viewMatrix:fe,projectionMatrix:he}))).latitude=k,t.longitude=N,t.zoom=ee,t.pitch=re,t.bearing=ie,t.altitude=oe,t.scale=ue,t.center=le,t.pixelsPerMeter=function getDistanceScales$1(t){var h=t.latitude,p=t.longitude,x=t.zoom,M=t.scale,k=t.highPrecision,I=void 0!==k&&k;M=void 0!==M?M:zoomToScale$1(x),assert(Number.isFinite(h)&&Number.isFinite(p)&&Number.isFinite(M));var N={},V=512*M,ee=Math.cos(h*ya),te=V/360,re=te/ee,ne=V/xa/ee;if(N.pixelsPerMeter=[ne,-ne,ne],N.metersPerPixel=[1/ne,-1/ne,1/ne],N.pixelsPerDegree=[te,-re,ne],N.degreesPerPixel=[1/te,-1/re,1/ne],I){var ie=ya*Math.tan(h*ya)/ee,ae=te*ie/2,oe=V/xa*ie,se=oe/re*ne;N.pixelsPerDegree2=[0,-ae,oe],N.pixelsPerMeter2=[se,0,se]}return N}(_assertThisInitialized(_assertThisInitialized(t))).pixelsPerMeter[2],Object.freeze(_assertThisInitialized(_assertThisInitialized(t))),t}return function _inherits(t,h){if("function"!=typeof h&&null!==h)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(h&&h.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),h&&_setPrototypeOf(t,h)}(WebMercatorViewport,t),_createClass(WebMercatorViewport,[{key:"projectFlat",value:function projectFlat(t){return lngLatToWorld(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function unprojectFlat(t){return worldToLngLat(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function getMapCenterByLngLatPosition(t){var h=t.lngLat,p=pixelsToWorld(t.pos,this.pixelUnprojectionMatrix),x=add([],lngLatToWorld(h,this.scale),function negate$1(t,h){return t[0]=-h[0],t[1]=-h[1],t}([],p));return worldToLngLat(add([],this.center,x),this.scale)}},{key:"getLocationAtPoint",value:function getLocationAtPoint(t){var h=t.lngLat,p=t.pos;return this.getMapCenterByLngLatPosition({lngLat:h,pos:p})}},{key:"fitBounds",value:function fitBounds$1(t){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=this.width,x=this.height,M=fitBounds(Object.assign({width:p,height:x,bounds:t},h));return new WebMercatorViewport({width:p,height:x,longitude:M.longitude,latitude:M.latitude,zoom:M.zoom})}}]),WebMercatorViewport}(_a),Sa=Math.PI/180,Ta=4003e4;function zoomToScale(t){return Math.pow(2,t)}var Aa=function(){function customTileLayer(t,h,p){_classCallCheck$1(this,customTileLayer),this.id=t,this.type="custom",this.renderingMode="2d",this.url=h,this.options={subdomains:null,minZoom:0,maxZoom:24,tileType:"xyz"},function setOptions(t,h){for(var p in t.hasOwnProperty("options")||(t.options=t.options?ea(t.options):{}),h)t.options[p]=h[p]||t.options[p];return t.options}(this,p),this.program,this.showTiles=[],this.tileCache={},this.gridCache={},this.matrix,this.map,this.isLayerShow,this.transformBaidu=new fa}return _createClass$1(customTileLayer,[{key:"onAdd",value:function onAdd(t,h){var p=this;this.map=t;var x=h.createShader(h.VERTEX_SHADER);h.shaderSource(x,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_TextCoord;varying vec2 v_TextCoord;const float TILE_SIZE = 512.0;const float PI = 3.1415926536;const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);uniform float u_project_scale;uniform bool u_is_offset;uniform vec3 u_pixels_per_degree;uniform vec3 u_pixels_per_degree2;uniform vec3 u_pixels_per_meter;uniform vec2 u_viewport_center;uniform vec4 u_viewport_center_projection;uniform vec2 u_viewport_size;float project_scale(float meters) {    return meters * u_pixels_per_meter.z;}vec3 project_scale(vec3 position) {    return position * u_pixels_per_meter;}vec2 project_mercator(vec2 lnglat) {    float x = lnglat.x;    return vec2(    radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))    );}vec4 project_offset(vec4 offset) {    float dy = offset.y;    dy = clamp(dy, -1., 1.);    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;    return vec4(offset.xyz * pixels_per_unit, offset.w);}vec4 project_position(vec4 position) {    if (u_is_offset) {        float X = position.x - u_viewport_center.x;        float Y = position.y - u_viewport_center.y;        return project_offset(vec4(X, Y, position.z, position.w));    }    else {        return vec4(        project_mercator(position.xy) * WORLD_SCALE * u_project_scale, project_scale(position.z), position.w        );    }}vec4 project_to_clipping_space(vec3 position) {    vec4 project_pos = project_position(vec4(position, 1.0));    return u_matrix * project_pos + u_viewport_center_projection;}void main() {   vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));   gl_Position = u_matrix * project_pos + u_viewport_center_projection;   v_TextCoord = a_TextCoord;}"),h.compileShader(x);var M=h.createShader(h.FRAGMENT_SHADER);h.shaderSource(M,"precision mediump float;uniform sampler2D u_Sampler; varying vec2 v_TextCoord; void main() {   gl_FragColor = texture2D(u_Sampler, v_TextCoord);}"),h.compileShader(M),this.program=h.createProgram(),h.attachShader(this.program,x),h.attachShader(this.program,M),h.linkProgram(this.program),this.a_Pos=h.getAttribLocation(this.program,"a_pos"),this.a_TextCoord=h.getAttribLocation(this.program,"a_TextCoord"),this.isLayerShow=!0,t.on("move",(function(){p.isLayerShow&&p.update(h,t)})),this.update(h,t)}},{key:"update",value:function update(t,h){var p,x,M,k=this,I=h.getCenter(),N=h.getBounds();if("xyz"===this.options.tileType){p=parseInt(h.getZoom()+1.4);var V=gps84_To_gcj02(N.getNorthWest()),ee=gps84_To_gcj02(N.getSouthEast());x=lonLatToTileNumbers(V.lng,V.lat,p),M=lonLatToTileNumbers(ee.lng,ee.lat,p)}else if("bd09"===this.options.tileType){p=parseInt(h.getZoom()+1.8);var te=gps84_To_bd09(N.getSouthWest()),re=gps84_To_bd09(N.getNorthEast());x=this.transformBaidu.lnglatToTile(te.lng,te.lat,p),M=this.transformBaidu.lnglatToTile(re.lng,re.lat,p)}for(var ne=[],ie=x[0];ie<=M[0];ie++)for(var ae=x[1];ae<=M[1];ae++){var oe={x:ie,y:ae,z:p};ne.push(oe),this.addGridCache(oe,0,0),ie===M[0]&&this.addGridCache(oe,1,0),ae===M[1]&&this.addGridCache(oe,0,1),ie===M[0]&&ae===M[1]&&this.addGridCache(oe,1,1)}if("xyz"===this.options.tileType)var se=lonLatToTileNumbers(I.lng,I.lat,p);else"bd09"===this.options.tileType&&(se=this.transformBaidu.lnglatToTile(I.lng,I.lat,p));ne.sort((function(t,h){return k.tileDistance(t,se)-k.tileDistance(h,se)})),this.showTiles=[];for(var ce=0,ue=ne;ce<ue.length;ce++){oe=ue[ce];if(this.tileCache[this.createTileKey(oe)])this.showTiles.push(this.tileCache[this.createTileKey(oe)]);else{var le=this.createTile(t,oe);this.showTiles.push(le),this.tileCache[this.createTileKey(oe)]=le}}}},{key:"addGridCache",value:function addGridCache(t,h,p){var x=this.createTileKey(t.x+h,t.y+p,t.z);this.gridCache[x]||("xyz"===this.options.tileType?this.gridCache[x]=gcj02_To_gps84(function tileNumbersToLonLat(t,h,p){var x=Math.pow(2,p);return[t/x*360-180,180*Math.atan(Math.sinh(na*(1-2*h/x)))/na]}(t.x+h,t.y+p,t.z)):"bd09"===this.options.tileType&&(this.gridCache[x]=bd09_To_gps84(this.transformBaidu.pixelToLnglat(0,0,t.x+h,t.y+p,t.z))))}},{key:"tileDistance",value:function tileDistance(t,h){return Math.sqrt(Math.pow(t.x-h[0],2)+Math.pow(t.y-h[1],2))}},{key:"createTileKey",value:function createTileKey(t,h,p){return t instanceof Object?t.z+"/"+t.x+"/"+t.y:p+"/"+t+"/"+h}},{key:"createTile",value:function createTile(t,h){var p,x,M,k,I=this,N=function template(t,h){return t.replace(ta,(function(t,p){var x=h[p];if(void 0===x)throw new Error("No value provided for variable "+t);return"function"==typeof x&&(x=x(h)),x}))}(this.url,{s:this.options.subdomains[Math.abs(h.x+h.y)%this.options.subdomains.length],x:h.x,y:h.y,z:h.z}),V={xyz:h};"xyz"===this.options.tileType?(p=this.gridCache[this.createTileKey(h)],x=this.gridCache[this.createTileKey(h.x+1,h.y,h.z)],M=this.gridCache[this.createTileKey(h.x,h.y+1,h.z)],k=this.gridCache[this.createTileKey(h.x+1,h.y+1,h.z)]):"bd09"===this.options.tileType&&(p=this.gridCache[this.createTileKey(h.x,h.y+1,h.z)],x=this.gridCache[this.createTileKey(h.x+1,h.y+1,h.z)],M=this.gridCache[this.createTileKey(h)],k=this.gridCache[this.createTileKey(h.x+1,h.y,h.z)]);var ee=new Float32Array([p.lng,p.lat,0,1,M.lng,M.lat,0,0,x.lng,x.lat,1,1,k.lng,k.lat,1,0]),te=ee.BYTES_PER_ELEMENT,re=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,re),t.bufferData(t.ARRAY_BUFFER,ee,t.STATIC_DRAW),V.buffer=re,V.PosParam={size:2,stride:4*te,offset:0},V.TextCoordParam={size:2,stride:4*te,offset:2*te};var ne=new Image;return ne.onload=function(){V.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,V.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ne),V.isLoad=!0,I.map.triggerRepaint()},ne.crossOrigin=!0,ne.src=N,V}},{key:"render",value:function render(t,h){if(!(this.map.getZoom()<this.options.minZoom||this.map.getZoom()>this.options.maxZoom)){this.matrix=h,t.useProgram(this.program);var p,x=_createForOfIteratorHelper(this.showTiles);try{for(x.s();!(p=x.n()).done;){var M=p.value;if(M.isLoad){t.bindTexture(t.TEXTURE_2D,M.texture),t.activeTexture(t.TEXTURE0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT);var k=t.getUniformLocation(this.program,"u_Sampler");t.uniform1i(k,0),t.bindBuffer(t.ARRAY_BUFFER,M.buffer),t.vertexAttribPointer(this.a_Pos,M.PosParam.size,t.FLOAT,!1,M.PosParam.stride,M.PosParam.offset),t.vertexAttribPointer(this.a_TextCoord,M.TextCoordParam.size,t.FLOAT,!1,M.TextCoordParam.stride,M.TextCoordParam.offset),t.enableVertexAttribArray(this.a_Pos),t.enableVertexAttribArray(this.a_TextCoord),this.setVertex(t),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}}catch(I){x.e(I)}finally{x.f()}}}},{key:"setVertex",value:function setVertex(t){var h=this.map.getZoom(),p=this.map.getBearing(),x=this.map.getPitch(),M=this.map.getCenter(),k=new Ca({width:t.drawingBufferWidth,height:t.drawingBufferHeight,longitude:M.lng,latitude:M.lat,zoom:h,pitch:x,bearing:p}),I=k.viewProjectionMatrix,N=k.projectionMatrix,V=k.viewMatrix,ee=k.viewMatrixUncentered,te={u_matrix:I,u_point_size:this.pointSize,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_project_scale:zoomToScale(h),u_viewport_center_projection:[0,0,0,0]};if(h>0){var re=function getDistanceScales(t){var h=t.latitude,p=void 0===h?0:h,x=t.zoom,M=void 0===x?1:x,k=t.scale,I=t.highPrecision,N=void 0!==I&&I,V={},ee=512*(k=void 0!==k?k:zoomToScale(M))*window.devicePixelRatio,te=Math.cos(p*Sa),re=ee/360,ne=re/te,ie=ee/Ta/te;if(V.pixelsPerMeter=[ie,-ie,ie],V.metersPerPixel=[1/ie,-1/ie,1/ie],V.pixelsPerDegree=[re,-ne,ie],V.degreesPerPixel=[1/re,-1/ne,1/ie],N){var ae=Sa*Math.tan(p*Sa)/te,oe=re*ae/2,se=ee/Ta*ae,ce=se/ne*ie;V.pixelsPerDegree2=[0,-oe,se],V.pixelsPerMeter2=[ce,0,ce]}return V}({longitude:M.lng,latitude:M.lat,zoom:h,highPrecision:!0}),ne=re.pixelsPerDegree,ie=re.pixelsPerDegree2,ae=k.projectFlat([Math.fround(M.lng),Math.fround(M.lat)],Math.pow(2,h)),oe=transformMat4([],[ae[0],ae[1],0,1],I),se=multiply([],N,ee||V);se=multiply([],se,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),te.u_matrix=se,te.u_is_offset=!0,te.u_viewport_center=[Math.fround(M.lng),Math.fround(M.lat)],te.u_viewport_center_projection=oe,te.u_pixels_per_degree=ne&&ne.map((function(t){return Math.fround(t)})),te.u_pixels_per_degree2=ie&&ie.map((function(t){return Math.fround(t)}))}t.uniformMatrix4fv(t.getUniformLocation(this.program,"u_matrix"),!1,te.u_matrix),t.uniform1f(t.getUniformLocation(this.program,"u_project_scale"),te.u_project_scale),t.uniform1i(t.getUniformLocation(this.program,"u_is_offset"),te.u_is_offset?1:0),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree"),te.u_pixels_per_degree),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_degree2"),te.u_pixels_per_degree2),t.uniform3fv(t.getUniformLocation(this.program,"u_pixels_per_meter"),te.u_pixels_per_meter),t.uniform2fv(t.getUniformLocation(this.program,"u_viewport_center"),te.u_viewport_center),t.uniform4fv(t.getUniformLocation(this.program,"u_viewport_center_projection"),te.u_viewport_center_projection)}},{key:"onRemove",value:function onRemove(t,h){this.isLayerShow=!1}}]),customTileLayer}();var Da=[];function MxMapAddRasterTileLayer(t,h,p,x){Da.forEach((function(h){t.getLayer(h)&&t.removeLayer(h),t.getSource(h)&&t.removeSource(h)})),Da=[],h.forEach((function(h){Da.push(h[0]);var M=p?{key:p}:null,k=function RasterTileLayer(t,h,p,x){var M=p||{};x||(x={TianDiTu:{Normal:{Map:"http://t{s}.tianditu.com/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Satellite:{Map:"http://t{s}.tianditu.com/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Terrain:{Map:"http://t{s}.tianditu.com/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:14},Subdomains:["0","1","2","3","4","5","6","7"],key:""},GaoDe:{Normal:{Map:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",minzoom:0,maxzoom:18},Normal_NoTag:{Map:"https://wprd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&scl=1&ltype=11&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Satellite:{Map:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",Annotion:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Subdomains:["1","2","3","4"]},Baidu:{Normal:{Map:"http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"},Satellite:{Map:"http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46",Annotion:"http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&v=020"},Subdomains:"0123456789",tileType:"bd09"},Geoq:{Normal:{Map:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",PurplishBlue:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",Gray:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",Warm:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",minzoom:3,maxzoom:16},Subdomains:[]},OSM:{Normal:{Map:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",minzoom:0,maxzoom:18},Subdomains:["a","b","c"]}});var k,I=h.split("."),N=I[0],V=I[1],ee=I[2],te=x[N][V][ee],re=x[N].Subdomains,ne=x[N][V].minzoom,ie=x[N][V].maxzoom,ae=x[N].tileType;if("TianDiTu"===N||"OSM"===N){var oe,se=M.key||x[N].key,ce=[],ue=_createForOfIteratorHelper(re);try{for(ue.s();!(oe=ue.n()).done;){var le=oe.value;ce.push(te.replace("{s}",le).replace("{key}",se))}}catch(he){ue.e(he)}finally{ue.f()}k={id:t,type:"raster",source:{type:"raster",tiles:ce,tileSize:256,minzoom:ne,maxzoom:ie}}}else k=new Aa(t,te,{subdomains:re,minZoom:ne,maxZoom:ie,tileType:ae});return k}(h[0],h[1],M,x);t.addLayer(k,"mx.layer.fill")}))}function MxMapAddGoogleCnLayer(t,h,p){h.forEach((function(h,x){if("Image"==h){var M="https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}";p&&x<p.length&&(M=p[x]),t.addLayer({id:"GoogleImageLayer",type:"raster",source:{type:"raster",tiles:[M],tileSize:256}})}else if("Lable"==h){var k="https://gac-geo.googlecnapps.cn/maps/vt?lyrs=s,m&gl=CN&x={x}&y={y}&z={z}";p&&x<p.length&&(k=p[x]),t.addLayer({id:"GoogleImageLableLayer",type:"raster",source:{type:"raster",tiles:[k],tileSize:256}})}}))}var ka=3.141592653589793,Pa=6378245,La=.006693421622965943;function transformLat(t,h){var p=2*t-100+3*h+.2*h*h+.1*t*h+.2*Math.sqrt(Math.abs(t));return p+=2*(20*Math.sin(6*t*ka)+20*Math.sin(2*t*ka))/3,p+=2*(20*Math.sin(h*ka)+40*Math.sin(h/3*ka))/3,p+=2*(160*Math.sin(h/12*ka)+320*Math.sin(h*ka/30))/3}function transformLng(t,h){var p=300+t+2*h+.1*t*t+.1*t*h+.1*Math.sqrt(Math.abs(t));return p+=2*(20*Math.sin(6*t*ka)+20*Math.sin(2*t*ka))/3,p+=2*(20*Math.sin(t*ka)+40*Math.sin(t/3*ka))/3,p+=2*(150*Math.sin(t/12*ka)+300*Math.sin(t/30*ka))/3}function mx_gps84_To_gcj02(t,h){if(t instanceof Object){var p=t.lng;h=t.lat,t=p}var x=transformLat(t-105,h-35),M=transformLng(t-105,h-35),k=h/180*ka,I=Math.sin(k);I=1-La*I*I;var N=Math.sqrt(I);return x=180*x/(Pa*(1-La)/(I*N)*ka),{lng:t+(M=180*M/(Pa/N*Math.cos(k)*ka)),lat:h+x}}function mx_gcj02_To_gps84(t,h){if(t instanceof Object){var p=t.lng;h=t.lat,t=p}var x=function transform(t,h){var p=transformLat(t-105,h-35),x=transformLng(t-105,h-35),M=h/180*ka,k=Math.sin(M);k=1-La*k*k;var I=Math.sqrt(k);return p=180*p/(Pa*(1-La)/(k*I)*ka),{lng:t+(x=180*x/(Pa/I*Math.cos(M)*ka)),lat:h+p}}(t,h);return{lng:2*t-x.lng,lat:2*h-x.lat}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var h=Object(t),p=1;p<arguments.length;p++){var x=arguments[p];if(null!=x)for(var M in x)Object.prototype.hasOwnProperty.call(x,M)&&(h[M]=x[M])}return h});var Ea=0,Ia=1,Ba=2,Oa=1,Ra=2,Fa=3,Na=0,Va=1,Ga=2,ja=0,Ua=0,za=1,Wa=2,Ha=3,$a=4,qa=5,Ka=100,Ya=101,Za=102,Ja=103,Qa=104,eo=200,to=201,ro=202,no=203,io=204,ao=205,oo=206,so=207,co=208,uo=209,lo=210,ho=0,fo=1,po=2,mo=3,vo=4,yo=5,bo=6,xo=7,Mo=0,wo=1,_o=2,Co=0,So=1,To=2,Ao=3,ko=4,Po=5,Lo=301,Eo=302,Io=303,Bo=304,Oo=305,Ro=306,Fo=307,No=1e3,Go=1001,jo=1002,Uo=1003,zo=1004,Wo=1005,Ho=1006,$o=1007,Xo=1008,qo=1009,Ko=1010,Yo=1011,Zo=1012,Jo=1013,Qo=1014,es=1015,ts=1016,rs=1017,ns=1018,is=1019,os=1020,ss=1021,cs=1022,us=1023,ls=1024,hs=1025,fs=us,ds=1026,ps=1027,ms=1028,gs=1029,vs=1030,ys=1031,bs=1032,xs=1033,Ms=33776,ws=33777,_s=33778,Cs=33779,Ss=35840,Ts=35841,As=35842,Ds=35843,ks=36196,Ps=37808,Ls=37809,Es=37810,Is=37811,Bs=37812,Os=37813,Rs=37814,Fs=37815,Ns=37816,Vs=37817,Gs=37818,js=37819,Us=37820,zs=37821,Ws=2300,Hs=2301,$s=2302,Xs=2400,qs=2401,Ks=2402,Ys=3e3,Zs=3001,Js=3007,Qs=3002,ec=3003,tc=3004,rc=3005,nc=3006,ic=3200,ac=3201,oc=0,sc=1,cc=7680,uc=519,lc=35044,hc=35048;function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(t,h){void 0===this._listeners&&(this._listeners={});var p=this._listeners;void 0===p[t]&&(p[t]=[]),-1===p[t].indexOf(h)&&p[t].push(h)},hasEventListener:function(t,h){if(void 0===this._listeners)return!1;var p=this._listeners;return void 0!==p[t]&&-1!==p[t].indexOf(h)},removeEventListener:function(t,h){if(void 0!==this._listeners){var p=this._listeners[t];if(void 0!==p){var x=p.indexOf(h);-1!==x&&p.splice(x,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var h=this._listeners[t.type];if(void 0!==h){t.target=this;for(var p=h.slice(0),x=0,M=p.length;x<M;x++)p[x].call(this,t)}}}});for(var dc=[],pc=0;pc<256;pc++)dc[pc]=(pc<16?"0":"")+pc.toString(16);var mc,gc={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,h=4294967295*Math.random()|0,p=4294967295*Math.random()|0,x=4294967295*Math.random()|0;return(dc[255&t]+dc[t>>8&255]+dc[t>>16&255]+dc[t>>24&255]+"-"+dc[255&h]+dc[h>>8&255]+"-"+dc[h>>16&15|64]+dc[h>>24&255]+"-"+dc[63&p|128]+dc[p>>8&255]+"-"+dc[p>>16&255]+dc[p>>24&255]+dc[255&x]+dc[x>>8&255]+dc[x>>16&255]+dc[x>>24&255]).toUpperCase()},clamp:function(t,h,p){return Math.max(h,Math.min(p,t))},euclideanModulo:function(t,h){return(t%h+h)%h},mapLinear:function(t,h,p,x,M){return x+(t-h)*(M-x)/(p-h)},lerp:function(t,h,p){return(1-p)*t+p*h},smoothstep:function(t,h,p){return t<=h?0:t>=p?1:(t=(t-h)/(p-h))*t*(3-2*t)},smootherstep:function(t,h,p){return t<=h?0:t>=p?1:(t=(t-h)/(p-h))*t*t*(t*(6*t-15)+10)},randInt:function(t,h){return t+Math.floor(Math.random()*(h-t+1))},randFloat:function(t,h){return t+Math.random()*(h-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*gc.DEG2RAD},radToDeg:function(t){return t*gc.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,h,p,x,M){var k=Math.cos,I=Math.sin,N=k(p/2),V=I(p/2),ee=k((h+x)/2),te=I((h+x)/2),re=k((h-x)/2),ne=I((h-x)/2),ie=k((x-h)/2),ae=I((x-h)/2);"XYX"===M?t.set(N*te,V*re,V*ne,N*ee):"YZY"===M?t.set(V*ne,N*te,V*re,N*ee):"ZXZ"===M?t.set(V*re,V*ne,N*te,N*ee):"XZX"===M?t.set(N*te,V*ae,V*ie,N*ee):"YXY"===M?t.set(V*ie,N*te,V*ae,N*ee):"ZYZ"===M&&t.set(V*ae,V*ie,N*te,N*ee)}};function Vector2(t,h){this.x=t||0,this.y=h||0}function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1]}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(t,h){return this.x=t,this.y=h,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,h){switch(t){case 0:this.x=h;break;case 1:this.y=h;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,h){return void 0!==h?this.addVectors(t,h):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,h){return this.x=t.x+h.x,this.y=t.y+h.y,this},addScaledVector:function(t,h){return this.x+=t.x*h,this.y+=t.y*h,this},sub:function(t,h){return void 0!==h?this.subVectors(t,h):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,h){return this.x=t.x-h.x,this.y=t.y-h.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var h=this.x,p=this.y,x=t.elements;return this.x=x[0]*h+x[3]*p+x[6],this.y=x[1]*h+x[4]*p+x[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,h){return this.x=Math.max(t.x,Math.min(h.x,this.x)),this.y=Math.max(t.y,Math.min(h.y,this.y)),this},clampScalar:function(t,h){return this.x=Math.max(t,Math.min(h,this.x)),this.y=Math.max(t,Math.min(h,this.y)),this},clampLength:function(t,h){var p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(t,Math.min(h,p)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var h=this.x-t.x,p=this.y-t.y;return h*h+p*p},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,h){return this.x+=(t.x-this.x)*h,this.y+=(t.y-this.y)*h,this},lerpVectors:function(t,h,p){return this.subVectors(h,t).multiplyScalar(p).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,h){return void 0===h&&(h=0),this.x=t[h],this.y=t[h+1],this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this.x,t[h+1]=this.y,t},fromBufferAttribute:function(t,h,p){return this.x=t.getX(h),this.y=t.getY(h),this},rotateAround:function(t,h){var p=Math.cos(h),x=Math.sin(h),M=this.x-t.x,k=this.y-t.y;return this.x=M*p-k*x+t.x,this.y=M*x+k*p+t.y,this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(t,h,p,x,M,k,I,N,V){var ee=this.elements;return ee[0]=t,ee[1]=x,ee[2]=I,ee[3]=h,ee[4]=M,ee[5]=N,ee[6]=p,ee[7]=k,ee[8]=V,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var h=this.elements,p=t.elements;return h[0]=p[0],h[1]=p[1],h[2]=p[2],h[3]=p[3],h[4]=p[4],h[5]=p[5],h[6]=p[6],h[7]=p[7],h[8]=p[8],this},setFromMatrix4:function(t){var h=t.elements;return this.set(h[0],h[4],h[8],h[1],h[5],h[9],h[2],h[6],h[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,h){var p=t.elements,x=h.elements,M=this.elements,k=p[0],I=p[3],N=p[6],V=p[1],ee=p[4],te=p[7],re=p[2],ne=p[5],ie=p[8],ae=x[0],oe=x[3],se=x[6],ce=x[1],ue=x[4],le=x[7],he=x[2],fe=x[5],de=x[8];return M[0]=k*ae+I*ce+N*he,M[3]=k*oe+I*ue+N*fe,M[6]=k*se+I*le+N*de,M[1]=V*ae+ee*ce+te*he,M[4]=V*oe+ee*ue+te*fe,M[7]=V*se+ee*le+te*de,M[2]=re*ae+ne*ce+ie*he,M[5]=re*oe+ne*ue+ie*fe,M[8]=re*se+ne*le+ie*de,this},multiplyScalar:function(t){var h=this.elements;return h[0]*=t,h[3]*=t,h[6]*=t,h[1]*=t,h[4]*=t,h[7]*=t,h[2]*=t,h[5]*=t,h[8]*=t,this},determinant:function(){var t=this.elements,h=t[0],p=t[1],x=t[2],M=t[3],k=t[4],I=t[5],N=t[6],V=t[7],ee=t[8];return h*k*ee-h*I*V-p*M*ee+p*I*N+x*M*V-x*k*N},getInverse:function(t,h){t&&t.isMatrix4;var p=t.elements,x=this.elements,M=p[0],k=p[1],I=p[2],N=p[3],V=p[4],ee=p[5],te=p[6],re=p[7],ne=p[8],ie=ne*V-ee*re,ae=ee*te-ne*N,oe=re*N-V*te,se=M*ie+k*ae+I*oe;if(0===se){if(!0===h)throw new Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var ce=1/se;return x[0]=ie*ce,x[1]=(I*re-ne*k)*ce,x[2]=(ee*k-I*V)*ce,x[3]=ae*ce,x[4]=(ne*M-I*te)*ce,x[5]=(I*N-ee*M)*ce,x[6]=oe*ce,x[7]=(k*te-re*M)*ce,x[8]=(V*M-k*N)*ce,this},transpose:function(){var t,h=this.elements;return t=h[1],h[1]=h[3],h[3]=t,t=h[2],h[2]=h[6],h[6]=t,t=h[5],h[5]=h[7],h[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var h=this.elements;return t[0]=h[0],t[1]=h[3],t[2]=h[6],t[3]=h[1],t[4]=h[4],t[5]=h[7],t[6]=h[2],t[7]=h[5],t[8]=h[8],this},setUvTransform:function(t,h,p,x,M,k,I){var N=Math.cos(M),V=Math.sin(M);this.set(p*N,p*V,-p*(N*k+V*I)+k+t,-x*V,x*N,-x*(-V*k+N*I)+I+h,0,0,1)},scale:function(t,h){var p=this.elements;return p[0]*=t,p[3]*=t,p[6]*=t,p[1]*=h,p[4]*=h,p[7]*=h,this},rotate:function(t){var h=Math.cos(t),p=Math.sin(t),x=this.elements,M=x[0],k=x[3],I=x[6],N=x[1],V=x[4],ee=x[7];return x[0]=h*M+p*N,x[3]=h*k+p*V,x[6]=h*I+p*ee,x[1]=-p*M+h*N,x[4]=-p*k+h*V,x[7]=-p*I+h*ee,this},translate:function(t,h){var p=this.elements;return p[0]+=t*p[2],p[3]+=t*p[5],p[6]+=t*p[8],p[1]+=h*p[2],p[4]+=h*p[5],p[7]+=h*p[8],this},equals:function(t){for(var h=this.elements,p=t.elements,x=0;x<9;x++)if(h[x]!==p[x])return!1;return!0},fromArray:function(t,h){void 0===h&&(h=0);for(var p=0;p<9;p++)this.elements[p]=t[p+h];return this},toArray:function(t,h){void 0===t&&(t=[]),void 0===h&&(h=0);var p=this.elements;return t[h]=p[0],t[h+1]=p[1],t[h+2]=p[2],t[h+3]=p[3],t[h+4]=p[4],t[h+5]=p[5],t[h+6]=p[6],t[h+7]=p[7],t[h+8]=p[8],t}});var vc={getDataURL:function(t){var h;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)h=t;else{void 0===mc&&(mc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),mc.width=t.width,mc.height=t.height;var p=mc.getContext("2d");t instanceof ImageData?p.putImageData(t,0,0):p.drawImage(t,0,0,t.width,t.height),h=mc}return h.width>2048||h.height>2048?h.toDataURL("image/jpeg",.6):h.toDataURL("image/png")}},yc=0;function Texture(t,h,p,x,M,k,I,N,V,ee){Object.defineProperty(this,"id",{value:yc++}),this.uuid=gc.generateUUID(),this.name="",this.image=void 0!==t?t:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==h?h:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==p?p:Go,this.wrapT=void 0!==x?x:Go,this.magFilter=void 0!==M?M:Ho,this.minFilter=void 0!==k?k:Xo,this.anisotropy=void 0!==V?V:1,this.format=void 0!==I?I:us,this.internalFormat=null,this.type=void 0!==N?N:qo,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==ee?ee:Ys,this.version=0,this.onUpdate=null}function Vector4(t,h,p,x){this.x=t||0,this.y=h||0,this.z=p||0,this.w=void 0!==x?x:1}function WebGLRenderTarget(t,h,p){this.width=t,this.height=h,this.scissor=new Vector4(0,0,t,h),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,h),p=p||{},this.texture=new Texture(void 0,p.mapping,p.wrapS,p.wrapT,p.magFilter,p.minFilter,p.format,p.type,p.anisotropy,p.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=h,this.texture.generateMipmaps=void 0!==p.generateMipmaps&&p.generateMipmaps,this.texture.minFilter=void 0!==p.minFilter?p.minFilter:Ho,this.depthBuffer=void 0===p.depthBuffer||p.depthBuffer,this.stencilBuffer=void 0===p.stencilBuffer||p.stencilBuffer,this.depthTexture=void 0!==p.depthTexture?p.depthTexture:null}function WebGLMultisampleRenderTarget(t,h,p){WebGLRenderTarget.call(this,t,h,p),this.samples=4}function Quaternion(t,h,p,x){this._x=t||0,this._y=h||0,this._z=p||0,this._w=void 0!==x?x:1}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var h=void 0===t||"string"==typeof t;if(!h&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var p={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var x=this.image;if(void 0===x.uuid&&(x.uuid=gc.generateUUID()),!h&&void 0===t.images[x.uuid]){var M;if(Array.isArray(x)){M=[];for(var k=0,I=x.length;k<I;k++)M.push(vc.getDataURL(x[k]))}else M=vc.getDataURL(x);t.images[x.uuid]={uuid:x.uuid,url:M}}p.image=x.uuid}return h||(t.textures[this.uuid]=p),p},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case No:t.x=t.x-Math.floor(t.x);break;case Go:t.x=t.x<0?0:1;break;case jo:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case No:t.y=t.y-Math.floor(t.y);break;case Go:t.y=t.y<0?0:1;break;case jo:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(Vector4.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(t,h,p,x){return this.x=t,this.y=h,this.z=p,this.w=x,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,h){switch(t){case 0:this.x=h;break;case 1:this.y=h;break;case 2:this.z=h;break;case 3:this.w=h;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,h){return void 0!==h?this.addVectors(t,h):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,h){return this.x=t.x+h.x,this.y=t.y+h.y,this.z=t.z+h.z,this.w=t.w+h.w,this},addScaledVector:function(t,h){return this.x+=t.x*h,this.y+=t.y*h,this.z+=t.z*h,this.w+=t.w*h,this},sub:function(t,h){return void 0!==h?this.subVectors(t,h):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,h){return this.x=t.x-h.x,this.y=t.y-h.y,this.z=t.z-h.z,this.w=t.w-h.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var h=this.x,p=this.y,x=this.z,M=this.w,k=t.elements;return this.x=k[0]*h+k[4]*p+k[8]*x+k[12]*M,this.y=k[1]*h+k[5]*p+k[9]*x+k[13]*M,this.z=k[2]*h+k[6]*p+k[10]*x+k[14]*M,this.w=k[3]*h+k[7]*p+k[11]*x+k[15]*M,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var h=Math.sqrt(1-t.w*t.w);return h<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/h,this.y=t.y/h,this.z=t.z/h),this},setAxisAngleFromRotationMatrix:function(t){var h,p,x,M,k=.01,I=.1,N=t.elements,V=N[0],ee=N[4],te=N[8],re=N[1],ne=N[5],ie=N[9],ae=N[2],oe=N[6],se=N[10];if(Math.abs(ee-re)<k&&Math.abs(te-ae)<k&&Math.abs(ie-oe)<k){if(Math.abs(ee+re)<I&&Math.abs(te+ae)<I&&Math.abs(ie+oe)<I&&Math.abs(V+ne+se-3)<I)return this.set(1,0,0,0),this;h=Math.PI;var ce=(V+1)/2,ue=(ne+1)/2,le=(se+1)/2,he=(ee+re)/4,fe=(te+ae)/4,de=(ie+oe)/4;return ce>ue&&ce>le?ce<k?(p=0,x=.707106781,M=.707106781):(x=he/(p=Math.sqrt(ce)),M=fe/p):ue>le?ue<k?(p=.707106781,x=0,M=.707106781):(p=he/(x=Math.sqrt(ue)),M=de/x):le<k?(p=.707106781,x=.707106781,M=0):(p=fe/(M=Math.sqrt(le)),x=de/M),this.set(p,x,M,h),this}var pe=Math.sqrt((oe-ie)*(oe-ie)+(te-ae)*(te-ae)+(re-ee)*(re-ee));return Math.abs(pe)<.001&&(pe=1),this.x=(oe-ie)/pe,this.y=(te-ae)/pe,this.z=(re-ee)/pe,this.w=Math.acos((V+ne+se-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,h){return this.x=Math.max(t.x,Math.min(h.x,this.x)),this.y=Math.max(t.y,Math.min(h.y,this.y)),this.z=Math.max(t.z,Math.min(h.z,this.z)),this.w=Math.max(t.w,Math.min(h.w,this.w)),this},clampScalar:function(t,h){return this.x=Math.max(t,Math.min(h,this.x)),this.y=Math.max(t,Math.min(h,this.y)),this.z=Math.max(t,Math.min(h,this.z)),this.w=Math.max(t,Math.min(h,this.w)),this},clampLength:function(t,h){var p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(t,Math.min(h,p)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,h){return this.x+=(t.x-this.x)*h,this.y+=(t.y-this.y)*h,this.z+=(t.z-this.z)*h,this.w+=(t.w-this.w)*h,this},lerpVectors:function(t,h,p){return this.subVectors(h,t).multiplyScalar(p).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,h){return void 0===h&&(h=0),this.x=t[h],this.y=t[h+1],this.z=t[h+2],this.w=t[h+3],this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this.x,t[h+1]=this.y,t[h+2]=this.z,t[h+3]=this.w,t},fromBufferAttribute:function(t,h,p){return this.x=t.getX(h),this.y=t.getY(h),this.z=t.getZ(h),this.w=t.getW(h),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(t,h){this.width===t&&this.height===h||(this.width=t,this.height=h,this.texture.image.width=t,this.texture.image.height=h,this.dispose()),this.viewport.set(0,0,t,h),this.scissor.set(0,0,t,h)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Quaternion,{slerp:function(t,h,p,x){return p.copy(t).slerp(h,x)},slerpFlat:function(t,h,p,x,M,k,I){var N=p[x+0],V=p[x+1],ee=p[x+2],te=p[x+3],re=M[k+0],ne=M[k+1],ie=M[k+2],ae=M[k+3];if(te!==ae||N!==re||V!==ne||ee!==ie){var oe=1-I,se=N*re+V*ne+ee*ie+te*ae,ce=se>=0?1:-1,ue=1-se*se;if(ue>Number.EPSILON){var le=Math.sqrt(ue),he=Math.atan2(le,se*ce);oe=Math.sin(oe*he)/le,I=Math.sin(I*he)/le}var fe=I*ce;if(N=N*oe+re*fe,V=V*oe+ne*fe,ee=ee*oe+ie*fe,te=te*oe+ae*fe,oe===1-I){var de=1/Math.sqrt(N*N+V*V+ee*ee+te*te);N*=de,V*=de,ee*=de,te*=de}}t[h]=N,t[h+1]=V,t[h+2]=ee,t[h+3]=te}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(t,h,p,x){return this._x=t,this._y=h,this._z=p,this._w=x,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,h){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var p=t._x,x=t._y,M=t._z,k=t.order,I=Math.cos,N=Math.sin,V=I(p/2),ee=I(x/2),te=I(M/2),re=N(p/2),ne=N(x/2),ie=N(M/2);return"XYZ"===k?(this._x=re*ee*te+V*ne*ie,this._y=V*ne*te-re*ee*ie,this._z=V*ee*ie+re*ne*te,this._w=V*ee*te-re*ne*ie):"YXZ"===k?(this._x=re*ee*te+V*ne*ie,this._y=V*ne*te-re*ee*ie,this._z=V*ee*ie-re*ne*te,this._w=V*ee*te+re*ne*ie):"ZXY"===k?(this._x=re*ee*te-V*ne*ie,this._y=V*ne*te+re*ee*ie,this._z=V*ee*ie+re*ne*te,this._w=V*ee*te-re*ne*ie):"ZYX"===k?(this._x=re*ee*te-V*ne*ie,this._y=V*ne*te+re*ee*ie,this._z=V*ee*ie-re*ne*te,this._w=V*ee*te+re*ne*ie):"YZX"===k?(this._x=re*ee*te+V*ne*ie,this._y=V*ne*te+re*ee*ie,this._z=V*ee*ie-re*ne*te,this._w=V*ee*te-re*ne*ie):"XZY"===k&&(this._x=re*ee*te-V*ne*ie,this._y=V*ne*te-re*ee*ie,this._z=V*ee*ie+re*ne*te,this._w=V*ee*te+re*ne*ie),!1!==h&&this._onChangeCallback(),this},setFromAxisAngle:function(t,h){var p=h/2,x=Math.sin(p);return this._x=t.x*x,this._y=t.y*x,this._z=t.z*x,this._w=Math.cos(p),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var h,p=t.elements,x=p[0],M=p[4],k=p[8],I=p[1],N=p[5],V=p[9],ee=p[2],te=p[6],re=p[10],ne=x+N+re;return ne>0?(h=.5/Math.sqrt(ne+1),this._w=.25/h,this._x=(te-V)*h,this._y=(k-ee)*h,this._z=(I-M)*h):x>N&&x>re?(h=2*Math.sqrt(1+x-N-re),this._w=(te-V)/h,this._x=.25*h,this._y=(M+I)/h,this._z=(k+ee)/h):N>re?(h=2*Math.sqrt(1+N-x-re),this._w=(k-ee)/h,this._x=(M+I)/h,this._y=.25*h,this._z=(V+te)/h):(h=2*Math.sqrt(1+re-x-N),this._w=(I-M)/h,this._x=(k+ee)/h,this._y=(V+te)/h,this._z=.25*h),this._onChangeCallback(),this},setFromUnitVectors:function(t,h){var p=t.dot(h)+1;return p<1e-6?(p=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=p):(this._x=0,this._y=-t.z,this._z=t.y,this._w=p)):(this._x=t.y*h.z-t.z*h.y,this._y=t.z*h.x-t.x*h.z,this._z=t.x*h.y-t.y*h.x,this._w=p),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(gc.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,h){var p=this.angleTo(t);if(0===p)return this;var x=Math.min(1,h/p);return this.slerp(t,x),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,h){return void 0!==h?this.multiplyQuaternions(t,h):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,h){var p=t._x,x=t._y,M=t._z,k=t._w,I=h._x,N=h._y,V=h._z,ee=h._w;return this._x=p*ee+k*I+x*V-M*N,this._y=x*ee+k*N+M*I-p*V,this._z=M*ee+k*V+p*N-x*I,this._w=k*ee-p*I-x*N-M*V,this._onChangeCallback(),this},slerp:function(t,h){if(0===h)return this;if(1===h)return this.copy(t);var p=this._x,x=this._y,M=this._z,k=this._w,I=k*t._w+p*t._x+x*t._y+M*t._z;if(I<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,I=-I):this.copy(t),I>=1)return this._w=k,this._x=p,this._y=x,this._z=M,this;var N=1-I*I;if(N<=Number.EPSILON){var V=1-h;return this._w=V*k+h*this._w,this._x=V*p+h*this._x,this._y=V*x+h*this._y,this._z=V*M+h*this._z,this.normalize(),this._onChangeCallback(),this}var ee=Math.sqrt(N),te=Math.atan2(ee,I),re=Math.sin((1-h)*te)/ee,ne=Math.sin(h*te)/ee;return this._w=k*re+this._w*ne,this._x=p*re+this._x*ne,this._y=x*re+this._y*ne,this._z=M*re+this._z*ne,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,h){return void 0===h&&(h=0),this._x=t[h],this._y=t[h+1],this._z=t[h+2],this._w=t[h+3],this._onChangeCallback(),this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this._x,t[h+1]=this._y,t[h+2]=this._z,t[h+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var bc=new Vector3,xc=new Quaternion;function Vector3(t,h,p){this.x=t||0,this.y=h||0,this.z=p||0}Object.assign(Vector3.prototype,{isVector3:!0,set:function(t,h,p){return this.x=t,this.y=h,this.z=p,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,h){switch(t){case 0:this.x=h;break;case 1:this.y=h;break;case 2:this.z=h;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,h){return void 0!==h?this.addVectors(t,h):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,h){return this.x=t.x+h.x,this.y=t.y+h.y,this.z=t.z+h.z,this},addScaledVector:function(t,h){return this.x+=t.x*h,this.y+=t.y*h,this.z+=t.z*h,this},sub:function(t,h){return void 0!==h?this.subVectors(t,h):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,h){return this.x=t.x-h.x,this.y=t.y-h.y,this.z=t.z-h.z,this},multiply:function(t,h){return void 0!==h?this.multiplyVectors(t,h):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,h){return this.x=t.x*h.x,this.y=t.y*h.y,this.z=t.z*h.z,this},applyEuler:function(t){return!t||t.isEuler,this.applyQuaternion(xc.setFromEuler(t))},applyAxisAngle:function(t,h){return this.applyQuaternion(xc.setFromAxisAngle(t,h))},applyMatrix3:function(t){var h=this.x,p=this.y,x=this.z,M=t.elements;return this.x=M[0]*h+M[3]*p+M[6]*x,this.y=M[1]*h+M[4]*p+M[7]*x,this.z=M[2]*h+M[5]*p+M[8]*x,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var h=this.x,p=this.y,x=this.z,M=t.elements,k=1/(M[3]*h+M[7]*p+M[11]*x+M[15]);return this.x=(M[0]*h+M[4]*p+M[8]*x+M[12])*k,this.y=(M[1]*h+M[5]*p+M[9]*x+M[13])*k,this.z=(M[2]*h+M[6]*p+M[10]*x+M[14])*k,this},applyQuaternion:function(t){var h=this.x,p=this.y,x=this.z,M=t.x,k=t.y,I=t.z,N=t.w,V=N*h+k*x-I*p,ee=N*p+I*h-M*x,te=N*x+M*p-k*h,re=-M*h-k*p-I*x;return this.x=V*N+re*-M+ee*-I-te*-k,this.y=ee*N+re*-k+te*-M-V*-I,this.z=te*N+re*-I+V*-k-ee*-M,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var h=this.x,p=this.y,x=this.z,M=t.elements;return this.x=M[0]*h+M[4]*p+M[8]*x,this.y=M[1]*h+M[5]*p+M[9]*x,this.z=M[2]*h+M[6]*p+M[10]*x,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,h){return this.x=Math.max(t.x,Math.min(h.x,this.x)),this.y=Math.max(t.y,Math.min(h.y,this.y)),this.z=Math.max(t.z,Math.min(h.z,this.z)),this},clampScalar:function(t,h){return this.x=Math.max(t,Math.min(h,this.x)),this.y=Math.max(t,Math.min(h,this.y)),this.z=Math.max(t,Math.min(h,this.z)),this},clampLength:function(t,h){var p=this.length();return this.divideScalar(p||1).multiplyScalar(Math.max(t,Math.min(h,p)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,h){return this.x+=(t.x-this.x)*h,this.y+=(t.y-this.y)*h,this.z+=(t.z-this.z)*h,this},lerpVectors:function(t,h,p){return this.subVectors(h,t).multiplyScalar(p).add(t)},cross:function(t,h){return void 0!==h?this.crossVectors(t,h):this.crossVectors(this,t)},crossVectors:function(t,h){var p=t.x,x=t.y,M=t.z,k=h.x,I=h.y,N=h.z;return this.x=x*N-M*I,this.y=M*k-p*N,this.z=p*I-x*k,this},projectOnVector:function(t){var h=t.lengthSq();if(0===h)return this.set(0,0,0);var p=t.dot(this)/h;return this.copy(t).multiplyScalar(p)},projectOnPlane:function(t){return bc.copy(this).projectOnVector(t),this.sub(bc)},reflect:function(t){return this.sub(bc.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var h=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===h)return Math.PI/2;var p=this.dot(t)/h;return Math.acos(gc.clamp(p,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var h=this.x-t.x,p=this.y-t.y,x=this.z-t.z;return h*h+p*p+x*x},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,h,p){var x=Math.sin(h)*t;return this.x=x*Math.sin(p),this.y=Math.cos(h)*t,this.z=x*Math.cos(p),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,h,p){return this.x=t*Math.sin(h),this.y=p,this.z=t*Math.cos(h),this},setFromMatrixPosition:function(t){var h=t.elements;return this.x=h[12],this.y=h[13],this.z=h[14],this},setFromMatrixScale:function(t){var h=this.setFromMatrixColumn(t,0).length(),p=this.setFromMatrixColumn(t,1).length(),x=this.setFromMatrixColumn(t,2).length();return this.x=h,this.y=p,this.z=x,this},setFromMatrixColumn:function(t,h){return this.fromArray(t.elements,4*h)},setFromMatrix3Column:function(t,h){return this.fromArray(t.elements,3*h)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,h){return void 0===h&&(h=0),this.x=t[h],this.y=t[h+1],this.z=t[h+2],this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this.x,t[h+1]=this.y,t[h+2]=this.z,t},fromBufferAttribute:function(t,h,p){return this.x=t.getX(h),this.y=t.getY(h),this.z=t.getZ(h),this}});var Mc=new Vector3,wc=new Matrix4,_c=new Vector3(0,0,0),Cc=new Vector3(1,1,1),Sc=new Vector3,Tc=new Vector3,Ac=new Vector3;function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(t,h,p,x,M,k,I,N,V,ee,te,re,ne,ie,ae,oe){var se=this.elements;return se[0]=t,se[4]=h,se[8]=p,se[12]=x,se[1]=M,se[5]=k,se[9]=I,se[13]=N,se[2]=V,se[6]=ee,se[10]=te,se[14]=re,se[3]=ne,se[7]=ie,se[11]=ae,se[15]=oe,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(t){var h=this.elements,p=t.elements;return h[0]=p[0],h[1]=p[1],h[2]=p[2],h[3]=p[3],h[4]=p[4],h[5]=p[5],h[6]=p[6],h[7]=p[7],h[8]=p[8],h[9]=p[9],h[10]=p[10],h[11]=p[11],h[12]=p[12],h[13]=p[13],h[14]=p[14],h[15]=p[15],this},copyPosition:function(t){var h=this.elements,p=t.elements;return h[12]=p[12],h[13]=p[13],h[14]=p[14],this},extractBasis:function(t,h,p){return t.setFromMatrixColumn(this,0),h.setFromMatrixColumn(this,1),p.setFromMatrixColumn(this,2),this},makeBasis:function(t,h,p){return this.set(t.x,h.x,p.x,0,t.y,h.y,p.y,0,t.z,h.z,p.z,0,0,0,0,1),this},extractRotation:function(t){var h=this.elements,p=t.elements,x=1/Mc.setFromMatrixColumn(t,0).length(),M=1/Mc.setFromMatrixColumn(t,1).length(),k=1/Mc.setFromMatrixColumn(t,2).length();return h[0]=p[0]*x,h[1]=p[1]*x,h[2]=p[2]*x,h[3]=0,h[4]=p[4]*M,h[5]=p[5]*M,h[6]=p[6]*M,h[7]=0,h[8]=p[8]*k,h[9]=p[9]*k,h[10]=p[10]*k,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this},makeRotationFromEuler:function(t){!t||t.isEuler;var h=this.elements,p=t.x,x=t.y,M=t.z,k=Math.cos(p),I=Math.sin(p),N=Math.cos(x),V=Math.sin(x),ee=Math.cos(M),te=Math.sin(M);if("XYZ"===t.order){var re=k*ee,ne=k*te,ie=I*ee,ae=I*te;h[0]=N*ee,h[4]=-N*te,h[8]=V,h[1]=ne+ie*V,h[5]=re-ae*V,h[9]=-I*N,h[2]=ae-re*V,h[6]=ie+ne*V,h[10]=k*N}else if("YXZ"===t.order){var oe=N*ee,se=N*te,ce=V*ee,ue=V*te;h[0]=oe+ue*I,h[4]=ce*I-se,h[8]=k*V,h[1]=k*te,h[5]=k*ee,h[9]=-I,h[2]=se*I-ce,h[6]=ue+oe*I,h[10]=k*N}else if("ZXY"===t.order){oe=N*ee,se=N*te,ce=V*ee,ue=V*te;h[0]=oe-ue*I,h[4]=-k*te,h[8]=ce+se*I,h[1]=se+ce*I,h[5]=k*ee,h[9]=ue-oe*I,h[2]=-k*V,h[6]=I,h[10]=k*N}else if("ZYX"===t.order){re=k*ee,ne=k*te,ie=I*ee,ae=I*te;h[0]=N*ee,h[4]=ie*V-ne,h[8]=re*V+ae,h[1]=N*te,h[5]=ae*V+re,h[9]=ne*V-ie,h[2]=-V,h[6]=I*N,h[10]=k*N}else if("YZX"===t.order){var le=k*N,he=k*V,fe=I*N,de=I*V;h[0]=N*ee,h[4]=de-le*te,h[8]=fe*te+he,h[1]=te,h[5]=k*ee,h[9]=-I*ee,h[2]=-V*ee,h[6]=he*te+fe,h[10]=le-de*te}else if("XZY"===t.order){le=k*N,he=k*V,fe=I*N,de=I*V;h[0]=N*ee,h[4]=-te,h[8]=V*ee,h[1]=le*te+de,h[5]=k*ee,h[9]=he*te-fe,h[2]=fe*te-he,h[6]=I*ee,h[10]=de*te+le}return h[3]=0,h[7]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(_c,t,Cc)},lookAt:function(t,h,p){var x=this.elements;return Ac.subVectors(t,h),0===Ac.lengthSq()&&(Ac.z=1),Ac.normalize(),Sc.crossVectors(p,Ac),0===Sc.lengthSq()&&(1===Math.abs(p.z)?Ac.x+=1e-4:Ac.z+=1e-4,Ac.normalize(),Sc.crossVectors(p,Ac)),Sc.normalize(),Tc.crossVectors(Ac,Sc),x[0]=Sc.x,x[4]=Tc.x,x[8]=Ac.x,x[1]=Sc.y,x[5]=Tc.y,x[9]=Ac.y,x[2]=Sc.z,x[6]=Tc.z,x[10]=Ac.z,this},multiply:function(t,h){return void 0!==h?this.multiplyMatrices(t,h):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,h){var p=t.elements,x=h.elements,M=this.elements,k=p[0],I=p[4],N=p[8],V=p[12],ee=p[1],te=p[5],re=p[9],ne=p[13],ie=p[2],ae=p[6],oe=p[10],se=p[14],ce=p[3],ue=p[7],le=p[11],he=p[15],fe=x[0],de=x[4],pe=x[8],me=x[12],ge=x[1],ve=x[5],ye=x[9],be=x[13],xe=x[2],Me=x[6],we=x[10],_e=x[14],Ce=x[3],Se=x[7],Te=x[11],Ae=x[15];return M[0]=k*fe+I*ge+N*xe+V*Ce,M[4]=k*de+I*ve+N*Me+V*Se,M[8]=k*pe+I*ye+N*we+V*Te,M[12]=k*me+I*be+N*_e+V*Ae,M[1]=ee*fe+te*ge+re*xe+ne*Ce,M[5]=ee*de+te*ve+re*Me+ne*Se,M[9]=ee*pe+te*ye+re*we+ne*Te,M[13]=ee*me+te*be+re*_e+ne*Ae,M[2]=ie*fe+ae*ge+oe*xe+se*Ce,M[6]=ie*de+ae*ve+oe*Me+se*Se,M[10]=ie*pe+ae*ye+oe*we+se*Te,M[14]=ie*me+ae*be+oe*_e+se*Ae,M[3]=ce*fe+ue*ge+le*xe+he*Ce,M[7]=ce*de+ue*ve+le*Me+he*Se,M[11]=ce*pe+ue*ye+le*we+he*Te,M[15]=ce*me+ue*be+le*_e+he*Ae,this},multiplyScalar:function(t){var h=this.elements;return h[0]*=t,h[4]*=t,h[8]*=t,h[12]*=t,h[1]*=t,h[5]*=t,h[9]*=t,h[13]*=t,h[2]*=t,h[6]*=t,h[10]*=t,h[14]*=t,h[3]*=t,h[7]*=t,h[11]*=t,h[15]*=t,this},determinant:function(){var t=this.elements,h=t[0],p=t[4],x=t[8],M=t[12],k=t[1],I=t[5],N=t[9],V=t[13],ee=t[2],te=t[6],re=t[10],ne=t[14];return t[3]*(+M*N*te-x*V*te-M*I*re+p*V*re+x*I*ne-p*N*ne)+t[7]*(+h*N*ne-h*V*re+M*k*re-x*k*ne+x*V*ee-M*N*ee)+t[11]*(+h*V*te-h*I*ne-M*k*te+p*k*ne+M*I*ee-p*V*ee)+t[15]*(-x*I*ee-h*N*te+h*I*re+x*k*te-p*k*re+p*N*ee)},transpose:function(){var t,h=this.elements;return t=h[1],h[1]=h[4],h[4]=t,t=h[2],h[2]=h[8],h[8]=t,t=h[6],h[6]=h[9],h[9]=t,t=h[3],h[3]=h[12],h[12]=t,t=h[7],h[7]=h[13],h[13]=t,t=h[11],h[11]=h[14],h[14]=t,this},setPosition:function(t,h,p){var x=this.elements;return t.isVector3?(x[12]=t.x,x[13]=t.y,x[14]=t.z):(x[12]=t,x[13]=h,x[14]=p),this},getInverse:function(t,h){var p=this.elements,x=t.elements,M=x[0],k=x[1],I=x[2],N=x[3],V=x[4],ee=x[5],te=x[6],re=x[7],ne=x[8],ie=x[9],ae=x[10],oe=x[11],se=x[12],ce=x[13],ue=x[14],le=x[15],he=ie*ue*re-ce*ae*re+ce*te*oe-ee*ue*oe-ie*te*le+ee*ae*le,fe=se*ae*re-ne*ue*re-se*te*oe+V*ue*oe+ne*te*le-V*ae*le,de=ne*ce*re-se*ie*re+se*ee*oe-V*ce*oe-ne*ee*le+V*ie*le,pe=se*ie*te-ne*ce*te-se*ee*ae+V*ce*ae+ne*ee*ue-V*ie*ue,me=M*he+k*fe+I*de+N*pe;if(0===me){if(!0===h)throw new Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var ge=1/me;return p[0]=he*ge,p[1]=(ce*ae*N-ie*ue*N-ce*I*oe+k*ue*oe+ie*I*le-k*ae*le)*ge,p[2]=(ee*ue*N-ce*te*N+ce*I*re-k*ue*re-ee*I*le+k*te*le)*ge,p[3]=(ie*te*N-ee*ae*N-ie*I*re+k*ae*re+ee*I*oe-k*te*oe)*ge,p[4]=fe*ge,p[5]=(ne*ue*N-se*ae*N+se*I*oe-M*ue*oe-ne*I*le+M*ae*le)*ge,p[6]=(se*te*N-V*ue*N-se*I*re+M*ue*re+V*I*le-M*te*le)*ge,p[7]=(V*ae*N-ne*te*N+ne*I*re-M*ae*re-V*I*oe+M*te*oe)*ge,p[8]=de*ge,p[9]=(se*ie*N-ne*ce*N-se*k*oe+M*ce*oe+ne*k*le-M*ie*le)*ge,p[10]=(V*ce*N-se*ee*N+se*k*re-M*ce*re-V*k*le+M*ee*le)*ge,p[11]=(ne*ee*N-V*ie*N-ne*k*re+M*ie*re+V*k*oe-M*ee*oe)*ge,p[12]=pe*ge,p[13]=(ne*ce*I-se*ie*I+se*k*ae-M*ce*ae-ne*k*ue+M*ie*ue)*ge,p[14]=(se*ee*I-V*ce*I-se*k*te+M*ce*te+V*k*ue-M*ee*ue)*ge,p[15]=(V*ie*I-ne*ee*I+ne*k*te-M*ie*te-V*k*ae+M*ee*ae)*ge,this},scale:function(t){var h=this.elements,p=t.x,x=t.y,M=t.z;return h[0]*=p,h[4]*=x,h[8]*=M,h[1]*=p,h[5]*=x,h[9]*=M,h[2]*=p,h[6]*=x,h[10]*=M,h[3]*=p,h[7]*=x,h[11]*=M,this},getMaxScaleOnAxis:function(){var t=this.elements,h=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],p=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],x=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(h,p,x))},makeTranslation:function(t,h,p){return this.set(1,0,0,t,0,1,0,h,0,0,1,p,0,0,0,1),this},makeRotationX:function(t){var h=Math.cos(t),p=Math.sin(t);return this.set(1,0,0,0,0,h,-p,0,0,p,h,0,0,0,0,1),this},makeRotationY:function(t){var h=Math.cos(t),p=Math.sin(t);return this.set(h,0,p,0,0,1,0,0,-p,0,h,0,0,0,0,1),this},makeRotationZ:function(t){var h=Math.cos(t),p=Math.sin(t);return this.set(h,-p,0,0,p,h,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,h){var p=Math.cos(h),x=Math.sin(h),M=1-p,k=t.x,I=t.y,N=t.z,V=M*k,ee=M*I;return this.set(V*k+p,V*I-x*N,V*N+x*I,0,V*I+x*N,ee*I+p,ee*N-x*k,0,V*N-x*I,ee*N+x*k,M*N*N+p,0,0,0,0,1),this},makeScale:function(t,h,p){return this.set(t,0,0,0,0,h,0,0,0,0,p,0,0,0,0,1),this},makeShear:function(t,h,p){return this.set(1,h,p,0,t,1,p,0,t,h,1,0,0,0,0,1),this},compose:function(t,h,p){var x=this.elements,M=h._x,k=h._y,I=h._z,N=h._w,V=M+M,ee=k+k,te=I+I,re=M*V,ne=M*ee,ie=M*te,ae=k*ee,oe=k*te,se=I*te,ce=N*V,ue=N*ee,le=N*te,he=p.x,fe=p.y,de=p.z;return x[0]=(1-(ae+se))*he,x[1]=(ne+le)*he,x[2]=(ie-ue)*he,x[3]=0,x[4]=(ne-le)*fe,x[5]=(1-(re+se))*fe,x[6]=(oe+ce)*fe,x[7]=0,x[8]=(ie+ue)*de,x[9]=(oe-ce)*de,x[10]=(1-(re+ae))*de,x[11]=0,x[12]=t.x,x[13]=t.y,x[14]=t.z,x[15]=1,this},decompose:function(t,h,p){var x=this.elements,M=Mc.set(x[0],x[1],x[2]).length(),k=Mc.set(x[4],x[5],x[6]).length(),I=Mc.set(x[8],x[9],x[10]).length();this.determinant()<0&&(M=-M),t.x=x[12],t.y=x[13],t.z=x[14],wc.copy(this);var N=1/M,V=1/k,ee=1/I;return wc.elements[0]*=N,wc.elements[1]*=N,wc.elements[2]*=N,wc.elements[4]*=V,wc.elements[5]*=V,wc.elements[6]*=V,wc.elements[8]*=ee,wc.elements[9]*=ee,wc.elements[10]*=ee,h.setFromRotationMatrix(wc),p.x=M,p.y=k,p.z=I,this},makePerspective:function(t,h,p,x,M,k){var I=this.elements,N=2*M/(h-t),V=2*M/(p-x),ee=(h+t)/(h-t),te=(p+x)/(p-x),re=-(k+M)/(k-M),ne=-2*k*M/(k-M);return I[0]=N,I[4]=0,I[8]=ee,I[12]=0,I[1]=0,I[5]=V,I[9]=te,I[13]=0,I[2]=0,I[6]=0,I[10]=re,I[14]=ne,I[3]=0,I[7]=0,I[11]=-1,I[15]=0,this},makeOrthographic:function(t,h,p,x,M,k){var I=this.elements,N=1/(h-t),V=1/(p-x),ee=1/(k-M),te=(h+t)*N,re=(p+x)*V,ne=(k+M)*ee;return I[0]=2*N,I[4]=0,I[8]=0,I[12]=-te,I[1]=0,I[5]=2*V,I[9]=0,I[13]=-re,I[2]=0,I[6]=0,I[10]=-2*ee,I[14]=-ne,I[3]=0,I[7]=0,I[11]=0,I[15]=1,this},equals:function(t){for(var h=this.elements,p=t.elements,x=0;x<16;x++)if(h[x]!==p[x])return!1;return!0},fromArray:function(t,h){void 0===h&&(h=0);for(var p=0;p<16;p++)this.elements[p]=t[p+h];return this},toArray:function(t,h){void 0===t&&(t=[]),void 0===h&&(h=0);var p=this.elements;return t[h]=p[0],t[h+1]=p[1],t[h+2]=p[2],t[h+3]=p[3],t[h+4]=p[4],t[h+5]=p[5],t[h+6]=p[6],t[h+7]=p[7],t[h+8]=p[8],t[h+9]=p[9],t[h+10]=p[10],t[h+11]=p[11],t[h+12]=p[12],t[h+13]=p[13],t[h+14]=p[14],t[h+15]=p[15],t}});var Dc=new Matrix4,kc=new Quaternion;function Euler(t,h,p,x){this._x=t||0,this._y=h||0,this._z=p||0,this._order=x||Euler.DefaultOrder}function Layers(){this.mask=1}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(t,h,p,x){return this._x=t,this._y=h,this._z=p,this._order=x||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,h,p){var x=gc.clamp,M=t.elements,k=M[0],I=M[4],N=M[8],V=M[1],ee=M[5],te=M[9],re=M[2],ne=M[6],ie=M[10];return"XYZ"===(h=h||this._order)?(this._y=Math.asin(x(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(-te,ie),this._z=Math.atan2(-I,k)):(this._x=Math.atan2(ne,ee),this._z=0)):"YXZ"===h?(this._x=Math.asin(-x(te,-1,1)),Math.abs(te)<.9999999?(this._y=Math.atan2(N,ie),this._z=Math.atan2(V,ee)):(this._y=Math.atan2(-re,k),this._z=0)):"ZXY"===h?(this._x=Math.asin(x(ne,-1,1)),Math.abs(ne)<.9999999?(this._y=Math.atan2(-re,ie),this._z=Math.atan2(-I,ee)):(this._y=0,this._z=Math.atan2(V,k))):"ZYX"===h?(this._y=Math.asin(-x(re,-1,1)),Math.abs(re)<.9999999?(this._x=Math.atan2(ne,ie),this._z=Math.atan2(V,k)):(this._x=0,this._z=Math.atan2(-I,ee))):"YZX"===h?(this._z=Math.asin(x(V,-1,1)),Math.abs(V)<.9999999?(this._x=Math.atan2(-te,ee),this._y=Math.atan2(-re,k)):(this._x=0,this._y=Math.atan2(N,ie))):"XZY"===h&&(this._z=Math.asin(-x(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(ne,ee),this._y=Math.atan2(N,k)):(this._x=Math.atan2(-te,ie),this._y=0)),this._order=h,!1!==p&&this._onChangeCallback(),this},setFromQuaternion:function(t,h,p){return Dc.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Dc,h,p)},setFromVector3:function(t,h){return this.set(t.x,t.y,t.z,h||this._order)},reorder:function(t){return kc.setFromEuler(this),this.setFromQuaternion(kc,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this._x,t[h+1]=this._y,t[h+2]=this._z,t[h+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});var Pc=0,Ec=new Vector3,Ic=new Quaternion,Bc=new Matrix4,Oc=new Vector3,Rc=new Vector3,Fc=new Vector3,Nc=new Quaternion,Vc=new Vector3(1,0,0),Gc=new Vector3(0,1,0),jc=new Vector3(0,0,1),Uc={type:"added"},zc={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:Pc++}),this.uuid=gc.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var t=new Vector3,h=new Euler,p=new Quaternion,x=new Vector3(1,1,1);h._onChange((function onRotationChange(){p.setFromEuler(h,!1)})),p._onChange((function onQuaternionChange(){h.setFromQuaternion(p,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:h},quaternion:{configurable:!0,enumerable:!0,value:p},scale:{configurable:!0,enumerable:!0,value:x},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,h){this.quaternion.setFromAxisAngle(t,h)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,h){return Ic.setFromAxisAngle(t,h),this.quaternion.multiply(Ic),this},rotateOnWorldAxis:function(t,h){return Ic.setFromAxisAngle(t,h),this.quaternion.premultiply(Ic),this},rotateX:function(t){return this.rotateOnAxis(Vc,t)},rotateY:function(t){return this.rotateOnAxis(Gc,t)},rotateZ:function(t){return this.rotateOnAxis(jc,t)},translateOnAxis:function(t,h){return Ec.copy(t).applyQuaternion(this.quaternion),this.position.add(Ec.multiplyScalar(h)),this},translateX:function(t){return this.translateOnAxis(Vc,t)},translateY:function(t){return this.translateOnAxis(Gc,t)},translateZ:function(t){return this.translateOnAxis(jc,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Bc.getInverse(this.matrixWorld))},lookAt:function(t,h,p){t.isVector3?Oc.copy(t):Oc.set(t,h,p);var x=this.parent;this.updateWorldMatrix(!0,!1),Rc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bc.lookAt(Rc,Oc,this.up):Bc.lookAt(Oc,Rc,this.up),this.quaternion.setFromRotationMatrix(Bc),x&&(Bc.extractRotation(x.matrixWorld),Ic.setFromRotationMatrix(Bc),this.quaternion.premultiply(Ic.inverse()))},add:function(t){if(arguments.length>1){for(var h=0;h<arguments.length;h++)this.add(arguments[h]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Uc)),this},remove:function(t){if(arguments.length>1){for(var h=0;h<arguments.length;h++)this.remove(arguments[h]);return this}var p=this.children.indexOf(t);return-1!==p&&(t.parent=null,this.children.splice(p,1),t.dispatchEvent(zc)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),Bc.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Bc.multiply(t.parent.matrixWorld)),t.applyMatrix4(Bc),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,h){if(this[t]===h)return this;for(var p=0,x=this.children.length;p<x;p++){var M=this.children[p].getObjectByProperty(t,h);if(void 0!==M)return M}},getWorldPosition:function(t){return void 0===t&&(t=new Vector3),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(t=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Rc,t,Fc),t},getWorldScale:function(t){return void 0===t&&(t=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(Rc,Nc,t),t},getWorldDirection:function(t){void 0===t&&(t=new Vector3),this.updateMatrixWorld(!0);var h=this.matrixWorld.elements;return t.set(h[8],h[9],h[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var h=this.children,p=0,x=h.length;p<x;p++)h[p].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var h=this.children,p=0,x=h.length;p<x;p++)h[p].traverseVisible(t)}},traverseAncestors:function(t){var h=this.parent;null!==h&&(t(h),h.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var h=this.children,p=0,x=h.length;p<x;p++)h[p].updateMatrixWorld(t)},updateWorldMatrix:function(t,h){var p=this.parent;if(!0===t&&null!==p&&p.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===h)for(var x=this.children,M=0,k=x.length;M<k;M++)x[M].updateWorldMatrix(!1,!0)},toJSON:function(t){var h=void 0===t||"string"==typeof t,p={};h&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},p.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var x={};function serialize(h,p){return void 0===h[p.uuid]&&(h[p.uuid]=p.toJSON(t)),p.uuid}if(x.uuid=this.uuid,x.type=this.type,""!==this.name&&(x.name=this.name),!0===this.castShadow&&(x.castShadow=!0),!0===this.receiveShadow&&(x.receiveShadow=!0),!1===this.visible&&(x.visible=!1),!1===this.frustumCulled&&(x.frustumCulled=!1),0!==this.renderOrder&&(x.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(x.userData=this.userData),x.layers=this.layers.mask,x.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(x.matrixAutoUpdate=!1),this.isInstancedMesh&&(x.type="InstancedMesh",x.count=this.count,x.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){x.geometry=serialize(t.geometries,this.geometry);var M=this.geometry.parameters;if(void 0!==M&&void 0!==M.shapes){var k=M.shapes;if(Array.isArray(k))for(var I=0,N=k.length;I<N;I++){var V=k[I];serialize(t.shapes,V)}else serialize(t.shapes,k)}}if(void 0!==this.material)if(Array.isArray(this.material)){var ee=[];for(I=0,N=this.material.length;I<N;I++)ee.push(serialize(t.materials,this.material[I]));x.material=ee}else x.material=serialize(t.materials,this.material);if(this.children.length>0){x.children=[];for(I=0;I<this.children.length;I++)x.children.push(this.children[I].toJSON(t).object)}if(h){var te=extractFromCache(t.geometries),re=extractFromCache(t.materials),ne=extractFromCache(t.textures),ie=extractFromCache(t.images);k=extractFromCache(t.shapes);te.length>0&&(p.geometries=te),re.length>0&&(p.materials=re),ne.length>0&&(p.textures=ne),ie.length>0&&(p.images=ie),k.length>0&&(p.shapes=k)}return p.object=x,p;function extractFromCache(t){var h=[];for(var p in t){var x=t[p];delete x.metadata,h.push(x)}return h}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,h){if(void 0===h&&(h=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===h)for(var p=0;p<t.children.length;p++){var x=t.children[p];this.add(x.clone())}return this}}),Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:!0,copy:function(t,h){return Object3D.prototype.copy.call(this,t,h),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var h=Object3D.prototype.toJSON.call(this,t);return null!==this.background&&(h.object.background=this.background.toJSON(t)),null!==this.environment&&(h.object.environment=this.environment.toJSON(t)),null!==this.fog&&(h.object.fog=this.fog.toJSON()),h},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Wc=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],Hc=new Vector3,$c=new Box3,Xc=new Vector3,qc=new Vector3,Kc=new Vector3,Yc=new Vector3,Zc=new Vector3,Jc=new Vector3,Qc=new Vector3,eu=new Vector3,tu=new Vector3,ru=new Vector3;function Box3(t,h){this.min=void 0!==t?t:new Vector3(1/0,1/0,1/0),this.max=void 0!==h?h:new Vector3(-1/0,-1/0,-1/0)}function satForAxes(t,h,p,x,M){var k,I;for(k=0,I=t.length-3;k<=I;k+=3){ru.fromArray(t,k);var N=M.x*Math.abs(ru.x)+M.y*Math.abs(ru.y)+M.z*Math.abs(ru.z),V=h.dot(ru),ee=p.dot(ru),te=x.dot(ru);if(Math.max(-Math.max(V,ee,te),Math.min(V,ee,te))>N)return!1}return!0}Object.assign(Box3.prototype,{isBox3:!0,set:function(t,h){return this.min.copy(t),this.max.copy(h),this},setFromArray:function(t){for(var h=1/0,p=1/0,x=1/0,M=-1/0,k=-1/0,I=-1/0,N=0,V=t.length;N<V;N+=3){var ee=t[N],te=t[N+1],re=t[N+2];ee<h&&(h=ee),te<p&&(p=te),re<x&&(x=re),ee>M&&(M=ee),te>k&&(k=te),re>I&&(I=re)}return this.min.set(h,p,x),this.max.set(M,k,I),this},setFromBufferAttribute:function(t){for(var h=1/0,p=1/0,x=1/0,M=-1/0,k=-1/0,I=-1/0,N=0,V=t.count;N<V;N++){var ee=t.getX(N),te=t.getY(N),re=t.getZ(N);ee<h&&(h=ee),te<p&&(p=te),re<x&&(x=re),ee>M&&(M=ee),te>k&&(k=te),re>I&&(I=re)}return this.min.set(h,p,x),this.max.set(M,k,I),this},setFromPoints:function(t){this.makeEmpty();for(var h=0,p=t.length;h<p;h++)this.expandByPoint(t[h]);return this},setFromCenterAndSize:function(t,h){var p=Hc.copy(h).multiplyScalar(.5);return this.min.copy(t).sub(p),this.max.copy(t).add(p),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(t=new Vector3),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(t=new Vector3),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var h=t.geometry;void 0!==h&&(null===h.boundingBox&&h.computeBoundingBox(),$c.copy(h.boundingBox),$c.applyMatrix4(t.matrixWorld),this.expandByPoint($c.min),this.expandByPoint($c.max));for(var p=t.children,x=0,M=p.length;x<M;x++)this.expandByObject(p[x]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,h){return void 0===h&&(h=new Vector3),h.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Hc),Hc.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var h,p;return t.normal.x>0?(h=t.normal.x*this.min.x,p=t.normal.x*this.max.x):(h=t.normal.x*this.max.x,p=t.normal.x*this.min.x),t.normal.y>0?(h+=t.normal.y*this.min.y,p+=t.normal.y*this.max.y):(h+=t.normal.y*this.max.y,p+=t.normal.y*this.min.y),t.normal.z>0?(h+=t.normal.z*this.min.z,p+=t.normal.z*this.max.z):(h+=t.normal.z*this.max.z,p+=t.normal.z*this.min.z),h<=-t.constant&&p>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Qc),eu.subVectors(this.max,Qc),Xc.subVectors(t.a,Qc),qc.subVectors(t.b,Qc),Kc.subVectors(t.c,Qc),Yc.subVectors(qc,Xc),Zc.subVectors(Kc,qc),Jc.subVectors(Xc,Kc);var h=[0,-Yc.z,Yc.y,0,-Zc.z,Zc.y,0,-Jc.z,Jc.y,Yc.z,0,-Yc.x,Zc.z,0,-Zc.x,Jc.z,0,-Jc.x,-Yc.y,Yc.x,0,-Zc.y,Zc.x,0,-Jc.y,Jc.x,0];return!!satForAxes(h,Xc,qc,Kc,eu)&&(!!satForAxes(h=[1,0,0,0,1,0,0,0,1],Xc,qc,Kc,eu)&&(tu.crossVectors(Yc,Zc),satForAxes(h=[tu.x,tu.y,tu.z],Xc,qc,Kc,eu)))},clampPoint:function(t,h){return void 0===h&&(h=new Vector3),h.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Hc.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Hc).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(Wc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Wc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Wc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Wc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Wc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Wc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Wc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Wc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Wc)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var nu=new Box3;function Sphere(t,h){this.center=void 0!==t?t:new Vector3,this.radius=void 0!==h?h:0}Object.assign(Sphere.prototype,{set:function(t,h){return this.center.copy(t),this.radius=h,this},setFromPoints:function(t,h){var p=this.center;void 0!==h?p.copy(h):nu.setFromPoints(t).getCenter(p);for(var x=0,M=0,k=t.length;M<k;M++)x=Math.max(x,p.distanceToSquared(t[M]));return this.radius=Math.sqrt(x),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var h=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=h*h},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,h){var p=this.center.distanceToSquared(t);return void 0===h&&(h=new Vector3),h.copy(t),p>this.radius*this.radius&&(h.sub(this.center).normalize(),h.multiplyScalar(this.radius).add(this.center)),h},getBoundingBox:function(t){return void 0===t&&(t=new Box3),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var iu=new Vector3,au=new Vector3,ou=new Vector3,su=new Vector3,cu=new Vector3,uu=new Vector3,lu=new Vector3;function Ray(t,h){this.origin=void 0!==t?t:new Vector3,this.direction=void 0!==h?h:new Vector3(0,0,-1)}Object.assign(Ray.prototype,{set:function(t,h){return this.origin.copy(t),this.direction.copy(h),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,h){return void 0===h&&(h=new Vector3),h.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,iu)),this},closestPointToPoint:function(t,h){void 0===h&&(h=new Vector3),h.subVectors(t,this.origin);var p=h.dot(this.direction);return p<0?h.copy(this.origin):h.copy(this.direction).multiplyScalar(p).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var h=iu.subVectors(t,this.origin).dot(this.direction);return h<0?this.origin.distanceToSquared(t):(iu.copy(this.direction).multiplyScalar(h).add(this.origin),iu.distanceToSquared(t))},distanceSqToSegment:function(t,h,p,x){au.copy(t).add(h).multiplyScalar(.5),ou.copy(h).sub(t).normalize(),su.copy(this.origin).sub(au);var M,k,I,N,V=.5*t.distanceTo(h),ee=-this.direction.dot(ou),te=su.dot(this.direction),re=-su.dot(ou),ne=su.lengthSq(),ie=Math.abs(1-ee*ee);if(ie>0)if(k=ee*te-re,N=V*ie,(M=ee*re-te)>=0)if(k>=-N)if(k<=N){var ae=1/ie;I=(M*=ae)*(M+ee*(k*=ae)+2*te)+k*(ee*M+k+2*re)+ne}else k=V,I=-(M=Math.max(0,-(ee*k+te)))*M+k*(k+2*re)+ne;else k=-V,I=-(M=Math.max(0,-(ee*k+te)))*M+k*(k+2*re)+ne;else k<=-N?I=-(M=Math.max(0,-(-ee*V+te)))*M+(k=M>0?-V:Math.min(Math.max(-V,-re),V))*(k+2*re)+ne:k<=N?(M=0,I=(k=Math.min(Math.max(-V,-re),V))*(k+2*re)+ne):I=-(M=Math.max(0,-(ee*V+te)))*M+(k=M>0?V:Math.min(Math.max(-V,-re),V))*(k+2*re)+ne;else k=ee>0?-V:V,I=-(M=Math.max(0,-(ee*k+te)))*M+k*(k+2*re)+ne;return p&&p.copy(this.direction).multiplyScalar(M).add(this.origin),x&&x.copy(ou).multiplyScalar(k).add(au),I},intersectSphere:function(t,h){iu.subVectors(t.center,this.origin);var p=iu.dot(this.direction),x=iu.dot(iu)-p*p,M=t.radius*t.radius;if(x>M)return null;var k=Math.sqrt(M-x),I=p-k,N=p+k;return I<0&&N<0?null:I<0?this.at(N,h):this.at(I,h)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var h=t.normal.dot(this.direction);if(0===h)return 0===t.distanceToPoint(this.origin)?0:null;var p=-(this.origin.dot(t.normal)+t.constant)/h;return p>=0?p:null},intersectPlane:function(t,h){var p=this.distanceToPlane(t);return null===p?null:this.at(p,h)},intersectsPlane:function(t){var h=t.distanceToPoint(this.origin);return 0===h||t.normal.dot(this.direction)*h<0},intersectBox:function(t,h){var p,x,M,k,I,N,V=1/this.direction.x,ee=1/this.direction.y,te=1/this.direction.z,re=this.origin;return V>=0?(p=(t.min.x-re.x)*V,x=(t.max.x-re.x)*V):(p=(t.max.x-re.x)*V,x=(t.min.x-re.x)*V),ee>=0?(M=(t.min.y-re.y)*ee,k=(t.max.y-re.y)*ee):(M=(t.max.y-re.y)*ee,k=(t.min.y-re.y)*ee),p>k||M>x?null:((M>p||p!=p)&&(p=M),(k<x||x!=x)&&(x=k),te>=0?(I=(t.min.z-re.z)*te,N=(t.max.z-re.z)*te):(I=(t.max.z-re.z)*te,N=(t.min.z-re.z)*te),p>N||I>x?null:((I>p||p!=p)&&(p=I),(N<x||x!=x)&&(x=N),x<0?null:this.at(p>=0?p:x,h)))},intersectsBox:function(t){return null!==this.intersectBox(t,iu)},intersectTriangle:function(t,h,p,x,M){cu.subVectors(h,t),uu.subVectors(p,t),lu.crossVectors(cu,uu);var k,I=this.direction.dot(lu);if(I>0){if(x)return null;k=1}else{if(!(I<0))return null;k=-1,I=-I}su.subVectors(this.origin,t);var N=k*this.direction.dot(uu.crossVectors(su,uu));if(N<0)return null;var V=k*this.direction.dot(cu.cross(su));if(V<0)return null;if(N+V>I)return null;var ee=-k*su.dot(lu);return ee<0?null:this.at(ee/I,M)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var hu=new Vector3,fu=new Vector3,du=new Matrix3;function Plane(t,h){this.normal=void 0!==t?t:new Vector3(1,0,0),this.constant=void 0!==h?h:0}Object.assign(Plane.prototype,{isPlane:!0,set:function(t,h){return this.normal.copy(t),this.constant=h,this},setComponents:function(t,h,p,x){return this.normal.set(t,h,p),this.constant=x,this},setFromNormalAndCoplanarPoint:function(t,h){return this.normal.copy(t),this.constant=-h.dot(this.normal),this},setFromCoplanarPoints:function(t,h,p){var x=hu.subVectors(p,h).cross(fu.subVectors(t,h)).normalize();return this.setFromNormalAndCoplanarPoint(x,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,h){return void 0===h&&(h=new Vector3),h.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,h){void 0===h&&(h=new Vector3);var p=t.delta(hu),x=this.normal.dot(p);if(0===x)return 0===this.distanceToPoint(t.start)?h.copy(t.start):void 0;var M=-(t.start.dot(this.normal)+this.constant)/x;return M<0||M>1?void 0:h.copy(p).multiplyScalar(M).add(t.start)},intersectsLine:function(t){var h=this.distanceToPoint(t.start),p=this.distanceToPoint(t.end);return h<0&&p>0||p<0&&h>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(t=new Vector3),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,h){var p=h||du.getNormalMatrix(t),x=this.coplanarPoint(hu).applyMatrix4(t),M=this.normal.applyMatrix3(p).normalize();return this.constant=-x.dot(M),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var pu=new Vector3,mu=new Vector3,gu=new Vector3,vu=new Vector3,yu=new Vector3,bu=new Vector3,xu=new Vector3,Mu=new Vector3,wu=new Vector3,_u=new Vector3;function Triangle(t,h,p){this.a=void 0!==t?t:new Vector3,this.b=void 0!==h?h:new Vector3,this.c=void 0!==p?p:new Vector3}Object.assign(Triangle,{getNormal:function(t,h,p,x){void 0===x&&(x=new Vector3),x.subVectors(p,h),pu.subVectors(t,h),x.cross(pu);var M=x.lengthSq();return M>0?x.multiplyScalar(1/Math.sqrt(M)):x.set(0,0,0)},getBarycoord:function(t,h,p,x,M){pu.subVectors(x,h),mu.subVectors(p,h),gu.subVectors(t,h);var k=pu.dot(pu),I=pu.dot(mu),N=pu.dot(gu),V=mu.dot(mu),ee=mu.dot(gu),te=k*V-I*I;if(void 0===M&&(M=new Vector3),0===te)return M.set(-2,-1,-1);var re=1/te,ne=(V*N-I*ee)*re,ie=(k*ee-I*N)*re;return M.set(1-ne-ie,ie,ne)},containsPoint:function(t,h,p,x){return Triangle.getBarycoord(t,h,p,x,vu),vu.x>=0&&vu.y>=0&&vu.x+vu.y<=1},getUV:function(t,h,p,x,M,k,I,N){return this.getBarycoord(t,h,p,x,vu),N.set(0,0),N.addScaledVector(M,vu.x),N.addScaledVector(k,vu.y),N.addScaledVector(I,vu.z),N},isFrontFacing:function(t,h,p,x){return pu.subVectors(p,h),mu.subVectors(t,h),pu.cross(mu).dot(x)<0}}),Object.assign(Triangle.prototype,{set:function(t,h,p){return this.a.copy(t),this.b.copy(h),this.c.copy(p),this},setFromPointsAndIndices:function(t,h,p,x){return this.a.copy(t[h]),this.b.copy(t[p]),this.c.copy(t[x]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return pu.subVectors(this.c,this.b),mu.subVectors(this.a,this.b),.5*pu.cross(mu).length()},getMidpoint:function(t){return void 0===t&&(t=new Vector3),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Triangle.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,h){return Triangle.getBarycoord(t,this.a,this.b,this.c,h)},getUV:function(t,h,p,x,M){return Triangle.getUV(t,this.a,this.b,this.c,h,p,x,M)},containsPoint:function(t){return Triangle.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,h){void 0===h&&(h=new Vector3);var p,x,M=this.a,k=this.b,I=this.c;yu.subVectors(k,M),bu.subVectors(I,M),Mu.subVectors(t,M);var N=yu.dot(Mu),V=bu.dot(Mu);if(N<=0&&V<=0)return h.copy(M);wu.subVectors(t,k);var ee=yu.dot(wu),te=bu.dot(wu);if(ee>=0&&te<=ee)return h.copy(k);var re=N*te-ee*V;if(re<=0&&N>=0&&ee<=0)return p=N/(N-ee),h.copy(M).addScaledVector(yu,p);_u.subVectors(t,I);var ne=yu.dot(_u),ie=bu.dot(_u);if(ie>=0&&ne<=ie)return h.copy(I);var ae=ne*V-N*ie;if(ae<=0&&V>=0&&ie<=0)return x=V/(V-ie),h.copy(M).addScaledVector(bu,x);var oe=ee*ie-ne*te;if(oe<=0&&te-ee>=0&&ne-ie>=0)return xu.subVectors(I,k),x=(te-ee)/(te-ee+(ne-ie)),h.copy(k).addScaledVector(xu,x);var se=1/(oe+ae+re);return p=ae*se,x=re*se,h.copy(M).addScaledVector(yu,p).addScaledVector(bu,x)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var Cu={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Su={h:0,s:0,l:0},Tu={h:0,s:0,l:0};function Color(t,h,p){return void 0===h&&void 0===p?this.set(t):this.setRGB(t,h,p)}function hue2rgb(t,h,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?t+6*(h-t)*p:p<.5?h:p<2/3?t+6*(h-t)*(2/3-p):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Face3(t,h,p,x,M,k){this.a=t,this.b=h,this.c=p,this.normal=x&&x.isVector3?x:new Vector3,this.vertexNormals=Array.isArray(x)?x:[],this.color=M&&M.isColor?M:new Color,this.vertexColors=Array.isArray(M)?M:[],this.materialIndex=void 0!==k?k:0}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,h,p){return this.r=t,this.g=h,this.b=p,this},setHSL:function(t,h,p){if(t=gc.euclideanModulo(t,1),h=gc.clamp(h,0,1),p=gc.clamp(p,0,1),0===h)this.r=this.g=this.b=p;else{var x=p<=.5?p*(1+h):p+h-p*h,M=2*p-x;this.r=hue2rgb(M,x,t+1/3),this.g=hue2rgb(M,x,t),this.b=hue2rgb(M,x,t-1/3)}return this},setStyle:function(t){function handleAlpha(t){void 0!==t&&parseFloat(t)}var h;if(h=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var p,x=h[1],M=h[2];switch(x){case"rgb":case"rgba":if(p=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(M))return this.r=Math.min(255,parseInt(p[1],10))/255,this.g=Math.min(255,parseInt(p[2],10))/255,this.b=Math.min(255,parseInt(p[3],10))/255,handleAlpha(p[5]),this;if(p=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(M))return this.r=Math.min(100,parseInt(p[1],10))/100,this.g=Math.min(100,parseInt(p[2],10))/100,this.b=Math.min(100,parseInt(p[3],10))/100,handleAlpha(p[5]),this;break;case"hsl":case"hsla":if(p=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(M)){var k=parseFloat(p[1])/360,I=parseInt(p[2],10)/100,N=parseInt(p[3],10)/100;return handleAlpha(p[5]),this.setHSL(k,I,N)}}}else if(h=/^\#([A-Fa-f0-9]+)$/.exec(t)){var V=h[1],ee=V.length;if(3===ee)return this.r=parseInt(V.charAt(0)+V.charAt(0),16)/255,this.g=parseInt(V.charAt(1)+V.charAt(1),16)/255,this.b=parseInt(V.charAt(2)+V.charAt(2),16)/255,this;if(6===ee)return this.r=parseInt(V.charAt(0)+V.charAt(1),16)/255,this.g=parseInt(V.charAt(2)+V.charAt(3),16)/255,this.b=parseInt(V.charAt(4)+V.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var h=Cu[t];return void 0!==h&&this.setHex(h),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,h){return void 0===h&&(h=2),this.r=Math.pow(t.r,h),this.g=Math.pow(t.g,h),this.b=Math.pow(t.b,h),this},copyLinearToGamma:function(t,h){void 0===h&&(h=2);var p=h>0?1/h:1;return this.r=Math.pow(t.r,p),this.g=Math.pow(t.g,p),this.b=Math.pow(t.b,p),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this},copyLinearToSRGB:function(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(t={h:0,s:0,l:0});var h,p,x=this.r,M=this.g,k=this.b,I=Math.max(x,M,k),N=Math.min(x,M,k),V=(N+I)/2;if(N===I)h=0,p=0;else{var ee=I-N;switch(p=V<=.5?ee/(I+N):ee/(2-I-N),I){case x:h=(M-k)/ee+(M<k?6:0);break;case M:h=(k-x)/ee+2;break;case k:h=(x-M)/ee+4}h/=6}return t.h=h,t.s=p,t.l=V,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,h,p){return this.getHSL(Su),Su.h+=t,Su.s+=h,Su.l+=p,this.setHSL(Su.h,Su.s,Su.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,h){return this.r=t.r+h.r,this.g=t.g+h.g,this.b=t.b+h.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,h){return this.r+=(t.r-this.r)*h,this.g+=(t.g-this.g)*h,this.b+=(t.b-this.b)*h,this},lerpHSL:function(t,h){this.getHSL(Su),t.getHSL(Tu);var p=gc.lerp(Su.h,Tu.h,h),x=gc.lerp(Su.s,Tu.s,h),M=gc.lerp(Su.l,Tu.l,h);return this.setHSL(p,x,M),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,h){return void 0===h&&(h=0),this.r=t[h],this.g=t[h+1],this.b=t[h+2],this},toArray:function(t,h){return void 0===t&&(t=[]),void 0===h&&(h=0),t[h]=this.r,t[h+1]=this.g,t[h+2]=this.b,t},toJSON:function(){return this.getHex()}}),Color.NAMES=Cu,Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var h=0,p=t.vertexNormals.length;h<p;h++)this.vertexNormals[h]=t.vertexNormals[h].clone();for(h=0,p=t.vertexColors.length;h<p;h++)this.vertexColors[h]=t.vertexColors[h].clone();return this}});var Au=0;function Material(){Object.defineProperty(this,"id",{value:Au++}),this.uuid=gc.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=za,this.side=Na,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=ja,this.opacity=1,this.transparent=!1,this.blendSrc=io,this.blendDst=ao,this.blendEquation=Ka,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=mo,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=uc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=cc,this.stencilZFail=cc,this.stencilZPass=cc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(t){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var h in t){var p=t[h];if(void 0!==p)if("shading"!==h){var x=this[h];void 0!==x&&(x&&x.isColor?x.set(p):x&&x.isVector3&&p&&p.isVector3?x.copy(p):this[h]=p)}else this.flatShading=1===p}},toJSON:function(t){var h=void 0===t||"string"==typeof t;h&&(t={textures:{},images:{}});var p={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(t){var h=[];for(var p in t){var x=t[p];delete x.metadata,h.push(x)}return h}if(p.uuid=this.uuid,p.type=this.type,""!==this.name&&(p.name=this.name),this.color&&this.color.isColor&&(p.color=this.color.getHex()),void 0!==this.roughness&&(p.roughness=this.roughness),void 0!==this.metalness&&(p.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(p.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(p.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(p.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(p.specular=this.specular.getHex()),void 0!==this.shininess&&(p.shininess=this.shininess),void 0!==this.clearcoat&&(p.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(p.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(p.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,p.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(p.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(p.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(p.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(p.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(p.aoMap=this.aoMap.toJSON(t).uuid,p.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(p.bumpMap=this.bumpMap.toJSON(t).uuid,p.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(p.normalMap=this.normalMap.toJSON(t).uuid,p.normalMapType=this.normalMapType,p.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(p.displacementMap=this.displacementMap.toJSON(t).uuid,p.displacementScale=this.displacementScale,p.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(p.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(p.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(p.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(p.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(p.envMap=this.envMap.toJSON(t).uuid,p.reflectivity=this.reflectivity,p.refractionRatio=this.refractionRatio,void 0!==this.combine&&(p.combine=this.combine),void 0!==this.envMapIntensity&&(p.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(p.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(p.size=this.size),void 0!==this.sizeAttenuation&&(p.sizeAttenuation=this.sizeAttenuation),this.blending!==za&&(p.blending=this.blending),!0===this.flatShading&&(p.flatShading=this.flatShading),this.side!==Na&&(p.side=this.side),this.vertexColors!==ja&&(p.vertexColors=this.vertexColors),this.opacity<1&&(p.opacity=this.opacity),!0===this.transparent&&(p.transparent=this.transparent),p.depthFunc=this.depthFunc,p.depthTest=this.depthTest,p.depthWrite=this.depthWrite,p.stencilWrite=this.stencilWrite,p.stencilWriteMask=this.stencilWriteMask,p.stencilFunc=this.stencilFunc,p.stencilRef=this.stencilRef,p.stencilFuncMask=this.stencilFuncMask,p.stencilFail=this.stencilFail,p.stencilZFail=this.stencilZFail,p.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(p.rotation=this.rotation),!0===this.polygonOffset&&(p.polygonOffset=!0),0!==this.polygonOffsetFactor&&(p.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(p.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(p.linewidth=this.linewidth),void 0!==this.dashSize&&(p.dashSize=this.dashSize),void 0!==this.gapSize&&(p.gapSize=this.gapSize),void 0!==this.scale&&(p.scale=this.scale),!0===this.dithering&&(p.dithering=!0),this.alphaTest>0&&(p.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(p.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(p.wireframe=this.wireframe),this.wireframeLinewidth>1&&(p.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(p.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(p.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(p.morphTargets=!0),!0===this.morphNormals&&(p.morphNormals=!0),!0===this.skinning&&(p.skinning=!0),!1===this.visible&&(p.visible=!1),!1===this.toneMapped&&(p.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(p.userData=this.userData),h){var x=extractFromCache(t.textures),M=extractFromCache(t.images);x.length>0&&(p.textures=x),M.length>0&&(p.images=M)}return p},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var h=t.clippingPlanes,p=null;if(null!==h){var x=h.length;p=new Array(x);for(var M=0;M!==x;++M)p[M]=h[M].clone()}return this.clippingPlanes=p,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var Du=new Vector3;function BufferAttribute(t,h,p){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=h,this.count=void 0!==t?t.length/h:0,this.normalized=!0===p,this.usage=lc,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(t,h,p){BufferAttribute.call(this,new Int8Array(t),h,p)}function Uint8BufferAttribute(t,h,p){BufferAttribute.call(this,new Uint8Array(t),h,p)}function Uint8ClampedBufferAttribute(t,h,p){BufferAttribute.call(this,new Uint8ClampedArray(t),h,p)}function Int16BufferAttribute(t,h,p){BufferAttribute.call(this,new Int16Array(t),h,p)}function Uint16BufferAttribute(t,h,p){BufferAttribute.call(this,new Uint16Array(t),h,p)}function Int32BufferAttribute(t,h,p){BufferAttribute.call(this,new Int32Array(t),h,p)}function Uint32BufferAttribute(t,h,p){BufferAttribute.call(this,new Uint32Array(t),h,p)}function Float32BufferAttribute(t,h,p){BufferAttribute.call(this,new Float32Array(t),h,p)}function Float64BufferAttribute(t,h,p){BufferAttribute.call(this,new Float64Array(t),h,p)}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMax(t){if(0===t.length)return-1/0;for(var h=t[0],p=1,x=t.length;p<x;++p)t[p]>h&&(h=t[p]);return h}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,h,p){t*=this.itemSize,p*=h.itemSize;for(var x=0,M=this.itemSize;x<M;x++)this.array[t+x]=h.array[p+x];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var h=this.array,p=0,x=0,M=t.length;x<M;x++){var k=t[x];void 0===k&&(k=new Color),h[p++]=k.r,h[p++]=k.g,h[p++]=k.b}return this},copyVector2sArray:function(t){for(var h=this.array,p=0,x=0,M=t.length;x<M;x++){var k=t[x];void 0===k&&(k=new Vector2),h[p++]=k.x,h[p++]=k.y}return this},copyVector3sArray:function(t){for(var h=this.array,p=0,x=0,M=t.length;x<M;x++){var k=t[x];void 0===k&&(k=new Vector3),h[p++]=k.x,h[p++]=k.y,h[p++]=k.z}return this},copyVector4sArray:function(t){for(var h=this.array,p=0,x=0,M=t.length;x<M;x++){var k=t[x];void 0===k&&(k=new Vector4),h[p++]=k.x,h[p++]=k.y,h[p++]=k.z,h[p++]=k.w}return this},applyMatrix3:function(t){for(var h=0,p=this.count;h<p;h++)Du.x=this.getX(h),Du.y=this.getY(h),Du.z=this.getZ(h),Du.applyMatrix3(t),this.setXYZ(h,Du.x,Du.y,Du.z);return this},applyMatrix4:function(t){for(var h=0,p=this.count;h<p;h++)Du.x=this.getX(h),Du.y=this.getY(h),Du.z=this.getZ(h),Du.applyMatrix4(t),this.setXYZ(h,Du.x,Du.y,Du.z);return this},applyNormalMatrix:function(t){for(var h=0,p=this.count;h<p;h++)Du.x=this.getX(h),Du.y=this.getY(h),Du.z=this.getZ(h),Du.applyNormalMatrix(t),this.setXYZ(h,Du.x,Du.y,Du.z);return this},transformDirection:function(t){for(var h=0,p=this.count;h<p;h++)Du.x=this.getX(h),Du.y=this.getY(h),Du.z=this.getZ(h),Du.transformDirection(t),this.setXYZ(h,Du.x,Du.y,Du.z);return this},set:function(t,h){return void 0===h&&(h=0),this.array.set(t,h),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,h){return this.array[t*this.itemSize]=h,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,h){return this.array[t*this.itemSize+1]=h,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,h){return this.array[t*this.itemSize+2]=h,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,h){return this.array[t*this.itemSize+3]=h,this},setXY:function(t,h,p){return t*=this.itemSize,this.array[t+0]=h,this.array[t+1]=p,this},setXYZ:function(t,h,p,x){return t*=this.itemSize,this.array[t+0]=h,this.array[t+1]=p,this.array[t+2]=x,this},setXYZW:function(t,h,p,x,M){return t*=this.itemSize,this.array[t+0]=h,this.array[t+1]=p,this.array[t+2]=x,this.array[t+3]=M,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(t){for(var h,p=[],x=void 0,M=t.faces,k=0;k<M.length;k++){var I=M[k];I.materialIndex!==x&&(x=I.materialIndex,void 0!==h&&(h.count=3*k-h.start,p.push(h)),h={start:3*k,materialIndex:x})}void 0!==h&&(h.count=3*k-h.start,p.push(h)),this.groups=p},fromGeometry:function(t){var h,p=t.faces,x=t.vertices,M=t.faceVertexUvs,k=M[0]&&M[0].length>0,I=M[1]&&M[1].length>0,N=t.morphTargets,V=N.length;if(V>0){h=[];for(var ee=0;ee<V;ee++)h[ee]={name:N[ee].name,data:[]};this.morphTargets.position=h}var te,re=t.morphNormals,ne=re.length;if(ne>0){te=[];for(ee=0;ee<ne;ee++)te[ee]={name:re[ee].name,data:[]};this.morphTargets.normal=te}var ie=t.skinIndices,ae=t.skinWeights,oe=ie.length===x.length,se=ae.length===x.length;x.length>0&&p.length;for(ee=0;ee<p.length;ee++){var ce=p[ee];this.vertices.push(x[ce.a],x[ce.b],x[ce.c]);var ue=ce.vertexNormals;if(3===ue.length)this.normals.push(ue[0],ue[1],ue[2]);else{var le=ce.normal;this.normals.push(le,le,le)}var he,fe=ce.vertexColors;if(3===fe.length)this.colors.push(fe[0],fe[1],fe[2]);else{var de=ce.color;this.colors.push(de,de,de)}if(!0===k)void 0!==(he=M[0][ee])?this.uvs.push(he[0],he[1],he[2]):this.uvs.push(new Vector2,new Vector2,new Vector2);if(!0===I)void 0!==(he=M[1][ee])?this.uvs2.push(he[0],he[1],he[2]):this.uvs2.push(new Vector2,new Vector2,new Vector2);for(var pe=0;pe<V;pe++){var me=N[pe].vertices;h[pe].data.push(me[ce.a],me[ce.b],me[ce.c])}for(pe=0;pe<ne;pe++){var ge=re[pe].vertexNormals[ee];te[pe].data.push(ge.a,ge.b,ge.c)}oe&&this.skinIndices.push(ie[ce.a],ie[ce.b],ie[ce.c]),se&&this.skinWeights.push(ae[ce.a],ae[ce.b],ae[ce.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var ku=1,Pu=new Matrix4,Lu=new Object3D,Eu=new Vector3,Iu=new Box3,Bu=new Box3,Ou=new Vector3;function BufferGeometry(){Object.defineProperty(this,"id",{value:ku+=2}),this.uuid=gc.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,h){return this.attributes[t]=h,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,h,p){this.groups.push({start:t,count:h,materialIndex:void 0!==p?p:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,h){this.drawRange.start=t,this.drawRange.count=h},applyMatrix4:function(t){var h=this.attributes.position;void 0!==h&&(h.applyMatrix4(t),h.needsUpdate=!0);var p=this.attributes.normal;if(void 0!==p){var x=(new Matrix3).getNormalMatrix(t);p.applyNormalMatrix(x),p.needsUpdate=!0}var M=this.attributes.tangent;return void 0!==M&&(M.transformDirection(t),M.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Pu.makeRotationX(t),this.applyMatrix4(Pu),this},rotateY:function(t){return Pu.makeRotationY(t),this.applyMatrix4(Pu),this},rotateZ:function(t){return Pu.makeRotationZ(t),this.applyMatrix4(Pu),this},translate:function(t,h,p){return Pu.makeTranslation(t,h,p),this.applyMatrix4(Pu),this},scale:function(t,h,p){return Pu.makeScale(t,h,p),this.applyMatrix4(Pu),this},lookAt:function(t){return Lu.lookAt(t),Lu.updateMatrix(),this.applyMatrix4(Lu.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Eu).negate(),this.translate(Eu.x,Eu.y,Eu.z),this},setFromObject:function(t){var h=t.geometry;if(t.isPoints||t.isLine){var p=new Float32BufferAttribute(3*h.vertices.length,3),x=new Float32BufferAttribute(3*h.colors.length,3);if(this.setAttribute("position",p.copyVector3sArray(h.vertices)),this.setAttribute("color",x.copyColorsArray(h.colors)),h.lineDistances&&h.lineDistances.length===h.vertices.length){var M=new Float32BufferAttribute(h.lineDistances.length,1);this.setAttribute("lineDistance",M.copyArray(h.lineDistances))}null!==h.boundingSphere&&(this.boundingSphere=h.boundingSphere.clone()),null!==h.boundingBox&&(this.boundingBox=h.boundingBox.clone())}else t.isMesh&&h&&h.isGeometry&&this.fromGeometry(h);return this},setFromPoints:function(t){for(var h=[],p=0,x=t.length;p<x;p++){var M=t[p];h.push(M.x,M.y,M.z||0)}return this.setAttribute("position",new Float32BufferAttribute(h,3)),this},updateFromObject:function(t){var h,p=t.geometry;if(t.isMesh){var x=p.__directGeometry;if(!0===p.elementsNeedUpdate&&(x=void 0,p.elementsNeedUpdate=!1),void 0===x)return this.fromGeometry(p);x.verticesNeedUpdate=p.verticesNeedUpdate,x.normalsNeedUpdate=p.normalsNeedUpdate,x.colorsNeedUpdate=p.colorsNeedUpdate,x.uvsNeedUpdate=p.uvsNeedUpdate,x.groupsNeedUpdate=p.groupsNeedUpdate,p.verticesNeedUpdate=!1,p.normalsNeedUpdate=!1,p.colorsNeedUpdate=!1,p.uvsNeedUpdate=!1,p.groupsNeedUpdate=!1,p=x}return!0===p.verticesNeedUpdate&&(void 0!==(h=this.attributes.position)&&(h.copyVector3sArray(p.vertices),h.needsUpdate=!0),p.verticesNeedUpdate=!1),!0===p.normalsNeedUpdate&&(void 0!==(h=this.attributes.normal)&&(h.copyVector3sArray(p.normals),h.needsUpdate=!0),p.normalsNeedUpdate=!1),!0===p.colorsNeedUpdate&&(void 0!==(h=this.attributes.color)&&(h.copyColorsArray(p.colors),h.needsUpdate=!0),p.colorsNeedUpdate=!1),p.uvsNeedUpdate&&(void 0!==(h=this.attributes.uv)&&(h.copyVector2sArray(p.uvs),h.needsUpdate=!0),p.uvsNeedUpdate=!1),p.lineDistancesNeedUpdate&&(void 0!==(h=this.attributes.lineDistance)&&(h.copyArray(p.lineDistances),h.needsUpdate=!0),p.lineDistancesNeedUpdate=!1),p.groupsNeedUpdate&&(p.computeGroups(t.geometry),this.groups=p.groups,p.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var h=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new BufferAttribute(h,3).copyVector3sArray(t.vertices)),t.normals.length>0){var p=new Float32Array(3*t.normals.length);this.setAttribute("normal",new BufferAttribute(p,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var x=new Float32Array(3*t.colors.length);this.setAttribute("color",new BufferAttribute(x,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var M=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new BufferAttribute(M,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var k=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new BufferAttribute(k,2).copyVector2sArray(t.uvs2))}for(var I in this.groups=t.groups,t.morphTargets){for(var N=[],V=t.morphTargets[I],ee=0,te=V.length;ee<te;ee++){var re=V[ee],ne=new Float32BufferAttribute(3*re.data.length,3);ne.name=re.name,N.push(ne.copyVector3sArray(re.data))}this.morphAttributes[I]=N}if(t.skinIndices.length>0){var ie=new Float32BufferAttribute(4*t.skinIndices.length,4);this.setAttribute("skinIndex",ie.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var ae=new Float32BufferAttribute(4*t.skinWeights.length,4);this.setAttribute("skinWeight",ae.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var t=this.attributes.position,h=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),h)for(var p=0,x=h.length;p<x;p++){var M=h[p];Iu.setFromBufferAttribute(M),this.morphTargetsRelative?(Ou.addVectors(this.boundingBox.min,Iu.min),this.boundingBox.expandByPoint(Ou),Ou.addVectors(this.boundingBox.max,Iu.max),this.boundingBox.expandByPoint(Ou)):(this.boundingBox.expandByPoint(Iu.min),this.boundingBox.expandByPoint(Iu.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var t=this.attributes.position,h=this.morphAttributes.position;if(t){var p=this.boundingSphere.center;if(Iu.setFromBufferAttribute(t),h)for(var x=0,M=h.length;x<M;x++){var k=h[x];Bu.setFromBufferAttribute(k),this.morphTargetsRelative?(Ou.addVectors(Iu.min,Bu.min),Iu.expandByPoint(Ou),Ou.addVectors(Iu.max,Bu.max),Iu.expandByPoint(Ou)):(Iu.expandByPoint(Bu.min),Iu.expandByPoint(Bu.max))}Iu.getCenter(p);var I=0;for(x=0,M=t.count;x<M;x++)Ou.fromBufferAttribute(t,x),I=Math.max(I,p.distanceToSquared(Ou));if(h)for(x=0,M=h.length;x<M;x++){k=h[x];for(var N=this.morphTargetsRelative,V=0,ee=k.count;V<ee;V++)Ou.fromBufferAttribute(k,V),N&&(Eu.fromBufferAttribute(t,V),Ou.add(Eu)),I=Math.max(I,p.distanceToSquared(Ou))}this.boundingSphere.radius=Math.sqrt(I),isNaN(this.boundingSphere.radius)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,h=this.attributes;if(h.position){var p=h.position.array;if(void 0===h.normal)this.setAttribute("normal",new BufferAttribute(new Float32Array(p.length),3));else for(var x=h.normal.array,M=0,k=x.length;M<k;M++)x[M]=0;var I,N,V,ee=h.normal.array,te=new Vector3,re=new Vector3,ne=new Vector3,ie=new Vector3,ae=new Vector3;if(t){var oe=t.array;for(M=0,k=t.count;M<k;M+=3)I=3*oe[M+0],N=3*oe[M+1],V=3*oe[M+2],te.fromArray(p,I),re.fromArray(p,N),ne.fromArray(p,V),ie.subVectors(ne,re),ae.subVectors(te,re),ie.cross(ae),ee[I]+=ie.x,ee[I+1]+=ie.y,ee[I+2]+=ie.z,ee[N]+=ie.x,ee[N+1]+=ie.y,ee[N+2]+=ie.z,ee[V]+=ie.x,ee[V+1]+=ie.y,ee[V+2]+=ie.z}else for(M=0,k=p.length;M<k;M+=9)te.fromArray(p,M),re.fromArray(p,M+3),ne.fromArray(p,M+6),ie.subVectors(ne,re),ae.subVectors(te,re),ie.cross(ae),ee[M]=ie.x,ee[M+1]=ie.y,ee[M+2]=ie.z,ee[M+3]=ie.x,ee[M+4]=ie.y,ee[M+5]=ie.z,ee[M+6]=ie.x,ee[M+7]=ie.y,ee[M+8]=ie.z;this.normalizeNormals(),h.normal.needsUpdate=!0}},merge:function(t,h){if(t&&t.isBufferGeometry){void 0===h&&(h=0);var p=this.attributes;for(var x in p)if(void 0!==t.attributes[x])for(var M=p[x].array,k=t.attributes[x],I=k.array,N=k.itemSize*h,V=Math.min(I.length,M.length-N),ee=0,te=N;ee<V;ee++,te++)M[te]=I[ee];return this}},normalizeNormals:function(){for(var t=this.attributes.normal,h=0,p=t.count;h<p;h++)Ou.x=t.getX(h),Ou.y=t.getY(h),Ou.z=t.getZ(h),Ou.normalize(),t.setXYZ(h,Ou.x,Ou.y,Ou.z)},toNonIndexed:function(){function convertBufferAttribute(t,h){for(var p=t.array,x=t.itemSize,M=new p.constructor(h.length*x),k=0,I=0,N=0,V=h.length;N<V;N++){k=h[N]*x;for(var ee=0;ee<x;ee++)M[I++]=p[k++]}return new BufferAttribute(M,x)}if(null===this.index)return this;var t=new BufferGeometry,h=this.index.array,p=this.attributes;for(var x in p){var M=convertBufferAttribute(p[x],h);t.setAttribute(x,M)}var k=this.morphAttributes;for(x in k){for(var I=[],N=k[x],V=0,ee=N.length;V<ee;V++){M=convertBufferAttribute(N[V],h);I.push(M)}t.morphAttributes[x]=I}t.morphTargetsRelative=this.morphTargetsRelative;for(var te=this.groups,re=(V=0,te.length);V<re;V++){var ne=te[V];t.addGroup(ne.start,ne.count,ne.materialIndex)}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var h=this.parameters;for(var p in h)void 0!==h[p]&&(t[p]=h[p]);return t}t.data={attributes:{}};var x=this.index;null!==x&&(t.data.index={type:x.array.constructor.name,array:Array.prototype.slice.call(x.array)});var M=this.attributes;for(var p in M){var k=(ne=M[p]).toJSON();""!==ne.name&&(k.name=ne.name),t.data.attributes[p]=k}var I={},N=!1;for(var p in this.morphAttributes){for(var V=this.morphAttributes[p],ee=[],te=0,re=V.length;te<re;te++){var ne;k=(ne=V[te]).toJSON();""!==ne.name&&(k.name=ne.name),ee.push(k)}ee.length>0&&(I[p]=ee,N=!0)}N&&(t.data.morphAttributes=I,t.data.morphTargetsRelative=this.morphTargetsRelative);var ie=this.groups;ie.length>0&&(t.data.groups=JSON.parse(JSON.stringify(ie)));var ae=this.boundingSphere;return null!==ae&&(t.data.boundingSphere={center:ae.center.toArray(),radius:ae.radius}),t},clone:function(){return(new BufferGeometry).copy(this)},copy:function(t){var h,p,x;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var M=t.index;null!==M&&this.setIndex(M.clone());var k=t.attributes;for(h in k){var I=k[h];this.setAttribute(h,I.clone())}var N=t.morphAttributes;for(h in N){var V=[],ee=N[h];for(p=0,x=ee.length;p<x;p++)V.push(ee[p].clone());this.morphAttributes[h]=V}this.morphTargetsRelative=t.morphTargetsRelative;var te=t.groups;for(p=0,x=te.length;p<x;p++){var re=te[p];this.addGroup(re.start,re.count,re.materialIndex)}var ne=t.boundingBox;null!==ne&&(this.boundingBox=ne.clone());var ie=t.boundingSphere;return null!==ie&&(this.boundingSphere=ie.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ru=new Matrix4,Fu=new Ray,Nu=new Sphere,Vu=new Vector3,Gu=new Vector3,ju=new Vector3,Uu=new Vector3,zu=new Vector3,Wu=new Vector3,Hu=new Vector3,$u=new Vector3,Xu=new Vector3,qu=new Vector2,Ku=new Vector2,Yu=new Vector2,Zu=new Vector3,Ju=new Vector3;function Mesh(t,h){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==h?h:new MeshBasicMaterial,this.updateMorphTargets()}function checkIntersection(t,h,p,x,M,k,I,N){if(null===(h.side===Va?x.intersectTriangle(I,k,M,!0,N):x.intersectTriangle(M,k,I,h.side!==Ga,N)))return null;Ju.copy(N),Ju.applyMatrix4(t.matrixWorld);var V=p.ray.origin.distanceTo(Ju);return V<p.near||V>p.far?null:{distance:V,point:Ju.clone(),object:t}}function checkBufferGeometryIntersection(t,h,p,x,M,k,I,N,V,ee,te,re){Vu.fromBufferAttribute(M,ee),Gu.fromBufferAttribute(M,te),ju.fromBufferAttribute(M,re);var ne=t.morphTargetInfluences;if(h.morphTargets&&k&&ne){Hu.set(0,0,0),$u.set(0,0,0),Xu.set(0,0,0);for(var ie=0,ae=k.length;ie<ae;ie++){var oe=ne[ie],se=k[ie];0!==oe&&(Uu.fromBufferAttribute(se,ee),zu.fromBufferAttribute(se,te),Wu.fromBufferAttribute(se,re),I?(Hu.addScaledVector(Uu,oe),$u.addScaledVector(zu,oe),Xu.addScaledVector(Wu,oe)):(Hu.addScaledVector(Uu.sub(Vu),oe),$u.addScaledVector(zu.sub(Gu),oe),Xu.addScaledVector(Wu.sub(ju),oe)))}Vu.add(Hu),Gu.add($u),ju.add(Xu)}var ce=checkIntersection(t,h,p,x,Vu,Gu,ju,Zu);if(ce){N&&(qu.fromBufferAttribute(N,ee),Ku.fromBufferAttribute(N,te),Yu.fromBufferAttribute(N,re),ce.uv=Triangle.getUV(Zu,Vu,Gu,ju,qu,Ku,Yu,new Vector2)),V&&(qu.fromBufferAttribute(V,ee),Ku.fromBufferAttribute(V,te),Yu.fromBufferAttribute(V,re),ce.uv2=Triangle.getUV(Zu,Vu,Gu,ju,qu,Ku,Yu,new Vector2));var ue=new Face3(ee,te,re);Triangle.getNormal(Vu,Gu,ju,ue.normal),ce.face=ue}return ce}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,h,p,x=this.geometry;if(x.isBufferGeometry){var M=x.morphAttributes,k=Object.keys(M);if(k.length>0){var I=M[k[0]];if(void 0!==I)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,h=I.length;t<h;t++)p=I[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=t}}else{var N=x.morphTargets;void 0!==N&&N.length}},raycast:function(t,h){var p,x=this.geometry,M=this.material,k=this.matrixWorld;if(void 0!==M&&(null===x.boundingSphere&&x.computeBoundingSphere(),Nu.copy(x.boundingSphere),Nu.applyMatrix4(k),!1!==t.ray.intersectsSphere(Nu)&&(Ru.getInverse(k),Fu.copy(t.ray).applyMatrix4(Ru),null===x.boundingBox||!1!==Fu.intersectsBox(x.boundingBox))))if(x.isBufferGeometry){var I,N,V,ee,te,re,ne,ie,ae,oe=x.index,se=x.attributes.position,ce=x.morphAttributes.position,ue=x.morphTargetsRelative,le=x.attributes.uv,he=x.attributes.uv2,fe=x.groups,de=x.drawRange;if(null!==oe)if(Array.isArray(M))for(ee=0,re=fe.length;ee<re;ee++)for(ae=M[(ie=fe[ee]).materialIndex],te=Math.max(ie.start,de.start),ne=Math.min(ie.start+ie.count,de.start+de.count);te<ne;te+=3)I=oe.getX(te),N=oe.getX(te+1),V=oe.getX(te+2),(p=checkBufferGeometryIntersection(this,ae,t,Fu,se,ce,ue,le,he,I,N,V))&&(p.faceIndex=Math.floor(te/3),p.face.materialIndex=ie.materialIndex,h.push(p));else for(ee=Math.max(0,de.start),re=Math.min(oe.count,de.start+de.count);ee<re;ee+=3)I=oe.getX(ee),N=oe.getX(ee+1),V=oe.getX(ee+2),(p=checkBufferGeometryIntersection(this,M,t,Fu,se,ce,ue,le,he,I,N,V))&&(p.faceIndex=Math.floor(ee/3),h.push(p));else if(void 0!==se)if(Array.isArray(M))for(ee=0,re=fe.length;ee<re;ee++)for(ae=M[(ie=fe[ee]).materialIndex],te=Math.max(ie.start,de.start),ne=Math.min(ie.start+ie.count,de.start+de.count);te<ne;te+=3)(p=checkBufferGeometryIntersection(this,ae,t,Fu,se,ce,ue,le,he,I=te,N=te+1,V=te+2))&&(p.faceIndex=Math.floor(te/3),p.face.materialIndex=ie.materialIndex,h.push(p));else for(ee=Math.max(0,de.start),re=Math.min(se.count,de.start+de.count);ee<re;ee+=3)(p=checkBufferGeometryIntersection(this,M,t,Fu,se,ce,ue,le,he,I=ee,N=ee+1,V=ee+2))&&(p.faceIndex=Math.floor(ee/3),h.push(p))}else if(x.isGeometry){var pe,me,ge,ve,ye=Array.isArray(M),be=x.vertices,xe=x.faces,Me=x.faceVertexUvs[0];Me.length>0&&(ve=Me);for(var we=0,_e=xe.length;we<_e;we++){var Ce=xe[we],Se=ye?M[Ce.materialIndex]:M;if(void 0!==Se&&(pe=be[Ce.a],me=be[Ce.b],ge=be[Ce.c],p=checkIntersection(this,Se,t,Fu,pe,me,ge,Zu))){if(ve&&ve[we]){var Te=ve[we];qu.copy(Te[0]),Ku.copy(Te[1]),Yu.copy(Te[2]),p.uv=Triangle.getUV(Zu,pe,me,ge,qu,Ku,Yu,new Vector2)}p.face=Ce,p.faceIndex=we,h.push(p)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Qu=0,el=new Matrix4,tl=new Object3D,rl=new Vector3;function Geometry(){Object.defineProperty(this,"id",{value:Qu+=2}),this.uuid=gc.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix4:function(t){for(var h=(new Matrix3).getNormalMatrix(t),p=0,x=this.vertices.length;p<x;p++){this.vertices[p].applyMatrix4(t)}for(p=0,x=this.faces.length;p<x;p++){var M=this.faces[p];M.normal.applyMatrix3(h).normalize();for(var k=0,I=M.vertexNormals.length;k<I;k++)M.vertexNormals[k].applyMatrix3(h).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return el.makeRotationX(t),this.applyMatrix4(el),this},rotateY:function(t){return el.makeRotationY(t),this.applyMatrix4(el),this},rotateZ:function(t){return el.makeRotationZ(t),this.applyMatrix4(el),this},translate:function(t,h,p){return el.makeTranslation(t,h,p),this.applyMatrix4(el),this},scale:function(t,h,p){return el.makeScale(t,h,p),this.applyMatrix4(el),this},lookAt:function(t){return tl.lookAt(t),tl.updateMatrix(),this.applyMatrix4(tl.matrix),this},fromBufferGeometry:function(t){var h=this,p=null!==t.index?t.index.array:void 0,x=t.attributes;if(void 0===x.position)return this;var M=x.position.array,k=void 0!==x.normal?x.normal.array:void 0,I=void 0!==x.color?x.color.array:void 0,N=void 0!==x.uv?x.uv.array:void 0,V=void 0!==x.uv2?x.uv2.array:void 0;void 0!==V&&(this.faceVertexUvs[1]=[]);for(var ee=0;ee<M.length;ee+=3)h.vertices.push((new Vector3).fromArray(M,ee)),void 0!==I&&h.colors.push((new Color).fromArray(I,ee));function addFace(t,p,x,M){var ee=void 0===I?[]:[h.colors[t].clone(),h.colors[p].clone(),h.colors[x].clone()],te=new Face3(t,p,x,void 0===k?[]:[(new Vector3).fromArray(k,3*t),(new Vector3).fromArray(k,3*p),(new Vector3).fromArray(k,3*x)],ee,M);h.faces.push(te),void 0!==N&&h.faceVertexUvs[0].push([(new Vector2).fromArray(N,2*t),(new Vector2).fromArray(N,2*p),(new Vector2).fromArray(N,2*x)]),void 0!==V&&h.faceVertexUvs[1].push([(new Vector2).fromArray(V,2*t),(new Vector2).fromArray(V,2*p),(new Vector2).fromArray(V,2*x)])}var te=t.groups;if(te.length>0)for(ee=0;ee<te.length;ee++)for(var re=te[ee],ne=re.start,ie=ne,ae=ne+re.count;ie<ae;ie+=3)void 0!==p?addFace(p[ie],p[ie+1],p[ie+2],re.materialIndex):addFace(ie,ie+1,ie+2,re.materialIndex);else if(void 0!==p)for(ee=0;ee<p.length;ee+=3)addFace(p[ee],p[ee+1],p[ee+2]);else for(ee=0;ee<M.length/3;ee+=3)addFace(ee,ee+1,ee+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(rl).negate(),this.translate(rl.x,rl.y,rl.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,h=this.boundingSphere.radius,p=0===h?1:1/h,x=new Matrix4;return x.set(p,0,0,-p*t.x,0,p,0,-p*t.y,0,0,p,-p*t.z,0,0,0,1),this.applyMatrix4(x),this},computeFaceNormals:function(){for(var t=new Vector3,h=new Vector3,p=0,x=this.faces.length;p<x;p++){var M=this.faces[p],k=this.vertices[M.a],I=this.vertices[M.b],N=this.vertices[M.c];t.subVectors(N,I),h.subVectors(k,I),t.cross(h),t.normalize(),M.normal.copy(t)}},computeVertexNormals:function(t){var h,p,x,M,k,I;for(void 0===t&&(t=!0),I=new Array(this.vertices.length),h=0,p=this.vertices.length;h<p;h++)I[h]=new Vector3;if(t){var N,V,ee,te=new Vector3,re=new Vector3;for(x=0,M=this.faces.length;x<M;x++)k=this.faces[x],N=this.vertices[k.a],V=this.vertices[k.b],ee=this.vertices[k.c],te.subVectors(ee,V),re.subVectors(N,V),te.cross(re),I[k.a].add(te),I[k.b].add(te),I[k.c].add(te)}else for(this.computeFaceNormals(),x=0,M=this.faces.length;x<M;x++)I[(k=this.faces[x]).a].add(k.normal),I[k.b].add(k.normal),I[k.c].add(k.normal);for(h=0,p=this.vertices.length;h<p;h++)I[h].normalize();for(x=0,M=this.faces.length;x<M;x++){var ne=(k=this.faces[x]).vertexNormals;3===ne.length?(ne[0].copy(I[k.a]),ne[1].copy(I[k.b]),ne[2].copy(I[k.c])):(ne[0]=I[k.a].clone(),ne[1]=I[k.b].clone(),ne[2]=I[k.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,h,p;for(this.computeFaceNormals(),t=0,h=this.faces.length;t<h;t++){var x=(p=this.faces[t]).vertexNormals;3===x.length?(x[0].copy(p.normal),x[1].copy(p.normal),x[2].copy(p.normal)):(x[0]=p.normal.clone(),x[1]=p.normal.clone(),x[2]=p.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,h,p,x,M;for(p=0,x=this.faces.length;p<x;p++)for((M=this.faces[p]).__originalFaceNormal?M.__originalFaceNormal.copy(M.normal):M.__originalFaceNormal=M.normal.clone(),M.__originalVertexNormals||(M.__originalVertexNormals=[]),t=0,h=M.vertexNormals.length;t<h;t++)M.__originalVertexNormals[t]?M.__originalVertexNormals[t].copy(M.vertexNormals[t]):M.__originalVertexNormals[t]=M.vertexNormals[t].clone();var k=new Geometry;for(k.faces=this.faces,t=0,h=this.morphTargets.length;t<h;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var I=this.morphNormals[t].faceNormals,N=this.morphNormals[t].vertexNormals;for(p=0,x=this.faces.length;p<x;p++)V=new Vector3,ee={a:new Vector3,b:new Vector3,c:new Vector3},I.push(V),N.push(ee)}var V,ee,te=this.morphNormals[t];for(k.vertices=this.morphTargets[t].vertices,k.computeFaceNormals(),k.computeVertexNormals(),p=0,x=this.faces.length;p<x;p++)M=this.faces[p],V=te.faceNormals[p],ee=te.vertexNormals[p],V.copy(M.normal),ee.a.copy(M.vertexNormals[0]),ee.b.copy(M.vertexNormals[1]),ee.c.copy(M.vertexNormals[2])}for(p=0,x=this.faces.length;p<x;p++)(M=this.faces[p]).normal=M.__originalFaceNormal,M.vertexNormals=M.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,h,p){if(t&&t.isGeometry){var x,M=this.vertices.length,k=this.vertices,I=t.vertices,N=this.faces,V=t.faces,ee=this.colors,te=t.colors;void 0===p&&(p=0),void 0!==h&&(x=(new Matrix3).getNormalMatrix(h));for(var re=0,ne=I.length;re<ne;re++){var ie=I[re].clone();void 0!==h&&ie.applyMatrix4(h),k.push(ie)}for(re=0,ne=te.length;re<ne;re++)ee.push(te[re].clone());for(re=0,ne=V.length;re<ne;re++){var ae,oe,se,ce=V[re],ue=ce.vertexNormals,le=ce.vertexColors;(ae=new Face3(ce.a+M,ce.b+M,ce.c+M)).normal.copy(ce.normal),void 0!==x&&ae.normal.applyMatrix3(x).normalize();for(var he=0,fe=ue.length;he<fe;he++)oe=ue[he].clone(),void 0!==x&&oe.applyMatrix3(x).normalize(),ae.vertexNormals.push(oe);ae.color.copy(ce.color);for(he=0,fe=le.length;he<fe;he++)se=le[he],ae.vertexColors.push(se.clone());ae.materialIndex=ce.materialIndex+p,N.push(ae)}for(re=0,ne=t.faceVertexUvs.length;re<ne;re++){var de=t.faceVertexUvs[re];void 0===this.faceVertexUvs[re]&&(this.faceVertexUvs[re]=[]);for(he=0,fe=de.length;he<fe;he++){for(var pe=de[he],me=[],ge=0,ve=pe.length;ge<ve;ge++)me.push(pe[ge].clone());this.faceVertexUvs[re].push(me)}}}},mergeMesh:function(t){t&&t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,h,p,x,M,k,I,N,V={},ee=[],te=[],re=Math.pow(10,4);for(p=0,x=this.vertices.length;p<x;p++)t=this.vertices[p],void 0===V[h=Math.round(t.x*re)+"_"+Math.round(t.y*re)+"_"+Math.round(t.z*re)]?(V[h]=p,ee.push(this.vertices[p]),te[p]=ee.length-1):te[p]=te[V[h]];var ne=[];for(p=0,x=this.faces.length;p<x;p++){(M=this.faces[p]).a=te[M.a],M.b=te[M.b],M.c=te[M.c],k=[M.a,M.b,M.c];for(var ie=0;ie<3;ie++)if(k[ie]===k[(ie+1)%3]){ne.push(p);break}}for(p=ne.length-1;p>=0;p--){var ae=ne[p];for(this.faces.splice(ae,1),I=0,N=this.faceVertexUvs.length;I<N;I++)this.faceVertexUvs[I].splice(ae,1)}var oe=this.vertices.length-ee.length;return this.vertices=ee,oe},setFromPoints:function(t){this.vertices=[];for(var h=0,p=t.length;h<p;h++){var x=t[h];this.vertices.push(new Vector3(x.x,x.y,x.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,h=t.length,p=0;p<h;p++)t[p]._id=p;t.sort((function materialIndexSort(t,h){return t.materialIndex-h.materialIndex}));var x,M,k=this.faceVertexUvs[0],I=this.faceVertexUvs[1];k&&k.length===h&&(x=[]),I&&I.length===h&&(M=[]);for(p=0;p<h;p++){var N=t[p]._id;x&&x.push(k[N]),M&&M.push(I[N])}x&&(this.faceVertexUvs[0]=x),M&&(this.faceVertexUvs[1]=M)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var h=this.parameters;for(var p in h)void 0!==h[p]&&(t[p]=h[p]);return t}for(var x=[],M=0;M<this.vertices.length;M++){var k=this.vertices[M];x.push(k.x,k.y,k.z)}var I=[],N=[],V={},ee=[],te={},re=[],ne={};for(M=0;M<this.faces.length;M++){var ie=this.faces[M],ae=void 0!==this.faceVertexUvs[0][M],oe=ie.normal.length()>0,se=ie.vertexNormals.length>0,ce=1!==ie.color.r||1!==ie.color.g||1!==ie.color.b,ue=ie.vertexColors.length>0,le=0;if(le=setBit(le,0,0),le=setBit(le,1,!0),le=setBit(le,2,!1),le=setBit(le,3,ae),le=setBit(le,4,oe),le=setBit(le,5,se),le=setBit(le,6,ce),le=setBit(le,7,ue),I.push(le),I.push(ie.a,ie.b,ie.c),I.push(ie.materialIndex),ae){var he=this.faceVertexUvs[0][M];I.push(getUvIndex(he[0]),getUvIndex(he[1]),getUvIndex(he[2]))}if(oe&&I.push(getNormalIndex(ie.normal)),se){var fe=ie.vertexNormals;I.push(getNormalIndex(fe[0]),getNormalIndex(fe[1]),getNormalIndex(fe[2]))}if(ce&&I.push(getColorIndex(ie.color)),ue){var de=ie.vertexColors;I.push(getColorIndex(de[0]),getColorIndex(de[1]),getColorIndex(de[2]))}}function setBit(t,h,p){return p?t|1<<h:t&~(1<<h)}function getNormalIndex(t){var h=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==V[h]||(V[h]=N.length/3,N.push(t.x,t.y,t.z)),V[h]}function getColorIndex(t){var h=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==te[h]||(te[h]=ee.length,ee.push(t.getHex())),te[h]}function getUvIndex(t){var h=t.x.toString()+t.y.toString();return void 0!==ne[h]||(ne[h]=re.length/2,re.push(t.x,t.y)),ne[h]}return t.data={},t.data.vertices=x,t.data.normals=N,ee.length>0&&(t.data.colors=ee),re.length>0&&(t.data.uvs=[re]),t.data.faces=I,t},clone:function(){return(new Geometry).copy(this)},copy:function(t){var h,p,x,M,k,I;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var N=t.vertices;for(h=0,p=N.length;h<p;h++)this.vertices.push(N[h].clone());var V=t.colors;for(h=0,p=V.length;h<p;h++)this.colors.push(V[h].clone());var ee=t.faces;for(h=0,p=ee.length;h<p;h++)this.faces.push(ee[h].clone());for(h=0,p=t.faceVertexUvs.length;h<p;h++){var te=t.faceVertexUvs[h];for(void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]),x=0,M=te.length;x<M;x++){var re=te[x],ne=[];for(k=0,I=re.length;k<I;k++){var ie=re[k];ne.push(ie.clone())}this.faceVertexUvs[h].push(ne)}}var ae=t.morphTargets;for(h=0,p=ae.length;h<p;h++){var oe={};if(oe.name=ae[h].name,void 0!==ae[h].vertices)for(oe.vertices=[],x=0,M=ae[h].vertices.length;x<M;x++)oe.vertices.push(ae[h].vertices[x].clone());if(void 0!==ae[h].normals)for(oe.normals=[],x=0,M=ae[h].normals.length;x<M;x++)oe.normals.push(ae[h].normals[x].clone());this.morphTargets.push(oe)}var se=t.morphNormals;for(h=0,p=se.length;h<p;h++){var ce={};if(void 0!==se[h].vertexNormals)for(ce.vertexNormals=[],x=0,M=se[h].vertexNormals.length;x<M;x++){var ue=se[h].vertexNormals[x],le={};le.a=ue.a.clone(),le.b=ue.b.clone(),le.c=ue.c.clone(),ce.vertexNormals.push(le)}if(void 0!==se[h].faceNormals)for(ce.faceNormals=[],x=0,M=se[h].faceNormals.length;x<M;x++)ce.faceNormals.push(se[h].faceNormals[x].clone());this.morphNormals.push(ce)}var he=t.skinWeights;for(h=0,p=he.length;h<p;h++)this.skinWeights.push(he[h].clone());var fe=t.skinIndices;for(h=0,p=fe.length;h<p;h++)this.skinIndices.push(fe[h].clone());var de=t.lineDistances;for(h=0,p=de.length;h<p;h++)this.lineDistances.push(de[h]);var pe=t.boundingBox;null!==pe&&(this.boundingBox=pe.clone());var me=t.boundingSphere;return null!==me&&(this.boundingSphere=me.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxBufferGeometry extends BufferGeometry{constructor(t,h,p,x,M,k){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:h,depth:p,widthSegments:x,heightSegments:M,depthSegments:k};var I=this;t=t||1,h=h||1,p=p||1,x=Math.floor(x)||1,M=Math.floor(M)||1,k=Math.floor(k)||1;var N=[],V=[],ee=[],te=[],re=0,ne=0;function buildPlane(t,h,p,x,M,k,ie,ae,oe,se,ce){var ue,le,he=k/oe,fe=ie/se,de=k/2,pe=ie/2,me=ae/2,ge=oe+1,ve=se+1,ye=0,be=0,xe=new Vector3;for(le=0;le<ve;le++){var Me=le*fe-pe;for(ue=0;ue<ge;ue++){var we=ue*he-de;xe[t]=we*x,xe[h]=Me*M,xe[p]=me,V.push(xe.x,xe.y,xe.z),xe[t]=0,xe[h]=0,xe[p]=ae>0?1:-1,ee.push(xe.x,xe.y,xe.z),te.push(ue/oe),te.push(1-le/se),ye+=1}}for(le=0;le<se;le++)for(ue=0;ue<oe;ue++){var _e=re+ue+ge*le,Ce=re+ue+ge*(le+1),Se=re+(ue+1)+ge*(le+1),Te=re+(ue+1)+ge*le;N.push(_e,Ce,Te),N.push(Ce,Se,Te),be+=6}I.addGroup(ne,be,ce),ne+=be,re+=ye}buildPlane("z","y","x",-1,-1,p,h,t,k,M,0),buildPlane("z","y","x",1,-1,p,h,-t,k,M,1),buildPlane("x","z","y",1,1,t,p,h,x,k,2),buildPlane("x","z","y",1,-1,t,p,-h,x,k,3),buildPlane("x","y","z",1,-1,t,h,p,x,M,4),buildPlane("x","y","z",-1,-1,t,h,-p,x,M,5),this.setIndex(N),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(ee,3)),this.setAttribute("uv",new Float32BufferAttribute(te,2))}}function cloneUniforms(t){var h={};for(var p in t)for(var x in h[p]={},t[p]){var M=t[p][x];M&&(M.isColor||M.isMatrix3||M.isMatrix4||M.isVector2||M.isVector3||M.isVector4||M.isTexture)?h[p][x]=M.clone():Array.isArray(M)?h[p][x]=M.slice():h[p][x]=M}return h}function mergeUniforms(t){for(var h={},p=0;p<t.length;p++){var x=cloneUniforms(t[p]);for(var M in x)h[M]=x[M]}return h}var nl={clone:cloneUniforms,merge:mergeUniforms},il="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",ol="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(t){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=il,this.fragmentShader=ol,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(t.attributes,this.setValues(t))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(t,h,p,x){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==p?p:.1,this.far=void 0!==x?x:2e3,this.focus=10,this.aspect=void 0!==h?h:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ShaderMaterial.prototype.toJSON=function(t){var h=Material.prototype.toJSON.call(this,t);for(var p in h.uniforms={},this.uniforms){var x=this.uniforms[p].value;x&&x.isTexture?h.uniforms[p]={type:"t",value:x.toJSON(t).uuid}:x&&x.isColor?h.uniforms[p]={type:"c",value:x.getHex()}:x&&x.isVector2?h.uniforms[p]={type:"v2",value:x.toArray()}:x&&x.isVector3?h.uniforms[p]={type:"v3",value:x.toArray()}:x&&x.isVector4?h.uniforms[p]={type:"v4",value:x.toArray()}:x&&x.isMatrix3?h.uniforms[p]={type:"m3",value:x.toArray()}:x&&x.isMatrix4?h.uniforms[p]={type:"m4",value:x.toArray()}:h.uniforms[p]={value:x}}Object.keys(this.defines).length>0&&(h.defines=this.defines),h.vertexShader=this.vertexShader,h.fragmentShader=this.fragmentShader;var M={};for(var k in this.extensions)!0===this.extensions[k]&&(M[k]=!0);return Object.keys(M).length>0&&(h.extensions=M),h},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(t,h){return Object3D.prototype.copy.call(this,t,h),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(t=new Vector3),this.updateMatrixWorld(!0);var h=this.matrixWorld.elements;return t.set(-h[8],-h[9],-h[10]).normalize()},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,h){Object3D.prototype.updateWorldMatrix.call(this,t,h),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(t,h){return Camera.prototype.copy.call(this,t,h),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var h=.5*this.getFilmHeight()/t;this.fov=2*gc.RAD2DEG*Math.atan(h),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*gc.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*gc.RAD2DEG*Math.atan(Math.tan(.5*gc.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,h,p,x,M,k){this.aspect=t/h,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=h,this.view.offsetX=p,this.view.offsetY=x,this.view.width=M,this.view.height=k,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,h=t*Math.tan(.5*gc.DEG2RAD*this.fov)/this.zoom,p=2*h,x=this.aspect*p,M=-.5*x,k=this.view;if(null!==this.view&&this.view.enabled){var I=k.fullWidth,N=k.fullHeight;M+=k.offsetX*x/I,h-=k.offsetY*p/N,x*=k.width/I,p*=k.height/N}var V=this.filmOffset;0!==V&&(M+=t*V/this.getFilmWidth()),this.projectionMatrix.makePerspective(M,M+x,h,h-p,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var h=Object3D.prototype.toJSON.call(this,t);return h.object.fov=this.fov,h.object.zoom=this.zoom,h.object.near=this.near,h.object.far=this.far,h.object.focus=this.focus,h.object.aspect=this.aspect,null!==this.view&&(h.object.view=Object.assign({},this.view)),h.object.filmGauge=this.filmGauge,h.object.filmOffset=this.filmOffset,h}});var sl=90;function CubeCamera(t,h,p,x){Object3D.call(this),this.type="CubeCamera";var M=new PerspectiveCamera(sl,1,t,h);M.up.set(0,-1,0),M.lookAt(new Vector3(1,0,0)),this.add(M);var k=new PerspectiveCamera(sl,1,t,h);k.up.set(0,-1,0),k.lookAt(new Vector3(-1,0,0)),this.add(k);var I=new PerspectiveCamera(sl,1,t,h);I.up.set(0,0,1),I.lookAt(new Vector3(0,1,0)),this.add(I);var N=new PerspectiveCamera(sl,1,t,h);N.up.set(0,0,-1),N.lookAt(new Vector3(0,-1,0)),this.add(N);var V=new PerspectiveCamera(sl,1,t,h);V.up.set(0,-1,0),V.lookAt(new Vector3(0,0,1)),this.add(V);var ee=new PerspectiveCamera(sl,1,t,h);ee.up.set(0,-1,0),ee.lookAt(new Vector3(0,0,-1)),this.add(ee),x=x||{format:cs,magFilter:Ho,minFilter:Ho},this.renderTarget=new WebGLCubeRenderTarget(p,x),this.renderTarget.texture.name="CubeCamera",this.update=function(t,h){null===this.parent&&this.updateMatrixWorld();var p=t.getRenderTarget(),x=this.renderTarget,te=x.texture.generateMipmaps;x.texture.generateMipmaps=!1,t.setRenderTarget(x,0),t.render(h,M),t.setRenderTarget(x,1),t.render(h,k),t.setRenderTarget(x,2),t.render(h,I),t.setRenderTarget(x,3),t.render(h,N),t.setRenderTarget(x,4),t.render(h,V),x.texture.generateMipmaps=te,t.setRenderTarget(x,5),t.render(h,ee),t.setRenderTarget(p)},this.clear=function(t,h,p,x){for(var M=t.getRenderTarget(),k=this.renderTarget,I=0;I<6;I++)t.setRenderTarget(k,I),t.clear(h,p,x);t.setRenderTarget(M)}}function WebGLCubeRenderTarget(t,h,p){Number.isInteger(h)&&(h=p),WebGLRenderTarget.call(this,t,t,h)}function DataTexture(t,h,p,x,M,k,I,N,V,ee,te,re){Texture.call(this,null,k,I,N,V,ee,x,M,te,re),this.image={data:t||null,width:h||1,height:p||1},this.magFilter=void 0!==V?V:Uo,this.minFilter=void 0!==ee?ee:Uo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,WebGLCubeRenderTarget.prototype=Object.create(WebGLRenderTarget.prototype),WebGLCubeRenderTarget.prototype.constructor=WebGLCubeRenderTarget,WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0,WebGLCubeRenderTarget.prototype.fromEquirectangularTexture=function(t,h){this.texture.type=h.type,this.texture.format=h.format,this.texture.encoding=h.encoding;var p=new Scene,x={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},M=new ShaderMaterial({type:"CubemapFromEquirect",uniforms:cloneUniforms(x.uniforms),vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,side:Va,blending:Ua});M.uniforms.tEquirect.value=h;var k=new Mesh(new BoxBufferGeometry(5,5,5),M);p.add(k);var I=new CubeCamera(1,10,1);return I.renderTarget=this,I.renderTarget.texture.name="CubeCameraTexture",I.update(t,p),k.geometry.dispose(),k.material.dispose(),this},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var cl=new Sphere,ul=new Vector3;function Frustum(t,h,p,x,M,k){this.planes=[void 0!==t?t:new Plane,void 0!==h?h:new Plane,void 0!==p?p:new Plane,void 0!==x?x:new Plane,void 0!==M?M:new Plane,void 0!==k?k:new Plane]}Object.assign(Frustum.prototype,{set:function(t,h,p,x,M,k){var I=this.planes;return I[0].copy(t),I[1].copy(h),I[2].copy(p),I[3].copy(x),I[4].copy(M),I[5].copy(k),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var h=this.planes,p=0;p<6;p++)h[p].copy(t.planes[p]);return this},setFromProjectionMatrix:function(t){var h=this.planes,p=t.elements,x=p[0],M=p[1],k=p[2],I=p[3],N=p[4],V=p[5],ee=p[6],te=p[7],re=p[8],ne=p[9],ie=p[10],ae=p[11],oe=p[12],se=p[13],ce=p[14],ue=p[15];return h[0].setComponents(I-x,te-N,ae-re,ue-oe).normalize(),h[1].setComponents(I+x,te+N,ae+re,ue+oe).normalize(),h[2].setComponents(I+M,te+V,ae+ne,ue+se).normalize(),h[3].setComponents(I-M,te-V,ae-ne,ue-se).normalize(),h[4].setComponents(I-k,te-ee,ae-ie,ue-ce).normalize(),h[5].setComponents(I+k,te+ee,ae+ie,ue+ce).normalize(),this},intersectsObject:function(t){var h=t.geometry;return null===h.boundingSphere&&h.computeBoundingSphere(),cl.copy(h.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(cl)},intersectsSprite:function(t){return cl.center.set(0,0,0),cl.radius=.7071067811865476,cl.applyMatrix4(t.matrixWorld),this.intersectsSphere(cl)},intersectsSphere:function(t){for(var h=this.planes,p=t.center,x=-t.radius,M=0;M<6;M++){if(h[M].distanceToPoint(p)<x)return!1}return!0},intersectsBox:function(t){for(var h=this.planes,p=0;p<6;p++){var x=h[p];if(ul.x=x.normal.x>0?t.max.x:t.min.x,ul.y=x.normal.y>0?t.max.y:t.min.y,ul.z=x.normal.z>0?t.max.z:t.min.z,x.distanceToPoint(ul)<0)return!1}return!0},containsPoint:function(t){for(var h=this.planes,p=0;p<6;p++)if(h[p].distanceToPoint(t)<0)return!1;return!0}});var ll={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}};function WebGLAnimation(){var t=null,h=!1,p=null;function onAnimationFrame(x,M){!1!==h&&(p(x,M),t.requestAnimationFrame(onAnimationFrame))}return{start:function(){!0!==h&&null!==p&&(t.requestAnimationFrame(onAnimationFrame),h=!0)},stop:function(){h=!1},setAnimationLoop:function(t){p=t},setContext:function(h){t=h}}}function WebGLAttributes(t,h){var p=h.isWebGL2,x=new WeakMap;return{get:function get(t){return t.isInterleavedBufferAttribute&&(t=t.data),x.get(t)},remove:function remove(h){h.isInterleavedBufferAttribute&&(h=h.data);var p=x.get(h);p&&(t.deleteBuffer(p.buffer),x.delete(h))},update:function update(h,M){h.isInterleavedBufferAttribute&&(h=h.data);var k=x.get(h);void 0===k?x.set(h,function createBuffer(h,p){var x=h.array,M=h.usage,k=t.createBuffer();t.bindBuffer(p,k),t.bufferData(p,x,M),h.onUploadCallback();var I=5126;return x instanceof Float32Array?I=5126:x instanceof Float64Array||(x instanceof Uint16Array?I=5123:x instanceof Int16Array?I=5122:x instanceof Uint32Array?I=5125:x instanceof Int32Array?I=5124:x instanceof Int8Array?I=5120:x instanceof Uint8Array&&(I=5121)),{buffer:k,type:I,bytesPerElement:x.BYTES_PER_ELEMENT,version:h.version}}(h,M)):k.version<h.version&&(!function updateBuffer(h,x,M){var k=x.array,I=x.updateRange;t.bindBuffer(M,h),-1===I.count?t.bufferSubData(M,0,k):(p?t.bufferSubData(M,I.offset*k.BYTES_PER_ELEMENT,k,I.offset,I.count):t.bufferSubData(M,I.offset*k.BYTES_PER_ELEMENT,k.subarray(I.offset,I.offset+I.count)),I.count=-1)}(k.buffer,h,M),k.version=h.version)}}}function PlaneGeometry(t,h,p,x){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:h,widthSegments:p,heightSegments:x},this.fromBufferGeometry(new PlaneBufferGeometry(t,h,p,x)),this.mergeVertices()}function PlaneBufferGeometry(t,h,p,x){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:h,widthSegments:p,heightSegments:x};var M,k,I=(t=t||1)/2,N=(h=h||1)/2,V=Math.floor(p)||1,ee=Math.floor(x)||1,te=V+1,re=ee+1,ne=t/V,ie=h/ee,ae=[],oe=[],se=[],ce=[];for(k=0;k<re;k++){var ue=k*ie-N;for(M=0;M<te;M++){var le=M*ne-I;oe.push(le,-ue,0),se.push(0,0,1),ce.push(M/V),ce.push(1-k/ee)}}for(k=0;k<ee;k++)for(M=0;M<V;M++){var he=M+te*k,fe=M+te*(k+1),de=M+1+te*(k+1),pe=M+1+te*k;ae.push(he,fe,pe),ae.push(fe,de,pe)}this.setIndex(ae),this.setAttribute("position",new Float32BufferAttribute(oe,3)),this.setAttribute("normal",new Float32BufferAttribute(se,3)),this.setAttribute("uv",new Float32BufferAttribute(ce,2))}PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;var hl={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},fl={basic:{uniforms:mergeUniforms([ll.common,ll.specularmap,ll.envmap,ll.aomap,ll.lightmap,ll.fog]),vertexShader:hl.meshbasic_vert,fragmentShader:hl.meshbasic_frag},lambert:{uniforms:mergeUniforms([ll.common,ll.specularmap,ll.envmap,ll.aomap,ll.lightmap,ll.emissivemap,ll.fog,ll.lights,{emissive:{value:new Color(0)}}]),vertexShader:hl.meshlambert_vert,fragmentShader:hl.meshlambert_frag},phong:{uniforms:mergeUniforms([ll.common,ll.specularmap,ll.envmap,ll.aomap,ll.lightmap,ll.emissivemap,ll.bumpmap,ll.normalmap,ll.displacementmap,ll.fog,ll.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:hl.meshphong_vert,fragmentShader:hl.meshphong_frag},standard:{uniforms:mergeUniforms([ll.common,ll.envmap,ll.aomap,ll.lightmap,ll.emissivemap,ll.bumpmap,ll.normalmap,ll.displacementmap,ll.roughnessmap,ll.metalnessmap,ll.fog,ll.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:hl.meshphysical_vert,fragmentShader:hl.meshphysical_frag},toon:{uniforms:mergeUniforms([ll.common,ll.specularmap,ll.aomap,ll.lightmap,ll.emissivemap,ll.bumpmap,ll.normalmap,ll.displacementmap,ll.gradientmap,ll.fog,ll.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:hl.meshtoon_vert,fragmentShader:hl.meshtoon_frag},matcap:{uniforms:mergeUniforms([ll.common,ll.bumpmap,ll.normalmap,ll.displacementmap,ll.fog,{matcap:{value:null}}]),vertexShader:hl.meshmatcap_vert,fragmentShader:hl.meshmatcap_frag},points:{uniforms:mergeUniforms([ll.points,ll.fog]),vertexShader:hl.points_vert,fragmentShader:hl.points_frag},dashed:{uniforms:mergeUniforms([ll.common,ll.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hl.linedashed_vert,fragmentShader:hl.linedashed_frag},depth:{uniforms:mergeUniforms([ll.common,ll.displacementmap]),vertexShader:hl.depth_vert,fragmentShader:hl.depth_frag},normal:{uniforms:mergeUniforms([ll.common,ll.bumpmap,ll.normalmap,ll.displacementmap,{opacity:{value:1}}]),vertexShader:hl.normal_vert,fragmentShader:hl.normal_frag},sprite:{uniforms:mergeUniforms([ll.sprite,ll.fog]),vertexShader:hl.sprite_vert,fragmentShader:hl.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:hl.background_vert,fragmentShader:hl.background_frag},cube:{uniforms:mergeUniforms([ll.envmap,{opacity:{value:1}}]),vertexShader:hl.cube_vert,fragmentShader:hl.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hl.equirect_vert,fragmentShader:hl.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([ll.common,ll.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hl.distanceRGBA_vert,fragmentShader:hl.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([ll.lights,ll.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:hl.shadow_vert,fragmentShader:hl.shadow_frag}};function WebGLBackground(t,h,p,x){var M,k,I=new Color(0),N=0,V=null,ee=0,te=null;function setClear(t,p){h.buffers.color.setClear(t.r,t.g,t.b,p,x)}return{getClearColor:function(){return I},setClearColor:function(t,h){I.set(t),setClear(I,N=void 0!==h?h:1)},getClearAlpha:function(){return N},setClearAlpha:function(t){setClear(I,N=t)},render:function render(h,x,re,ne){var ie=x.background,ae=t.xr,oe=ae.getSession&&ae.getSession();if(oe&&"additive"===oe.environmentBlendMode&&(ie=null),null===ie?setClear(I,N):ie&&ie.isColor&&(setClear(ie,1),ne=!0),(t.autoClear||ne)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),ie&&(ie.isCubeTexture||ie.isWebGLCubeRenderTarget||ie.mapping===Ro)){void 0===k&&((k=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(fl.cube.uniforms),vertexShader:fl.cube.vertexShader,fragmentShader:fl.cube.fragmentShader,side:Va,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),k.geometry.deleteAttribute("uv"),k.onBeforeRender=function(t,h,p){this.matrixWorld.copyPosition(p.matrixWorld)},Object.defineProperty(k.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),p.update(k));var se=ie.isWebGLCubeRenderTarget?ie.texture:ie;k.material.uniforms.envMap.value=se,k.material.uniforms.flipEnvMap.value=se.isCubeTexture?-1:1,V===ie&&ee===se.version&&te===t.toneMapping||(k.material.needsUpdate=!0,V=ie,ee=se.version,te=t.toneMapping),h.unshift(k,k.geometry,k.material,0,0,null)}else ie&&ie.isTexture&&(void 0===M&&((M=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(fl.background.uniforms),vertexShader:fl.background.vertexShader,fragmentShader:fl.background.fragmentShader,side:Na,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(M.material,"map",{get:function(){return this.uniforms.t2D.value}}),p.update(M)),M.material.uniforms.t2D.value=ie,!0===ie.matrixAutoUpdate&&ie.updateMatrix(),M.material.uniforms.uvTransform.value.copy(ie.matrix),V===ie&&ee===ie.version&&te===t.toneMapping||(M.material.needsUpdate=!0,V=ie,ee=ie.version,te=t.toneMapping),h.unshift(M,M.geometry,M.material,0,0,null))}}}function WebGLBufferRenderer(t,h,p,x){var M,k=x.isWebGL2;this.setMode=function setMode(t){M=t},this.render=function render(h,x){t.drawArrays(M,h,x),p.update(x,M)},this.renderInstances=function renderInstances(x,I,N,V){if(0!==V){var ee,te;if(k)ee=t,te="drawArraysInstanced";else if(te="drawArraysInstancedANGLE",null===(ee=h.get("ANGLE_instanced_arrays")))return;ee[te](M,I,N,V),p.update(N,M,V)}}}function WebGLCapabilities(t,h,p){var x;function getMaxPrecision(h){if("highp"===h){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";h="mediump"}return"mediump"===h&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var M="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,k=void 0!==p.precision?p.precision:"highp",I=getMaxPrecision(k);I!==k&&(k=I);var N=!0===p.logarithmicDepthBuffer,V=t.getParameter(34930),ee=t.getParameter(35660),te=t.getParameter(3379),re=t.getParameter(34076),ne=t.getParameter(34921),ie=t.getParameter(36347),ae=t.getParameter(36348),oe=t.getParameter(36349),se=ee>0,ce=M||!!h.get("OES_texture_float");return{isWebGL2:M,getMaxAnisotropy:function getMaxAnisotropy(){if(void 0!==x)return x;var p=h.get("EXT_texture_filter_anisotropic");return x=null!==p?t.getParameter(p.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:k,logarithmicDepthBuffer:N,maxTextures:V,maxVertexTextures:ee,maxTextureSize:te,maxCubemapSize:re,maxAttributes:ne,maxVertexUniforms:ie,maxVaryings:ae,maxFragmentUniforms:oe,vertexTextures:se,floatFragmentTextures:ce,floatVertexTextures:se&&ce,maxSamples:M?t.getParameter(36183):0}}function WebGLClipping(){var t=this,h=null,p=0,x=!1,M=!1,k=new Plane,I=new Matrix3,N={value:null,needsUpdate:!1};function resetGlobalState(){N.value!==h&&(N.value=h,N.needsUpdate=p>0),t.numPlanes=p,t.numIntersection=0}function projectPlanes(h,p,x,M){var V=null!==h?h.length:0,ee=null;if(0!==V){if(ee=N.value,!0!==M||null===ee){var te=x+4*V,re=p.matrixWorldInverse;I.getNormalMatrix(re),(null===ee||ee.length<te)&&(ee=new Float32Array(te));for(var ne=0,ie=x;ne!==V;++ne,ie+=4)k.copy(h[ne]).applyMatrix4(re,I),k.normal.toArray(ee,ie),ee[ie+3]=k.constant}N.value=ee,N.needsUpdate=!0}return t.numPlanes=V,ee}this.uniform=N,this.numPlanes=0,this.numIntersection=0,this.init=function(t,M,k){var I=0!==t.length||M||0!==p||x;return x=M,h=projectPlanes(t,k,0),p=t.length,I},this.beginShadows=function(){M=!0,projectPlanes(null)},this.endShadows=function(){M=!1,resetGlobalState()},this.setState=function(t,k,I,V,ee,te){if(!x||null===t||0===t.length||M&&!I)M?projectPlanes(null):resetGlobalState();else{var re=M?0:p,ne=4*re,ie=ee.clippingState||null;N.value=ie,ie=projectPlanes(t,V,ne,te);for(var ae=0;ae!==ne;++ae)ie[ae]=h[ae];ee.clippingState=ie,this.numIntersection=k?this.numPlanes:0,this.numPlanes+=re}}}function WebGLExtensions(t){var h={};return{get:function(p){if(void 0!==h[p])return h[p];var x;switch(p){case"WEBGL_depth_texture":x=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":x=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":x=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":x=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:x=t.getExtension(p)}return h[p]=x,x}}}function WebGLGeometries(t,h,p){var x=new WeakMap,M=new WeakMap;function onGeometryDispose(t){var k=t.target,I=x.get(k);for(var N in null!==I.index&&h.remove(I.index),I.attributes)h.remove(I.attributes[N]);k.removeEventListener("dispose",onGeometryDispose),x.delete(k);var V=M.get(I);V&&(h.remove(V),M.delete(I)),p.memory.geometries--}function updateWireframeAttribute(t){var p=[],x=t.index,k=t.attributes.position,I=0;if(null!==x){var N=x.array;I=x.version;for(var V=0,ee=N.length;V<ee;V+=3){var te=N[V+0],re=N[V+1],ne=N[V+2];p.push(te,re,re,ne,ne,te)}}else{N=k.array;I=k.version;for(V=0,ee=N.length/3-1;V<ee;V+=3){te=V+0,re=V+1,ne=V+2;p.push(te,re,re,ne,ne,te)}}var ie=new(arrayMax(p)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(p,1);ie.version=I,h.update(ie,34963);var ae=M.get(t);ae&&h.remove(ae),M.set(t,ie)}return{get:function get(t,h){var M=x.get(h);return M||(h.addEventListener("dispose",onGeometryDispose),h.isBufferGeometry?M=h:h.isGeometry&&(void 0===h._bufferGeometry&&(h._bufferGeometry=(new BufferGeometry).setFromObject(t)),M=h._bufferGeometry),x.set(h,M),p.memory.geometries++,M)},update:function update(t){var p=t.index,x=t.attributes;for(var M in null!==p&&h.update(p,34963),x)h.update(x[M],34962);var k=t.morphAttributes;for(var M in k)for(var I=k[M],N=0,V=I.length;N<V;N++)h.update(I[N],34962)},getWireframeAttribute:function getWireframeAttribute(t){var h=M.get(t);if(h){var p=t.index;null!==p&&h.version<p.version&&updateWireframeAttribute(t)}else updateWireframeAttribute(t);return M.get(t)}}}function WebGLIndexedBufferRenderer(t,h,p,x){var M,k,I,N=x.isWebGL2;this.setMode=function setMode(t){M=t},this.setIndex=function setIndex(t){k=t.type,I=t.bytesPerElement},this.render=function render(h,x){t.drawElements(M,x,k,h*I),p.update(x,M)},this.renderInstances=function renderInstances(x,V,ee,te){if(0!==te){var re,ne;if(N)re=t,ne="drawElementsInstanced";else if(ne="drawElementsInstancedANGLE",null===(re=h.get("ANGLE_instanced_arrays")))return;re[ne](M,ee,k,V*I,te),p.update(ee,M,te)}}}function WebGLInfo(t){var h={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:h,programs:null,autoReset:!0,reset:function reset(){h.frame++,h.calls=0,h.triangles=0,h.points=0,h.lines=0},update:function update(t,p,x){switch(x=x||1,h.calls++,p){case 4:h.triangles+=x*(t/3);break;case 1:h.lines+=x*(t/2);break;case 3:h.lines+=x*(t-1);break;case 2:h.lines+=x*t;break;case 0:h.points+=x*t}}}}function absNumericalSort(t,h){return Math.abs(h[1])-Math.abs(t[1])}function WebGLMorphtargets(t){var h={},p=new Float32Array(8);return{update:function update(x,M,k,I){var N=x.morphTargetInfluences,V=void 0===N?0:N.length,ee=h[M.id];if(void 0===ee){ee=[];for(var te=0;te<V;te++)ee[te]=[te,0];h[M.id]=ee}var re=k.morphTargets&&M.morphAttributes.position,ne=k.morphNormals&&M.morphAttributes.normal;for(te=0;te<V;te++){0!==(ae=ee[te])[1]&&(re&&M.deleteAttribute("morphTarget"+te),ne&&M.deleteAttribute("morphNormal"+te))}for(te=0;te<V;te++){(ae=ee[te])[0]=te,ae[1]=N[te]}ee.sort(absNumericalSort);var ie=0;for(te=0;te<8;te++){var ae;if(ae=ee[te]){var oe=ae[0],se=ae[1];if(se){re&&M.setAttribute("morphTarget"+te,re[oe]),ne&&M.setAttribute("morphNormal"+te,ne[oe]),p[te]=se,ie+=se;continue}}p[te]=0}var ce=M.morphTargetsRelative?1:1-ie;I.getUniforms().setValue(t,"morphTargetBaseInfluence",ce),I.getUniforms().setValue(t,"morphTargetInfluences",p)}}}function WebGLObjects(t,h,p,x){var M={};return{update:function update(t){var k=x.render.frame,I=t.geometry,N=h.get(t,I);return M[N.id]!==k&&(I.isGeometry&&N.updateFromObject(t),h.update(N),M[N.id]=k),t.isInstancedMesh&&p.update(t.instanceMatrix,34962),N},dispose:function dispose(){M={}}}}function CubeTexture(t,h,p,x,M,k,I,N,V,ee){t=void 0!==t?t:[],h=void 0!==h?h:Lo,I=void 0!==I?I:cs,Texture.call(this,t,h,p,x,M,k,I,N,V,ee),this.flipY=!1}function DataTexture2DArray(t,h,p,x){Texture.call(this,null),this.image={data:t||null,width:h||1,height:p||1,depth:x||1},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Go,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(t,h,p,x){Texture.call(this,null),this.image={data:t||null,width:h||1,height:p||1,depth:x||1},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Go,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}fl.physical={uniforms:mergeUniforms([fl.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Color(0)},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:hl.meshphysical_vert,fragmentShader:hl.meshphysical_frag},CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;var dl=new Texture,pl=new DataTexture2DArray,ml=new DataTexture3D,gl=new CubeTexture,vl=[],yl=[],bl=new Float32Array(16),xl=new Float32Array(9),Ml=new Float32Array(4);function flatten(t,h,p){var x=t[0];if(x<=0||x>0)return t;var M=h*p,k=vl[M];if(void 0===k&&(k=new Float32Array(M),vl[M]=k),0!==h){x.toArray(k,0);for(var I=1,N=0;I!==h;++I)N+=p,t[I].toArray(k,N)}return k}function arraysEqual(t,h){if(t.length!==h.length)return!1;for(var p=0,x=t.length;p<x;p++)if(t[p]!==h[p])return!1;return!0}function copyArray(t,h){for(var p=0,x=h.length;p<x;p++)t[p]=h[p]}function allocTexUnits(t,h){var p=yl[h];void 0===p&&(p=new Int32Array(h),yl[h]=p);for(var x=0;x!==h;++x)p[x]=t.allocateTextureUnit();return p}function setValueV1f(t,h){var p=this.cache;p[0]!==h&&(t.uniform1f(this.addr,h),p[0]=h)}function setValueV2f(t,h){var p=this.cache;if(void 0!==h.x)p[0]===h.x&&p[1]===h.y||(t.uniform2f(this.addr,h.x,h.y),p[0]=h.x,p[1]=h.y);else{if(arraysEqual(p,h))return;t.uniform2fv(this.addr,h),copyArray(p,h)}}function setValueV3f(t,h){var p=this.cache;if(void 0!==h.x)p[0]===h.x&&p[1]===h.y&&p[2]===h.z||(t.uniform3f(this.addr,h.x,h.y,h.z),p[0]=h.x,p[1]=h.y,p[2]=h.z);else if(void 0!==h.r)p[0]===h.r&&p[1]===h.g&&p[2]===h.b||(t.uniform3f(this.addr,h.r,h.g,h.b),p[0]=h.r,p[1]=h.g,p[2]=h.b);else{if(arraysEqual(p,h))return;t.uniform3fv(this.addr,h),copyArray(p,h)}}function setValueV4f(t,h){var p=this.cache;if(void 0!==h.x)p[0]===h.x&&p[1]===h.y&&p[2]===h.z&&p[3]===h.w||(t.uniform4f(this.addr,h.x,h.y,h.z,h.w),p[0]=h.x,p[1]=h.y,p[2]=h.z,p[3]=h.w);else{if(arraysEqual(p,h))return;t.uniform4fv(this.addr,h),copyArray(p,h)}}function setValueM2(t,h){var p=this.cache,x=h.elements;if(void 0===x){if(arraysEqual(p,h))return;t.uniformMatrix2fv(this.addr,!1,h),copyArray(p,h)}else{if(arraysEqual(p,x))return;Ml.set(x),t.uniformMatrix2fv(this.addr,!1,Ml),copyArray(p,x)}}function setValueM3(t,h){var p=this.cache,x=h.elements;if(void 0===x){if(arraysEqual(p,h))return;t.uniformMatrix3fv(this.addr,!1,h),copyArray(p,h)}else{if(arraysEqual(p,x))return;xl.set(x),t.uniformMatrix3fv(this.addr,!1,xl),copyArray(p,x)}}function setValueM4(t,h){var p=this.cache,x=h.elements;if(void 0===x){if(arraysEqual(p,h))return;t.uniformMatrix4fv(this.addr,!1,h),copyArray(p,h)}else{if(arraysEqual(p,x))return;bl.set(x),t.uniformMatrix4fv(this.addr,!1,bl),copyArray(p,x)}}function setValueT1(t,h,p){var x=this.cache,M=p.allocateTextureUnit();x[0]!==M&&(t.uniform1i(this.addr,M),x[0]=M),p.safeSetTexture2D(h||dl,M)}function setValueT2DArray1(t,h,p){var x=this.cache,M=p.allocateTextureUnit();x[0]!==M&&(t.uniform1i(this.addr,M),x[0]=M),p.setTexture2DArray(h||pl,M)}function setValueT3D1(t,h,p){var x=this.cache,M=p.allocateTextureUnit();x[0]!==M&&(t.uniform1i(this.addr,M),x[0]=M),p.setTexture3D(h||ml,M)}function setValueT6(t,h,p){var x=this.cache,M=p.allocateTextureUnit();x[0]!==M&&(t.uniform1i(this.addr,M),x[0]=M),p.safeSetTextureCube(h||gl,M)}function setValueV1i(t,h){var p=this.cache;p[0]!==h&&(t.uniform1i(this.addr,h),p[0]=h)}function setValueV2i(t,h){var p=this.cache;arraysEqual(p,h)||(t.uniform2iv(this.addr,h),copyArray(p,h))}function setValueV3i(t,h){var p=this.cache;arraysEqual(p,h)||(t.uniform3iv(this.addr,h),copyArray(p,h))}function setValueV4i(t,h){var p=this.cache;arraysEqual(p,h)||(t.uniform4iv(this.addr,h),copyArray(p,h))}function setValueV1ui(t,h){var p=this.cache;p[0]!==h&&(t.uniform1ui(this.addr,h),p[0]=h)}function setValueV1fArray(t,h){t.uniform1fv(this.addr,h)}function setValueV1iArray(t,h){t.uniform1iv(this.addr,h)}function setValueV2iArray(t,h){t.uniform2iv(this.addr,h)}function setValueV3iArray(t,h){t.uniform3iv(this.addr,h)}function setValueV4iArray(t,h){t.uniform4iv(this.addr,h)}function setValueV2fArray(t,h){var p=flatten(h,this.size,2);t.uniform2fv(this.addr,p)}function setValueV3fArray(t,h){var p=flatten(h,this.size,3);t.uniform3fv(this.addr,p)}function setValueV4fArray(t,h){var p=flatten(h,this.size,4);t.uniform4fv(this.addr,p)}function setValueM2Array(t,h){var p=flatten(h,this.size,4);t.uniformMatrix2fv(this.addr,!1,p)}function setValueM3Array(t,h){var p=flatten(h,this.size,9);t.uniformMatrix3fv(this.addr,!1,p)}function setValueM4Array(t,h){var p=flatten(h,this.size,16);t.uniformMatrix4fv(this.addr,!1,p)}function setValueT1Array(t,h,p){var x=h.length,M=allocTexUnits(p,x);t.uniform1iv(this.addr,M);for(var k=0;k!==x;++k)p.safeSetTexture2D(h[k]||dl,M[k])}function setValueT6Array(t,h,p){var x=h.length,M=allocTexUnits(p,x);t.uniform1iv(this.addr,M);for(var k=0;k!==x;++k)p.safeSetTextureCube(h[k]||gl,M[k])}function SingleUniform(t,h,p){this.id=t,this.addr=p,this.cache=[],this.setValue=function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}(h.type)}function PureArrayUniform(t,h,p){this.id=t,this.addr=p,this.cache=[],this.size=h.size,this.setValue=function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}(h.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){var h=this.cache;t instanceof Float32Array&&h.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(h,t)},StructuredUniform.prototype.setValue=function(t,h,p){for(var x=this.seq,M=0,k=x.length;M!==k;++M){var I=x[M];I.setValue(t,h[I.id],p)}};var wl=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(t,h){t.seq.push(h),t.map[h.id]=h}function parseUniform(t,h,p){var x=t.name,M=x.length;for(wl.lastIndex=0;;){var k=wl.exec(x),I=wl.lastIndex,N=k[1],V="]"===k[2],ee=k[3];if(V&&(N|=0),void 0===ee||"["===ee&&I+2===M){addUniform(p,void 0===ee?new SingleUniform(N,t,h):new PureArrayUniform(N,t,h));break}var te=p.map[N];void 0===te&&addUniform(p,te=new StructuredUniform(N)),p=te}}function WebGLUniforms(t,h){this.seq=[],this.map={};for(var p=t.getProgramParameter(h,35718),x=0;x<p;++x){var M=t.getActiveUniform(h,x);parseUniform(M,t.getUniformLocation(h,M.name),this)}}function WebGLShader(t,h,p){var x=t.createShader(h);return t.shaderSource(x,p),t.compileShader(x),x}WebGLUniforms.prototype.setValue=function(t,h,p,x){var M=this.map[h];void 0!==M&&M.setValue(t,p,x)},WebGLUniforms.prototype.setOptional=function(t,h,p){var x=h[p];void 0!==x&&this.setValue(t,p,x)},WebGLUniforms.upload=function(t,h,p,x){for(var M=0,k=h.length;M!==k;++M){var I=h[M],N=p[I.id];!1!==N.needsUpdate&&I.setValue(t,N.value,x)}},WebGLUniforms.seqWithValue=function(t,h){for(var p=[],x=0,M=t.length;x!==M;++x){var k=t[x];k.id in h&&p.push(k)}return p};var _l=0;function getEncodingComponents(t){switch(t){case Ys:return["Linear","( value )"];case Zs:return["sRGB","( value )"];case Qs:return["RGBE","( value )"];case tc:return["RGBM","( value, 7.0 )"];case rc:return["RGBM","( value, 16.0 )"];case nc:return["RGBD","( value, 256.0 )"];case Js:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ec:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function getShaderErrors(t,h,p){var x=t.getShaderParameter(h,35713),M=t.getShaderInfoLog(h).trim();return x&&""===M?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+p+"\n"+M+function addLineNumbers(t){for(var h=t.split("\n"),p=0;p<h.length;p++)h[p]=p+1+": "+h[p];return h.join("\n")}(t.getShaderSource(h))}function getTexelDecodingFunction(t,h){var p=getEncodingComponents(h);return"vec4 "+t+"( vec4 value ) { return "+p[0]+"ToLinear"+p[1]+"; }"}function getToneMappingFunction(t,h){var p;switch(h){case So:p="Linear";break;case To:p="Reinhard";break;case Ao:p="Uncharted2";break;case ko:p="OptimizedCineon";break;case Po:p="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+h)}return"vec3 "+t+"( vec3 color ) { return "+p+"ToneMapping( color ); }"}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,h){return t.replace(/NUM_DIR_LIGHTS/g,h.numDirLights).replace(/NUM_SPOT_LIGHTS/g,h.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,h.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,h.numPointLights).replace(/NUM_HEMI_LIGHTS/g,h.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,h.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,h.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,h.numPointLightShadows)}function replaceClippingPlaneNums(t,h){return t.replace(/NUM_CLIPPING_PLANES/g,h.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,h.numClippingPlanes-h.numClipIntersection)}var Cl=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(Cl,includeReplacer)}function includeReplacer(t,h){var p=hl[h];if(void 0===p)throw new Error("Can not resolve #include <"+h+">");return resolveIncludes(p)}var Sl=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function unrollLoops(t){return t.replace(Sl,loopReplacer)}function loopReplacer(t,h,p,x){for(var M="",k=parseInt(h);k<parseInt(p);k++)M+=x.replace(/\[ i \]/g,"[ "+k+" ]").replace(/UNROLLED_LOOP_INDEX/g,k);return M}function generatePrecision(t){var h="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?h+="\n#define HIGH_PRECISION":"mediump"===t.precision?h+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(h+="\n#define LOW_PRECISION"),h}function WebGLProgram(t,h,p){var x,M,k,I,N,V=t.getContext(),ee=p.defines,te=p.vertexShader,re=p.fragmentShader,ne=function generateShadowMapTypeDefine(t){var h="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===Oa?h="SHADOWMAP_TYPE_PCF":t.shadowMapType===Ra?h="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Fa&&(h="SHADOWMAP_TYPE_VSM"),h}(p),ie=function generateEnvMapTypeDefine(t){var h="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Lo:case Eo:h="ENVMAP_TYPE_CUBE";break;case Ro:case Fo:h="ENVMAP_TYPE_CUBE_UV";break;case Io:case Bo:h="ENVMAP_TYPE_EQUIREC";break;case Oo:h="ENVMAP_TYPE_SPHERE"}return h}(p),ae=function generateEnvMapModeDefine(t){var h="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Eo:case Bo:h="ENVMAP_MODE_REFRACTION"}return h}(p),oe=function generateEnvMapBlendingDefine(t){var h="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Mo:h="ENVMAP_BLENDING_MULTIPLY";break;case wo:h="ENVMAP_BLENDING_MIX";break;case _o:h="ENVMAP_BLENDING_ADD"}return h}(p),se=t.gammaFactor>0?t.gammaFactor:1,ce=p.isWebGL2?"":function generateExtensions(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(p),ue=function generateDefines(t){var h=[];for(var p in t){var x=t[p];!1!==x&&h.push("#define "+p+" "+x)}return h.join("\n")}(ee),le=V.createProgram(),he=p.numMultiviewViews;if(p.isRawShaderMaterial?((x=[ue].filter(filterEmptyLine).join("\n")).length>0&&(x+="\n"),(M=[ce,ue].filter(filterEmptyLine).join("\n")).length>0&&(M+="\n")):(x=[generatePrecision(p),"#define SHADER_NAME "+p.shaderName,ue,p.instancing?"#define USE_INSTANCING":"",p.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+se,"#define MAX_BONES "+p.maxBones,p.useFog&&p.fog?"#define USE_FOG":"",p.useFog&&p.fogExp2?"#define FOG_EXP2":"",p.map?"#define USE_MAP":"",p.envMap?"#define USE_ENVMAP":"",p.envMap?"#define "+ae:"",p.lightMap?"#define USE_LIGHTMAP":"",p.aoMap?"#define USE_AOMAP":"",p.emissiveMap?"#define USE_EMISSIVEMAP":"",p.bumpMap?"#define USE_BUMPMAP":"",p.normalMap?"#define USE_NORMALMAP":"",p.normalMap&&p.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",p.normalMap&&p.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",p.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",p.displacementMap&&p.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",p.specularMap?"#define USE_SPECULARMAP":"",p.roughnessMap?"#define USE_ROUGHNESSMAP":"",p.metalnessMap?"#define USE_METALNESSMAP":"",p.alphaMap?"#define USE_ALPHAMAP":"",p.vertexTangents?"#define USE_TANGENT":"",p.vertexColors?"#define USE_COLOR":"",p.vertexUvs?"#define USE_UV":"",p.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",p.flatShading?"#define FLAT_SHADED":"",p.skinning?"#define USE_SKINNING":"",p.useVertexTexture?"#define BONE_TEXTURE":"",p.morphTargets?"#define USE_MORPHTARGETS":"",p.morphNormals&&!1===p.flatShading?"#define USE_MORPHNORMALS":"",p.doubleSided?"#define DOUBLE_SIDED":"",p.flipSided?"#define FLIP_SIDED":"",p.shadowMapEnabled?"#define USE_SHADOWMAP":"",p.shadowMapEnabled?"#define "+ne:"",p.sizeAttenuation?"#define USE_SIZEATTENUATION":"",p.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",p.logarithmicDepthBuffer&&p.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),M=[ce,generatePrecision(p),"#define SHADER_NAME "+p.shaderName,ue,p.alphaTest?"#define ALPHATEST "+p.alphaTest+(p.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+se,p.useFog&&p.fog?"#define USE_FOG":"",p.useFog&&p.fogExp2?"#define FOG_EXP2":"",p.map?"#define USE_MAP":"",p.matcap?"#define USE_MATCAP":"",p.envMap?"#define USE_ENVMAP":"",p.envMap?"#define "+ie:"",p.envMap?"#define "+ae:"",p.envMap?"#define "+oe:"",p.lightMap?"#define USE_LIGHTMAP":"",p.aoMap?"#define USE_AOMAP":"",p.emissiveMap?"#define USE_EMISSIVEMAP":"",p.bumpMap?"#define USE_BUMPMAP":"",p.normalMap?"#define USE_NORMALMAP":"",p.normalMap&&p.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",p.normalMap&&p.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",p.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",p.specularMap?"#define USE_SPECULARMAP":"",p.roughnessMap?"#define USE_ROUGHNESSMAP":"",p.metalnessMap?"#define USE_METALNESSMAP":"",p.alphaMap?"#define USE_ALPHAMAP":"",p.sheen?"#define USE_SHEEN":"",p.vertexTangents?"#define USE_TANGENT":"",p.vertexColors?"#define USE_COLOR":"",p.vertexUvs?"#define USE_UV":"",p.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",p.gradientMap?"#define USE_GRADIENTMAP":"",p.flatShading?"#define FLAT_SHADED":"",p.doubleSided?"#define DOUBLE_SIDED":"",p.flipSided?"#define FLIP_SIDED":"",p.shadowMapEnabled?"#define USE_SHADOWMAP":"",p.shadowMapEnabled?"#define "+ne:"",p.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",p.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",p.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",p.logarithmicDepthBuffer&&p.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(p.extensionShaderTextureLOD||p.envMap)&&p.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",p.toneMapping!==Co?"#define TONE_MAPPING":"",p.toneMapping!==Co?hl.tonemapping_pars_fragment:"",p.toneMapping!==Co?getToneMappingFunction("toneMapping",p.toneMapping):"",p.dithering?"#define DITHERING":"",p.outputEncoding||p.mapEncoding||p.matcapEncoding||p.envMapEncoding||p.emissiveMapEncoding||p.lightMapEncoding?hl.encodings_pars_fragment:"",p.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",p.mapEncoding):"",p.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",p.matcapEncoding):"",p.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",p.envMapEncoding):"",p.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",p.emissiveMapEncoding):"",p.lightMapEncoding?getTexelDecodingFunction("lightMapTexelToLinear",p.lightMapEncoding):"",p.outputEncoding?(k="linearToOutputTexel",I=p.outputEncoding,N=getEncodingComponents(I),"vec4 "+k+"( vec4 value ) { return LinearTo"+N[0]+N[1]+"; }"):"",p.depthPacking?"#define DEPTH_PACKING "+p.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),te=replaceClippingPlaneNums(te=replaceLightNums(te=resolveIncludes(te),p),p),re=replaceClippingPlaneNums(re=replaceLightNums(re=resolveIncludes(re),p),p),te=unrollLoops(te),re=unrollLoops(re),p.isWebGL2&&!p.isRawShaderMaterial){var fe=!1,de=/^\s*#version\s+300\s+es\s*\n/;p.isShaderMaterial&&null!==te.match(de)&&null!==re.match(de)&&(fe=!0,te=te.replace(de,""),re=re.replace(de,"")),x=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,M=["#version 300 es\n","#define varying in",fe?"":"out highp vec4 pc_fragColor;",fe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+M,he>0&&(x=(x=x.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+he+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+he+"];","uniform mat4 projectionMatrices["+he+"];","uniform mat4 viewMatrices["+he+"];","uniform mat3 normalMatrices["+he+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),M=(M=M.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+he+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var pe,me,ge=M+re,ve=WebGLShader(V,35633,x+te),ye=WebGLShader(V,35632,ge);if(V.attachShader(le,ve),V.attachShader(le,ye),void 0!==p.index0AttributeName?V.bindAttribLocation(le,0,p.index0AttributeName):!0===p.morphTargets&&V.bindAttribLocation(le,0,"position"),V.linkProgram(le),t.debug.checkShaderErrors){var be=V.getProgramInfoLog(le).trim(),xe=V.getShaderInfoLog(ve).trim(),Me=V.getShaderInfoLog(ye).trim(),we=!0,_e=!0;if(!1===V.getProgramParameter(le,35714)){we=!1;getShaderErrors(V,ve,"vertex"),getShaderErrors(V,ye,"fragment")}else""!==be||""!==xe&&""!==Me||(_e=!1);_e&&(this.diagnostics={runnable:we,programLog:be,vertexShader:{log:xe,prefix:x},fragmentShader:{log:Me,prefix:M}})}return V.deleteShader(ve),V.deleteShader(ye),this.getUniforms=function(){return void 0===pe&&(pe=new WebGLUniforms(V,le)),pe},this.getAttributes=function(){return void 0===me&&(me=function fetchAttributeLocations(t,h){for(var p={},x=t.getProgramParameter(h,35721),M=0;M<x;M++){var k=t.getActiveAttrib(h,M).name;p[k]=t.getAttribLocation(h,k)}return p}(V,le)),me},this.destroy=function(){V.deleteProgram(le),this.program=void 0},this.name=p.shaderName,this.id=_l++,this.cacheKey=h,this.usedTimes=1,this.program=le,this.vertexShader=ve,this.fragmentShader=ye,this.numMultiviewViews=he,this}function WebGLPrograms(t,h,p){var x=[],M=p.isWebGL2,k=p.logarithmicDepthBuffer,I=p.floatVertexTextures,N=p.precision,V=p.maxVertexUniforms,ee=p.vertexTextures,te={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},re=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function getTextureEncodingFromMap(t){var h;return t?t.isTexture?h=t.encoding:t.isWebGLRenderTarget&&(h=t.texture.encoding):h=Ys,h}this.getParameters=function(x,re,ne,ie,ae,oe,se){var ce=ie.fog,ue=x.isMeshStandardMaterial?ie.environment:null,le=x.envMap||ue,he=te[x.type],fe=se.isSkinnedMesh?function allocateBones(t){var h=t.skeleton.bones;if(I)return 1024;var p=V,x=Math.floor((p-20)/4),M=Math.min(x,h.length);return M<h.length?0:M}(se):0;null!==x.precision&&(N=p.getMaxPrecision(x.precision),x.precision);var de=function getShaderObject(t,h){var p;if(h){var x=fl[h];p={name:t.type,uniforms:nl.clone(x.uniforms),vertexShader:x.vertexShader,fragmentShader:x.fragmentShader}}else p={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return p}(x,he);x.onBeforeCompile(de,t);var pe=t.getRenderTarget(),me=pe&&pe.isWebGLMultiviewRenderTarget?pe.numViews:0;return{isWebGL2:M,shaderID:he,shaderName:de.name,uniforms:de.uniforms,vertexShader:de.vertexShader,fragmentShader:de.fragmentShader,defines:x.defines,isRawShaderMaterial:x.isRawShaderMaterial,isShaderMaterial:x.isShaderMaterial,precision:N,instancing:!0===se.isInstancedMesh,supportsVertexTextures:ee,numMultiviewViews:me,outputEncoding:null!==pe?getTextureEncodingFromMap(pe.texture):t.outputEncoding,map:!!x.map,mapEncoding:getTextureEncodingFromMap(x.map),matcap:!!x.matcap,matcapEncoding:getTextureEncodingFromMap(x.matcap),envMap:!!le,envMapMode:le&&le.mapping,envMapEncoding:getTextureEncodingFromMap(le),envMapCubeUV:!!le&&(le.mapping===Ro||le.mapping===Fo),lightMap:!!x.lightMap,lightMapEncoding:getTextureEncodingFromMap(x.lightMap),aoMap:!!x.aoMap,emissiveMap:!!x.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(x.emissiveMap),bumpMap:!!x.bumpMap,normalMap:!!x.normalMap,objectSpaceNormalMap:x.normalMapType===sc,tangentSpaceNormalMap:x.normalMapType===oc,clearcoatNormalMap:!!x.clearcoatNormalMap,displacementMap:!!x.displacementMap,roughnessMap:!!x.roughnessMap,metalnessMap:!!x.metalnessMap,specularMap:!!x.specularMap,alphaMap:!!x.alphaMap,gradientMap:!!x.gradientMap,sheen:!!x.sheen,combine:x.combine,vertexTangents:x.normalMap&&x.vertexTangents,vertexColors:x.vertexColors,vertexUvs:!!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatNormalMap||x.displacementMap),uvsVertexOnly:!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatNormalMap||!x.displacementMap),fog:!!ce,useFog:x.fog,fogExp2:ce&&ce.isFogExp2,flatShading:x.flatShading,sizeAttenuation:x.sizeAttenuation,logarithmicDepthBuffer:k,skinning:x.skinning&&fe>0,maxBones:fe,useVertexTexture:I,morphTargets:x.morphTargets,morphNormals:x.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:re.directional.length,numPointLights:re.point.length,numSpotLights:re.spot.length,numRectAreaLights:re.rectArea.length,numHemiLights:re.hemi.length,numDirLightShadows:re.directionalShadowMap.length,numPointLightShadows:re.pointShadowMap.length,numSpotLightShadows:re.spotShadowMap.length,numClippingPlanes:ae,numClipIntersection:oe,dithering:x.dithering,shadowMapEnabled:t.shadowMap.enabled&&ne.length>0,shadowMapType:t.shadowMap.type,toneMapping:x.toneMapped?t.toneMapping:Co,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:x.premultipliedAlpha,alphaTest:x.alphaTest,doubleSided:x.side===Ga,flipSided:x.side===Va,depthPacking:void 0!==x.depthPacking&&x.depthPacking,index0AttributeName:x.index0AttributeName,extensionDerivatives:x.extensions&&x.extensions.derivatives,extensionFragDepth:x.extensions&&x.extensions.frawbuffers,extensionDrawbuffers:x.extensions&&x.extensions.drawbuffers,extensionShaderTextureLOD:x.extensions&&x.extensions.shaderTextureLOD,rendererExtensionFragDepth:M||null!==h.get("EXT_frag_depth"),rendererExtensionDrawBuffers:M||null!==h.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:M||null!==h.get("EXT_shader_texture_lod"),onBeforeCompile:x.onBeforeCompile}},this.getProgramCacheKey=function(h){var p=[];if(h.shaderID?p.push(h.shaderID):(p.push(h.fragmentShader),p.push(h.vertexShader)),void 0!==h.defines)for(var x in h.defines)p.push(x),p.push(h.defines[x]);if(void 0===h.isRawShaderMaterial){for(var M=0;M<re.length;M++)p.push(h[re[M]]);p.push(t.outputEncoding),p.push(t.gammaFactor)}return p.push(h.onBeforeCompile.toString()),p.join()},this.acquireProgram=function(h,p){for(var M,k=0,I=x.length;k<I;k++){var N=x[k];if(N.cacheKey===p){++(M=N).usedTimes;break}}return void 0===M&&(M=new WebGLProgram(t,p,h),x.push(M)),M},this.releaseProgram=function(t){if(0==--t.usedTimes){var h=x.indexOf(t);x[h]=x[x.length-1],x.pop(),t.destroy()}},this.programs=x}function WebGLProperties(){var t=new WeakMap;return{get:function get(h){var p=t.get(h);return void 0===p&&(p={},t.set(h,p)),p},remove:function remove(h){t.delete(h)},update:function update(h,p,x){t.get(h)[p]=x},dispose:function dispose(){t=new WeakMap}}}function painterSortStable(t,h){return t.groupOrder!==h.groupOrder?t.groupOrder-h.groupOrder:t.renderOrder!==h.renderOrder?t.renderOrder-h.renderOrder:t.program!==h.program?t.program.id-h.program.id:t.material.id!==h.material.id?t.material.id-h.material.id:t.z!==h.z?t.z-h.z:t.id-h.id}function reversePainterSortStable(t,h){return t.groupOrder!==h.groupOrder?t.groupOrder-h.groupOrder:t.renderOrder!==h.renderOrder?t.renderOrder-h.renderOrder:t.z!==h.z?h.z-t.z:t.id-h.id}function WebGLRenderList(){var t=[],h=0,p=[],x=[],M={id:-1};function getNextRenderItem(p,x,k,I,N,V){var ee=t[h];return void 0===ee?(ee={id:p.id,object:p,geometry:x,material:k,program:k.program||M,groupOrder:I,renderOrder:p.renderOrder,z:N,group:V},t[h]=ee):(ee.id=p.id,ee.object=p,ee.geometry=x,ee.material=k,ee.program=k.program||M,ee.groupOrder=I,ee.renderOrder=p.renderOrder,ee.z=N,ee.group=V),h++,ee}return{opaque:p,transparent:x,init:function init(){h=0,p.length=0,x.length=0},push:function push(t,h,M,k,I,N){var V=getNextRenderItem(t,h,M,k,I,N);(!0===M.transparent?x:p).push(V)},unshift:function unshift(t,h,M,k,I,N){var V=getNextRenderItem(t,h,M,k,I,N);(!0===M.transparent?x:p).unshift(V)},sort:function sort(t,h){p.length>1&&p.sort(t||painterSortStable),x.length>1&&x.sort(h||reversePainterSortStable)}}}function WebGLRenderLists(){var t=new WeakMap;function onSceneDispose(h){var p=h.target;p.removeEventListener("dispose",onSceneDispose),t.delete(p)}return{get:function get(h,p){var x,M=t.get(h);return void 0===M?(x=new WebGLRenderList,t.set(h,new WeakMap),t.get(h).set(p,x),h.addEventListener("dispose",onSceneDispose)):void 0===(x=M.get(p))&&(x=new WebGLRenderList,M.set(p,x)),x},dispose:function dispose(){t=new WeakMap}}}function UniformsCache(){var t={};return{get:function(h){if(void 0!==t[h.id])return t[h.id];var p;switch(h.type){case"DirectionalLight":p={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":p={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":p={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":p={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":p={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return t[h.id]=p,p}}}var Tl=0;function shadowCastingLightsFirst(t,h){return(h.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(){for(var t=new UniformsCache,h={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},p=0;p<9;p++)h.probe.push(new Vector3);var x=new Vector3,M=new Matrix4,k=new Matrix4;return{setup:function setup(p,I,N){for(var V=0,ee=0,te=0,re=0;re<9;re++)h.probe[re].set(0,0,0);var ne=0,ie=0,ae=0,oe=0,se=0,ce=0,ue=0,le=0,he=N.matrixWorldInverse;p.sort(shadowCastingLightsFirst),re=0;for(var fe=p.length;re<fe;re++){var de=p[re],pe=de.color,me=de.intensity,ge=de.distance,ve=de.shadow&&de.shadow.map?de.shadow.map.texture:null;if(de.isAmbientLight)V+=pe.r*me,ee+=pe.g*me,te+=pe.b*me;else if(de.isLightProbe)for(var ye=0;ye<9;ye++)h.probe[ye].addScaledVector(de.sh.coefficients[ye],me);else if(de.isDirectionalLight){if((xe=t.get(de)).color.copy(de.color).multiplyScalar(de.intensity),xe.direction.setFromMatrixPosition(de.matrixWorld),x.setFromMatrixPosition(de.target.matrixWorld),xe.direction.sub(x),xe.direction.transformDirection(he),xe.shadow=de.castShadow,de.castShadow){var be=de.shadow;xe.shadowBias=be.bias,xe.shadowRadius=be.radius,xe.shadowMapSize=be.mapSize,h.directionalShadowMap[ne]=ve,h.directionalShadowMatrix[ne]=de.shadow.matrix,ce++}h.directional[ne]=xe,ne++}else if(de.isSpotLight){if((xe=t.get(de)).position.setFromMatrixPosition(de.matrixWorld),xe.position.applyMatrix4(he),xe.color.copy(pe).multiplyScalar(me),xe.distance=ge,xe.direction.setFromMatrixPosition(de.matrixWorld),x.setFromMatrixPosition(de.target.matrixWorld),xe.direction.sub(x),xe.direction.transformDirection(he),xe.coneCos=Math.cos(de.angle),xe.penumbraCos=Math.cos(de.angle*(1-de.penumbra)),xe.decay=de.decay,xe.shadow=de.castShadow,de.castShadow){be=de.shadow;xe.shadowBias=be.bias,xe.shadowRadius=be.radius,xe.shadowMapSize=be.mapSize,h.spotShadowMap[ae]=ve,h.spotShadowMatrix[ae]=de.shadow.matrix,le++}h.spot[ae]=xe,ae++}else if(de.isRectAreaLight){(xe=t.get(de)).color.copy(pe).multiplyScalar(me),xe.position.setFromMatrixPosition(de.matrixWorld),xe.position.applyMatrix4(he),k.identity(),M.copy(de.matrixWorld),M.premultiply(he),k.extractRotation(M),xe.halfWidth.set(.5*de.width,0,0),xe.halfHeight.set(0,.5*de.height,0),xe.halfWidth.applyMatrix4(k),xe.halfHeight.applyMatrix4(k),h.rectArea[oe]=xe,oe++}else if(de.isPointLight){if((xe=t.get(de)).position.setFromMatrixPosition(de.matrixWorld),xe.position.applyMatrix4(he),xe.color.copy(de.color).multiplyScalar(de.intensity),xe.distance=de.distance,xe.decay=de.decay,xe.shadow=de.castShadow,de.castShadow){be=de.shadow;xe.shadowBias=be.bias,xe.shadowRadius=be.radius,xe.shadowMapSize=be.mapSize,xe.shadowCameraNear=be.camera.near,xe.shadowCameraFar=be.camera.far,h.pointShadowMap[ie]=ve,h.pointShadowMatrix[ie]=de.shadow.matrix,ue++}h.point[ie]=xe,ie++}else if(de.isHemisphereLight){var xe;(xe=t.get(de)).direction.setFromMatrixPosition(de.matrixWorld),xe.direction.transformDirection(he),xe.direction.normalize(),xe.skyColor.copy(de.color).multiplyScalar(me),xe.groundColor.copy(de.groundColor).multiplyScalar(me),h.hemi[se]=xe,se++}}h.ambient[0]=V,h.ambient[1]=ee,h.ambient[2]=te;var Me=h.hash;Me.directionalLength===ne&&Me.pointLength===ie&&Me.spotLength===ae&&Me.rectAreaLength===oe&&Me.hemiLength===se&&Me.numDirectionalShadows===ce&&Me.numPointShadows===ue&&Me.numSpotShadows===le||(h.directional.length=ne,h.spot.length=ae,h.rectArea.length=oe,h.point.length=ie,h.hemi.length=se,h.directionalShadowMap.length=ce,h.pointShadowMap.length=ue,h.spotShadowMap.length=le,h.directionalShadowMatrix.length=ce,h.pointShadowMatrix.length=ue,h.spotShadowMatrix.length=le,Me.directionalLength=ne,Me.pointLength=ie,Me.spotLength=ae,Me.rectAreaLength=oe,Me.hemiLength=se,Me.numDirectionalShadows=ce,Me.numPointShadows=ue,Me.numSpotShadows=le,h.version=Tl++)},state:h}}function WebGLRenderState(){var t=new WebGLLights,h=[],p=[];return{init:function init(){h.length=0,p.length=0},state:{lightsArray:h,shadowsArray:p,lights:t},setupLights:function setupLights(x){t.setup(h,p,x)},pushLight:function pushLight(t){h.push(t)},pushShadow:function pushShadow(t){p.push(t)}}}function WebGLRenderStates(){var t=new WeakMap;function onSceneDispose(h){var p=h.target;p.removeEventListener("dispose",onSceneDispose),t.delete(p)}return{get:function get(h,p){var x;return!1===t.has(h)?(x=new WebGLRenderState,t.set(h,new WeakMap),t.get(h).set(p,x),h.addEventListener("dispose",onSceneDispose)):!1===t.get(h).has(p)?(x=new WebGLRenderState,t.get(h).set(p,x)):x=t.get(h).get(p),x},dispose:function dispose(){t=new WeakMap}}}function MeshDepthMaterial(t){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=ic,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function MeshDistanceMaterial(t){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var Al="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Dl="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(t,h,p){var x=new Frustum,M=new Vector2,k=new Vector2,I=new Vector4,N=[],V=[],ee={},te={0:Va,1:Na,2:Ga},re=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:Dl,fragmentShader:Al}),ne=re.clone();ne.defines.HORIZONAL_PASS=1;var ie=new BufferGeometry;ie.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var ae=new Mesh(ie,re),oe=this;function VSMPass(p,x){var M=h.update(ae);re.uniforms.shadow_pass.value=p.map.texture,re.uniforms.resolution.value=p.mapSize,re.uniforms.radius.value=p.radius,t.setRenderTarget(p.mapPass),t.clear(),t.renderBufferDirect(x,null,M,re,ae,null),ne.uniforms.shadow_pass.value=p.mapPass.texture,ne.uniforms.resolution.value=p.mapSize,ne.uniforms.radius.value=p.radius,t.setRenderTarget(p.map),t.clear(),t.renderBufferDirect(x,null,M,ne,ae,null)}function getDepthMaterialVariant(t,h,p){var x=t<<0|h<<1|p<<2,M=N[x];return void 0===M&&(M=new MeshDepthMaterial({depthPacking:ac,morphTargets:t,skinning:h}),N[x]=M),M}function getDistanceMaterialVariant(t,h,p){var x=t<<0|h<<1|p<<2,M=V[x];return void 0===M&&(M=new MeshDistanceMaterial({morphTargets:t,skinning:h}),V[x]=M),M}function getDepthMaterial(h,p,x,M,k,I){var N=h.geometry,V=null,re=getDepthMaterialVariant,ne=h.customDepthMaterial;if(!0===x.isPointLight&&(re=getDistanceMaterialVariant,ne=h.customDistanceMaterial),void 0===ne){var ie=!1;!0===p.morphTargets&&(!0===N.isBufferGeometry?ie=N.morphAttributes&&N.morphAttributes.position&&N.morphAttributes.position.length>0:!0===N.isGeometry&&(ie=N.morphTargets&&N.morphTargets.length>0));var ae=!1;!0===h.isSkinnedMesh&&!0===p.skinning&&(ae=!0),V=re(ie,ae,!0===h.isInstancedMesh)}else V=ne;if(t.localClippingEnabled&&!0===p.clipShadows&&0!==p.clippingPlanes.length){var oe=V.uuid,se=p.uuid,ce=ee[oe];void 0===ce&&(ce={},ee[oe]=ce);var ue=ce[se];void 0===ue&&(ue=V.clone(),ce[se]=ue),V=ue}return V.visible=p.visible,V.wireframe=p.wireframe,V.side=I===Fa?null!==p.shadowSide?p.shadowSide:p.side:null!==p.shadowSide?p.shadowSide:te[p.side],V.clipShadows=p.clipShadows,V.clippingPlanes=p.clippingPlanes,V.clipIntersection=p.clipIntersection,V.wireframeLinewidth=p.wireframeLinewidth,V.linewidth=p.linewidth,!0===x.isPointLight&&!0===V.isMeshDistanceMaterial&&(V.referencePosition.setFromMatrixPosition(x.matrixWorld),V.nearDistance=M,V.farDistance=k),V}function renderObject(p,M,k,I,N){if(!1!==p.visible){if(p.layers.test(M.layers)&&(p.isMesh||p.isLine||p.isPoints)&&(p.castShadow||p.receiveShadow&&N===Fa)&&(!p.frustumCulled||x.intersectsObject(p))){p.modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,p.matrixWorld);var V=h.update(p),ee=p.material;if(Array.isArray(ee))for(var te=V.groups,re=0,ne=te.length;re<ne;re++){var ie=te[re],ae=ee[ie.materialIndex];if(ae&&ae.visible){var oe=getDepthMaterial(p,ae,I,k.near,k.far,N);t.renderBufferDirect(k,null,V,oe,p,ie)}}else if(ee.visible){oe=getDepthMaterial(p,ee,I,k.near,k.far,N);t.renderBufferDirect(k,null,V,oe,p,null)}}for(var se=p.children,ce=0,ue=se.length;ce<ue;ce++)renderObject(se[ce],M,k,I,N)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Oa,this.render=function(h,N,V){if(!1!==oe.enabled&&(!1!==oe.autoUpdate||!1!==oe.needsUpdate)&&0!==h.length){var ee=t.getRenderTarget(),te=t.getActiveCubeFace(),re=t.getActiveMipmapLevel(),ne=t.state;ne.setBlending(Ua),ne.buffers.color.setClear(1,1,1,1),ne.buffers.depth.setTest(!0),ne.setScissorTest(!1);for(var ie=0,ae=h.length;ie<ae;ie++){var se=h[ie],ce=se.shadow;if(void 0!==ce){M.copy(ce.mapSize);var ue=ce.getFrameExtents();if(M.multiply(ue),k.copy(ce.mapSize),(M.x>p||M.y>p)&&(M.x>p&&(k.x=Math.floor(p/ue.x),M.x=k.x*ue.x,ce.mapSize.x=k.x),M.y>p&&(k.y=Math.floor(p/ue.y),M.y=k.y*ue.y,ce.mapSize.y=k.y)),null===ce.map&&!ce.isPointLightShadow&&this.type===Fa){var le={minFilter:Ho,magFilter:Ho,format:us};ce.map=new WebGLRenderTarget(M.x,M.y,le),ce.map.texture.name=se.name+".shadowMap",ce.mapPass=new WebGLRenderTarget(M.x,M.y,le),ce.camera.updateProjectionMatrix()}if(null===ce.map){le={minFilter:Uo,magFilter:Uo,format:us};ce.map=new WebGLRenderTarget(M.x,M.y,le),ce.map.texture.name=se.name+".shadowMap",ce.camera.updateProjectionMatrix()}t.setRenderTarget(ce.map),t.clear();for(var he=ce.getViewportCount(),fe=0;fe<he;fe++){var de=ce.getViewport(fe);I.set(k.x*de.x,k.y*de.y,k.x*de.z,k.y*de.w),ne.viewport(I),ce.updateMatrices(se,fe),x=ce.getFrustum(),renderObject(N,V,ce.camera,se,this.type)}ce.isPointLightShadow||this.type!==Fa||VSMPass(ce,V)}}oe.needsUpdate=!1,t.setRenderTarget(ee,te,re)}}}function WebGLState(t,h,p){var x=p.isWebGL2;var M=new function ColorBuffer(){var h=!1,p=new Vector4,x=null,M=new Vector4(0,0,0,0);return{setMask:function(p){x===p||h||(t.colorMask(p,p,p,p),x=p)},setLocked:function(t){h=t},setClear:function(h,x,k,I,N){!0===N&&(h*=I,x*=I,k*=I),p.set(h,x,k,I),!1===M.equals(p)&&(t.clearColor(h,x,k,I),M.copy(p))},reset:function(){h=!1,x=null,M.set(-1,0,0,0)}}},k=new function DepthBuffer(){var h=!1,p=null,x=null,M=null;return{setTest:function(t){t?enable(2929):disable(2929)},setMask:function(x){p===x||h||(t.depthMask(x),p=x)},setFunc:function(h){if(x!==h){if(h)switch(h){case ho:t.depthFunc(512);break;case fo:t.depthFunc(519);break;case po:t.depthFunc(513);break;case mo:t.depthFunc(515);break;case vo:t.depthFunc(514);break;case yo:t.depthFunc(518);break;case bo:t.depthFunc(516);break;case xo:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);x=h}},setLocked:function(t){h=t},setClear:function(h){M!==h&&(t.clearDepth(h),M=h)},reset:function(){h=!1,p=null,x=null,M=null}}},I=new function StencilBuffer(){var h=!1,p=null,x=null,M=null,k=null,I=null,N=null,V=null,ee=null;return{setTest:function(t){h||(t?enable(2960):disable(2960))},setMask:function(x){p===x||h||(t.stencilMask(x),p=x)},setFunc:function(h,p,I){x===h&&M===p&&k===I||(t.stencilFunc(h,p,I),x=h,M=p,k=I)},setOp:function(h,p,x){I===h&&N===p&&V===x||(t.stencilOp(h,p,x),I=h,N=p,V=x)},setLocked:function(t){h=t},setClear:function(h){ee!==h&&(t.clearStencil(h),ee=h)},reset:function(){h=!1,p=null,x=null,M=null,k=null,I=null,N=null,V=null,ee=null}}},N=t.getParameter(34921),V=new Uint8Array(N),ee=new Uint8Array(N),te=new Uint8Array(N),re={},ne=null,ie=null,ae=null,oe=null,se=null,ce=null,ue=null,le=null,he=null,fe=!1,de=null,pe=null,me=null,ge=null,ve=null,ye=t.getParameter(35661),be=!1,xe=0,Me=t.getParameter(7938);-1!==Me.indexOf("WebGL")?(xe=parseFloat(/^WebGL\ ([0-9])/.exec(Me)[1]),be=xe>=1):-1!==Me.indexOf("OpenGL ES")&&(xe=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Me)[1]),be=xe>=2);var we=null,_e={},Ce=new Vector4,Se=new Vector4;function createTexture(h,p,x){var M=new Uint8Array(4),k=t.createTexture();t.bindTexture(h,k),t.texParameteri(h,10241,9728),t.texParameteri(h,10240,9728);for(var I=0;I<x;I++)t.texImage2D(p+I,0,6408,1,1,0,6408,5121,M);return k}var Te={};function enableAttributeAndDivisor(p,M){(V[p]=1,0===ee[p]&&(t.enableVertexAttribArray(p),ee[p]=1),te[p]!==M)&&((x?t:h.get("ANGLE_instanced_arrays"))[x?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](p,M),te[p]=M)}function enable(h){!0!==re[h]&&(t.enable(h),re[h]=!0)}function disable(h){!1!==re[h]&&(t.disable(h),re[h]=!1)}Te[3553]=createTexture(3553,3553,1),Te[34067]=createTexture(34067,34069,6),M.setClear(0,0,0,1),k.setClear(1),I.setClear(0),enable(2929),k.setFunc(mo),setFlipSided(!1),setCullFace(Ia),enable(2884),setBlending(Ua);var Ae={[Ka]:32774,[Ya]:32778,[Za]:32779};if(x)Ae[Ja]=32775,Ae[Qa]=32776;else{var De=h.get("EXT_blend_minmax");null!==De&&(Ae[Ja]=De.MIN_EXT,Ae[Qa]=De.MAX_EXT)}var ke={[eo]:0,[to]:1,[ro]:768,[io]:770,[lo]:776,[co]:774,[oo]:772,[no]:769,[ao]:771,[uo]:775,[so]:773};function setBlending(h,p,x,M,k,I,N,V){if(h!==Ua){if(ie||(enable(3042),ie=!0),h===qa)k=k||p,I=I||x,N=N||M,p===oe&&k===ue||(t.blendEquationSeparate(Ae[p],Ae[k]),oe=p,ue=k),x===se&&M===ce&&I===le&&N===he||(t.blendFuncSeparate(ke[x],ke[M],ke[I],ke[N]),se=x,ce=M,le=I,he=N),ae=h,fe=null;else if(h!==ae||V!==fe){if(oe===Ka&&ue===Ka||(t.blendEquation(32774),oe=Ka,ue=Ka),V)switch(h){case za:t.blendFuncSeparate(1,771,1,771);break;case Wa:t.blendFunc(1,1);break;case Ha:t.blendFuncSeparate(0,0,769,771);break;case $a:t.blendFuncSeparate(0,768,0,770)}else switch(h){case za:t.blendFuncSeparate(770,771,1,771);break;case Wa:t.blendFunc(770,1);break;case Ha:t.blendFunc(0,769);break;case $a:t.blendFunc(0,768)}se=null,ce=null,le=null,he=null,ae=h,fe=V}}else ie&&(disable(3042),ie=!1)}function setFlipSided(h){de!==h&&(h?t.frontFace(2304):t.frontFace(2305),de=h)}function setCullFace(h){h!==Ea?(enable(2884),h!==pe&&(h===Ia?t.cullFace(1029):h===Ba?t.cullFace(1028):t.cullFace(1032))):disable(2884),pe=h}function setPolygonOffset(h,p,x){h?(enable(32823),ge===p&&ve===x||(t.polygonOffset(p,x),ge=p,ve=x)):disable(32823)}function activeTexture(h){void 0===h&&(h=33984+ye-1),we!==h&&(t.activeTexture(h),we=h)}return{buffers:{color:M,depth:k,stencil:I},initAttributes:function initAttributes(){for(var t=0,h=V.length;t<h;t++)V[t]=0},enableAttribute:function enableAttribute(t){enableAttributeAndDivisor(t,0)},enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:function disableUnusedAttributes(){for(var h=0,p=ee.length;h!==p;++h)ee[h]!==V[h]&&(t.disableVertexAttribArray(h),ee[h]=0)},enable:enable,disable:disable,useProgram:function useProgram(h){return ne!==h&&(t.useProgram(h),ne=h,!0)},setBlending:setBlending,setMaterial:function setMaterial(t,h){t.side===Ga?disable(2884):enable(2884);var p=t.side===Va;h&&(p=!p),setFlipSided(p),t.blending===za&&!1===t.transparent?setBlending(Ua):setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),k.setFunc(t.depthFunc),k.setTest(t.depthTest),k.setMask(t.depthWrite),M.setMask(t.colorWrite);var x=t.stencilWrite;I.setTest(x),x&&(I.setMask(t.stencilWriteMask),I.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),I.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function setLineWidth(h){h!==me&&(be&&t.lineWidth(h),me=h)},setPolygonOffset:setPolygonOffset,setScissorTest:function setScissorTest(t){t?enable(3089):disable(3089)},activeTexture:activeTexture,bindTexture:function bindTexture(h,p){null===we&&activeTexture();var x=_e[we];void 0===x&&(x={type:void 0,texture:void 0},_e[we]=x),x.type===h&&x.texture===p||(t.bindTexture(h,p||Te[h]),x.type=h,x.texture=p)},unbindTexture:function unbindTexture(){var h=_e[we];void 0!==h&&void 0!==h.type&&(t.bindTexture(h.type,null),h.type=void 0,h.texture=void 0)},compressedTexImage2D:function compressedTexImage2D(){try{t.compressedTexImage2D.apply(t,arguments)}catch(h){}},texImage2D:function texImage2D(){try{t.texImage2D.apply(t,arguments)}catch(h){}},texImage3D:function texImage3D(){try{t.texImage3D.apply(t,arguments)}catch(h){}},scissor:function scissor(h){!1===Ce.equals(h)&&(t.scissor(h.x,h.y,h.z,h.w),Ce.copy(h))},viewport:function viewport(h){!1===Se.equals(h)&&(t.viewport(h.x,h.y,h.z,h.w),Se.copy(h))},reset:function reset(){for(var h=0;h<ee.length;h++)1===ee[h]&&(t.disableVertexAttribArray(h),ee[h]=0);re={},we=null,_e={},ne=null,ae=null,de=null,pe=null,M.reset(),k.reset(),I.reset()}}}function WebGLTextures(t,h,p,x,M,k,I){var N,V=M.isWebGL2,ee=(M.maxTextures,M.maxCubemapSize),te=M.maxTextureSize,re=M.maxSamples,ne=new WeakMap,ie=!1;try{ie="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(le){}function createCanvas(t,h){return ie?new OffscreenCanvas(t,h):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function resizeImage(t,h,p,x){var M=1;if((t.width>x||t.height>x)&&(M=x/Math.max(t.width,t.height)),M<1||!0===h){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var k=h?gc.floorPowerOfTwo:Math.floor,I=k(M*t.width),V=k(M*t.height);void 0===N&&(N=createCanvas(I,V));var ee=p?createCanvas(I,V):N;return ee.width=I,ee.height=V,ee.getContext("2d").drawImage(t,0,0,I,V),ee}return t}return t}function isPowerOfTwo(t){return gc.isPowerOfTwo(t.width)&&gc.isPowerOfTwo(t.height)}function textureNeedsGenerateMipmaps(t,h){return t.generateMipmaps&&h&&t.minFilter!==Uo&&t.minFilter!==Ho}function generateMipmap(h,p,M,k){t.generateMipmap(h),x.get(p).__maxMipLevel=Math.log(Math.max(M,k))*Math.LOG2E}function getInternalFormat(p,x,M){if(!1===V)return x;if(null!==p&&void 0!==t[p])return t[p];var k=x;return 6403===x&&(5126===M&&(k=33326),5131===M&&(k=33325),5121===M&&(k=33321)),6407===x&&(5126===M&&(k=34837),5131===M&&(k=34843),5121===M&&(k=32849)),6408===x&&(5126===M&&(k=34836),5131===M&&(k=34842),5121===M&&(k=32856)),33325!==k&&33326!==k&&34842!==k&&34836!==k||h.get("EXT_color_buffer_float"),k}function filterFallback(t){return t===Uo||t===zo||t===Wo?9728:9729}function onTextureDispose(h){var p=h.target;p.removeEventListener("dispose",onTextureDispose),function deallocateTexture(h){var p=x.get(h);if(void 0===p.__webglInit)return;t.deleteTexture(p.__webglTexture),x.remove(h)}(p),p.isVideoTexture&&ne.delete(p),I.memory.textures--}function onRenderTargetDispose(h){var p=h.target;p.removeEventListener("dispose",onRenderTargetDispose),function deallocateRenderTarget(h){var p=x.get(h),M=x.get(h.texture);if(!h)return;void 0!==M.__webglTexture&&t.deleteTexture(M.__webglTexture);h.depthTexture&&h.depthTexture.dispose();if(h.isWebGLCubeRenderTarget)for(var k=0;k<6;k++)t.deleteFramebuffer(p.__webglFramebuffer[k]),p.__webglDepthbuffer&&t.deleteRenderbuffer(p.__webglDepthbuffer[k]);else t.deleteFramebuffer(p.__webglFramebuffer),p.__webglDepthbuffer&&t.deleteRenderbuffer(p.__webglDepthbuffer);if(h.isWebGLMultiviewRenderTarget){t.deleteTexture(p.__webglColorTexture),t.deleteTexture(p.__webglDepthStencilTexture),I.memory.textures-=2;k=0;for(var N=p.__webglViewFramebuffers.length;k<N;k++)t.deleteFramebuffer(p.__webglViewFramebuffers[k])}x.remove(h.texture),x.remove(h)}(p),I.memory.textures--}var ae=0;function setTexture2D(t,h){var M=x.get(t);if(t.isVideoTexture&&function updateVideoTexture(t){var h=I.render.frame;ne.get(t)!==h&&(ne.set(t,h),t.update())}(t),t.version>0&&M.__version!==t.version){var k=t.image;if(void 0===k);else if(!1!==k.complete)return void uploadTexture(M,t,h)}p.activeTexture(33984+h),p.bindTexture(3553,M.__webglTexture)}function setTextureCube(h,M){if(6===h.image.length){var I=x.get(h);if(h.version>0&&I.__version!==h.version){initTexture(I,h),p.activeTexture(33984+M),p.bindTexture(34067,I.__webglTexture),t.pixelStorei(37440,h.flipY);for(var N=h&&(h.isCompressedTexture||h.image[0].isCompressedTexture),te=h.image[0]&&h.image[0].isDataTexture,re=[],ne=0;ne<6;ne++)re[ne]=N||te?te?h.image[ne].image:h.image[ne]:resizeImage(h.image[ne],!1,!0,ee);var ie,ae=re[0],oe=isPowerOfTwo(ae)||V,se=k.convert(h.format),ce=k.convert(h.type),ue=getInternalFormat(h.internalFormat,se,ce);if(setTextureParameters(34067,h,oe),N){for(ne=0;ne<6;ne++){ie=re[ne].mipmaps;for(var le=0;le<ie.length;le++){var he=ie[le];h.format!==us&&h.format!==cs?null!==se&&p.compressedTexImage2D(34069+ne,le,ue,he.width,he.height,0,he.data):p.texImage2D(34069+ne,le,ue,he.width,he.height,0,se,ce,he.data)}}I.__maxMipLevel=ie.length-1}else{ie=h.mipmaps;for(ne=0;ne<6;ne++)if(te){p.texImage2D(34069+ne,0,ue,re[ne].width,re[ne].height,0,se,ce,re[ne].data);for(le=0;le<ie.length;le++){var fe=(he=ie[le]).image[ne].image;p.texImage2D(34069+ne,le+1,ue,fe.width,fe.height,0,se,ce,fe.data)}}else{p.texImage2D(34069+ne,0,ue,se,ce,re[ne]);for(le=0;le<ie.length;le++){he=ie[le];p.texImage2D(34069+ne,le+1,ue,se,ce,he.image[ne])}}I.__maxMipLevel=ie.length}textureNeedsGenerateMipmaps(h,oe)&&generateMipmap(34067,h,ae.width,ae.height),I.__version=h.version,h.onUpdate&&h.onUpdate(h)}else p.activeTexture(33984+M),p.bindTexture(34067,I.__webglTexture)}}function setTextureCubeDynamic(t,h){p.activeTexture(33984+h),p.bindTexture(34067,x.get(t).__webglTexture)}var oe={[No]:10497,[Go]:33071,[jo]:33648},se={[Uo]:9728,[zo]:9984,[Wo]:9986,[Ho]:9729,[$o]:9985,[Xo]:9987};function setTextureParameters(p,k,I){I?(t.texParameteri(p,10242,oe[k.wrapS]),t.texParameteri(p,10243,oe[k.wrapT]),32879!==p&&35866!==p||t.texParameteri(p,32882,oe[k.wrapR]),t.texParameteri(p,10240,se[k.magFilter]),t.texParameteri(p,10241,se[k.minFilter])):(t.texParameteri(p,10242,33071),t.texParameteri(p,10243,33071),32879!==p&&35866!==p||t.texParameteri(p,32882,33071),k.wrapS!==Go||k.wrapT,t.texParameteri(p,10240,filterFallback(k.magFilter)),t.texParameteri(p,10241,filterFallback(k.minFilter)),k.minFilter!==Uo&&k.minFilter);var N=h.get("EXT_texture_filter_anisotropic");if(N){if(k.type===es&&null===h.get("OES_texture_float_linear"))return;if(k.type===ts&&null===(V||h.get("OES_texture_half_float_linear")))return;(k.anisotropy>1||x.get(k).__currentAnisotropy)&&(t.texParameterf(p,N.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,M.getMaxAnisotropy())),x.get(k).__currentAnisotropy=k.anisotropy)}}function initTexture(h,p){void 0===h.__webglInit&&(h.__webglInit=!0,p.addEventListener("dispose",onTextureDispose),h.__webglTexture=t.createTexture(),I.memory.textures++)}function uploadTexture(h,x,M){var I=3553;x.isDataTexture2DArray&&(I=35866),x.isDataTexture3D&&(I=32879),initTexture(h,x),p.activeTexture(33984+M),p.bindTexture(I,h.__webglTexture),t.pixelStorei(37440,x.flipY),t.pixelStorei(37441,x.premultiplyAlpha),t.pixelStorei(3317,x.unpackAlignment);var N=function textureNeedsPowerOfTwo(t){return!V&&(t.wrapS!==Go||t.wrapT!==Go||t.minFilter!==Uo&&t.minFilter!==Ho)}(x)&&!1===isPowerOfTwo(x.image),ee=resizeImage(x.image,N,!1,te),re=isPowerOfTwo(ee)||V,ne=k.convert(x.format),ie=k.convert(x.type),ae=getInternalFormat(x.internalFormat,ne,ie);setTextureParameters(I,x,re);var oe,se=x.mipmaps;if(x.isDepthTexture){if(ae=6402,x.type===es){if(!1===V)throw new Error("Float Depth Texture only supported in WebGL2.0");ae=36012}else V&&(ae=33189);x.format===ds&&6402===ae&&x.type!==Zo&&x.type!==Qo&&(x.type=Zo,ie=k.convert(x.type)),x.format===ps&&(ae=34041,x.type!==os&&(x.type=os,ie=k.convert(x.type))),p.texImage2D(3553,0,ae,ee.width,ee.height,0,ne,ie,null)}else if(x.isDataTexture)if(se.length>0&&re){for(var ce=0,ue=se.length;ce<ue;ce++)oe=se[ce],p.texImage2D(3553,ce,ae,oe.width,oe.height,0,ne,ie,oe.data);x.generateMipmaps=!1,h.__maxMipLevel=se.length-1}else p.texImage2D(3553,0,ae,ee.width,ee.height,0,ne,ie,ee.data),h.__maxMipLevel=0;else if(x.isCompressedTexture){for(ce=0,ue=se.length;ce<ue;ce++)oe=se[ce],x.format!==us&&x.format!==cs?null!==ne&&p.compressedTexImage2D(3553,ce,ae,oe.width,oe.height,0,oe.data):p.texImage2D(3553,ce,ae,oe.width,oe.height,0,ne,ie,oe.data);h.__maxMipLevel=se.length-1}else if(x.isDataTexture2DArray)p.texImage3D(35866,0,ae,ee.width,ee.height,ee.depth,0,ne,ie,ee.data),h.__maxMipLevel=0;else if(x.isDataTexture3D)p.texImage3D(32879,0,ae,ee.width,ee.height,ee.depth,0,ne,ie,ee.data),h.__maxMipLevel=0;else if(se.length>0&&re){for(ce=0,ue=se.length;ce<ue;ce++)oe=se[ce],p.texImage2D(3553,ce,ae,ne,ie,oe);x.generateMipmaps=!1,h.__maxMipLevel=se.length-1}else p.texImage2D(3553,0,ae,ne,ie,ee),h.__maxMipLevel=0;textureNeedsGenerateMipmaps(x,re)&&generateMipmap(I,x,ee.width,ee.height),h.__version=x.version,x.onUpdate&&x.onUpdate(x)}function setupFrameBufferTexture(h,M,I,N){var V=k.convert(M.texture.format),ee=k.convert(M.texture.type),te=getInternalFormat(M.texture.internalFormat,V,ee);p.texImage2D(N,0,te,M.width,M.height,0,V,ee,null),t.bindFramebuffer(36160,h),t.framebufferTexture2D(36160,I,N,x.get(M.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function setupRenderBufferStorage(h,p,x){if(t.bindRenderbuffer(36161,h),p.depthBuffer&&!p.stencilBuffer){if(x){var M=getRenderTargetSamples(p);t.renderbufferStorageMultisample(36161,M,33189,p.width,p.height)}else t.renderbufferStorage(36161,33189,p.width,p.height);t.framebufferRenderbuffer(36160,36096,36161,h)}else if(p.depthBuffer&&p.stencilBuffer){if(x){M=getRenderTargetSamples(p);t.renderbufferStorageMultisample(36161,M,35056,p.width,p.height)}else t.renderbufferStorage(36161,34041,p.width,p.height);t.framebufferRenderbuffer(36160,33306,36161,h)}else{var I=k.convert(p.texture.format),N=k.convert(p.texture.type),V=getInternalFormat(p.texture.internalFormat,I,N);if(x){M=getRenderTargetSamples(p);t.renderbufferStorageMultisample(36161,M,V,p.width,p.height)}else t.renderbufferStorage(36161,V,p.width,p.height)}t.bindRenderbuffer(36161,null)}function setupDepthRenderbuffer(h){var p=x.get(h),M=!0===h.isWebGLCubeRenderTarget;if(h.depthTexture){if(M)throw new Error("target.depthTexture not supported in Cube render targets");!function setupDepthTexture(h,p){if(p&&p.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,h),!p.depthTexture||!p.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");x.get(p.depthTexture).__webglTexture&&p.depthTexture.image.width===p.width&&p.depthTexture.image.height===p.height||(p.depthTexture.image.width=p.width,p.depthTexture.image.height=p.height,p.depthTexture.needsUpdate=!0),setTexture2D(p.depthTexture,0);var M=x.get(p.depthTexture).__webglTexture;if(p.depthTexture.format===ds)t.framebufferTexture2D(36160,36096,3553,M,0);else{if(p.depthTexture.format!==ps)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,M,0)}}(p.__webglFramebuffer,h)}else if(M){p.__webglDepthbuffer=[];for(var k=0;k<6;k++)t.bindFramebuffer(36160,p.__webglFramebuffer[k]),p.__webglDepthbuffer[k]=t.createRenderbuffer(),setupRenderBufferStorage(p.__webglDepthbuffer[k],h)}else t.bindFramebuffer(36160,p.__webglFramebuffer),p.__webglDepthbuffer=t.createRenderbuffer(),setupRenderBufferStorage(p.__webglDepthbuffer,h);t.bindFramebuffer(36160,null)}function getRenderTargetSamples(t){return V&&t.isWebGLMultisampleRenderTarget?Math.min(re,t.samples):0}var ce=!1,ue=!1;this.allocateTextureUnit=function allocateTextureUnit(){var t=ae;return ae+=1,t},this.resetTextureUnits=function resetTextureUnits(){ae=0},this.setTexture2D=setTexture2D,this.setTexture2DArray=function setTexture2DArray(t,h){var M=x.get(t);t.version>0&&M.__version!==t.version?uploadTexture(M,t,h):(p.activeTexture(33984+h),p.bindTexture(35866,M.__webglTexture))},this.setTexture3D=function setTexture3D(t,h){var M=x.get(t);t.version>0&&M.__version!==t.version?uploadTexture(M,t,h):(p.activeTexture(33984+h),p.bindTexture(32879,M.__webglTexture))},this.setTextureCube=setTextureCube,this.setTextureCubeDynamic=setTextureCubeDynamic,this.setupRenderTarget=function setupRenderTarget(M){var N=x.get(M),ee=x.get(M.texture);M.addEventListener("dispose",onRenderTargetDispose),ee.__webglTexture=t.createTexture(),I.memory.textures++;var te=!0===M.isWebGLCubeRenderTarget,re=!0===M.isWebGLMultisampleRenderTarget,ne=!0===M.isWebGLMultiviewRenderTarget,ie=isPowerOfTwo(M)||V;if(te){N.__webglFramebuffer=[];for(var ae=0;ae<6;ae++)N.__webglFramebuffer[ae]=t.createFramebuffer()}else if(N.__webglFramebuffer=t.createFramebuffer(),re){if(V){N.__webglMultisampledFramebuffer=t.createFramebuffer(),N.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,N.__webglColorRenderbuffer);var oe=k.convert(M.texture.format),se=k.convert(M.texture.type),ce=getInternalFormat(M.texture.internalFormat,oe,se),ue=getRenderTargetSamples(M);t.renderbufferStorageMultisample(36161,ue,ce,M.width,M.height),t.bindFramebuffer(36160,N.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,N.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),M.depthBuffer&&(N.__webglDepthRenderbuffer=t.createRenderbuffer(),setupRenderBufferStorage(N.__webglDepthRenderbuffer,M,!0)),t.bindFramebuffer(36160,null)}}else if(ne){var le=M.width,he=M.height,fe=M.numViews;t.bindFramebuffer(36160,N.__webglFramebuffer);var de=h.get("OVR_multiview2");I.memory.textures+=2;var pe=t.createTexture();t.bindTexture(35866,pe),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,le,he,fe,0,6408,5121,null),de.framebufferTextureMultiviewOVR(36160,36064,pe,0,0,fe);var me=t.createTexture();t.bindTexture(35866,me),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,le,he,fe,0,34041,34042,null),de.framebufferTextureMultiviewOVR(36160,33306,me,0,0,fe);var ge=new Array(fe);for(ae=0;ae<fe;++ae)ge[ae]=t.createFramebuffer(),t.bindFramebuffer(36160,ge[ae]),t.framebufferTextureLayer(36160,36064,pe,0,ae);N.__webglColorTexture=pe,N.__webglDepthStencilTexture=me,N.__webglViewFramebuffers=ge,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(te){p.bindTexture(34067,ee.__webglTexture),setTextureParameters(34067,M.texture,ie);for(ae=0;ae<6;ae++)setupFrameBufferTexture(N.__webglFramebuffer[ae],M,36064,34069+ae);textureNeedsGenerateMipmaps(M.texture,ie)&&generateMipmap(34067,M.texture,M.width,M.height),p.bindTexture(34067,null)}else ne||(p.bindTexture(3553,ee.__webglTexture),setTextureParameters(3553,M.texture,ie),setupFrameBufferTexture(N.__webglFramebuffer,M,36064,3553),textureNeedsGenerateMipmaps(M.texture,ie)&&generateMipmap(3553,M.texture,M.width,M.height),p.bindTexture(3553,null));M.depthBuffer&&setupDepthRenderbuffer(M)},this.updateRenderTargetMipmap=function updateRenderTargetMipmap(t){var h=t.texture;if(textureNeedsGenerateMipmaps(h,isPowerOfTwo(t)||V)){var M=t.isWebGLCubeRenderTarget?34067:3553,k=x.get(h).__webglTexture;p.bindTexture(M,k),generateMipmap(M,h,t.width,t.height),p.bindTexture(M,null)}},this.updateMultisampleRenderTarget=function updateMultisampleRenderTarget(h){if(h.isWebGLMultisampleRenderTarget&&V){var p=x.get(h);t.bindFramebuffer(36008,p.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,p.__webglFramebuffer);var M=h.width,k=h.height,I=16384;h.depthBuffer&&(I|=256),h.stencilBuffer&&(I|=1024),t.blitFramebuffer(0,0,M,k,0,0,M,k,I,9728)}},this.safeSetTexture2D=function safeSetTexture2D(t,h){t&&t.isWebGLRenderTarget&&(!1===ce&&(ce=!0),t=t.texture),setTexture2D(t,h)},this.safeSetTextureCube=function safeSetTextureCube(t,h){t&&t.isWebGLCubeRenderTarget&&(!1===ue&&(ue=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?setTextureCube(t,h):setTextureCubeDynamic(t,h)}}function WebGLUtils(t,h,p){var x=p.isWebGL2;return{convert:function convert(t){var p;if(t===qo)return 5121;if(t===rs)return 32819;if(t===ns)return 32820;if(t===is)return 33635;if(t===Ko)return 5120;if(t===Yo)return 5122;if(t===Zo)return 5123;if(t===Jo)return 5124;if(t===Qo)return 5125;if(t===es)return 5126;if(t===ts)return x?5131:null!==(p=h.get("OES_texture_half_float"))?p.HALF_FLOAT_OES:null;if(t===ss)return 6406;if(t===cs)return 6407;if(t===us)return 6408;if(t===ls)return 6409;if(t===hs)return 6410;if(t===ds)return 6402;if(t===ps)return 34041;if(t===ms)return 6403;if(t===gs)return 36244;if(t===vs)return 33319;if(t===ys)return 33320;if(t===bs)return 36248;if(t===xs)return 36249;if(t===Ms||t===ws||t===_s||t===Cs){if(null===(p=h.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Ms)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===ws)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===_s)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Cs)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Ss||t===Ts||t===As||t===Ds){if(null===(p=h.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===Ss)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Ts)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===As)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Ds)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return t===ks?null!==(p=h.get("WEBGL_compressed_texture_etc1"))?p.COMPRESSED_RGB_ETC1_WEBGL:null:t===Ps||t===Ls||t===Es||t===Is||t===Bs||t===Os||t===Rs||t===Fs||t===Ns||t===Vs||t===Gs||t===js||t===Us||t===zs?null!==(p=h.get("WEBGL_compressed_texture_astc"))?t:null:t===os?x?34042:null!==(p=h.get("WEBGL_depth_texture"))?p.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function WebGLMultiviewRenderTarget(t,h,p,x){WebGLRenderTarget.call(this,t,h,x),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=p}function WebGLMultiview(t,h){var p,x,M,k,I,N,V,ee=2,te=t.extensions,re=t.properties,ne=0;function getCameraArray(t){return t.isArrayCamera?t.cameras:(I[0]=t,I)}this.isAvailable=function isAvailable(){if(void 0===V){var t=te.get("OVR_multiview2");if(V=null!==t&&!1===h.getContextAttributes().antialias){ne=h.getParameter(t.MAX_VIEWS_OVR),p=new WebGLMultiviewRenderTarget(0,0,ee),N=new Vector2,k=[],M=[],I=[];for(var x=0;x<ne;x++)k[x]=new Matrix4,M[x]=new Matrix3}}return V},this.attachCamera=function attachCamera(h){!1!==function isMultiviewCompatible(t){if(void 0===t.isArrayCamera)return!0;var h=t.cameras;if(h.length>ne)return!1;for(var p=1,x=h.length;p<x;p++)if(h[0].viewport.z!==h[p].viewport.z||h[0].viewport.w!==h[p].viewport.w)return!1;return!0}(h)&&(x=t.getRenderTarget(),function resizeRenderTarget(h){if(x?N.set(x.width,x.height):t.getDrawingBufferSize(N),h.isArrayCamera){var M=h.cameras[0].viewport;p.setSize(M.z,M.w),p.setNumViews(h.cameras.length)}else p.setSize(N.x,N.y),p.setNumViews(ee)}(h),t.setRenderTarget(p))},this.detachCamera=function detachCamera(M){p===t.getRenderTarget()&&(t.setRenderTarget(x),function flush(t){var x=p,M=x.numViews,k=re.get(x).__webglViewFramebuffers,I=x.width,V=x.height;if(t.isArrayCamera)for(var ee=0;ee<M;ee++){var te=t.cameras[ee].viewport,ne=te.x,ie=te.y,ae=ne+te.z,oe=ie+te.w;h.bindFramebuffer(36008,k[ee]),h.blitFramebuffer(0,0,I,V,ne,ie,ae,oe,16384,9728)}else h.bindFramebuffer(36008,k[0]),h.blitFramebuffer(0,0,I,V,0,0,N.x,N.y,16384,9728)}(M))},this.updateCameraProjectionMatricesUniform=function updateCameraProjectionMatricesUniform(t,p){for(var x=getCameraArray(t),M=0;M<x.length;M++)k[M].copy(x[M].projectionMatrix);p.setValue(h,"projectionMatrices",k)},this.updateCameraViewMatricesUniform=function updateCameraViewMatricesUniform(t,p){for(var x=getCameraArray(t),M=0;M<x.length;M++)k[M].copy(x[M].matrixWorldInverse);p.setValue(h,"viewMatrices",k)},this.updateObjectMatricesUniforms=function updateObjectMatricesUniforms(t,p,x){for(var I=getCameraArray(p),N=0;N<I.length;N++)k[N].multiplyMatrices(I[N].matrixWorldInverse,t.matrixWorld),M[N].getNormalMatrix(k[N]);x.setValue(h,"modelViewMatrices",k),x.setValue(h,"normalMatrices",M)}}function ArrayCamera(t){PerspectiveCamera.call(this),this.cameras=t||[]}function Group(){Object3D.call(this),this.type="Group"}function WebXRManager(t,h){var p=this,x=null,M=null,k="local-floor",I=null,N=[],V=new Map,ee=new PerspectiveCamera;ee.layers.enable(1),ee.viewport=new Vector4;var te=new PerspectiveCamera;te.layers.enable(2),te.viewport=new Vector4;var re=new ArrayCamera([ee,te]);re.layers.enable(1),re.layers.enable(2);var ne=null,ie=null;function onSessionEvent(t){var h=V.get(t.inputSource);h&&(h.targetRay&&h.targetRay.dispatchEvent({type:t.type}),h.grip&&h.grip.dispatchEvent({type:t.type}))}function onSessionEnd(){V.forEach((function(t,h){t.targetRay&&(t.targetRay.dispatchEvent({type:"disconnected",data:h}),t.targetRay.visible=!1),t.grip&&(t.grip.dispatchEvent({type:"disconnected",data:h}),t.grip.visible=!1)})),V.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),ce.stop(),p.isPresenting=!1,p.dispatchEvent({type:"sessionend"})}function onRequestReferenceSpace(t){M=t,ce.setContext(x),ce.start(),p.isPresenting=!0,p.dispatchEvent({type:"sessionstart"})}function updateInputSources(t){for(var h=x.inputSources,p=0;p<N.length;p++)V.set(h[p],N[p]);for(p=0;p<t.removed.length;p++){var M=t.removed[p];(k=V.get(M))&&(k.targetRay&&k.targetRay.dispatchEvent({type:"disconnected",data:M}),k.grip&&k.grip.dispatchEvent({type:"disconnected",data:M}),V.delete(M))}for(p=0;p<t.added.length;p++){var k;M=t.added[p];(k=V.get(M))&&(k.targetRay&&k.targetRay.dispatchEvent({type:"connected",data:M}),k.grip&&k.grip.dispatchEvent({type:"connected",data:M}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var h=N[t];return void 0===h&&(h={},N[t]=h),void 0===h.targetRay&&(h.targetRay=new Group,h.targetRay.matrixAutoUpdate=!1,h.targetRay.visible=!1),h.targetRay},this.getControllerGrip=function(t){var h=N[t];return void 0===h&&(h={},N[t]=h),void 0===h.grip&&(h.grip=new Group,h.grip.matrixAutoUpdate=!1,h.grip.visible=!1),h.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(t){k=t},this.getReferenceSpace=function(){return M},this.getSession=function(){return x},this.setSession=function(t){if(null!==(x=t)){x.addEventListener("select",onSessionEvent),x.addEventListener("selectstart",onSessionEvent),x.addEventListener("selectend",onSessionEvent),x.addEventListener("squeeze",onSessionEvent),x.addEventListener("squeezestart",onSessionEvent),x.addEventListener("squeezeend",onSessionEvent),x.addEventListener("end",onSessionEnd);var p=h.getContextAttributes(),M={antialias:p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil},I=new XRWebGLLayer(x,h,M);x.updateRenderState({baseLayer:I}),x.requestReferenceSpace(k).then(onRequestReferenceSpace),x.addEventListener("inputsourceschange",updateInputSources)}};var ae=new Vector3,oe=new Vector3;function updateCamera(t,h){null===h?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(h.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){re.near=te.near=ee.near=t.near,re.far=te.far=ee.far=t.far,ne===re.near&&ie===re.far||(x.updateRenderState({depthNear:re.near,depthFar:re.far}),ne=re.near,ie=re.far);var h=t.parent,p=re.cameras;updateCamera(re,h);for(var M=0;M<p.length;M++)updateCamera(p[M],h);t.matrixWorld.copy(re.matrixWorld);for(var k=t.children,I=(M=0,k.length);M<I;M++)k[M].updateMatrixWorld(!0);return function setProjectionFromUnion(t,h,p){ae.setFromMatrixPosition(h.matrixWorld),oe.setFromMatrixPosition(p.matrixWorld);var x=ae.distanceTo(oe),M=h.projectionMatrix.elements,k=p.projectionMatrix.elements,I=M[14]/(M[10]-1),N=M[14]/(M[10]+1),V=(M[9]+1)/M[5],ee=(M[9]-1)/M[5],te=(M[8]-1)/M[0],re=(k[8]+1)/k[0],ne=I*te,ie=I*re,se=x/(-te+re),ce=se*-te;h.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(ce),t.translateZ(se),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var ue=I+se,le=N+se,he=ne-ce,fe=ie+(x-ce),de=V*N/le*ue,pe=ee*N/le*ue;t.projectionMatrix.makePerspective(he,fe,de,pe,ue,le)}(re,ee,te),re};var se=null;var ce=new WebGLAnimation;ce.setAnimationLoop((function onAnimationFrame(h,p){if(null!==(I=p.getViewerPose(M))){var k=I.views,V=x.renderState.baseLayer;t.setFramebuffer(V.framebuffer);for(var ee=0;ee<k.length;ee++){var te=k[ee],ne=V.getViewport(te),ie=re.cameras[ee];ie.matrix.fromArray(te.transform.matrix),ie.projectionMatrix.fromArray(te.projectionMatrix),ie.viewport.set(ne.x,ne.y,ne.width,ne.height),0===ee&&re.matrix.copy(ie.matrix)}}var ae=x.inputSources;for(ee=0;ee<N.length;ee++){var oe=N[ee],ce=ae[ee],ue=null,le=null;ce&&(oe.targetRay&&null!==(ue=p.getPose(ce.targetRaySpace,M))&&(oe.targetRay.matrix.fromArray(ue.transform.matrix),oe.targetRay.matrix.decompose(oe.targetRay.position,oe.targetRay.rotation,oe.targetRay.scale)),oe.grip&&ce.gripSpace&&null!==(le=p.getPose(ce.gripSpace,M))&&(oe.grip.matrix.fromArray(le.transform.matrix),oe.grip.matrix.decompose(oe.grip.position,oe.grip.rotation,oe.grip.scale))),oe.targetRay&&(oe.targetRay.visible=null!==ue),oe.grip&&(oe.grip.visible=null!==le)}se&&se(h,p)})),this.setAnimationLoop=function(t){se=t},this.dispose=function(){}}function WebGLRenderer(t){var h=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),p=void 0!==t.context?t.context:null,x=void 0!==t.alpha&&t.alpha,M=void 0===t.depth||t.depth,k=void 0===t.stencil||t.stencil,I=void 0!==t.antialias&&t.antialias,N=void 0===t.premultipliedAlpha||t.premultipliedAlpha,V=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,ee=void 0!==t.powerPreference?t.powerPreference:"default",te=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,re=null,ne=null;this.domElement=h,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ys,this.physicallyCorrectLights=!1,this.toneMapping=So,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var ie,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe,Me,we=this,_e=!1,Ce=null,Se=0,Te=0,Ae=null,De=null,ke=-1,Le={geometry:null,program:null,wireframe:!1},Ee=null,Ie=null,Be=new Vector4,Oe=new Vector4,Re=null,Fe=h.width,Ne=h.height,Ve=1,Ge=null,je=null,Ue=new Vector4(0,0,Fe,Ne),ze=new Vector4(0,0,Fe,Ne),We=!1,He=new Frustum,$e=new WebGLClipping,Xe=!1,qe=!1,Ke=new Matrix4,Ye=new Vector3;function getTargetPixelRatio(){return null===Ae?Ve:1}try{var Ze={alpha:x,depth:M,stencil:k,antialias:I,premultipliedAlpha:N,preserveDrawingBuffer:V,powerPreference:ee,failIfMajorPerformanceCaveat:te,xrCompatible:!0};if(h.addEventListener("webglcontextlost",onContextLost,!1),h.addEventListener("webglcontextrestored",onContextRestore,!1),null===(ie=p||h.getContext("webgl",Ze)||h.getContext("experimental-webgl",Ze)))throw null!==h.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===ie.getShaderPrecisionFormat&&(ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(it){throw it}function initGLContext(){ae=new WebGLExtensions(ie),!1===(oe=new WebGLCapabilities(ie,ae,t)).isWebGL2&&(ae.get("WEBGL_depth_texture"),ae.get("OES_texture_float"),ae.get("OES_texture_half_float"),ae.get("OES_texture_half_float_linear"),ae.get("OES_standard_derivatives"),ae.get("OES_element_index_uint"),ae.get("ANGLE_instanced_arrays")),ae.get("OES_texture_float_linear"),Me=new WebGLUtils(ie,ae,oe),(se=new WebGLState(ie,ae,oe)).scissor(Oe.copy(ze).multiplyScalar(Ve).floor()),se.viewport(Be.copy(Ue).multiplyScalar(Ve).floor()),ce=new WebGLInfo,ue=new WebGLProperties,le=new WebGLTextures(ie,ae,se,ue,oe,Me,ce),he=new WebGLAttributes(ie,oe),fe=new WebGLGeometries(ie,he,ce),de=new WebGLObjects(ie,fe,he,ce),ye=new WebGLMorphtargets(ie),pe=new WebGLPrograms(we,ae,oe),me=new WebGLRenderLists,ge=new WebGLRenderStates,ve=new WebGLBackground(we,se,de,N),be=new WebGLBufferRenderer(ie,ae,ce,oe),xe=new WebGLIndexedBufferRenderer(ie,ae,ce,oe),ce.programs=pe.programs,we.capabilities=oe,we.extensions=ae,we.properties=ue,we.renderLists=me,we.state=se,we.info=ce}initGLContext();var Je=new WebXRManager(we,ie);this.xr=Je;var Qe=new WebGLMultiview(we,ie),et=new WebGLShadowMap(we,de,oe.maxTextureSize);function onContextLost(t){t.preventDefault(),_e=!0}function onContextRestore(){_e=!1,initGLContext()}function onMaterialDispose(t){var h=t.target;h.removeEventListener("dispose",onMaterialDispose),function deallocateMaterial(t){releaseMaterialProgramReference(t),ue.remove(t)}(h)}function releaseMaterialProgramReference(t){var h=ue.get(t).program;t.program=void 0,void 0!==h&&pe.releaseProgram(h)}this.shadowMap=et,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){var t=ae.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=ae.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return Ve},this.setPixelRatio=function(t){void 0!==t&&(Ve=t,this.setSize(Fe,Ne,!1))},this.getSize=function(t){return void 0===t&&(t=new Vector2),t.set(Fe,Ne)},this.setSize=function(t,p,x){Je.isPresenting||(Fe=t,Ne=p,h.width=Math.floor(t*Ve),h.height=Math.floor(p*Ve),!1!==x&&(h.style.width=t+"px",h.style.height=p+"px"),this.setViewport(0,0,t,p))},this.getDrawingBufferSize=function(t){return void 0===t&&(t=new Vector2),t.set(Fe*Ve,Ne*Ve).floor()},this.setDrawingBufferSize=function(t,p,x){Fe=t,Ne=p,Ve=x,h.width=Math.floor(t*x),h.height=Math.floor(p*x),this.setViewport(0,0,t,p)},this.getCurrentViewport=function(t){return void 0===t&&(t=new Vector4),t.copy(Be)},this.getViewport=function(t){return t.copy(Ue)},this.setViewport=function(t,h,p,x){t.isVector4?Ue.set(t.x,t.y,t.z,t.w):Ue.set(t,h,p,x),se.viewport(Be.copy(Ue).multiplyScalar(Ve).floor())},this.getScissor=function(t){return t.copy(ze)},this.setScissor=function(t,h,p,x){t.isVector4?ze.set(t.x,t.y,t.z,t.w):ze.set(t,h,p,x),se.scissor(Oe.copy(ze).multiplyScalar(Ve).floor())},this.getScissorTest=function(){return We},this.setScissorTest=function(t){se.setScissorTest(We=t)},this.setOpaqueSort=function(t){Ge=t},this.setTransparentSort=function(t){je=t},this.getClearColor=function(){return ve.getClearColor()},this.setClearColor=function(){ve.setClearColor.apply(ve,arguments)},this.getClearAlpha=function(){return ve.getClearAlpha()},this.setClearAlpha=function(){ve.setClearAlpha.apply(ve,arguments)},this.clear=function(t,h,p){var x=0;(void 0===t||t)&&(x|=16384),(void 0===h||h)&&(x|=256),(void 0===p||p)&&(x|=1024),ie.clear(x)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){h.removeEventListener("webglcontextlost",onContextLost,!1),h.removeEventListener("webglcontextrestored",onContextRestore,!1),me.dispose(),ge.dispose(),ue.dispose(),de.dispose(),Je.dispose(),nt.stop()},this.renderBufferImmediate=function(t,h){se.initAttributes();var p=ue.get(t);t.hasPositions&&!p.position&&(p.position=ie.createBuffer()),t.hasNormals&&!p.normal&&(p.normal=ie.createBuffer()),t.hasUvs&&!p.uv&&(p.uv=ie.createBuffer()),t.hasColors&&!p.color&&(p.color=ie.createBuffer());var x=h.getAttributes();t.hasPositions&&(ie.bindBuffer(34962,p.position),ie.bufferData(34962,t.positionArray,35048),se.enableAttribute(x.position),ie.vertexAttribPointer(x.position,3,5126,!1,0,0)),t.hasNormals&&(ie.bindBuffer(34962,p.normal),ie.bufferData(34962,t.normalArray,35048),se.enableAttribute(x.normal),ie.vertexAttribPointer(x.normal,3,5126,!1,0,0)),t.hasUvs&&(ie.bindBuffer(34962,p.uv),ie.bufferData(34962,t.uvArray,35048),se.enableAttribute(x.uv),ie.vertexAttribPointer(x.uv,2,5126,!1,0,0)),t.hasColors&&(ie.bindBuffer(34962,p.color),ie.bufferData(34962,t.colorArray,35048),se.enableAttribute(x.color),ie.vertexAttribPointer(x.color,3,5126,!1,0,0)),se.disableUnusedAttributes(),ie.drawArrays(4,0,t.count),t.count=0};var tt=new Scene;this.renderBufferDirect=function(t,h,p,x,M,k){null===h&&(h=tt);var I=M.isMesh&&M.matrixWorld.determinant()<0,N=setProgram(t,h,x,M);se.setMaterial(x,I);var V=!1;Le.geometry===p.id&&Le.program===N.id&&Le.wireframe===(!0===x.wireframe)||(Le.geometry=p.id,Le.program=N.id,Le.wireframe=!0===x.wireframe,V=!0),(x.morphTargets||x.morphNormals)&&(ye.update(M,p,x,N),V=!0);var ee=p.index,te=p.attributes.position;if(null===ee){if(void 0===te||0===te.count)return}else if(0===ee.count)return;var re,ne=1;!0===x.wireframe&&(ee=fe.getWireframeAttribute(p),ne=2);var ce=be;null!==ee&&(re=he.get(ee),(ce=xe).setIndex(re)),V&&(!function setupVertexAttributes(t,h,p,x){if(!1===oe.isWebGL2&&(t.isInstancedMesh||h.isInstancedBufferGeometry)&&null===ae.get("ANGLE_instanced_arrays"))return;se.initAttributes();var M=h.attributes,k=x.getAttributes(),I=p.defaultAttributeValues;for(var N in k){var V=k[N];if(V>=0){var ee=M[N];if(void 0!==ee){var te=ee.normalized,re=ee.itemSize;if(void 0===(pe=he.get(ee)))continue;var ne=pe.buffer,ce=pe.type,ue=pe.bytesPerElement;if(ee.isInterleavedBufferAttribute){var le=ee.data,fe=le.stride,de=ee.offset;le&&le.isInstancedInterleavedBuffer?(se.enableAttributeAndDivisor(V,le.meshPerAttribute),void 0===h.maxInstancedCount&&(h.maxInstancedCount=le.meshPerAttribute*le.count)):se.enableAttribute(V),ie.bindBuffer(34962,ne),ie.vertexAttribPointer(V,re,ce,te,fe*ue,de*ue)}else ee.isInstancedBufferAttribute?(se.enableAttributeAndDivisor(V,ee.meshPerAttribute),void 0===h.maxInstancedCount&&(h.maxInstancedCount=ee.meshPerAttribute*ee.count)):se.enableAttribute(V),ie.bindBuffer(34962,ne),ie.vertexAttribPointer(V,re,ce,te,0,0)}else if("instanceMatrix"===N){var pe;if(void 0===(pe=he.get(t.instanceMatrix)))continue;ne=pe.buffer,ce=pe.type;se.enableAttributeAndDivisor(V+0,1),se.enableAttributeAndDivisor(V+1,1),se.enableAttributeAndDivisor(V+2,1),se.enableAttributeAndDivisor(V+3,1),ie.bindBuffer(34962,ne),ie.vertexAttribPointer(V+0,4,ce,!1,64,0),ie.vertexAttribPointer(V+1,4,ce,!1,64,16),ie.vertexAttribPointer(V+2,4,ce,!1,64,32),ie.vertexAttribPointer(V+3,4,ce,!1,64,48)}else if(void 0!==I){var me=I[N];if(void 0!==me)switch(me.length){case 2:ie.vertexAttrib2fv(V,me);break;case 3:ie.vertexAttrib3fv(V,me);break;case 4:ie.vertexAttrib4fv(V,me);break;default:ie.vertexAttrib1fv(V,me)}}}}se.disableUnusedAttributes()}(M,p,x,N),null!==ee&&ie.bindBuffer(34963,re.buffer));var ue=null!==ee?ee.count:te.count,le=p.drawRange.start*ne,de=p.drawRange.count*ne,pe=null!==k?k.start*ne:0,me=null!==k?k.count*ne:1/0,ge=Math.max(le,pe),ve=Math.min(ue,le+de,pe+me)-1,Me=Math.max(0,ve-ge+1);if(0!==Me){if(M.isMesh)!0===x.wireframe?(se.setLineWidth(x.wireframeLinewidth*getTargetPixelRatio()),ce.setMode(1)):ce.setMode(4);else if(M.isLine){var we=x.linewidth;void 0===we&&(we=1),se.setLineWidth(we*getTargetPixelRatio()),M.isLineSegments?ce.setMode(1):M.isLineLoop?ce.setMode(2):ce.setMode(3)}else M.isPoints?ce.setMode(0):M.isSprite&&ce.setMode(4);M.isInstancedMesh?ce.renderInstances(p,ge,Me,M.count):p.isInstancedBufferGeometry?ce.renderInstances(p,ge,Me,p.maxInstancedCount):ce.render(ge,Me)}},this.compile=function(t,h){(ne=ge.get(t,h)).init(),t.traverse((function(t){t.isLight&&(ne.pushLight(t),t.castShadow&&ne.pushShadow(t))})),ne.setupLights(h);var p={};t.traverse((function(h){if(h.material)if(Array.isArray(h.material))for(var x=0;x<h.material.length;x++)h.material[x].uuid in p==!1&&(initMaterial(h.material[x],t,h),p[h.material[x].uuid]=!0);else h.material.uuid in p==!1&&(initMaterial(h.material,t,h),p[h.material.uuid]=!0)}))};var rt=null;var nt=new WebGLAnimation;function projectObject(t,h,p,x){if(!1!==t.visible){if(t.layers.test(h.layers))if(t.isGroup)p=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(h);else if(t.isLight)ne.pushLight(t),t.castShadow&&ne.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||He.intersectsSprite(t)){x&&Ye.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Ke);var M=de.update(t);(k=t.material).visible&&re.push(t,M,k,p,Ye.z,null)}}else if(t.isImmediateRenderObject)x&&Ye.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Ke),re.push(t,null,t.material,p,Ye.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==ce.render.frame&&(t.skeleton.update(),t.skeleton.frame=ce.render.frame),!t.frustumCulled||He.intersectsObject(t))){x&&Ye.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Ke);M=de.update(t);var k=t.material;if(Array.isArray(k))for(var I=M.groups,N=0,V=I.length;N<V;N++){var ee=I[N],te=k[ee.materialIndex];te&&te.visible&&re.push(t,M,te,p,Ye.z,ee)}else k.visible&&re.push(t,M,k,p,Ye.z,null)}var ie=t.children;for(N=0,V=ie.length;N<V;N++)projectObject(ie[N],h,p,x)}}function renderObjects(t,h,p,x){for(var M=0,k=t.length;M<k;M++){var I=t[M],N=I.object,V=I.geometry,ee=void 0===x?I.material:x,te=I.group;if(p.isArrayCamera)if(Ie=p,Je.enabled&&Qe.isAvailable())renderObject(N,h,p,V,ee,te);else for(var re=p.cameras,ie=0,ae=re.length;ie<ae;ie++){var oe=re[ie];N.layers.test(oe.layers)&&(se.viewport(Be.copy(oe.viewport)),ne.setupLights(oe),renderObject(N,h,oe,V,ee,te))}else Ie=null,renderObject(N,h,p,V,ee,te)}}function renderObject(t,h,p,x,M,k){if(t.onBeforeRender(we,h,p,x,M,k),ne=ge.get(h,Ie||p),t.modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var I=setProgram(p,h,M,t);se.setMaterial(M),Le.geometry=null,Le.program=null,Le.wireframe=!1,function renderObjectImmediate(t,h){t.render((function(t){we.renderBufferImmediate(t,h)}))}(t,I)}else we.renderBufferDirect(p,h,x,M,t,k);t.onAfterRender(we,h,p,x,M,k),ne=ge.get(h,Ie||p)}function initMaterial(t,h,p){var x=ue.get(t),M=ne.state.lights,k=ne.state.shadowsArray,I=M.state.version,N=pe.getParameters(t,M.state,k,h,$e.numPlanes,$e.numIntersection,p),V=pe.getProgramCacheKey(N),ee=x.program,te=!0;if(void 0===ee)t.addEventListener("dispose",onMaterialDispose);else if(ee.cacheKey!==V)releaseMaterialProgramReference(t);else if(x.lightsStateVersion!==I)x.lightsStateVersion=I,te=!1;else{if(void 0!==N.shaderID)return;te=!1}te&&(ee=pe.acquireProgram(N,V),x.program=ee,x.uniforms=N.uniforms,x.environment=t.isMeshStandardMaterial?h.environment:null,x.outputEncoding=we.outputEncoding,t.program=ee);var re=ee.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var ie=0;ie<we.maxMorphTargets;ie++)re["morphTarget"+ie]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(ie=0;ie<we.maxMorphNormals;ie++)re["morphNormal"+ie]>=0&&t.numSupportedMorphNormals++}var ae=x.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(x.numClippingPlanes=$e.numPlanes,x.numIntersection=$e.numIntersection,ae.clippingPlanes=$e.uniform),x.fog=h.fog,x.needsLights=function materialNeedsLights(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),x.lightsStateVersion=I,x.needsLights&&(ae.ambientLightColor.value=M.state.ambient,ae.lightProbe.value=M.state.probe,ae.directionalLights.value=M.state.directional,ae.spotLights.value=M.state.spot,ae.rectAreaLights.value=M.state.rectArea,ae.pointLights.value=M.state.point,ae.hemisphereLights.value=M.state.hemi,ae.directionalShadowMap.value=M.state.directionalShadowMap,ae.directionalShadowMatrix.value=M.state.directionalShadowMatrix,ae.spotShadowMap.value=M.state.spotShadowMap,ae.spotShadowMatrix.value=M.state.spotShadowMatrix,ae.pointShadowMap.value=M.state.pointShadowMap,ae.pointShadowMatrix.value=M.state.pointShadowMatrix);var oe=x.program.getUniforms(),se=WebGLUniforms.seqWithValue(oe.seq,ae);x.uniformsList=se}function setProgram(t,h,p,x){le.resetTextureUnits();var M=h.fog,k=p.isMeshStandardMaterial?h.environment:null,I=ue.get(p),N=ne.state.lights;if(Xe&&(qe||t!==Ee)){var V=t===Ee&&p.id===ke;$e.setState(p.clippingPlanes,p.clipIntersection,p.clipShadows,t,I,V)}p.version===I.__version?void 0===I.program||p.fog&&I.fog!==M||I.environment!==k||I.needsLights&&I.lightsStateVersion!==N.state.version?initMaterial(p,h,x):void 0===I.numClippingPlanes||I.numClippingPlanes===$e.numPlanes&&I.numIntersection===$e.numIntersection?I.outputEncoding!==we.outputEncoding&&initMaterial(p,h,x):initMaterial(p,h,x):(initMaterial(p,h,x),I.__version=p.version);var ee=!1,te=!1,re=!1,ae=I.program,ce=ae.getUniforms(),he=I.uniforms;if(se.useProgram(ae.program)&&(ee=!0,te=!0,re=!0),p.id!==ke&&(ke=p.id,te=!0),ee||Ee!==t){if(ae.numMultiviewViews>0?Qe.updateCameraProjectionMatricesUniform(t,ce):ce.setValue(ie,"projectionMatrix",t.projectionMatrix),oe.logarithmicDepthBuffer&&ce.setValue(ie,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),Ee!==t&&(Ee=t,te=!0,re=!0),p.isShaderMaterial||p.isMeshPhongMaterial||p.isMeshToonMaterial||p.isMeshStandardMaterial||p.envMap){var fe=ce.map.cameraPosition;void 0!==fe&&fe.setValue(ie,Ye.setFromMatrixPosition(t.matrixWorld))}(p.isMeshPhongMaterial||p.isMeshToonMaterial||p.isMeshLambertMaterial||p.isMeshBasicMaterial||p.isMeshStandardMaterial||p.isShaderMaterial)&&ce.setValue(ie,"isOrthographic",!0===t.isOrthographicCamera),(p.isMeshPhongMaterial||p.isMeshToonMaterial||p.isMeshLambertMaterial||p.isMeshBasicMaterial||p.isMeshStandardMaterial||p.isShaderMaterial||p.skinning)&&(ae.numMultiviewViews>0?Qe.updateCameraViewMatricesUniform(t,ce):ce.setValue(ie,"viewMatrix",t.matrixWorldInverse))}if(p.skinning){ce.setOptional(ie,x,"bindMatrix"),ce.setOptional(ie,x,"bindMatrixInverse");var de=x.skeleton;if(de){var pe=de.bones;if(oe.floatVertexTextures){if(void 0===de.boneTexture){var me=Math.sqrt(4*pe.length);me=gc.ceilPowerOfTwo(me),me=Math.max(me,4);var ge=new Float32Array(me*me*4);ge.set(de.boneMatrices);var ve=new DataTexture(ge,me,me,us,es);de.boneMatrices=ge,de.boneTexture=ve,de.boneTextureSize=me}ce.setValue(ie,"boneTexture",de.boneTexture,le),ce.setValue(ie,"boneTextureSize",de.boneTextureSize)}else ce.setOptional(ie,de,"boneMatrices")}}return(te||I.receiveShadow!==x.receiveShadow)&&(I.receiveShadow=x.receiveShadow,ce.setValue(ie,"receiveShadow",x.receiveShadow)),te&&(ce.setValue(ie,"toneMappingExposure",we.toneMappingExposure),ce.setValue(ie,"toneMappingWhitePoint",we.toneMappingWhitePoint),I.needsLights&&function markUniformsLightsNeedsUpdate(t,h){t.ambientLightColor.needsUpdate=h,t.lightProbe.needsUpdate=h,t.directionalLights.needsUpdate=h,t.pointLights.needsUpdate=h,t.spotLights.needsUpdate=h,t.rectAreaLights.needsUpdate=h,t.hemisphereLights.needsUpdate=h}(he,re),M&&p.fog&&function refreshUniformsFog(t,h){t.fogColor.value.copy(h.color),h.isFog?(t.fogNear.value=h.near,t.fogFar.value=h.far):h.isFogExp2&&(t.fogDensity.value=h.density)}(he,M),p.isMeshBasicMaterial?refreshUniformsCommon(he,p):p.isMeshLambertMaterial?(refreshUniformsCommon(he,p),function refreshUniformsLambert(t,h){h.emissiveMap&&(t.emissiveMap.value=h.emissiveMap)}(he,p)):p.isMeshToonMaterial?(refreshUniformsCommon(he,p),function refreshUniformsToon(t,h){t.specular.value.copy(h.specular),t.shininess.value=Math.max(h.shininess,1e-4),h.gradientMap&&(t.gradientMap.value=h.gradientMap);h.emissiveMap&&(t.emissiveMap.value=h.emissiveMap);h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Va&&(t.bumpScale.value*=-1));h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Va&&t.normalScale.value.negate());h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)}(he,p)):p.isMeshPhongMaterial?(refreshUniformsCommon(he,p),function refreshUniformsPhong(t,h){t.specular.value.copy(h.specular),t.shininess.value=Math.max(h.shininess,1e-4),h.emissiveMap&&(t.emissiveMap.value=h.emissiveMap);h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Va&&(t.bumpScale.value*=-1));h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Va&&t.normalScale.value.negate());h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)}(he,p)):p.isMeshStandardMaterial?(refreshUniformsCommon(he,p,k),p.isMeshPhysicalMaterial?function refreshUniformsPhysical(t,h,p){refreshUniformsStandard(t,h,p),t.reflectivity.value=h.reflectivity,t.clearcoat.value=h.clearcoat,t.clearcoatRoughness.value=h.clearcoatRoughness,h.sheen&&t.sheen.value.copy(h.sheen);h.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),t.clearcoatNormalMap.value=h.clearcoatNormalMap,h.side===Va&&t.clearcoatNormalScale.value.negate());t.transparency.value=h.transparency}(he,p,k):refreshUniformsStandard(he,p,k)):p.isMeshMatcapMaterial?(refreshUniformsCommon(he,p),function refreshUniformsMatcap(t,h){h.matcap&&(t.matcap.value=h.matcap);h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Va&&(t.bumpScale.value*=-1));h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Va&&t.normalScale.value.negate());h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)}(he,p)):p.isMeshDepthMaterial?(refreshUniformsCommon(he,p),function refreshUniformsDepth(t,h){h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)}(he,p)):p.isMeshDistanceMaterial?(refreshUniformsCommon(he,p),function refreshUniformsDistance(t,h){h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias);t.referencePosition.value.copy(h.referencePosition),t.nearDistance.value=h.nearDistance,t.farDistance.value=h.farDistance}(he,p)):p.isMeshNormalMaterial?(refreshUniformsCommon(he,p),function refreshUniformsNormal(t,h){h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Va&&(t.bumpScale.value*=-1));h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Va&&t.normalScale.value.negate());h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias)}(he,p)):p.isLineBasicMaterial?(!function refreshUniformsLine(t,h){t.diffuse.value.copy(h.color),t.opacity.value=h.opacity}(he,p),p.isLineDashedMaterial&&function refreshUniformsDash(t,h){t.dashSize.value=h.dashSize,t.totalSize.value=h.dashSize+h.gapSize,t.scale.value=h.scale}(he,p)):p.isPointsMaterial?function refreshUniformsPoints(t,h){t.diffuse.value.copy(h.color),t.opacity.value=h.opacity,t.size.value=h.size*Ve,t.scale.value=.5*Ne,h.map&&(t.map.value=h.map);h.alphaMap&&(t.alphaMap.value=h.alphaMap);var p;h.map?p=h.map:h.alphaMap&&(p=h.alphaMap);void 0!==p&&(!0===p.matrixAutoUpdate&&p.updateMatrix(),t.uvTransform.value.copy(p.matrix))}(he,p):p.isSpriteMaterial?function refreshUniformsSprites(t,h){t.diffuse.value.copy(h.color),t.opacity.value=h.opacity,t.rotation.value=h.rotation,h.map&&(t.map.value=h.map);h.alphaMap&&(t.alphaMap.value=h.alphaMap);var p;h.map?p=h.map:h.alphaMap&&(p=h.alphaMap);void 0!==p&&(!0===p.matrixAutoUpdate&&p.updateMatrix(),t.uvTransform.value.copy(p.matrix))}(he,p):p.isShadowMaterial&&(he.color.value.copy(p.color),he.opacity.value=p.opacity),void 0!==he.ltc_1&&(he.ltc_1.value=ll.LTC_1),void 0!==he.ltc_2&&(he.ltc_2.value=ll.LTC_2),WebGLUniforms.upload(ie,I.uniformsList,he,le),p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)),p.isShaderMaterial&&!0===p.uniformsNeedUpdate&&(WebGLUniforms.upload(ie,I.uniformsList,he,le),p.uniformsNeedUpdate=!1),p.isSpriteMaterial&&ce.setValue(ie,"center",x.center),ae.numMultiviewViews>0?Qe.updateObjectMatricesUniforms(x,t,ce):(ce.setValue(ie,"modelViewMatrix",x.modelViewMatrix),ce.setValue(ie,"normalMatrix",x.normalMatrix)),ce.setValue(ie,"modelMatrix",x.matrixWorld),ae}function refreshUniformsCommon(t,h,p){t.opacity.value=h.opacity,h.color&&t.diffuse.value.copy(h.color),h.emissive&&t.emissive.value.copy(h.emissive).multiplyScalar(h.emissiveIntensity),h.map&&(t.map.value=h.map),h.alphaMap&&(t.alphaMap.value=h.alphaMap),h.specularMap&&(t.specularMap.value=h.specularMap);var x,M,k=h.envMap||p;k&&(t.envMap.value=k,t.flipEnvMap.value=k.isCubeTexture?-1:1,t.reflectivity.value=h.reflectivity,t.refractionRatio.value=h.refractionRatio,t.maxMipLevel.value=ue.get(k).__maxMipLevel),h.lightMap&&(t.lightMap.value=h.lightMap,t.lightMapIntensity.value=h.lightMapIntensity),h.aoMap&&(t.aoMap.value=h.aoMap,t.aoMapIntensity.value=h.aoMapIntensity),h.map?x=h.map:h.specularMap?x=h.specularMap:h.displacementMap?x=h.displacementMap:h.normalMap?x=h.normalMap:h.bumpMap?x=h.bumpMap:h.roughnessMap?x=h.roughnessMap:h.metalnessMap?x=h.metalnessMap:h.alphaMap?x=h.alphaMap:h.emissiveMap&&(x=h.emissiveMap),void 0!==x&&(x.isWebGLRenderTarget&&(x=x.texture),!0===x.matrixAutoUpdate&&x.updateMatrix(),t.uvTransform.value.copy(x.matrix)),h.aoMap?M=h.aoMap:h.lightMap&&(M=h.lightMap),void 0!==M&&(M.isWebGLRenderTarget&&(M=M.texture),!0===M.matrixAutoUpdate&&M.updateMatrix(),t.uv2Transform.value.copy(M.matrix))}function refreshUniformsStandard(t,h,p){t.roughness.value=h.roughness,t.metalness.value=h.metalness,h.roughnessMap&&(t.roughnessMap.value=h.roughnessMap),h.metalnessMap&&(t.metalnessMap.value=h.metalnessMap),h.emissiveMap&&(t.emissiveMap.value=h.emissiveMap),h.bumpMap&&(t.bumpMap.value=h.bumpMap,t.bumpScale.value=h.bumpScale,h.side===Va&&(t.bumpScale.value*=-1)),h.normalMap&&(t.normalMap.value=h.normalMap,t.normalScale.value.copy(h.normalScale),h.side===Va&&t.normalScale.value.negate()),h.displacementMap&&(t.displacementMap.value=h.displacementMap,t.displacementScale.value=h.displacementScale,t.displacementBias.value=h.displacementBias),(h.envMap||p)&&(t.envMapIntensity.value=h.envMapIntensity)}nt.setAnimationLoop((function onAnimationFrame(t){Je.isPresenting||rt&&rt(t)})),"undefined"!=typeof window&&nt.setContext(window),this.setAnimationLoop=function(t){rt=t,Je.setAnimationLoop(t),nt.start()},this.render=function(t,h){var p,x;if(void 0!==arguments[2]&&(p=arguments[2]),void 0!==arguments[3]&&(x=arguments[3]),h&&h.isCamera&&!_e){Le.geometry=null,Le.program=null,Le.wireframe=!1,ke=-1,Ee=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===h.parent&&h.updateMatrixWorld(),Je.enabled&&Je.isPresenting&&(h=Je.getCamera(h)),(ne=ge.get(t,h)).init(),t.onBeforeRender(we,t,h,p||Ae),Ke.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),He.setFromProjectionMatrix(Ke),qe=this.localClippingEnabled,Xe=$e.init(this.clippingPlanes,qe,h),(re=me.get(t,h)).init(),projectObject(t,h,0,we.sortObjects),!0===we.sortObjects&&re.sort(Ge,je),Xe&&$e.beginShadows();var M=ne.state.shadowsArray;et.render(M,t,h),ne.setupLights(h),Xe&&$e.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==p&&this.setRenderTarget(p),Je.enabled&&Qe.isAvailable()&&Qe.attachCamera(h),ve.render(re,t,h,x);var k=re.opaque,I=re.transparent;if(t.overrideMaterial){var N=t.overrideMaterial;k.length&&renderObjects(k,t,h,N),I.length&&renderObjects(I,t,h,N)}else k.length&&renderObjects(k,t,h),I.length&&renderObjects(I,t,h);t.onAfterRender(we,t,h),null!==Ae&&(le.updateRenderTargetMipmap(Ae),le.updateMultisampleRenderTarget(Ae)),se.buffers.depth.setTest(!0),se.buffers.depth.setMask(!0),se.buffers.color.setMask(!0),se.setPolygonOffset(!1),Je.enabled&&Qe.isAvailable()&&Qe.detachCamera(h),re=null,ne=null}},this.setFramebuffer=function(t){Ce!==t&&null===Ae&&ie.bindFramebuffer(36160,t),Ce=t},this.getActiveCubeFace=function(){return Se},this.getActiveMipmapLevel=function(){return Te},this.getRenderTarget=function(){return Ae},this.setRenderTarget=function(t,h,p){Ae=t,Se=h,Te=p,t&&void 0===ue.get(t).__webglFramebuffer&&le.setupRenderTarget(t);var x=Ce,M=!1;if(t){var k=ue.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(x=k[h||0],M=!0):x=t.isWebGLMultisampleRenderTarget?ue.get(t).__webglMultisampledFramebuffer:k,Be.copy(t.viewport),Oe.copy(t.scissor),Re=t.scissorTest}else Be.copy(Ue).multiplyScalar(Ve).floor(),Oe.copy(ze).multiplyScalar(Ve).floor(),Re=We;if(De!==x&&(ie.bindFramebuffer(36160,x),De=x),se.viewport(Be),se.scissor(Oe),se.setScissorTest(Re),M){var I=ue.get(t.texture);ie.framebufferTexture2D(36160,36064,34069+(h||0),I.__webglTexture,p||0)}},this.readRenderTargetPixels=function(t,h,p,x,M,k,I){if(t&&t.isWebGLRenderTarget){var N=ue.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==I&&(N=N[I]),N){var V=!1;N!==De&&(ie.bindFramebuffer(36160,N),V=!0);try{var ee=t.texture,te=ee.format,re=ee.type;if(te!==us&&Me.convert(te)!==ie.getParameter(35739))return;if(!(re===qo||Me.convert(re)===ie.getParameter(35738)||re===es&&(oe.isWebGL2||ae.get("OES_texture_float")||ae.get("WEBGL_color_buffer_float"))||re===ts&&(oe.isWebGL2?ae.get("EXT_color_buffer_float"):ae.get("EXT_color_buffer_half_float"))))return;36053===ie.checkFramebufferStatus(36160)&&h>=0&&h<=t.width-x&&p>=0&&p<=t.height-M&&ie.readPixels(h,p,x,M,Me.convert(te),Me.convert(re),k)}finally{V&&ie.bindFramebuffer(36160,De)}}}},this.copyFramebufferToTexture=function(t,h,p){void 0===p&&(p=0);var x=Math.pow(2,-p),M=Math.floor(h.image.width*x),k=Math.floor(h.image.height*x),I=Me.convert(h.format);le.setTexture2D(h,0),ie.copyTexImage2D(3553,p,I,t.x,t.y,M,k,0),se.unbindTexture()},this.copyTextureToTexture=function(t,h,p,x){var M=h.image.width,k=h.image.height,I=Me.convert(p.format),N=Me.convert(p.type);le.setTexture2D(p,0),h.isDataTexture?ie.texSubImage2D(3553,x||0,t.x,t.y,M,k,I,N,h.image.data):ie.texSubImage2D(3553,x||0,t.x,t.y,I,N,h.image),se.unbindTexture()},this.initTexture=function(t){le.setTexture2D(t,0),se.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function FogExp2(t,h){this.name="",this.color=new Color(t),this.density=void 0!==h?h:25e-5}function Fog(t,h,p){this.name="",this.color=new Color(t),this.near=void 0!==h?h:1,this.far=void 0!==p?p:1e3}function InterleavedBuffer(t,h){this.array=t,this.stride=h,this.count=void 0!==t?t.length/h:0,this.usage=lc,this.updateRange={offset:0,count:-1},this.version=0}WebGLMultiviewRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultiviewRenderTarget,isWebGLMultiviewRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,h,p){t*=this.stride,p*=h.stride;for(var x=0,M=this.stride;x<M;x++)this.array[t+x]=h.array[p+x];return this},set:function(t,h){return void 0===h&&(h=0),this.array.set(t,h),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var kl,Pl=new Vector3;function InterleavedBufferAttribute(t,h,p,x){this.data=t,this.itemSize=h,this.offset=p,this.normalized=!0===x}function SpriteMaterial(t){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var h=0,p=this.data.count;h<p;h++)Pl.x=this.getX(h),Pl.y=this.getY(h),Pl.z=this.getZ(h),Pl.applyMatrix4(t),this.setXYZ(h,Pl.x,Pl.y,Pl.z);return this},setX:function(t,h){return this.data.array[t*this.data.stride+this.offset]=h,this},setY:function(t,h){return this.data.array[t*this.data.stride+this.offset+1]=h,this},setZ:function(t,h){return this.data.array[t*this.data.stride+this.offset+2]=h,this},setW:function(t,h){return this.data.array[t*this.data.stride+this.offset+3]=h,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,h,p){return t=t*this.data.stride+this.offset,this.data.array[t+0]=h,this.data.array[t+1]=p,this},setXYZ:function(t,h,p,x){return t=t*this.data.stride+this.offset,this.data.array[t+0]=h,this.data.array[t+1]=p,this.data.array[t+2]=x,this},setXYZW:function(t,h,p,x,M){return t=t*this.data.stride+this.offset,this.data.array[t+0]=h,this.data.array[t+1]=p,this.data.array[t+2]=x,this.data.array[t+3]=M,this}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Ll=new Vector3,El=new Vector3,Il=new Vector3,Bl=new Vector2,Ol=new Vector2,Rl=new Matrix4,Fl=new Vector3,Nl=new Vector3,Vl=new Vector3,Gl=new Vector2,jl=new Vector2,Ul=new Vector2;function Sprite(t){if(Object3D.call(this),this.type="Sprite",void 0===kl){kl=new BufferGeometry;var h=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);kl.setIndex([0,1,2,0,2,3]),kl.setAttribute("position",new InterleavedBufferAttribute(h,3,0,!1)),kl.setAttribute("uv",new InterleavedBufferAttribute(h,2,3,!1))}this.geometry=kl,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(t,h,p,x,M,k){Bl.subVectors(t,p).addScalar(.5).multiply(x),void 0!==M?(Ol.x=k*Bl.x-M*Bl.y,Ol.y=M*Bl.x+k*Bl.y):Ol.copy(Bl),t.copy(h),t.x+=Ol.x,t.y+=Ol.y,t.applyMatrix4(Rl)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(t,h){t.camera,El.setFromMatrixScale(this.matrixWorld),Rl.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Il.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&El.multiplyScalar(-Il.z);var p,x,M=this.material.rotation;0!==M&&(x=Math.cos(M),p=Math.sin(M));var k=this.center;transformVertex(Fl.set(-.5,-.5,0),Il,k,El,p,x),transformVertex(Nl.set(.5,-.5,0),Il,k,El,p,x),transformVertex(Vl.set(.5,.5,0),Il,k,El,p,x),Gl.set(0,0),jl.set(1,0),Ul.set(1,1);var I=t.ray.intersectTriangle(Fl,Nl,Vl,!1,Ll);if(null!==I||(transformVertex(Nl.set(-.5,.5,0),Il,k,El,p,x),jl.set(0,1),null!==(I=t.ray.intersectTriangle(Fl,Vl,Nl,!1,Ll)))){var N=t.ray.origin.distanceTo(Ll);N<t.near||N>t.far||h.push({distance:N,point:Ll.clone(),uv:Triangle.getUV(Ll,Fl,Nl,Vl,Gl,jl,Ul,new Vector2),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var zl=new Vector3,Wl=new Vector3;function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function SkinnedMesh(t,h){t&&t.isGeometry,Mesh.call(this,t,h),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(t){Object3D.prototype.copy.call(this,t,!1);for(var h=t.levels,p=0,x=h.length;p<x;p++){var M=h[p];this.addLevel(M.object.clone(),M.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,h){void 0===h&&(h=0),h=Math.abs(h);for(var p=this.levels,x=0;x<p.length&&!(h<p[x].distance);x++);return p.splice(x,0,{distance:h,object:t}),this.add(t),this},getObjectForDistance:function(t){var h=this.levels;if(h.length>0){for(var p=1,x=h.length;p<x&&!(t<h[p].distance);p++);return h[p-1].object}return null},raycast:function(t,h){if(this.levels.length>0){zl.setFromMatrixPosition(this.matrixWorld);var p=t.ray.origin.distanceTo(zl);this.getObjectForDistance(p).raycast(t,h)}},update:function(t){var h=this.levels;if(h.length>1){zl.setFromMatrixPosition(t.matrixWorld),Wl.setFromMatrixPosition(this.matrixWorld);var p=zl.distanceTo(Wl);h[0].object.visible=!0;for(var x=1,M=h.length;x<M&&p>=h[x].distance;x++)h[x-1].object.visible=!1,h[x].object.visible=!0;for(;x<M;x++)h[x].object.visible=!1}},toJSON:function(t){var h=Object3D.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(h.object.autoUpdate=!1),h.object.levels=[];for(var p=this.levels,x=0,M=p.length;x<M;x++){var k=p[x];h.object.levels.push({object:k.object.uuid,distance:k.distance})}return h}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(t,h){this.skeleton=t,void 0===h&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),h=this.matrixWorld),this.bindMatrix.copy(h),this.bindMatrixInverse.getInverse(h)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Vector4,h=this.geometry.attributes.skinWeight,p=0,x=h.count;p<x;p++){t.x=h.getX(p),t.y=h.getY(p),t.z=h.getZ(p),t.w=h.getW(p);var M=1/t.manhattanLength();M!==1/0?t.multiplyScalar(M):t.set(1,0,0,0),h.setXYZW(p,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Mesh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Hl=new Matrix4,$l=new Matrix4;function Skeleton(t,h){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===h)this.calculateInverses();else if(this.bones.length===h.length)this.boneInverses=h.slice(0);else{this.boneInverses=[];for(var p=0,x=this.bones.length;p<x;p++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,h=this.bones.length;t<h;t++){var p=new Matrix4;this.bones[t]&&p.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(p)}},pose:function(){var t,h,p;for(h=0,p=this.bones.length;h<p;h++)(t=this.bones[h])&&t.matrixWorld.getInverse(this.boneInverses[h]);for(h=0,p=this.bones.length;h<p;h++)(t=this.bones[h])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,h=this.boneInverses,p=this.boneMatrices,x=this.boneTexture,M=0,k=t.length;M<k;M++){var I=t[M]?t[M].matrixWorld:$l;Hl.multiplyMatrices(I,h[M]),Hl.toArray(p,16*M)}void 0!==x&&(x.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(t){for(var h=0,p=this.bones.length;h<p;h++){var x=this.bones[h];if(x.name===t)return x}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});var Xl=new Matrix4,ql=new Matrix4,Kl=[],Yl=new Mesh;function InstancedMesh(t,h,p){Mesh.call(this,t,h),this.instanceMatrix=new BufferAttribute(new Float32Array(16*p),16),this.count=p,this.frustumCulled=!1}function LineBasicMaterial(t){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,getMatrixAt:function(t,h){h.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,h){var p=this.matrixWorld,x=this.count;if(Yl.geometry=this.geometry,Yl.material=this.material,void 0!==Yl.material)for(var M=0;M<x;M++)this.getMatrixAt(M,Xl),ql.multiplyMatrices(p,Xl),Yl.matrixWorld=ql,Yl.raycast(t,Kl),Kl.length>0&&(Kl[0].instanceId=M,Kl[0].object=this,h.push(Kl[0]),Kl.length=0)},setMatrixAt:function(t,h){h.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var Zl=new Vector3,Jl=new Vector3,Ql=new Matrix4,eh=new Ray,th=new Sphere;function Line(t,h,p){Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==h?h:new LineBasicMaterial}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry){if(null===t.index){for(var h=t.attributes.position,p=[0],x=1,M=h.count;x<M;x++)Zl.fromBufferAttribute(h,x-1),Jl.fromBufferAttribute(h,x),p[x]=p[x-1],p[x]+=Zl.distanceTo(Jl);t.setAttribute("lineDistance",new Float32BufferAttribute(p,1))}}else if(t.isGeometry){var k=t.vertices;(p=t.lineDistances)[0]=0;for(x=1,M=k.length;x<M;x++)p[x]=p[x-1],p[x]+=k[x-1].distanceTo(k[x])}return this},raycast:function(t,h){var p=t.linePrecision,x=this.geometry,M=this.matrixWorld;if(null===x.boundingSphere&&x.computeBoundingSphere(),th.copy(x.boundingSphere),th.applyMatrix4(M),th.radius+=p,!1!==t.ray.intersectsSphere(th)){Ql.getInverse(M),eh.copy(t.ray).applyMatrix4(Ql);var k=p/((this.scale.x+this.scale.y+this.scale.z)/3),I=k*k,N=new Vector3,V=new Vector3,ee=new Vector3,te=new Vector3,re=this&&this.isLineSegments?2:1;if(x.isBufferGeometry){var ne=x.index,ie=x.attributes.position.array;if(null!==ne)for(var ae=ne.array,oe=0,se=ae.length-1;oe<se;oe+=re){var ce=ae[oe],ue=ae[oe+1];if(N.fromArray(ie,3*ce),V.fromArray(ie,3*ue),!(eh.distanceSqToSegment(N,V,te,ee)>I))te.applyMatrix4(this.matrixWorld),(fe=t.ray.origin.distanceTo(te))<t.near||fe>t.far||h.push({distance:fe,point:ee.clone().applyMatrix4(this.matrixWorld),index:oe,face:null,faceIndex:null,object:this})}else for(oe=0,se=ie.length/3-1;oe<se;oe+=re){if(N.fromArray(ie,3*oe),V.fromArray(ie,3*oe+3),!(eh.distanceSqToSegment(N,V,te,ee)>I))te.applyMatrix4(this.matrixWorld),(fe=t.ray.origin.distanceTo(te))<t.near||fe>t.far||h.push({distance:fe,point:ee.clone().applyMatrix4(this.matrixWorld),index:oe,face:null,faceIndex:null,object:this})}}else if(x.isGeometry){var le=x.vertices,he=le.length;for(oe=0;oe<he-1;oe+=re){var fe;if(!(eh.distanceSqToSegment(le[oe],le[oe+1],te,ee)>I))te.applyMatrix4(this.matrixWorld),(fe=t.ray.origin.distanceTo(te))<t.near||fe>t.far||h.push({distance:fe,point:ee.clone().applyMatrix4(this.matrixWorld),index:oe,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var rh=new Vector3,ih=new Vector3;function LineSegments(t,h){Line.call(this,t,h),this.type="LineSegments"}function LineLoop(t,h){Line.call(this,t,h),this.type="LineLoop"}function PointsMaterial(t){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry){if(null===t.index){for(var h=t.attributes.position,p=[],x=0,M=h.count;x<M;x+=2)rh.fromBufferAttribute(h,x),ih.fromBufferAttribute(h,x+1),p[x]=0===x?0:p[x-1],p[x+1]=p[x]+rh.distanceTo(ih);t.setAttribute("lineDistance",new Float32BufferAttribute(p,1))}}else if(t.isGeometry){var k=t.vertices;for(p=t.lineDistances,x=0,M=k.length;x<M;x+=2)rh.copy(k[x]),ih.copy(k[x+1]),p[x]=0===x?0:p[x-1],p[x+1]=p[x]+rh.distanceTo(ih)}return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var ah=new Matrix4,oh=new Ray,sh=new Sphere,ch=new Vector3;function Points(t,h){Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new BufferGeometry,this.material=void 0!==h?h:new PointsMaterial,this.updateMorphTargets()}function testPoint(t,h,p,x,M,k,I){var N=oh.distanceSqToPoint(t);if(N<p){var V=new Vector3;oh.closestPointToPoint(t,V),V.applyMatrix4(x);var ee=M.ray.origin.distanceTo(V);if(ee<M.near||ee>M.far)return;k.push({distance:ee,distanceToRay:Math.sqrt(N),point:V,index:h,face:null,object:I})}}function VideoTexture(t,h,p,x,M,k,I,N,V){Texture.call(this,t,h,p,x,M,k,I,N,V),this.format=void 0!==I?I:cs,this.minFilter=void 0!==k?k:Ho,this.magFilter=void 0!==M?M:Ho,this.generateMipmaps=!1}function CompressedTexture(t,h,p,x,M,k,I,N,V,ee,te,re){Texture.call(this,null,k,I,N,V,ee,x,M,te,re),this.image={width:h,height:p},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(t,h,p,x,M,k,I,N,V){Texture.call(this,t,h,p,x,M,k,I,N,V),this.needsUpdate=!0}function DepthTexture(t,h,p,x,M,k,I,N,V,ee){if((ee=void 0!==ee?ee:ds)!==ds&&ee!==ps)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===p&&ee===ds&&(p=Zo),void 0===p&&ee===ps&&(p=os),Texture.call(this,null,x,M,k,I,N,ee,p,V),this.image={width:t,height:h},this.magFilter=void 0!==I?I:Uo,this.minFilter=void 0!==N?N:Uo,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(t){BufferGeometry.call(this),this.type="WireframeGeometry";var h,p,x,M,k,I,N,V,ee,te,re=[],ne=[0,0],ie={},ae=["a","b","c"];if(t&&t.isGeometry){var oe=t.faces;for(h=0,x=oe.length;h<x;h++){var se=oe[h];for(p=0;p<3;p++)N=se[ae[p]],V=se[ae[(p+1)%3]],ne[0]=Math.min(N,V),ne[1]=Math.max(N,V),void 0===ie[ee=ne[0]+","+ne[1]]&&(ie[ee]={index1:ne[0],index2:ne[1]})}for(ee in ie)I=ie[ee],te=t.vertices[I.index1],re.push(te.x,te.y,te.z),te=t.vertices[I.index2],re.push(te.x,te.y,te.z)}else if(t&&t.isBufferGeometry){var ce,ue,le,he,fe,de,pe;if(te=new Vector3,null!==t.index){for(ce=t.attributes.position,ue=t.index,0===(le=t.groups).length&&(le=[{start:0,count:ue.count,materialIndex:0}]),M=0,k=le.length;M<k;++M)for(h=fe=(he=le[M]).start,x=fe+he.count;h<x;h+=3)for(p=0;p<3;p++)N=ue.getX(h+p),V=ue.getX(h+(p+1)%3),ne[0]=Math.min(N,V),ne[1]=Math.max(N,V),void 0===ie[ee=ne[0]+","+ne[1]]&&(ie[ee]={index1:ne[0],index2:ne[1]});for(ee in ie)I=ie[ee],te.fromBufferAttribute(ce,I.index1),re.push(te.x,te.y,te.z),te.fromBufferAttribute(ce,I.index2),re.push(te.x,te.y,te.z)}else for(h=0,x=(ce=t.attributes.position).count/3;h<x;h++)for(p=0;p<3;p++)de=3*h+p,te.fromBufferAttribute(ce,de),re.push(te.x,te.y,te.z),pe=3*h+(p+1)%3,te.fromBufferAttribute(ce,pe),re.push(te.x,te.y,te.z)}this.setAttribute("position",new Float32BufferAttribute(re,3))}function ParametricGeometry(t,h,p){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:h,stacks:p},this.fromBufferGeometry(new ParametricBufferGeometry(t,h,p)),this.mergeVertices()}function ParametricBufferGeometry(t,h,p){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:h,stacks:p};var x,M,k=[],I=[],N=[],V=[],ee=1e-5,te=new Vector3,re=new Vector3,ne=new Vector3,ie=new Vector3,ae=new Vector3;t.length;var oe=h+1;for(x=0;x<=p;x++){var se=x/p;for(M=0;M<=h;M++){var ce=M/h;t(ce,se,re),I.push(re.x,re.y,re.z),ce-ee>=0?(t(ce-ee,se,ne),ie.subVectors(re,ne)):(t(ce+ee,se,ne),ie.subVectors(ne,re)),se-ee>=0?(t(ce,se-ee,ne),ae.subVectors(re,ne)):(t(ce,se+ee,ne),ae.subVectors(ne,re)),te.crossVectors(ie,ae).normalize(),N.push(te.x,te.y,te.z),V.push(ce,se)}}for(x=0;x<p;x++)for(M=0;M<h;M++){var ue=x*oe+M,le=x*oe+M+1,he=(x+1)*oe+M+1,fe=(x+1)*oe+M;k.push(ue,le,fe),k.push(le,he,fe)}this.setIndex(k),this.setAttribute("position",new Float32BufferAttribute(I,3)),this.setAttribute("normal",new Float32BufferAttribute(N,3)),this.setAttribute("uv",new Float32BufferAttribute(V,2))}function PolyhedronGeometry(t,h,p,x){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:h,radius:p,detail:x},this.fromBufferGeometry(new PolyhedronBufferGeometry(t,h,p,x)),this.mergeVertices()}function PolyhedronBufferGeometry(t,h,p,x){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:h,radius:p,detail:x},p=p||1;var M=[],k=[];function subdivideFace(t,h,p,x){var M,k,I=Math.pow(2,x),N=[];for(M=0;M<=I;M++){N[M]=[];var V=t.clone().lerp(p,M/I),ee=h.clone().lerp(p,M/I),te=I-M;for(k=0;k<=te;k++)N[M][k]=0===k&&M===I?V:V.clone().lerp(ee,k/te)}for(M=0;M<I;M++)for(k=0;k<2*(I-M)-1;k++){var re=Math.floor(k/2);k%2==0?(pushVertex(N[M][re+1]),pushVertex(N[M+1][re]),pushVertex(N[M][re])):(pushVertex(N[M][re+1]),pushVertex(N[M+1][re+1]),pushVertex(N[M+1][re]))}}function pushVertex(t){M.push(t.x,t.y,t.z)}function getVertexByIndex(h,p){var x=3*h;p.x=t[x+0],p.y=t[x+1],p.z=t[x+2]}function correctUV(t,h,p,x){x<0&&1===t.x&&(k[h]=t.x-1),0===p.x&&0===p.z&&(k[h]=x/2/Math.PI+.5)}function azimuth(t){return Math.atan2(t.z,-t.x)}!function subdivide(t){for(var p=new Vector3,x=new Vector3,M=new Vector3,k=0;k<h.length;k+=3)getVertexByIndex(h[k+0],p),getVertexByIndex(h[k+1],x),getVertexByIndex(h[k+2],M),subdivideFace(p,x,M,t)}(x=x||0),function applyRadius(t){for(var h=new Vector3,p=0;p<M.length;p+=3)h.x=M[p+0],h.y=M[p+1],h.z=M[p+2],h.normalize().multiplyScalar(t),M[p+0]=h.x,M[p+1]=h.y,M[p+2]=h.z}(p),function generateUVs(){for(var t=new Vector3,h=0;h<M.length;h+=3){t.x=M[h+0],t.y=M[h+1],t.z=M[h+2];var p=azimuth(t)/2/Math.PI+.5,x=(I=t,Math.atan2(-I.y,Math.sqrt(I.x*I.x+I.z*I.z))/Math.PI+.5);k.push(p,1-x)}var I;(function correctUVs(){for(var t=new Vector3,h=new Vector3,p=new Vector3,x=new Vector3,I=new Vector2,N=new Vector2,V=new Vector2,ee=0,te=0;ee<M.length;ee+=9,te+=6){t.set(M[ee+0],M[ee+1],M[ee+2]),h.set(M[ee+3],M[ee+4],M[ee+5]),p.set(M[ee+6],M[ee+7],M[ee+8]),I.set(k[te+0],k[te+1]),N.set(k[te+2],k[te+3]),V.set(k[te+4],k[te+5]),x.copy(t).add(h).add(p).divideScalar(3);var re=azimuth(x);correctUV(I,te+0,t,re),correctUV(N,te+2,h,re),correctUV(V,te+4,p,re)}})(),function correctSeam(){for(var t=0;t<k.length;t+=6){var h=k[t+0],p=k[t+2],x=k[t+4],M=Math.max(h,p,x),I=Math.min(h,p,x);M>.9&&I<.1&&(h<.2&&(k[t+0]+=1),p<.2&&(k[t+2]+=1),x<.2&&(k[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(M,3)),this.setAttribute("normal",new Float32BufferAttribute(M.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(k,2)),0===x?this.computeVertexNormals():this.normalizeNormals()}function TetrahedronGeometry(t,h){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:h},this.fromBufferGeometry(new TetrahedronBufferGeometry(t,h)),this.mergeVertices()}function TetrahedronBufferGeometry(t,h){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,h),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:h}}function OctahedronGeometry(t,h){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:h},this.fromBufferGeometry(new OctahedronBufferGeometry(t,h)),this.mergeVertices()}function OctahedronBufferGeometry(t,h){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,h),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:h}}function IcosahedronGeometry(t,h){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:h},this.fromBufferGeometry(new IcosahedronBufferGeometry(t,h)),this.mergeVertices()}function IcosahedronBufferGeometry(t,h){var p=(1+Math.sqrt(5))/2,x=[-1,p,0,1,p,0,-1,-p,0,1,-p,0,0,-1,p,0,1,p,0,-1,-p,0,1,-p,p,0,-1,p,0,1,-p,0,-1,-p,0,1];PolyhedronBufferGeometry.call(this,x,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,h),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:h}}function DodecahedronGeometry(t,h){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:h},this.fromBufferGeometry(new DodecahedronBufferGeometry(t,h)),this.mergeVertices()}function DodecahedronBufferGeometry(t,h){var p=(1+Math.sqrt(5))/2,x=1/p,M=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-x,-p,0,-x,p,0,x,-p,0,x,p,-x,-p,0,-x,p,0,x,-p,0,x,p,0,-p,0,-x,p,0,-x,-p,0,x,p,0,x];PolyhedronBufferGeometry.call(this,M,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,h),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:h}}function TubeGeometry(t,h,p,x,M,k){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:h,radius:p,radialSegments:x,closed:M};var I=new TubeBufferGeometry(t,h,p,x,M);this.tangents=I.tangents,this.normals=I.normals,this.binormals=I.binormals,this.fromBufferGeometry(I),this.mergeVertices()}function TubeBufferGeometry(t,h,p,x,M){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:h,radius:p,radialSegments:x,closed:M},h=h||64,p=p||1,x=x||8,M=M||!1;var k=t.computeFrenetFrames(h,M);this.tangents=k.tangents,this.normals=k.normals,this.binormals=k.binormals;var I,N,V=new Vector3,ee=new Vector3,te=new Vector2,re=new Vector3,ne=[],ie=[],ae=[],oe=[];function generateSegment(M){re=t.getPointAt(M/h,re);var I=k.normals[M],te=k.binormals[M];for(N=0;N<=x;N++){var ae=N/x*Math.PI*2,oe=Math.sin(ae),se=-Math.cos(ae);ee.x=se*I.x+oe*te.x,ee.y=se*I.y+oe*te.y,ee.z=se*I.z+oe*te.z,ee.normalize(),ie.push(ee.x,ee.y,ee.z),V.x=re.x+p*ee.x,V.y=re.y+p*ee.y,V.z=re.z+p*ee.z,ne.push(V.x,V.y,V.z)}}!function generateBufferData(){for(I=0;I<h;I++)generateSegment(I);generateSegment(!1===M?h:0),function generateUVs(){for(I=0;I<=h;I++)for(N=0;N<=x;N++)te.x=I/h,te.y=N/x,ae.push(te.x,te.y)}(),function generateIndices(){for(N=1;N<=h;N++)for(I=1;I<=x;I++){var t=(x+1)*(N-1)+(I-1),p=(x+1)*N+(I-1),M=(x+1)*N+I,k=(x+1)*(N-1)+I;oe.push(t,p,k),oe.push(p,M,k)}}()}(),this.setIndex(oe),this.setAttribute("position",new Float32BufferAttribute(ne,3)),this.setAttribute("normal",new Float32BufferAttribute(ie,3)),this.setAttribute("uv",new Float32BufferAttribute(ae,2))}function TorusKnotGeometry(t,h,p,x,M,k,I){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:h,tubularSegments:p,radialSegments:x,p:M,q:k},this.fromBufferGeometry(new TorusKnotBufferGeometry(t,h,p,x,M,k)),this.mergeVertices()}function TorusKnotBufferGeometry(t,h,p,x,M,k){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:h,tubularSegments:p,radialSegments:x,p:M,q:k},t=t||1,h=h||.4,p=Math.floor(p)||64,x=Math.floor(x)||8,M=M||2,k=k||3;var I,N,V=[],ee=[],te=[],re=[],ne=new Vector3,ie=new Vector3,ae=new Vector3,oe=new Vector3,se=new Vector3,ce=new Vector3,ue=new Vector3;for(I=0;I<=p;++I){var le=I/p*M*Math.PI*2;for(calculatePositionOnCurve(le,M,k,t,ae),calculatePositionOnCurve(le+.01,M,k,t,oe),ce.subVectors(oe,ae),ue.addVectors(oe,ae),se.crossVectors(ce,ue),ue.crossVectors(se,ce),se.normalize(),ue.normalize(),N=0;N<=x;++N){var he=N/x*Math.PI*2,fe=-h*Math.cos(he),de=h*Math.sin(he);ne.x=ae.x+(fe*ue.x+de*se.x),ne.y=ae.y+(fe*ue.y+de*se.y),ne.z=ae.z+(fe*ue.z+de*se.z),ee.push(ne.x,ne.y,ne.z),ie.subVectors(ne,ae).normalize(),te.push(ie.x,ie.y,ie.z),re.push(I/p),re.push(N/x)}}for(N=1;N<=p;N++)for(I=1;I<=x;I++){var pe=(x+1)*(N-1)+(I-1),me=(x+1)*N+(I-1),ge=(x+1)*N+I,ve=(x+1)*(N-1)+I;V.push(pe,me,ve),V.push(me,ge,ve)}function calculatePositionOnCurve(t,h,p,x,M){var k=Math.cos(t),I=Math.sin(t),N=p/h*t,V=Math.cos(N);M.x=x*(2+V)*.5*k,M.y=x*(2+V)*I*.5,M.z=x*Math.sin(N)*.5}this.setIndex(V),this.setAttribute("position",new Float32BufferAttribute(ee,3)),this.setAttribute("normal",new Float32BufferAttribute(te,3)),this.setAttribute("uv",new Float32BufferAttribute(re,2))}function TorusGeometry(t,h,p,x,M){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:h,radialSegments:p,tubularSegments:x,arc:M},this.fromBufferGeometry(new TorusBufferGeometry(t,h,p,x,M)),this.mergeVertices()}function TorusBufferGeometry(t,h,p,x,M){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:h,radialSegments:p,tubularSegments:x,arc:M},t=t||1,h=h||.4,p=Math.floor(p)||8,x=Math.floor(x)||6,M=M||2*Math.PI;var k,I,N=[],V=[],ee=[],te=[],re=new Vector3,ne=new Vector3,ie=new Vector3;for(k=0;k<=p;k++)for(I=0;I<=x;I++){var ae=I/x*M,oe=k/p*Math.PI*2;ne.x=(t+h*Math.cos(oe))*Math.cos(ae),ne.y=(t+h*Math.cos(oe))*Math.sin(ae),ne.z=h*Math.sin(oe),V.push(ne.x,ne.y,ne.z),re.x=t*Math.cos(ae),re.y=t*Math.sin(ae),ie.subVectors(ne,re).normalize(),ee.push(ie.x,ie.y,ie.z),te.push(I/x),te.push(k/p)}for(k=1;k<=p;k++)for(I=1;I<=x;I++){var se=(x+1)*k+I-1,ce=(x+1)*(k-1)+I-1,ue=(x+1)*(k-1)+I,le=(x+1)*k+I;N.push(se,ce,le),N.push(ce,ue,le)}this.setIndex(N),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("normal",new Float32BufferAttribute(ee,3)),this.setAttribute("uv",new Float32BufferAttribute(te,2))}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(t,h){var p=this.geometry,x=this.matrixWorld,M=t.params.Points.threshold;if(null===p.boundingSphere&&p.computeBoundingSphere(),sh.copy(p.boundingSphere),sh.applyMatrix4(x),sh.radius+=M,!1!==t.ray.intersectsSphere(sh)){ah.getInverse(x),oh.copy(t.ray).applyMatrix4(ah);var k=M/((this.scale.x+this.scale.y+this.scale.z)/3),I=k*k;if(p.isBufferGeometry){var N=p.index,V=p.attributes.position.array;if(null!==N)for(var ee=N.array,te=0,re=ee.length;te<re;te++){var ne=ee[te];ch.fromArray(V,3*ne),testPoint(ch,ne,I,x,t,h,this)}else{te=0;for(var ie=V.length/3;te<ie;te++)ch.fromArray(V,3*te),testPoint(ch,te,I,x,t,h,this)}}else{var ae=p.vertices;for(te=0,ie=ae.length;te<ie;te++)testPoint(ae[te],te,I,x,t,h,this)}}},updateMorphTargets:function(){var t,h,p,x=this.geometry;if(x.isBufferGeometry){var M=x.morphAttributes,k=Object.keys(M);if(k.length>0){var I=M[k[0]];if(void 0!==I)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,h=I.length;t<h;t++)p=I[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=t}}else{var N=x.morphTargets;void 0!==N&&N.length}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TubeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Earcut_triangulate=function(t,h,p){p=p||2;var x,M,k,I,N,V,ee,te=h&&h.length,re=te?h[0]*p:t.length,ne=linkedList(t,0,re,p,!0),ie=[];if(!ne||ne.next===ne.prev)return ie;if(te&&(ne=function eliminateHoles(t,h,p,x){var M,k,I,N=[];for(M=0,k=h.length;M<k;M++)(I=linkedList(t,h[M]*x,M<k-1?h[M+1]*x:t.length,x,!1))===I.next&&(I.steiner=!0),N.push(getLeftmost(I));for(N.sort(compareX),M=0;M<N.length;M++)eliminateHole(N[M],p),p=filterPoints(p,p.next);return p}(t,h,ne,p)),t.length>80*p){x=k=t[0],M=I=t[1];for(var ae=p;ae<re;ae+=p)(N=t[ae])<x&&(x=N),(V=t[ae+1])<M&&(M=V),N>k&&(k=N),V>I&&(I=V);ee=0!==(ee=Math.max(k-x,I-M))?1/ee:0}return earcutLinked(ne,ie,p,x,M,ee),ie};function linkedList(t,h,p,x,M){var k,I;if(M===function signedArea(t,h,p,x){for(var M=0,k=h,I=p-x;k<p;k+=x)M+=(t[I]-t[k])*(t[k+1]+t[I+1]),I=k;return M}(t,h,p,x)>0)for(k=h;k<p;k+=x)I=insertNode(k,t[k],t[k+1],I);else for(k=p-x;k>=h;k-=x)I=insertNode(k,t[k],t[k+1],I);return I&&equals(I,I.next)&&(removeNode(I),I=I.next),I}function filterPoints(t,h){if(!t)return t;h||(h=t);var p,x=t;do{if(p=!1,x.steiner||!equals(x,x.next)&&0!==area(x.prev,x,x.next))x=x.next;else{if(removeNode(x),(x=h=x.prev)===x.next)break;p=!0}}while(p||x!==h);return h}function earcutLinked(t,h,p,x,M,k,I){if(t){!I&&k&&function indexCurve(t,h,p,x){var M=t;do{null===M.z&&(M.z=zOrder(M.x,M.y,h,p,x)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next}while(M!==t);M.prevZ.nextZ=null,M.prevZ=null,function sortLinked(t){var h,p,x,M,k,I,N,V,ee=1;do{for(p=t,t=null,k=null,I=0;p;){for(I++,x=p,N=0,h=0;h<ee&&(N++,x=x.nextZ);h++);for(V=ee;N>0||V>0&&x;)0!==N&&(0===V||!x||p.z<=x.z)?(M=p,p=p.nextZ,N--):(M=x,x=x.nextZ,V--),k?k.nextZ=M:t=M,M.prevZ=k,k=M;p=x}k.nextZ=null,ee*=2}while(I>1);return t}(M)}(t,x,M,k);for(var N,V,ee=t;t.prev!==t.next;)if(N=t.prev,V=t.next,k?isEarHashed(t,x,M,k):isEar(t))h.push(N.i/p),h.push(t.i/p),h.push(V.i/p),removeNode(t),t=V.next,ee=V.next;else if((t=V)===ee){I?1===I?earcutLinked(t=cureLocalIntersections(t,h,p),h,p,x,M,k,2):2===I&&splitEarcut(t,h,p,x,M,k):earcutLinked(filterPoints(t),h,p,x,M,k,1);break}}}function isEar(t){var h=t.prev,p=t,x=t.next;if(area(h,p,x)>=0)return!1;for(var M=t.next.next;M!==t.prev;){if(pointInTriangle(h.x,h.y,p.x,p.y,x.x,x.y,M.x,M.y)&&area(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function isEarHashed(t,h,p,x){var M=t.prev,k=t,I=t.next;if(area(M,k,I)>=0)return!1;for(var N=M.x<k.x?M.x<I.x?M.x:I.x:k.x<I.x?k.x:I.x,V=M.y<k.y?M.y<I.y?M.y:I.y:k.y<I.y?k.y:I.y,ee=M.x>k.x?M.x>I.x?M.x:I.x:k.x>I.x?k.x:I.x,te=M.y>k.y?M.y>I.y?M.y:I.y:k.y>I.y?k.y:I.y,re=zOrder(N,V,h,p,x),ne=zOrder(ee,te,h,p,x),ie=t.prevZ,ae=t.nextZ;ie&&ie.z>=re&&ae&&ae.z<=ne;){if(ie!==t.prev&&ie!==t.next&&pointInTriangle(M.x,M.y,k.x,k.y,I.x,I.y,ie.x,ie.y)&&area(ie.prev,ie,ie.next)>=0)return!1;if(ie=ie.prevZ,ae!==t.prev&&ae!==t.next&&pointInTriangle(M.x,M.y,k.x,k.y,I.x,I.y,ae.x,ae.y)&&area(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}for(;ie&&ie.z>=re;){if(ie!==t.prev&&ie!==t.next&&pointInTriangle(M.x,M.y,k.x,k.y,I.x,I.y,ie.x,ie.y)&&area(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ae&&ae.z<=ne;){if(ae!==t.prev&&ae!==t.next&&pointInTriangle(M.x,M.y,k.x,k.y,I.x,I.y,ae.x,ae.y)&&area(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function cureLocalIntersections(t,h,p){var x=t;do{var M=x.prev,k=x.next.next;!equals(M,k)&&intersects(M,x,x.next,k)&&locallyInside(M,k)&&locallyInside(k,M)&&(h.push(M.i/p),h.push(x.i/p),h.push(k.i/p),removeNode(x),removeNode(x.next),x=t=k),x=x.next}while(x!==t);return x}function splitEarcut(t,h,p,x,M,k){var I=t;do{for(var N=I.next.next;N!==I.prev;){if(I.i!==N.i&&isValidDiagonal(I,N)){var V=splitPolygon(I,N);return I=filterPoints(I,I.next),V=filterPoints(V,V.next),earcutLinked(I,h,p,x,M,k),void earcutLinked(V,h,p,x,M,k)}N=N.next}I=I.next}while(I!==t)}function compareX(t,h){return t.x-h.x}function eliminateHole(t,h){if(h=function findHoleBridge(t,h){var p,x=h,M=t.x,k=t.y,I=-1/0;do{if(k<=x.y&&k>=x.next.y&&x.next.y!==x.y){var N=x.x+(k-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(N<=M&&N>I){if(I=N,N===M){if(k===x.y)return x;if(k===x.next.y)return x.next}p=x.x<x.next.x?x:x.next}}x=x.next}while(x!==h);if(!p)return null;if(M===I)return p.prev;var V,ee=p,te=p.x,re=p.y,ne=1/0;x=p.next;for(;x!==ee;)M>=x.x&&x.x>=te&&M!==x.x&&pointInTriangle(k<re?M:I,k,te,re,k<re?I:M,k,x.x,x.y)&&((V=Math.abs(k-x.y)/(M-x.x))<ne||V===ne&&x.x>p.x)&&locallyInside(x,t)&&(p=x,ne=V),x=x.next;return p}(t,h),h){var p=splitPolygon(h,t);filterPoints(p,p.next)}}function zOrder(t,h,p,x,M){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-p)*M)|t<<8))|t<<4))|t<<2))|t<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-x)*M)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function getLeftmost(t){var h=t,p=t;do{(h.x<p.x||h.x===p.x&&h.y<p.y)&&(p=h),h=h.next}while(h!==t);return p}function pointInTriangle(t,h,p,x,M,k,I,N){return(M-I)*(h-N)-(t-I)*(k-N)>=0&&(t-I)*(x-N)-(p-I)*(h-N)>=0&&(p-I)*(k-N)-(M-I)*(x-N)>=0}function isValidDiagonal(t,h){return t.next.i!==h.i&&t.prev.i!==h.i&&!function intersectsPolygon(t,h){var p=t;do{if(p.i!==t.i&&p.next.i!==t.i&&p.i!==h.i&&p.next.i!==h.i&&intersects(p,p.next,t,h))return!0;p=p.next}while(p!==t);return!1}(t,h)&&locallyInside(t,h)&&locallyInside(h,t)&&function middleInside(t,h){var p=t,x=!1,M=(t.x+h.x)/2,k=(t.y+h.y)/2;do{p.y>k!=p.next.y>k&&p.next.y!==p.y&&M<(p.next.x-p.x)*(k-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next}while(p!==t);return x}(t,h)}function area(t,h,p){return(h.y-t.y)*(p.x-h.x)-(h.x-t.x)*(p.y-h.y)}function equals(t,h){return t.x===h.x&&t.y===h.y}function intersects(t,h,p,x){return!!(equals(t,p)&&equals(h,x)||equals(t,x)&&equals(p,h))||area(t,h,p)>0!=area(t,h,x)>0&&area(p,x,t)>0!=area(p,x,h)>0}function locallyInside(t,h){return area(t.prev,t,t.next)<0?area(t,h,t.next)>=0&&area(t,t.prev,h)>=0:area(t,h,t.prev)<0||area(t,t.next,h)<0}function splitPolygon(t,h){var p=new Node(t.i,t.x,t.y),x=new Node(h.i,h.x,h.y),M=t.next,k=h.prev;return t.next=h,h.prev=t,p.next=M,M.prev=p,x.next=p,p.prev=x,k.next=x,x.prev=k,x}function insertNode(t,h,p,x){var M=new Node(t,h,p);return x?(M.next=x.next,M.prev=x,x.next.prev=M,x.next=M):(M.prev=M,M.next=M),M}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,h,p){this.i=t,this.x=h,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var uh={area:function(t){for(var h=t.length,p=0,x=h-1,M=0;M<h;x=M++)p+=t[x].x*t[M].y-t[M].x*t[x].y;return.5*p},isClockWise:function(t){return uh.area(t)<0},triangulateShape:function(t,h){var p=[],x=[],M=[];removeDupEndPts(t),addContour(p,t);var k=t.length;h.forEach(removeDupEndPts);for(var I=0;I<h.length;I++)x.push(k),k+=h[I].length,addContour(p,h[I]);var N=Earcut_triangulate(p,x);for(I=0;I<N.length;I+=3)M.push(N.slice(I,I+3));return M}};function removeDupEndPts(t){var h=t.length;h>2&&t[h-1].equals(t[0])&&t.pop()}function addContour(t,h){for(var p=0;p<h.length;p++)t.push(h[p].x),t.push(h[p].y)}function ExtrudeGeometry(t,h){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:h},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,h)),this.mergeVertices()}function ExtrudeBufferGeometry(t,h){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:h},t=Array.isArray(t)?t:[t];for(var p=this,x=[],M=[],k=0,I=t.length;k<I;k++){addShape(t[k])}function addShape(t){var k=[],I=void 0!==h.curveSegments?h.curveSegments:12,N=void 0!==h.steps?h.steps:1,V=void 0!==h.depth?h.depth:100,ee=void 0===h.bevelEnabled||h.bevelEnabled,te=void 0!==h.bevelThickness?h.bevelThickness:6,re=void 0!==h.bevelSize?h.bevelSize:te-2,ne=void 0!==h.bevelOffset?h.bevelOffset:0,ie=void 0!==h.bevelSegments?h.bevelSegments:3,ae=h.extrudePath,oe=void 0!==h.UVGenerator?h.UVGenerator:lh;void 0!==h.amount&&(V=h.amount);var se,ce,ue,le,he,fe,de,pe,me=!1;ae&&(se=ae.getSpacedPoints(N),me=!0,ee=!1,ce=ae.computeFrenetFrames(N,!1),ue=new Vector3,le=new Vector3,he=new Vector3),ee||(ie=0,te=0,re=0,ne=0);var ge=t.extractPoints(I),ve=ge.shape,ye=ge.holes;if(!uh.isClockWise(ve))for(ve=ve.reverse(),de=0,pe=ye.length;de<pe;de++)fe=ye[de],uh.isClockWise(fe)&&(ye[de]=fe.reverse());var be=uh.triangulateShape(ve,ye),xe=ve;for(de=0,pe=ye.length;de<pe;de++)fe=ye[de],ve=ve.concat(fe);function scalePt2(t,h,p){return h.clone().multiplyScalar(p).add(t)}var Me,we,_e,Ce,Se,Te,Ae=ve.length,De=be.length;function getBevelVec(t,h,p){var x,M,k,I=t.x-h.x,N=t.y-h.y,V=p.x-t.x,ee=p.y-t.y,te=I*I+N*N,re=I*ee-N*V;if(Math.abs(re)>Number.EPSILON){var ne=Math.sqrt(te),ie=Math.sqrt(V*V+ee*ee),ae=h.x-N/ne,oe=h.y+I/ne,se=((p.x-ee/ie-ae)*ee-(p.y+V/ie-oe)*V)/(I*ee-N*V),ce=(x=ae+I*se-t.x)*x+(M=oe+N*se-t.y)*M;if(ce<=2)return new Vector2(x,M);k=Math.sqrt(ce/2)}else{var ue=!1;I>Number.EPSILON?V>Number.EPSILON&&(ue=!0):I<-Number.EPSILON?V<-Number.EPSILON&&(ue=!0):Math.sign(N)===Math.sign(ee)&&(ue=!0),ue?(x=-N,M=I,k=Math.sqrt(te)):(x=I,M=N,k=Math.sqrt(te/2))}return new Vector2(x/k,M/k)}for(var ke=[],Le=0,Ee=xe.length,Ie=Ee-1,Be=Le+1;Le<Ee;Le++,Ie++,Be++)Ie===Ee&&(Ie=0),Be===Ee&&(Be=0),ke[Le]=getBevelVec(xe[Le],xe[Ie],xe[Be]);var Oe,Re,Fe=[],Ne=ke.concat();for(de=0,pe=ye.length;de<pe;de++){for(fe=ye[de],Oe=[],Le=0,Ie=(Ee=fe.length)-1,Be=Le+1;Le<Ee;Le++,Ie++,Be++)Ie===Ee&&(Ie=0),Be===Ee&&(Be=0),Oe[Le]=getBevelVec(fe[Le],fe[Ie],fe[Be]);Fe.push(Oe),Ne=Ne.concat(Oe)}for(Me=0;Me<ie;Me++){for(_e=Me/ie,Ce=te*Math.cos(_e*Math.PI/2),we=re*Math.sin(_e*Math.PI/2)+ne,Le=0,Ee=xe.length;Le<Ee;Le++)v((Se=scalePt2(xe[Le],ke[Le],we)).x,Se.y,-Ce);for(de=0,pe=ye.length;de<pe;de++)for(fe=ye[de],Oe=Fe[de],Le=0,Ee=fe.length;Le<Ee;Le++)v((Se=scalePt2(fe[Le],Oe[Le],we)).x,Se.y,-Ce)}for(we=re+ne,Le=0;Le<Ae;Le++)Se=ee?scalePt2(ve[Le],Ne[Le],we):ve[Le],me?(le.copy(ce.normals[0]).multiplyScalar(Se.x),ue.copy(ce.binormals[0]).multiplyScalar(Se.y),he.copy(se[0]).add(le).add(ue),v(he.x,he.y,he.z)):v(Se.x,Se.y,0);for(Re=1;Re<=N;Re++)for(Le=0;Le<Ae;Le++)Se=ee?scalePt2(ve[Le],Ne[Le],we):ve[Le],me?(le.copy(ce.normals[Re]).multiplyScalar(Se.x),ue.copy(ce.binormals[Re]).multiplyScalar(Se.y),he.copy(se[Re]).add(le).add(ue),v(he.x,he.y,he.z)):v(Se.x,Se.y,V/N*Re);for(Me=ie-1;Me>=0;Me--){for(_e=Me/ie,Ce=te*Math.cos(_e*Math.PI/2),we=re*Math.sin(_e*Math.PI/2)+ne,Le=0,Ee=xe.length;Le<Ee;Le++)v((Se=scalePt2(xe[Le],ke[Le],we)).x,Se.y,V+Ce);for(de=0,pe=ye.length;de<pe;de++)for(fe=ye[de],Oe=Fe[de],Le=0,Ee=fe.length;Le<Ee;Le++)Se=scalePt2(fe[Le],Oe[Le],we),me?v(Se.x,Se.y+se[N-1].y,se[N-1].x+Ce):v(Se.x,Se.y,V+Ce)}function sidewalls(t,h){var p,x;for(Le=t.length;--Le>=0;){p=Le,(x=Le-1)<0&&(x=t.length-1);var M=0,k=N+2*ie;for(M=0;M<k;M++){var I=Ae*M,V=Ae*(M+1);f4(h+p+I,h+x+I,h+x+V,h+p+V)}}}function v(t,h,p){k.push(t),k.push(h),k.push(p)}function f3(t,h,M){addVertex(t),addVertex(h),addVertex(M);var k=x.length/3,I=oe.generateTopUV(p,x,k-3,k-2,k-1);addUV(I[0]),addUV(I[1]),addUV(I[2])}function f4(t,h,M,k){addVertex(t),addVertex(h),addVertex(k),addVertex(h),addVertex(M),addVertex(k);var I=x.length/3,N=oe.generateSideWallUV(p,x,I-6,I-3,I-2,I-1);addUV(N[0]),addUV(N[1]),addUV(N[3]),addUV(N[1]),addUV(N[2]),addUV(N[3])}function addVertex(t){x.push(k[3*t+0]),x.push(k[3*t+1]),x.push(k[3*t+2])}function addUV(t){M.push(t.x),M.push(t.y)}!function buildLidFaces(){var t=x.length/3;if(ee){var h=0,M=Ae*h;for(Le=0;Le<De;Le++)f3((Te=be[Le])[2]+M,Te[1]+M,Te[0]+M);for(M=Ae*(h=N+2*ie),Le=0;Le<De;Le++)f3((Te=be[Le])[0]+M,Te[1]+M,Te[2]+M)}else{for(Le=0;Le<De;Le++)f3((Te=be[Le])[2],Te[1],Te[0]);for(Le=0;Le<De;Le++)f3((Te=be[Le])[0]+Ae*N,Te[1]+Ae*N,Te[2]+Ae*N)}p.addGroup(t,x.length/3-t,0)}(),function buildSideFaces(){var t=x.length/3,h=0;for(sidewalls(xe,h),h+=xe.length,de=0,pe=ye.length;de<pe;de++)sidewalls(fe=ye[de],h),h+=fe.length;p.addGroup(t,x.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(x,3)),this.setAttribute("uv",new Float32BufferAttribute(M,2)),this.computeVertexNormals()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var t=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,t)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,t)};var lh={generateTopUV:function(t,h,p,x,M){var k=h[3*p],I=h[3*p+1],N=h[3*x],V=h[3*x+1],ee=h[3*M],te=h[3*M+1];return[new Vector2(k,I),new Vector2(N,V),new Vector2(ee,te)]},generateSideWallUV:function(t,h,p,x,M,k){var I=h[3*p],N=h[3*p+1],V=h[3*p+2],ee=h[3*x],te=h[3*x+1],re=h[3*x+2],ne=h[3*M],ie=h[3*M+1],ae=h[3*M+2],oe=h[3*k],se=h[3*k+1],ce=h[3*k+2];return Math.abs(N-te)<.01?[new Vector2(I,1-V),new Vector2(ee,1-re),new Vector2(ne,1-ae),new Vector2(oe,1-ce)]:[new Vector2(N,1-V),new Vector2(te,1-re),new Vector2(ie,1-ae),new Vector2(se,1-ce)]}};function toJSON(t,h,p){if(p.shapes=[],Array.isArray(t))for(var x=0,M=t.length;x<M;x++){var k=t[x];p.shapes.push(k.uuid)}else p.shapes.push(t.uuid);return void 0!==h.extrudePath&&(p.options.extrudePath=h.extrudePath.toJSON()),p}function TextGeometry(t,h){Geometry.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:h},this.fromBufferGeometry(new TextBufferGeometry(t,h)),this.mergeVertices()}function TextBufferGeometry(t,h){var p=(h=h||{}).font;if(!p||!p.isFont)return new Geometry;var x=p.generateShapes(t,h.size);h.depth=void 0!==h.height?h.height:50,void 0===h.bevelThickness&&(h.bevelThickness=10),void 0===h.bevelSize&&(h.bevelSize=8),void 0===h.bevelEnabled&&(h.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,x,h),this.type="TextBufferGeometry"}function SphereGeometry(t,h,p,x,M,k,I){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:h,heightSegments:p,phiStart:x,phiLength:M,thetaStart:k,thetaLength:I},this.fromBufferGeometry(new SphereBufferGeometry(t,h,p,x,M,k,I)),this.mergeVertices()}function SphereBufferGeometry(t,h,p,x,M,k,I){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:h,heightSegments:p,phiStart:x,phiLength:M,thetaStart:k,thetaLength:I},t=t||1,h=Math.max(3,Math.floor(h)||8),p=Math.max(2,Math.floor(p)||6),x=void 0!==x?x:0,M=void 0!==M?M:2*Math.PI,k=void 0!==k?k:0,I=void 0!==I?I:Math.PI;var N,V,ee=Math.min(k+I,Math.PI),te=0,re=[],ne=new Vector3,ie=new Vector3,ae=[],oe=[],se=[],ce=[];for(V=0;V<=p;V++){var ue=[],le=V/p,he=0;for(0==V&&0==k?he=.5/h:V==p&&ee==Math.PI&&(he=-.5/h),N=0;N<=h;N++){var fe=N/h;ne.x=-t*Math.cos(x+fe*M)*Math.sin(k+le*I),ne.y=t*Math.cos(k+le*I),ne.z=t*Math.sin(x+fe*M)*Math.sin(k+le*I),oe.push(ne.x,ne.y,ne.z),ie.copy(ne).normalize(),se.push(ie.x,ie.y,ie.z),ce.push(fe+he,1-le),ue.push(te++)}re.push(ue)}for(V=0;V<p;V++)for(N=0;N<h;N++){var de=re[V][N+1],pe=re[V][N],me=re[V+1][N],ge=re[V+1][N+1];(0!==V||k>0)&&ae.push(de,pe,ge),(V!==p-1||ee<Math.PI)&&ae.push(pe,me,ge)}this.setIndex(ae),this.setAttribute("position",new Float32BufferAttribute(oe,3)),this.setAttribute("normal",new Float32BufferAttribute(se,3)),this.setAttribute("uv",new Float32BufferAttribute(ce,2))}function RingGeometry(t,h,p,x,M,k){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:h,thetaSegments:p,phiSegments:x,thetaStart:M,thetaLength:k},this.fromBufferGeometry(new RingBufferGeometry(t,h,p,x,M,k)),this.mergeVertices()}function RingBufferGeometry(t,h,p,x,M,k){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:h,thetaSegments:p,phiSegments:x,thetaStart:M,thetaLength:k},t=t||.5,h=h||1,M=void 0!==M?M:0,k=void 0!==k?k:2*Math.PI,p=void 0!==p?Math.max(3,p):8;var I,N,V,ee=[],te=[],re=[],ne=[],ie=t,ae=(h-t)/(x=void 0!==x?Math.max(1,x):1),oe=new Vector3,se=new Vector2;for(N=0;N<=x;N++){for(V=0;V<=p;V++)I=M+V/p*k,oe.x=ie*Math.cos(I),oe.y=ie*Math.sin(I),te.push(oe.x,oe.y,oe.z),re.push(0,0,1),se.x=(oe.x/h+1)/2,se.y=(oe.y/h+1)/2,ne.push(se.x,se.y);ie+=ae}for(N=0;N<x;N++){var ce=N*(p+1);for(V=0;V<p;V++){var ue=I=V+ce,le=I+p+1,he=I+p+2,fe=I+1;ee.push(ue,le,fe),ee.push(le,he,fe)}}this.setIndex(ee),this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("normal",new Float32BufferAttribute(re,3)),this.setAttribute("uv",new Float32BufferAttribute(ne,2))}function LatheGeometry(t,h,p,x){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:h,phiStart:p,phiLength:x},this.fromBufferGeometry(new LatheBufferGeometry(t,h,p,x)),this.mergeVertices()}function LatheBufferGeometry(t,h,p,x){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:h,phiStart:p,phiLength:x},h=Math.floor(h)||12,p=p||0,x=x||2*Math.PI,x=gc.clamp(x,0,2*Math.PI);var M,k,I,N=[],V=[],ee=[],te=1/h,re=new Vector3,ne=new Vector2;for(k=0;k<=h;k++){var ie=p+k*te*x,ae=Math.sin(ie),oe=Math.cos(ie);for(I=0;I<=t.length-1;I++)re.x=t[I].x*ae,re.y=t[I].y,re.z=t[I].x*oe,V.push(re.x,re.y,re.z),ne.x=k/h,ne.y=I/(t.length-1),ee.push(ne.x,ne.y)}for(k=0;k<h;k++)for(I=0;I<t.length-1;I++){var se=M=I+k*t.length,ce=M+t.length,ue=M+t.length+1,le=M+1;N.push(se,ce,le),N.push(ce,ue,le)}if(this.setIndex(N),this.setAttribute("position",new Float32BufferAttribute(V,3)),this.setAttribute("uv",new Float32BufferAttribute(ee,2)),this.computeVertexNormals(),x===2*Math.PI){var he=this.attributes.normal.array,fe=new Vector3,de=new Vector3,pe=new Vector3;for(M=h*t.length*3,k=0,I=0;k<t.length;k++,I+=3)fe.x=he[I+0],fe.y=he[I+1],fe.z=he[I+2],de.x=he[M+I+0],de.y=he[M+I+1],de.z=he[M+I+2],pe.addVectors(fe,de).normalize(),he[I+0]=he[M+I+0]=pe.x,he[I+1]=he[M+I+1]=pe.y,he[I+2]=he[M+I+2]=pe.z}}function ShapeGeometry(t,h){Geometry.call(this),this.type="ShapeGeometry","object"==typeof h&&(h=h.curveSegments),this.parameters={shapes:t,curveSegments:h},this.fromBufferGeometry(new ShapeBufferGeometry(t,h)),this.mergeVertices()}function ShapeBufferGeometry(t,h){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:h},h=h||12;var p=[],x=[],M=[],k=[],I=0,N=0;if(!1===Array.isArray(t))addShape(t);else for(var V=0;V<t.length;V++)addShape(t[V]),this.addGroup(I,N,V),I+=N,N=0;function addShape(t){var I,V,ee,te=x.length/3,re=t.extractPoints(h),ne=re.shape,ie=re.holes;for(!1===uh.isClockWise(ne)&&(ne=ne.reverse()),I=0,V=ie.length;I<V;I++)ee=ie[I],!0===uh.isClockWise(ee)&&(ie[I]=ee.reverse());var ae=uh.triangulateShape(ne,ie);for(I=0,V=ie.length;I<V;I++)ee=ie[I],ne=ne.concat(ee);for(I=0,V=ne.length;I<V;I++){var oe=ne[I];x.push(oe.x,oe.y,0),M.push(0,0,1),k.push(oe.x,oe.y)}for(I=0,V=ae.length;I<V;I++){var se=ae[I],ce=se[0]+te,ue=se[1]+te,le=se[2]+te;p.push(ce,ue,le),N+=3}}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(x,3)),this.setAttribute("normal",new Float32BufferAttribute(M,3)),this.setAttribute("uv",new Float32BufferAttribute(k,2))}function toJSON$1(t,h){if(h.shapes=[],Array.isArray(t))for(var p=0,x=t.length;p<x;p++){var M=t[p];h.shapes.push(M.uuid)}else h.shapes.push(t.uuid);return h}function EdgesGeometry(t,h){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:h},h=void 0!==h?h:1;var p,x,M,k,I=[],N=Math.cos(gc.DEG2RAD*h),V=[0,0],ee={},te=["a","b","c"];t.isBufferGeometry?(k=new Geometry).fromBufferGeometry(t):k=t.clone(),k.mergeVertices(),k.computeFaceNormals();for(var re=k.vertices,ne=k.faces,ie=0,ae=ne.length;ie<ae;ie++)for(var oe=ne[ie],se=0;se<3;se++)p=oe[te[se]],x=oe[te[(se+1)%3]],V[0]=Math.min(p,x),V[1]=Math.max(p,x),void 0===ee[M=V[0]+","+V[1]]?ee[M]={index1:V[0],index2:V[1],face1:ie,face2:void 0}:ee[M].face2=ie;for(M in ee){var ce=ee[M];if(void 0===ce.face2||ne[ce.face1].normal.dot(ne[ce.face2].normal)<=N){var ue=re[ce.index1];I.push(ue.x,ue.y,ue.z),ue=re[ce.index2],I.push(ue.x,ue.y,ue.z)}}this.setAttribute("position",new Float32BufferAttribute(I,3))}function CylinderGeometry(t,h,p,x,M,k,I,N){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:h,height:p,radialSegments:x,heightSegments:M,openEnded:k,thetaStart:I,thetaLength:N},this.fromBufferGeometry(new CylinderBufferGeometry(t,h,p,x,M,k,I,N)),this.mergeVertices()}function CylinderBufferGeometry(t,h,p,x,M,k,I,N){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:h,height:p,radialSegments:x,heightSegments:M,openEnded:k,thetaStart:I,thetaLength:N};var V=this;t=void 0!==t?t:1,h=void 0!==h?h:1,p=p||1,x=Math.floor(x)||8,M=Math.floor(M)||1,k=void 0!==k&&k,I=void 0!==I?I:0,N=void 0!==N?N:2*Math.PI;var ee=[],te=[],re=[],ne=[],ie=0,ae=[],oe=p/2,se=0;function generateCap(p){var M,k,ae,ce=new Vector2,ue=new Vector3,le=0,he=!0===p?t:h,fe=!0===p?1:-1;for(k=ie,M=1;M<=x;M++)te.push(0,oe*fe,0),re.push(0,fe,0),ne.push(.5,.5),ie++;for(ae=ie,M=0;M<=x;M++){var de=M/x*N+I,pe=Math.cos(de),me=Math.sin(de);ue.x=he*me,ue.y=oe*fe,ue.z=he*pe,te.push(ue.x,ue.y,ue.z),re.push(0,fe,0),ce.x=.5*pe+.5,ce.y=.5*me*fe+.5,ne.push(ce.x,ce.y),ie++}for(M=0;M<x;M++){var ge=k+M,ve=ae+M;!0===p?ee.push(ve,ve+1,ge):ee.push(ve+1,ve,ge),le+=3}V.addGroup(se,le,!0===p?1:2),se+=le}!function generateTorso(){var k,ce,ue=new Vector3,le=new Vector3,he=0,fe=(h-t)/p;for(ce=0;ce<=M;ce++){var de=[],pe=ce/M,me=pe*(h-t)+t;for(k=0;k<=x;k++){var ge=k/x,ve=ge*N+I,ye=Math.sin(ve),be=Math.cos(ve);le.x=me*ye,le.y=-pe*p+oe,le.z=me*be,te.push(le.x,le.y,le.z),ue.set(ye,fe,be).normalize(),re.push(ue.x,ue.y,ue.z),ne.push(ge,1-pe),de.push(ie++)}ae.push(de)}for(k=0;k<x;k++)for(ce=0;ce<M;ce++){var xe=ae[ce][k],Me=ae[ce+1][k],we=ae[ce+1][k+1],_e=ae[ce][k+1];ee.push(xe,Me,_e),ee.push(Me,we,_e),he+=6}V.addGroup(se,he,0),se+=he}(),!1===k&&(t>0&&generateCap(!0),h>0&&generateCap(!1)),this.setIndex(ee),this.setAttribute("position",new Float32BufferAttribute(te,3)),this.setAttribute("normal",new Float32BufferAttribute(re,3)),this.setAttribute("uv",new Float32BufferAttribute(ne,2))}function ConeGeometry(t,h,p,x,M,k,I){CylinderGeometry.call(this,0,t,h,p,x,M,k,I),this.type="ConeGeometry",this.parameters={radius:t,height:h,radialSegments:p,heightSegments:x,openEnded:M,thetaStart:k,thetaLength:I}}function ConeBufferGeometry(t,h,p,x,M,k,I){CylinderBufferGeometry.call(this,0,t,h,p,x,M,k,I),this.type="ConeBufferGeometry",this.parameters={radius:t,height:h,radialSegments:p,heightSegments:x,openEnded:M,thetaStart:k,thetaLength:I}}function CircleGeometry(t,h,p,x){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:h,thetaStart:p,thetaLength:x},this.fromBufferGeometry(new CircleBufferGeometry(t,h,p,x)),this.mergeVertices()}function CircleBufferGeometry(t,h,p,x){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:h,thetaStart:p,thetaLength:x},t=t||1,h=void 0!==h?Math.max(3,h):8,p=void 0!==p?p:0,x=void 0!==x?x:2*Math.PI;var M,k,I=[],N=[],V=[],ee=[],te=new Vector3,re=new Vector2;for(N.push(0,0,0),V.push(0,0,1),ee.push(.5,.5),k=0,M=3;k<=h;k++,M+=3){var ne=p+k/h*x;te.x=t*Math.cos(ne),te.y=t*Math.sin(ne),N.push(te.x,te.y,te.z),V.push(0,0,1),re.x=(N[M]/t+1)/2,re.y=(N[M+1]/t+1)/2,ee.push(re.x,re.y)}for(M=1;M<=h;M++)I.push(M,M+1,0);this.setIndex(I),this.setAttribute("position",new Float32BufferAttribute(N,3)),this.setAttribute("normal",new Float32BufferAttribute(V,3)),this.setAttribute("uv",new Float32BufferAttribute(ee,2))}TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var t=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,t)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,t)},EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var hh=Object.freeze({__proto__:null,WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:class BoxGeometry extends Geometry{constructor(t,h,p,x,M,k){super(),this.type="BoxGeometry",this.parameters={width:t,height:h,depth:p,widthSegments:x,heightSegments:M,depthSegments:k},this.fromBufferGeometry(new BoxBufferGeometry(t,h,p,x,M,k)),this.mergeVertices()}},BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(t){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(t)}function RawShaderMaterial(t){ShaderMaterial.call(this,t),this.type="RawShaderMaterial"}function MeshStandardMaterial(t){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshPhysicalMaterial(t){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}function MeshPhongMaterial(t){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshToonMaterial(t){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshNormalMaterial(t){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshLambertMaterial(t){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Mo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshMatcapMaterial(t){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oc,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LineDashedMaterial(t){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(t){return MeshStandardMaterial.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,t.sheen?this.sheen=(this.sheen||new Color).copy(t.sheen):this.sheen=null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(t){return LineBasicMaterial.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var fh=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),dh={arraySlice:function(t,h,p){return dh.isTypedArray(t)?new t.constructor(t.subarray(h,void 0!==p?p:t.length)):t.slice(h,p)},convertArray:function(t,h,p){return!t||!p&&t.constructor===h?t:"number"==typeof h.BYTES_PER_ELEMENT?new h(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var h=t.length,p=new Array(h),x=0;x!==h;++x)p[x]=x;return p.sort((function compareTime(h,p){return t[h]-t[p]})),p},sortedArray:function(t,h,p){for(var x=t.length,M=new t.constructor(x),k=0,I=0;I!==x;++k)for(var N=p[k]*h,V=0;V!==h;++V)M[I++]=t[N+V];return M},flattenJSON:function(t,h,p,x){for(var M=1,k=t[0];void 0!==k&&void 0===k[x];)k=t[M++];if(void 0!==k){var I=k[x];if(void 0!==I)if(Array.isArray(I))do{void 0!==(I=k[x])&&(h.push(k.time),p.push.apply(p,I)),k=t[M++]}while(void 0!==k);else if(void 0!==I.toArray)do{void 0!==(I=k[x])&&(h.push(k.time),I.toArray(p,p.length)),k=t[M++]}while(void 0!==k);else do{void 0!==(I=k[x])&&(h.push(k.time),p.push(I)),k=t[M++]}while(void 0!==k)}},subclip:function(t,h,p,x,M){M=M||30;var k=t.clone();k.name=h;for(var I=[],N=0;N<k.tracks.length;++N){for(var V=k.tracks[N],ee=V.getValueSize(),te=[],re=[],ne=0;ne<V.times.length;++ne){var ie=V.times[ne]*M;if(!(ie<p||ie>=x)){te.push(V.times[ne]);for(var ae=0;ae<ee;++ae)re.push(V.values[ne*ee+ae])}}0!==te.length&&(V.times=dh.convertArray(te,V.times.constructor),V.values=dh.convertArray(re,V.values.constructor),I.push(V))}k.tracks=I;var oe=1/0;for(N=0;N<k.tracks.length;++N)oe>k.tracks[N].times[0]&&(oe=k.tracks[N].times[0]);for(N=0;N<k.tracks.length;++N)k.tracks[N].shift(-1*oe);return k.resetDuration(),k}};function Interpolant(t,h,p,x){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==x?x:new h.constructor(p),this.sampleValues=h,this.valueSize=p}function CubicInterpolant(t,h,p,x){Interpolant.call(this,t,h,p,x),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(t,h,p,x){Interpolant.call(this,t,h,p,x)}function DiscreteInterpolant(t,h,p,x){Interpolant.call(this,t,h,p,x)}function KeyframeTrack(t,h,p,x){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===h||0===h.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=dh.convertArray(h,this.TimeBufferType),this.values=dh.convertArray(p,this.ValueBufferType),this.setInterpolation(x||this.DefaultInterpolation)}function BooleanKeyframeTrack(t,h,p){KeyframeTrack.call(this,t,h,p)}function ColorKeyframeTrack(t,h,p,x){KeyframeTrack.call(this,t,h,p,x)}function NumberKeyframeTrack(t,h,p,x){KeyframeTrack.call(this,t,h,p,x)}function QuaternionLinearInterpolant(t,h,p,x){Interpolant.call(this,t,h,p,x)}function QuaternionKeyframeTrack(t,h,p,x){KeyframeTrack.call(this,t,h,p,x)}function StringKeyframeTrack(t,h,p,x){KeyframeTrack.call(this,t,h,p,x)}function VectorKeyframeTrack(t,h,p,x){KeyframeTrack.call(this,t,h,p,x)}function AnimationClip(t,h,p){this.name=t,this.tracks=p,this.duration=void 0!==h?h:-1,this.uuid=gc.generateUUID(),this.duration<0&&this.resetDuration()}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var h=function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var p=[],x=[];dh.flattenJSON(t.keys,p,x,"value"),t.times=p,t.values=x}return void 0!==h.parse?h.parse(t):new h(t.name,t.times,t.values,t.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){var h=this.parameterPositions,p=this._cachedIndex,x=h[p],M=h[p-1];e:{t:{var k;r:{n:if(!(t<x)){for(var I=p+2;;){if(void 0===x){if(t<M)break n;return p=h.length,this._cachedIndex=p,this.afterEnd_(p-1,t,M)}if(p===I)break;if(M=x,t<(x=h[++p]))break t}k=h.length;break r}if(t>=M)break e;var N=h[1];t<N&&(p=2,M=N);for(I=p-2;;){if(void 0===M)return this._cachedIndex=0,this.beforeStart_(0,t,x);if(p===I)break;if(x=M,t>=(M=h[--p-1]))break t}k=p,p=0}for(;p<k;){var V=p+k>>>1;t<h[V]?k=V:p=V+1}if(x=h[p],void 0===(M=h[p-1]))return this._cachedIndex=0,this.beforeStart_(0,t,x);if(void 0===x)return p=h.length,this._cachedIndex=p,this.afterEnd_(p-1,M,t)}this._cachedIndex=p,this.intervalChanged_(p,M,x)}return this.interpolate_(p,M,t,x)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var h=this.resultBuffer,p=this.sampleValues,x=this.valueSize,M=t*x,k=0;k!==x;++k)h[k]=p[M+k];return h},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:Xs,endingEnd:Xs},intervalChanged_:function(t,h,p){var x=this.parameterPositions,M=t-2,k=t+1,I=x[M],N=x[k];if(void 0===I)switch(this.getSettings_().endingStart){case qs:M=t,I=2*h-p;break;case Ks:I=h+x[M=x.length-2]-x[M+1];break;default:M=t,I=p}if(void 0===N)switch(this.getSettings_().endingEnd){case qs:k=t,N=2*p-h;break;case Ks:k=1,N=p+x[1]-x[0];break;default:k=t-1,N=h}var V=.5*(p-h),ee=this.valueSize;this._weightPrev=V/(h-I),this._weightNext=V/(N-p),this._offsetPrev=M*ee,this._offsetNext=k*ee},interpolate_:function(t,h,p,x){for(var M=this.resultBuffer,k=this.sampleValues,I=this.valueSize,N=t*I,V=N-I,ee=this._offsetPrev,te=this._offsetNext,re=this._weightPrev,ne=this._weightNext,ie=(p-h)/(x-h),ae=ie*ie,oe=ae*ie,se=-re*oe+2*re*ae-re*ie,ce=(1+re)*oe+(-1.5-2*re)*ae+(-.5+re)*ie+1,ue=(-1-ne)*oe+(1.5+ne)*ae+.5*ie,le=ne*oe-ne*ae,he=0;he!==I;++he)M[he]=se*k[ee+he]+ce*k[V+he]+ue*k[N+he]+le*k[te+he];return M}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(t,h,p,x){for(var M=this.resultBuffer,k=this.sampleValues,I=this.valueSize,N=t*I,V=N-I,ee=(p-h)/(x-h),te=1-ee,re=0;re!==I;++re)M[re]=k[V+re]*te+k[N+re]*ee;return M}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(KeyframeTrack,{toJSON:function(t){var h,p=t.constructor;if(void 0!==p.toJSON)h=p.toJSON(t);else{h={name:t.name,times:dh.convertArray(t.times,Array),values:dh.convertArray(t.values,Array)};var x=t.getInterpolation();x!==t.DefaultInterpolation&&(h.interpolation=x)}return h.type=t.ValueTypeName,h}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Hs,InterpolantFactoryMethodDiscrete:function(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var h;switch(t){case Ws:h=this.InterpolantFactoryMethodDiscrete;break;case Hs:h=this.InterpolantFactoryMethodLinear;break;case $s:h=this.InterpolantFactoryMethodSmooth}if(void 0===h){var p="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(p);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=h,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ws;case this.InterpolantFactoryMethodLinear:return Hs;case this.InterpolantFactoryMethodSmooth:return $s}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var h=this.times,p=0,x=h.length;p!==x;++p)h[p]+=t;return this},scale:function(t){if(1!==t)for(var h=this.times,p=0,x=h.length;p!==x;++p)h[p]*=t;return this},trim:function(t,h){for(var p=this.times,x=p.length,M=0,k=x-1;M!==x&&p[M]<t;)++M;for(;-1!==k&&p[k]>h;)--k;if(++k,0!==M||k!==x){M>=k&&(M=(k=Math.max(k,1))-1);var I=this.getValueSize();this.times=dh.arraySlice(p,M,k),this.values=dh.arraySlice(this.values,M*I,k*I)}return this},validate:function(){var t=!0,h=this.getValueSize();h-Math.floor(h)!=0&&(t=!1);var p=this.times,x=this.values,M=p.length;0===M&&(t=!1);for(var k=null,I=0;I!==M;I++){var N=p[I];if("number"==typeof N&&isNaN(N)){t=!1;break}if(null!==k&&k>N){t=!1;break}k=N}if(void 0!==x&&dh.isTypedArray(x)){I=0;for(var V=x.length;I!==V;++I){var ee=x[I];if(isNaN(ee)){t=!1;break}}}return t},optimize:function(){for(var t=dh.arraySlice(this.times),h=dh.arraySlice(this.values),p=this.getValueSize(),x=this.getInterpolation()===$s,M=1,k=t.length-1,I=1;I<k;++I){var N=!1,V=t[I];if(V!==t[I+1]&&(1!==I||V!==V[0]))if(x)N=!0;else for(var ee=I*p,te=ee-p,re=ee+p,ne=0;ne!==p;++ne){var ie=h[ee+ne];if(ie!==h[te+ne]||ie!==h[re+ne]){N=!0;break}}if(N){if(I!==M){t[M]=t[I];var ae=I*p,oe=M*p;for(ne=0;ne!==p;++ne)h[oe+ne]=h[ae+ne]}++M}}if(k>0){t[M]=t[k];for(ae=k*p,oe=M*p,ne=0;ne!==p;++ne)h[oe+ne]=h[ae+ne];++M}return M!==t.length?(this.times=dh.arraySlice(t,0,M),this.values=dh.arraySlice(h,0,M*p)):(this.times=t,this.values=h),this},clone:function(){var t=dh.arraySlice(this.times,0),h=dh.arraySlice(this.values,0),p=new(0,this.constructor)(this.name,t,h);return p.createInterpolant=this.createInterpolant,p}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ws,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(t,h,p,x){for(var M=this.resultBuffer,k=this.sampleValues,I=this.valueSize,N=t*I,V=(p-h)/(x-h),ee=N+I;N!==ee;N+=4)Quaternion.slerpFlat(M,0,k,N-I,k,N,V);return M}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:Hs,InterpolantFactoryMethodLinear:function(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ws,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(t){for(var h=[],p=t.tracks,x=1/(t.fps||1),M=0,k=p.length;M!==k;++M)h.push(parseKeyframeTrack(p[M]).scale(x));return new AnimationClip(t.name,t.duration,h)},toJSON:function(t){for(var h=[],p=t.tracks,x={name:t.name,duration:t.duration,tracks:h,uuid:t.uuid},M=0,k=p.length;M!==k;++M)h.push(KeyframeTrack.toJSON(p[M]));return x},CreateFromMorphTargetSequence:function(t,h,p,x){for(var M=h.length,k=[],I=0;I<M;I++){var N=[],V=[];N.push((I+M-1)%M,I,(I+1)%M),V.push(0,1,0);var ee=dh.getKeyframeOrder(N);N=dh.sortedArray(N,1,ee),V=dh.sortedArray(V,1,ee),x||0!==N[0]||(N.push(M),V.push(V[0])),k.push(new NumberKeyframeTrack(".morphTargetInfluences["+h[I].name+"]",N,V).scale(1/p))}return new AnimationClip(t,-1,k)},findByName:function(t,h){var p=t;if(!Array.isArray(t)){var x=t;p=x.geometry&&x.geometry.animations||x.animations}for(var M=0;M<p.length;M++)if(p[M].name===h)return p[M];return null},CreateClipsFromMorphTargetSequences:function(t,h,p){for(var x={},M=/^([\w-]*?)([\d]+)$/,k=0,I=t.length;k<I;k++){var N=t[k],V=N.name.match(M);if(V&&V.length>1){var ee=x[re=V[1]];ee||(x[re]=ee=[]),ee.push(N)}}var te=[];for(var re in x)te.push(AnimationClip.CreateFromMorphTargetSequence(re,x[re],h,p));return te},parseAnimation:function(t,h){if(!t)return null;for(var addNonemptyTrack=function(t,h,p,x,M){if(0!==p.length){var k=[],I=[];dh.flattenJSON(p,k,I,x),0!==k.length&&M.push(new t(h,k,I))}},p=[],x=t.name||"default",M=t.length||-1,k=t.fps||30,I=t.hierarchy||[],N=0;N<I.length;N++){var V=I[N].keys;if(V&&0!==V.length)if(V[0].morphTargets){for(var ee={},te=0;te<V.length;te++)if(V[te].morphTargets)for(var re=0;re<V[te].morphTargets.length;re++)ee[V[te].morphTargets[re]]=-1;for(var ne in ee){var ie=[],ae=[];for(re=0;re!==V[te].morphTargets.length;++re){var oe=V[te];ie.push(oe.time),ae.push(oe.morphTarget===ne?1:0)}p.push(new NumberKeyframeTrack(".morphTargetInfluence["+ne+"]",ie,ae))}M=ee.length*(k||1)}else{var se=".bones["+h[N].name+"]";addNonemptyTrack(VectorKeyframeTrack,se+".position",V,"pos",p),addNonemptyTrack(QuaternionKeyframeTrack,se+".quaternion",V,"rot",p),addNonemptyTrack(VectorKeyframeTrack,se+".scale",V,"scl",p)}}return 0===p.length?null:new AnimationClip(x,M,p)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var t=0,h=0,p=this.tracks.length;h!==p;++h){var x=this.tracks[h];t=Math.max(t,x.times[x.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,h=0;h<this.tracks.length;h++)t=t&&this.tracks[h].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],h=0;h<this.tracks.length;h++)t.push(this.tracks[h].clone());return new AnimationClip(this.name,this.duration,t)}});var ph={enabled:!1,files:{},add:function(t,h){!1!==this.enabled&&(this.files[t]=h)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function LoadingManager(t,h,p){var x=this,M=!1,k=0,I=0,N=void 0,V=[];this.onStart=void 0,this.onLoad=t,this.onProgress=h,this.onError=p,this.itemStart=function(t){I++,!1===M&&void 0!==x.onStart&&x.onStart(t,k,I),M=!0},this.itemEnd=function(t){k++,void 0!==x.onProgress&&x.onProgress(t,k,I),k===I&&(M=!1,void 0!==x.onLoad&&x.onLoad())},this.itemError=function(t){void 0!==x.onError&&x.onError(t)},this.resolveURL=function(t){return N?N(t):t},this.setURLModifier=function(t){return N=t,this},this.addHandler=function(t,h){return V.push(t,h),this},this.removeHandler=function(t){var h=V.indexOf(t);return-1!==h&&V.splice(h,2),this},this.getHandler=function(t){for(var h=0,p=V.length;h<p;h+=2){var x=V[h],M=V[h+1];if(x.global&&(x.lastIndex=0),x.test(t))return M}return null}}var mh=new LoadingManager;function Loader(t){this.manager=void 0!==t?t:mh,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Loader.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var gh={};function FileLoader(t){Loader.call(this,t)}function AnimationLoader(t){Loader.call(this,t)}function CompressedTextureLoader(t){Loader.call(this,t)}function DataTextureLoader(t){Loader.call(this,t)}function ImageLoader(t){Loader.call(this,t)}function CubeTextureLoader(t){Loader.call(this,t)}function TextureLoader(t){Loader.call(this,t)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(t,h,p,x,M,k,I,N){Curve.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=h||0,this.xRadius=p||1,this.yRadius=x||1,this.aStartAngle=M||0,this.aEndAngle=k||2*Math.PI,this.aClockwise=I||!1,this.aRotation=N||0}function ArcCurve(t,h,p,x,M,k){EllipseCurve.call(this,t,h,p,p,x,M,k),this.type="ArcCurve"}function CubicPoly(){var t=0,h=0,p=0,x=0;function init(M,k,I,N){t=M,h=I,p=-3*M+3*k-2*I-N,x=2*M-2*k+I+N}return{initCatmullRom:function(t,h,p,x,M){init(h,p,M*(p-t),M*(x-h))},initNonuniformCatmullRom:function(t,h,p,x,M,k,I){var N=(h-t)/M-(p-t)/(M+k)+(p-h)/k,V=(p-h)/k-(x-h)/(k+I)+(x-p)/I;init(h,p,N*=k,V*=k)},calc:function(M){var k=M*M;return t+h*M+p*k+x*(k*M)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(t,h,p,x){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var M=this,k=ph.get(t);if(void 0!==k)return M.manager.itemStart(t),setTimeout((function(){h&&h(k),M.manager.itemEnd(t)}),0),k;if(void 0===gh[t]){var I=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(I){var N=I[1],V=!!I[2],ee=I[3];ee=decodeURIComponent(ee),V&&(ee=atob(ee));try{var te,re=(this.responseType||"").toLowerCase();switch(re){case"arraybuffer":case"blob":for(var ne=new Uint8Array(ee.length),ie=0;ie<ee.length;ie++)ne[ie]=ee.charCodeAt(ie);te="blob"===re?new Blob([ne.buffer],{type:N}):ne.buffer;break;case"document":var ae=new DOMParser;te=ae.parseFromString(ee,N);break;case"json":te=JSON.parse(ee);break;default:te=ee}setTimeout((function(){h&&h(te),M.manager.itemEnd(t)}),0)}catch(ce){setTimeout((function(){x&&x(ce),M.manager.itemError(t),M.manager.itemEnd(t)}),0)}}else{gh[t]=[],gh[t].push({onLoad:h,onProgress:p,onError:x});var oe=new XMLHttpRequest;for(var se in oe.open("GET",t,!0),oe.addEventListener("load",(function(h){var p=this.response,x=gh[t];if(delete gh[t],200===this.status||0===this.status){this.status,ph.add(t,p);for(var k=0,I=x.length;k<I;k++){(N=x[k]).onLoad&&N.onLoad(p)}M.manager.itemEnd(t)}else{for(k=0,I=x.length;k<I;k++){var N;(N=x[k]).onError&&N.onError(h)}M.manager.itemError(t),M.manager.itemEnd(t)}}),!1),oe.addEventListener("progress",(function(h){for(var p=gh[t],x=0,M=p.length;x<M;x++){var k=p[x];k.onProgress&&k.onProgress(h)}}),!1),oe.addEventListener("error",(function(h){var p=gh[t];delete gh[t];for(var x=0,k=p.length;x<k;x++){var I=p[x];I.onError&&I.onError(h)}M.manager.itemError(t),M.manager.itemEnd(t)}),!1),oe.addEventListener("abort",(function(h){var p=gh[t];delete gh[t];for(var x=0,k=p.length;x<k;x++){var I=p[x];I.onError&&I.onError(h)}M.manager.itemError(t),M.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(oe.responseType=this.responseType),void 0!==this.withCredentials&&(oe.withCredentials=this.withCredentials),oe.overrideMimeType&&oe.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)oe.setRequestHeader(se,this.requestHeader[se]);oe.send(null)}return M.manager.itemStart(t),oe}gh[t].push({onLoad:h,onProgress:p,onError:x})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,h,p,x){var M=this,k=new FileLoader(M.manager);k.setPath(M.path),k.load(t,(function(t){h(M.parse(JSON.parse(t)))}),p,x)},parse:function(t){for(var h=[],p=0;p<t.length;p++){var x=AnimationClip.parse(t[p]);h.push(x)}return h}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(t,h,p,x){var M=this,k=[],I=new CompressedTexture;I.image=k;var N=new FileLoader(this.manager);function loadTexture(ee){N.load(t[ee],(function(t){var p=M.parse(t,!0);k[ee]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},6===(V+=1)&&(1===p.mipmapCount&&(I.minFilter=Ho),I.format=p.format,I.needsUpdate=!0,h&&h(I))}),p,x)}if(N.setPath(this.path),N.setResponseType("arraybuffer"),Array.isArray(t))for(var V=0,ee=0,te=t.length;ee<te;++ee)loadTexture(ee);else N.load(t,(function(t){var p=M.parse(t,!0);if(p.isCubemap)for(var x=p.mipmaps.length/p.mipmapCount,N=0;N<x;N++){k[N]={mipmaps:[]};for(var V=0;V<p.mipmapCount;V++)k[N].mipmaps.push(p.mipmaps[N*p.mipmapCount+V]),k[N].format=p.format,k[N].width=p.width,k[N].height=p.height}else I.image.width=p.width,I.image.height=p.height,I.mipmaps=p.mipmaps;1===p.mipmapCount&&(I.minFilter=Ho),I.format=p.format,I.needsUpdate=!0,h&&h(I)}),p,x);return I}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(t,h,p,x){var M=this,k=new DataTexture,I=new FileLoader(this.manager);return I.setResponseType("arraybuffer"),I.setPath(this.path),I.load(t,(function(t){var p=M.parse(t);p&&(void 0!==p.image?k.image=p.image:void 0!==p.data&&(k.image.width=p.width,k.image.height=p.height,k.image.data=p.data),k.wrapS=void 0!==p.wrapS?p.wrapS:Go,k.wrapT=void 0!==p.wrapT?p.wrapT:Go,k.magFilter=void 0!==p.magFilter?p.magFilter:Ho,k.minFilter=void 0!==p.minFilter?p.minFilter:Ho,k.anisotropy=void 0!==p.anisotropy?p.anisotropy:1,void 0!==p.colorSpace&&(k.colorSpace=p.colorSpace),void 0!==p.flipY&&(k.flipY=p.flipY),void 0!==p.format&&(k.format=p.format),void 0!==p.type&&(k.type=p.type),void 0!==p.mipmaps&&(k.mipmaps=p.mipmaps,k.minFilter=Xo),1===p.mipmapCount&&(k.minFilter=Ho),k.needsUpdate=!0,h&&h(k,p))}),p,x),k}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,h,p,x){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var M=this,k=ph.get(t);if(void 0!==k)return M.manager.itemStart(t),setTimeout((function(){h&&h(k),M.manager.itemEnd(t)}),0),k;var I=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){I.removeEventListener("load",onImageLoad,!1),I.removeEventListener("error",onImageError,!1),ph.add(t,this),h&&h(this),M.manager.itemEnd(t)}function onImageError(h){I.removeEventListener("load",onImageLoad,!1),I.removeEventListener("error",onImageError,!1),x&&x(h),M.manager.itemError(t),M.manager.itemEnd(t)}return I.addEventListener("load",onImageLoad,!1),I.addEventListener("error",onImageError,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(I.crossOrigin=this.crossOrigin),M.manager.itemStart(t),I.src=t,I}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(t,h,p,x){var M=new CubeTexture,k=new ImageLoader(this.manager);k.setCrossOrigin(this.crossOrigin),k.setPath(this.path);var I=0;function loadTexture(p){k.load(t[p],(function(t){M.images[p]=t,6===++I&&(M.needsUpdate=!0,h&&h(M))}),void 0,x)}for(var N=0;N<t.length;++N)loadTexture(N);return M}}),TextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader,load:function(t,h,p,x){var M=new Texture,k=new ImageLoader(this.manager);return k.setCrossOrigin(this.crossOrigin),k.setPath(this.path),k.load(t,(function(p){M.image=p;var x=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);M.format=x?cs:us,M.needsUpdate=!0,void 0!==h&&h(M)}),p,x),M}}),Object.assign(Curve.prototype,{getPoint:function(){return null},getPointAt:function(t,h){var p=this.getUtoTmapping(t);return this.getPoint(p,h)},getPoints:function(t){void 0===t&&(t=5);for(var h=[],p=0;p<=t;p++)h.push(this.getPoint(p/t));return h},getSpacedPoints:function(t){void 0===t&&(t=5);for(var h=[],p=0;p<=t;p++)h.push(this.getPointAt(p/t));return h},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var h,p,x=[],M=this.getPoint(0),k=0;for(x.push(0),p=1;p<=t;p++)k+=(h=this.getPoint(p/t)).distanceTo(M),x.push(k),M=h;return this.cacheArcLengths=x,x},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,h){var p,x=this.getLengths(),M=0,k=x.length;p=h||t*x[k-1];for(var I,N=0,V=k-1;N<=V;)if((I=x[M=Math.floor(N+(V-N)/2)]-p)<0)N=M+1;else{if(!(I>0)){V=M;break}V=M-1}if(x[M=V]===p)return M/(k-1);var ee=x[M];return(M+(p-ee)/(x[M+1]-ee))/(k-1)},getTangent:function(t){var h=1e-4,p=t-h,x=t+h;p<0&&(p=0),x>1&&(x=1);var M=this.getPoint(p);return this.getPoint(x).clone().sub(M).normalize()},getTangentAt:function(t){var h=this.getUtoTmapping(t);return this.getTangent(h)},computeFrenetFrames:function(t,h){var p,x,M,k=new Vector3,I=[],N=[],V=[],ee=new Vector3,te=new Matrix4;for(p=0;p<=t;p++)x=p/t,I[p]=this.getTangentAt(x),I[p].normalize();N[0]=new Vector3,V[0]=new Vector3;var re=Number.MAX_VALUE,ne=Math.abs(I[0].x),ie=Math.abs(I[0].y),ae=Math.abs(I[0].z);for(ne<=re&&(re=ne,k.set(1,0,0)),ie<=re&&(re=ie,k.set(0,1,0)),ae<=re&&k.set(0,0,1),ee.crossVectors(I[0],k).normalize(),N[0].crossVectors(I[0],ee),V[0].crossVectors(I[0],N[0]),p=1;p<=t;p++)N[p]=N[p-1].clone(),V[p]=V[p-1].clone(),ee.crossVectors(I[p-1],I[p]),ee.length()>Number.EPSILON&&(ee.normalize(),M=Math.acos(gc.clamp(I[p-1].dot(I[p]),-1,1)),N[p].applyMatrix4(te.makeRotationAxis(ee,M))),V[p].crossVectors(I[p],N[p]);if(!0===h)for(M=Math.acos(gc.clamp(N[0].dot(N[t]),-1,1)),M/=t,I[0].dot(ee.crossVectors(N[0],N[t]))>0&&(M=-M),p=1;p<=t;p++)N[p].applyMatrix4(te.makeRotationAxis(I[p],M*p)),V[p].crossVectors(I[p],N[p]);return{tangents:I,normals:N,binormals:V}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,h){for(var p=h||new Vector2,x=2*Math.PI,M=this.aEndAngle-this.aStartAngle,k=Math.abs(M)<Number.EPSILON;M<0;)M+=x;for(;M>x;)M-=x;M<Number.EPSILON&&(M=k?0:x),!0!==this.aClockwise||k||(M===x?M=-x:M-=x);var I=this.aStartAngle+t*M,N=this.aX+this.xRadius*Math.cos(I),V=this.aY+this.yRadius*Math.sin(I);if(0!==this.aRotation){var ee=Math.cos(this.aRotation),te=Math.sin(this.aRotation),re=N-this.aX,ne=V-this.aY;N=re*ee-ne*te+this.aX,V=re*te+ne*ee+this.aY}return p.set(N,V)},EllipseCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},EllipseCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},EllipseCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var vh=new Vector3,yh=new CubicPoly,bh=new CubicPoly,xh=new CubicPoly;function CatmullRomCurve3(t,h,p,x){Curve.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=h||!1,this.curveType=p||"centripetal",this.tension=x||.5}function CatmullRom(t,h,p,x,M){var k=.5*(x-h),I=.5*(M-p),N=t*t;return(2*p-2*x+k+I)*(t*N)+(-3*p+3*x-2*k-I)*N+k*t+p}function QuadraticBezier(t,h,p,x){return function QuadraticBezierP0(t,h){var p=1-t;return p*p*h}(t,h)+function QuadraticBezierP1(t,h){return 2*(1-t)*t*h}(t,p)+function QuadraticBezierP2(t,h){return t*t*h}(t,x)}function CubicBezier(t,h,p,x,M){return function CubicBezierP0(t,h){var p=1-t;return p*p*p*h}(t,h)+function CubicBezierP1(t,h){var p=1-t;return 3*p*p*t*h}(t,p)+function CubicBezierP2(t,h){return 3*(1-t)*t*t*h}(t,x)+function CubicBezierP3(t,h){return t*t*t*h}(t,M)}function CubicBezierCurve(t,h,p,x){Curve.call(this),this.type="CubicBezierCurve",this.v0=t||new Vector2,this.v1=h||new Vector2,this.v2=p||new Vector2,this.v3=x||new Vector2}function CubicBezierCurve3(t,h,p,x){Curve.call(this),this.type="CubicBezierCurve3",this.v0=t||new Vector3,this.v1=h||new Vector3,this.v2=p||new Vector3,this.v3=x||new Vector3}function LineCurve(t,h){Curve.call(this),this.type="LineCurve",this.v1=t||new Vector2,this.v2=h||new Vector2}function LineCurve3(t,h){Curve.call(this),this.type="LineCurve3",this.v1=t||new Vector3,this.v2=h||new Vector3}function QuadraticBezierCurve(t,h,p){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Vector2,this.v1=h||new Vector2,this.v2=p||new Vector2}function QuadraticBezierCurve3(t,h,p){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Vector3,this.v1=h||new Vector3,this.v2=p||new Vector3}function SplineCurve(t){Curve.call(this),this.type="SplineCurve",this.points=t||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,h){var p,x,M,k,I=h||new Vector3,N=this.points,V=N.length,ee=(V-(this.closed?0:1))*t,te=Math.floor(ee),re=ee-te;if(this.closed?te+=te>0?0:(Math.floor(Math.abs(te)/V)+1)*V:0===re&&te===V-1&&(te=V-2,re=1),this.closed||te>0?p=N[(te-1)%V]:(vh.subVectors(N[0],N[1]).add(N[0]),p=vh),x=N[te%V],M=N[(te+1)%V],this.closed||te+2<V?k=N[(te+2)%V]:(vh.subVectors(N[V-1],N[V-2]).add(N[V-1]),k=vh),"centripetal"===this.curveType||"chordal"===this.curveType){var ne="chordal"===this.curveType?.5:.25,ie=Math.pow(p.distanceToSquared(x),ne),ae=Math.pow(x.distanceToSquared(M),ne),oe=Math.pow(M.distanceToSquared(k),ne);ae<1e-4&&(ae=1),ie<1e-4&&(ie=ae),oe<1e-4&&(oe=ae),yh.initNonuniformCatmullRom(p.x,x.x,M.x,k.x,ie,ae,oe),bh.initNonuniformCatmullRom(p.y,x.y,M.y,k.y,ie,ae,oe),xh.initNonuniformCatmullRom(p.z,x.z,M.z,k.z,ie,ae,oe)}else"catmullrom"===this.curveType&&(yh.initCatmullRom(p.x,x.x,M.x,k.x,this.tension),bh.initCatmullRom(p.y,x.y,M.y,k.y,this.tension),xh.initCatmullRom(p.z,x.z,M.z,k.z,this.tension));return I.set(yh.calc(re),bh.calc(re),xh.calc(re)),I},CatmullRomCurve3.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(var h=0,p=t.points.length;h<p;h++){var x=t.points[h];this.points.push(x.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);t.points=[];for(var h=0,p=this.points.length;h<p;h++){var x=this.points[h];t.points.push(x.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},CatmullRomCurve3.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(var h=0,p=t.points.length;h<p;h++){var x=t.points[h];this.points.push((new Vector3).fromArray(x))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,h){var p=h||new Vector2,x=this.v0,M=this.v1,k=this.v2,I=this.v3;return p.set(CubicBezier(t,x.x,M.x,k.x,I.x),CubicBezier(t,x.y,M.y,k.y,I.y)),p},CubicBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,h){var p=h||new Vector3,x=this.v0,M=this.v1,k=this.v2,I=this.v3;return p.set(CubicBezier(t,x.x,M.x,k.x,I.x),CubicBezier(t,x.y,M.y,k.y,I.y),CubicBezier(t,x.z,M.z,k.z,I.z)),p},CubicBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,h){var p=h||new Vector2;return 1===t?p.copy(this.v2):(p.copy(this.v2).sub(this.v1),p.multiplyScalar(t).add(this.v1)),p},LineCurve.prototype.getPointAt=function(t,h){return this.getPoint(t,h)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,h){var p=h||new Vector3;return 1===t?p.copy(this.v2):(p.copy(this.v2).sub(this.v1),p.multiplyScalar(t).add(this.v1)),p},LineCurve3.prototype.getPointAt=function(t,h){return this.getPoint(t,h)},LineCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,h){var p=h||new Vector2,x=this.v0,M=this.v1,k=this.v2;return p.set(QuadraticBezier(t,x.x,M.x,k.x),QuadraticBezier(t,x.y,M.y,k.y)),p},QuadraticBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,h){var p=h||new Vector3,x=this.v0,M=this.v1,k=this.v2;return p.set(QuadraticBezier(t,x.x,M.x,k.x),QuadraticBezier(t,x.y,M.y,k.y),QuadraticBezier(t,x.z,M.z,k.z)),p},QuadraticBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,h){var p=h||new Vector2,x=this.points,M=(x.length-1)*t,k=Math.floor(M),I=M-k,N=x[0===k?k:k-1],V=x[k],ee=x[k>x.length-2?x.length-1:k+1],te=x[k>x.length-3?x.length-1:k+2];return p.set(CatmullRom(I,N.x,V.x,ee.x,te.x),CatmullRom(I,N.y,V.y,ee.y,te.y)),p},SplineCurve.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(var h=0,p=t.points.length;h<p;h++){var x=t.points[h];this.points.push(x.clone())}return this},SplineCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);t.points=[];for(var h=0,p=this.points.length;h<p;h++){var x=this.points[h];t.points.push(x.toArray())}return t},SplineCurve.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(var h=0,p=t.points.length;h<p;h++){var x=t.points[h];this.points.push((new Vector2).fromArray(x))}return this};var Mh=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(t){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,t&&this.setFromPoints(t)}function Shape(t){Path.call(this,t),this.uuid=gc.generateUUID(),this.type="Shape",this.holes=[]}function Light(t,h){Object3D.call(this),this.type="Light",this.color=new Color(t),this.intensity=void 0!==h?h:1,this.receiveShadow=void 0}function HemisphereLight(t,h,p){Light.call(this,t,p),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(h)}function LightShadow(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(t,h,p,x,M,k){Light.call(this,t,h),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==p?p:0,this.angle=void 0!==x?x:Math.PI/3,this.penumbra=void 0!==M?M:0,this.decay=void 0!==k?k:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function PointLight(t,h,p,x){Light.call(this,t,h),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==p?p:0,this.decay=void 0!==x?x:1,this.shadow=new PointLightShadow}function OrthographicCamera(t,h,p,x,M,k){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==h?h:1,this.top=void 0!==p?p:1,this.bottom=void 0!==x?x:-1,this.near=void 0!==M?M:.1,this.far=void 0!==k?k:2e3,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(t,h){Light.call(this,t,h),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(t,h){Light.call(this,t,h),this.type="AmbientLight",this.castShadow=void 0}function RectAreaLight(t,h,p,x){Light.call(this,t,h),this.type="RectAreaLight",this.width=void 0!==p?p:10,this.height=void 0!==x?x:10}function MaterialLoader(t){Loader.call(this,t),this.textures={}}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),h=this.curves[this.curves.length-1].getPoint(1);t.equals(h)||this.curves.push(new LineCurve(h,t))},getPoint:function(t){for(var h=t*this.getLength(),p=this.getCurveLengths(),x=0;x<p.length;){if(p[x]>=h){var M=p[x]-h,k=this.curves[x],I=k.getLength(),N=0===I?0:1-M/I;return k.getPointAt(N)}x++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],h=0,p=0,x=this.curves.length;p<x;p++)h+=this.curves[p].getLength(),t.push(h);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var h=[],p=0;p<=t;p++)h.push(this.getPoint(p/t));return this.autoClose&&h.push(h[0]),h},getPoints:function(t){t=t||12;for(var h,p=[],x=0,M=this.curves;x<M.length;x++)for(var k=M[x],I=k&&k.isEllipseCurve?2*t:k&&(k.isLineCurve||k.isLineCurve3)?1:k&&k.isSplineCurve?t*k.points.length:t,N=k.getPoints(I),V=0;V<N.length;V++){var ee=N[V];h&&h.equals(ee)||(p.push(ee),h=ee)}return this.autoClose&&p.length>1&&!p[p.length-1].equals(p[0])&&p.push(p[0]),p},copy:function(t){Curve.prototype.copy.call(this,t),this.curves=[];for(var h=0,p=t.curves.length;h<p;h++){var x=t.curves[h];this.curves.push(x.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Curve.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var h=0,p=this.curves.length;h<p;h++){var x=this.curves[h];t.curves.push(x.toJSON())}return t},fromJSON:function(t){Curve.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var h=0,p=t.curves.length;h<p;h++){var x=t.curves[h];this.curves.push((new Mh[x.type]).fromJSON(x))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var h=1,p=t.length;h<p;h++)this.lineTo(t[h].x,t[h].y);return this},moveTo:function(t,h){return this.currentPoint.set(t,h),this},lineTo:function(t,h){var p=new LineCurve(this.currentPoint.clone(),new Vector2(t,h));return this.curves.push(p),this.currentPoint.set(t,h),this},quadraticCurveTo:function(t,h,p,x){var M=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(t,h),new Vector2(p,x));return this.curves.push(M),this.currentPoint.set(p,x),this},bezierCurveTo:function(t,h,p,x,M,k){var I=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(t,h),new Vector2(p,x),new Vector2(M,k));return this.curves.push(I),this.currentPoint.set(M,k),this},splineThru:function(t){var h=new SplineCurve([this.currentPoint.clone()].concat(t));return this.curves.push(h),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,h,p,x,M,k){var I=this.currentPoint.x,N=this.currentPoint.y;return this.absarc(t+I,h+N,p,x,M,k),this},absarc:function(t,h,p,x,M,k){return this.absellipse(t,h,p,p,x,M,k),this},ellipse:function(t,h,p,x,M,k,I,N){var V=this.currentPoint.x,ee=this.currentPoint.y;return this.absellipse(t+V,h+ee,p,x,M,k,I,N),this},absellipse:function(t,h,p,x,M,k,I,N){var V=new EllipseCurve(t,h,p,x,M,k,I,N);if(this.curves.length>0){var ee=V.getPoint(0);ee.equals(this.currentPoint)||this.lineTo(ee.x,ee.y)}this.curves.push(V);var te=V.getPoint(1);return this.currentPoint.copy(te),this},copy:function(t){return CurvePath.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=CurvePath.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return CurvePath.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(t){for(var h=[],p=0,x=this.holes.length;p<x;p++)h[p]=this.holes[p].getPoints(t);return h},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Path.prototype.copy.call(this,t),this.holes=[];for(var h=0,p=t.holes.length;h<p;h++){var x=t.holes[h];this.holes.push(x.clone())}return this},toJSON:function(){var t=Path.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var h=0,p=this.holes.length;h<p;h++){var x=this.holes[h];t.holes.push(x.toJSON())}return t},fromJSON:function(t){Path.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var h=0,p=t.holes.length;h<p;h++){var x=t.holes[h];this.holes.push((new Path).fromJSON(x))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var h=Object3D.prototype.toJSON.call(this,t);return h.object.color=this.color.getHex(),h.object.intensity=this.intensity,void 0!==this.groundColor&&(h.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(h.object.distance=this.distance),void 0!==this.angle&&(h.object.angle=this.angle),void 0!==this.decay&&(h.object.decay=this.decay),void 0!==this.penumbra&&(h.object.penumbra=this.penumbra),void 0!==this.shadow&&(h.object.shadow=this.shadow.toJSON()),h}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var h=this.camera,p=this.matrix,x=this._projScreenMatrix,M=this._lookTarget,k=this._lightPositionWorld;k.setFromMatrixPosition(t.matrixWorld),h.position.copy(k),M.setFromMatrixPosition(t.target.matrixWorld),h.lookAt(M),h.updateMatrixWorld(),x.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(x),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(h.projectionMatrix),p.multiply(h.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(t){var h=this.camera,p=2*gc.RAD2DEG*t.angle,x=this.mapSize.width/this.mapSize.height,M=t.distance||h.far;p===h.fov&&x===h.aspect&&M===h.far||(h.fov=p,h.aspect=x,h.far=M,h.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,t)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(t,h){void 0===h&&(h=0);var p=this.camera,x=this.matrix,M=this._lightPositionWorld,k=this._lookTarget,I=this._projScreenMatrix;M.setFromMatrixPosition(t.matrixWorld),p.position.copy(M),k.copy(p.position),k.add(this._cubeDirections[h]),p.up.copy(this._cubeUps[h]),p.lookAt(k),p.updateMatrixWorld(),x.makeTranslation(-M.x,-M.y,-M.z),I.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),this._frustum.setFromProjectionMatrix(I)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(t,h){return Camera.prototype.copy.call(this,t,h),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,h,p,x,M,k){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=h,this.view.offsetX=p,this.view.offsetY=x,this.view.width=M,this.view.height=k,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),h=(this.top-this.bottom)/(2*this.zoom),p=(this.right+this.left)/2,x=(this.top+this.bottom)/2,M=p-t,k=p+t,I=x+h,N=x-h;if(null!==this.view&&this.view.enabled){var V=(this.right-this.left)/this.view.fullWidth/this.zoom,ee=(this.top-this.bottom)/this.view.fullHeight/this.zoom;k=(M+=V*this.view.offsetX)+V*this.view.width,N=(I-=ee*this.view.offsetY)-ee*this.view.height}this.projectionMatrix.makeOrthographic(M,k,I,N,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var h=Object3D.prototype.toJSON.call(this,t);return h.object.zoom=this.zoom,h.object.left=this.left,h.object.right=this.right,h.object.top=this.top,h.object.bottom=this.bottom,h.object.near=this.near,h.object.far=this.far,null!==this.view&&(h.object.view=Object.assign({},this.view)),h}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(t){LightShadow.prototype.updateMatrices.call(this,t)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var h=Light.prototype.toJSON.call(this,t);return h.object.width=this.width,h.object.height=this.height,h}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,h,p,x){var M=this,k=new FileLoader(M.manager);k.setPath(M.path),k.load(t,(function(t){h(M.parse(JSON.parse(t)))}),p,x)},parse:function(t){var h=this.textures;function getTexture(t){return h[t],h[t]}var p=new fh[t.type];if(void 0!==t.uuid&&(p.uuid=t.uuid),void 0!==t.name&&(p.name=t.name),void 0!==t.color&&p.color.setHex(t.color),void 0!==t.roughness&&(p.roughness=t.roughness),void 0!==t.metalness&&(p.metalness=t.metalness),void 0!==t.sheen&&(p.sheen=(new Color).setHex(t.sheen)),void 0!==t.emissive&&p.emissive.setHex(t.emissive),void 0!==t.specular&&p.specular.setHex(t.specular),void 0!==t.shininess&&(p.shininess=t.shininess),void 0!==t.clearcoat&&(p.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(p.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.vertexColors&&(p.vertexColors=t.vertexColors),void 0!==t.fog&&(p.fog=t.fog),void 0!==t.flatShading&&(p.flatShading=t.flatShading),void 0!==t.blending&&(p.blending=t.blending),void 0!==t.combine&&(p.combine=t.combine),void 0!==t.side&&(p.side=t.side),void 0!==t.opacity&&(p.opacity=t.opacity),void 0!==t.transparent&&(p.transparent=t.transparent),void 0!==t.alphaTest&&(p.alphaTest=t.alphaTest),void 0!==t.depthTest&&(p.depthTest=t.depthTest),void 0!==t.depthWrite&&(p.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(p.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(p.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(p.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(p.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(p.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(p.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(p.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(p.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(p.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(p.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(p.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(p.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(p.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(p.rotation=t.rotation),1!==t.linewidth&&(p.linewidth=t.linewidth),void 0!==t.dashSize&&(p.dashSize=t.dashSize),void 0!==t.gapSize&&(p.gapSize=t.gapSize),void 0!==t.scale&&(p.scale=t.scale),void 0!==t.polygonOffset&&(p.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(p.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(p.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(p.skinning=t.skinning),void 0!==t.morphTargets&&(p.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(p.morphNormals=t.morphNormals),void 0!==t.dithering&&(p.dithering=t.dithering),void 0!==t.visible&&(p.visible=t.visible),void 0!==t.toneMapped&&(p.toneMapped=t.toneMapped),void 0!==t.userData&&(p.userData=t.userData),void 0!==t.uniforms)for(var x in t.uniforms){var M=t.uniforms[x];switch(p.uniforms[x]={},M.type){case"t":p.uniforms[x].value=getTexture(M.value);break;case"c":p.uniforms[x].value=(new Color).setHex(M.value);break;case"v2":p.uniforms[x].value=(new Vector2).fromArray(M.value);break;case"v3":p.uniforms[x].value=(new Vector3).fromArray(M.value);break;case"v4":p.uniforms[x].value=(new Vector4).fromArray(M.value);break;case"m3":p.uniforms[x].value=(new Matrix3).fromArray(M.value);case"m4":p.uniforms[x].value=(new Matrix4).fromArray(M.value);break;default:p.uniforms[x].value=M.value}}if(void 0!==t.defines&&(p.defines=t.defines),void 0!==t.vertexShader&&(p.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(p.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var k in t.extensions)p.extensions[k]=t.extensions[k];if(void 0!==t.shading&&(p.flatShading=1===t.shading),void 0!==t.size&&(p.size=t.size),void 0!==t.sizeAttenuation&&(p.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(p.map=getTexture(t.map)),void 0!==t.matcap&&(p.matcap=getTexture(t.matcap)),void 0!==t.alphaMap&&(p.alphaMap=getTexture(t.alphaMap),p.transparent=!0),void 0!==t.bumpMap&&(p.bumpMap=getTexture(t.bumpMap)),void 0!==t.bumpScale&&(p.bumpScale=t.bumpScale),void 0!==t.normalMap&&(p.normalMap=getTexture(t.normalMap)),void 0!==t.normalMapType&&(p.normalMapType=t.normalMapType),void 0!==t.normalScale){var I=t.normalScale;!1===Array.isArray(I)&&(I=[I,I]),p.normalScale=(new Vector2).fromArray(I)}return void 0!==t.displacementMap&&(p.displacementMap=getTexture(t.displacementMap)),void 0!==t.displacementScale&&(p.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(p.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(p.roughnessMap=getTexture(t.roughnessMap)),void 0!==t.metalnessMap&&(p.metalnessMap=getTexture(t.metalnessMap)),void 0!==t.emissiveMap&&(p.emissiveMap=getTexture(t.emissiveMap)),void 0!==t.emissiveIntensity&&(p.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(p.specularMap=getTexture(t.specularMap)),void 0!==t.envMap&&(p.envMap=getTexture(t.envMap)),void 0!==t.envMapIntensity&&(p.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(p.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(p.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(p.lightMap=getTexture(t.lightMap)),void 0!==t.lightMapIntensity&&(p.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(p.aoMap=getTexture(t.aoMap)),void 0!==t.aoMapIntensity&&(p.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(p.gradientMap=getTexture(t.gradientMap)),void 0!==t.clearcoatNormalMap&&(p.clearcoatNormalMap=getTexture(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(p.clearcoatNormalScale=(new Vector2).fromArray(t.clearcoatNormalScale)),p},setTextures:function(t){return this.textures=t,this}});var LoaderUtils_extractUrlBase=function(t){var h=t.lastIndexOf("/");return-1===h?"./":t.substr(0,h+1)};function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InstancedBufferAttribute(t,h,p,x){"number"==typeof p&&(x=p,p=!1),BufferAttribute.call(this,t,h,p),this.meshPerAttribute=x||1}function BufferGeometryLoader(t){Loader.call(this,t)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(t){return BufferGeometry.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=BufferGeometry.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(t){return BufferAttribute.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=BufferAttribute.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,h,p,x){var M=this,k=new FileLoader(M.manager);k.setPath(M.path),k.load(t,(function(t){h(M.parse(JSON.parse(t)))}),p,x)},parse:function(t){var h=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,p=t.data.index;if(void 0!==p){var x=new wh[p.type](p.array);h.setIndex(new BufferAttribute(x,1))}var M=t.data.attributes;for(var k in M){var I=M[k],N=(x=new wh[I.type](I.array),new(I.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(x,I.itemSize,I.normalized));void 0!==I.name&&(N.name=I.name),h.setAttribute(k,N)}var V=t.data.morphAttributes;if(V)for(var k in V){for(var ee=V[k],te=[],re=0,ne=ee.length;re<ne;re++){I=ee[re],N=new BufferAttribute(x=new wh[I.type](I.array),I.itemSize,I.normalized);void 0!==I.name&&(N.name=I.name),te.push(N)}h.morphAttributes[k]=te}t.data.morphTargetsRelative&&(h.morphTargetsRelative=!0);var ie=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==ie){re=0;for(var ae=ie.length;re!==ae;++re){var oe=ie[re];h.addGroup(oe.start,oe.count,oe.materialIndex)}}var se=t.data.boundingSphere;if(void 0!==se){var ce=new Vector3;void 0!==se.center&&ce.fromArray(se.center),h.boundingSphere=new Sphere(ce,se.radius)}return t.name&&(h.name=t.name),t.userData&&(h.userData=t.userData),h}});var wh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ObjectLoader(t){Loader.call(this,t)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(t,h,p,x){var M=this,k=""===this.path?LoaderUtils_extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||k;var I=new FileLoader(M.manager);I.setPath(this.path),I.load(t,(function(t){var p=null;try{p=JSON.parse(t)}catch(I){return void(void 0!==x&&x(I))}var k=p.metadata;void 0!==k&&void 0!==k.type&&"geometry"!==k.type.toLowerCase()&&M.parse(p,h)}),p,x)},parse:function(t,h){var p=this.parseShape(t.shapes),x=this.parseGeometries(t.geometries,p),M=this.parseImages(t.images,(function(){void 0!==h&&h(N)})),k=this.parseTextures(t.textures,M),I=this.parseMaterials(t.materials,k),N=this.parseObject(t.object,x,I);return t.animations&&(N.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==h&&h(N),N},parseShape:function(t){var h={};if(void 0!==t)for(var p=0,x=t.length;p<x;p++){var M=(new Shape).fromJSON(t[p]);h[M.uuid]=M}return h},parseGeometries:function(t,h){var p={};if(void 0!==t)for(var x=new BufferGeometryLoader,M=0,k=t.length;M<k;M++){var I,N=t[M];switch(N.type){case"PlaneGeometry":case"PlaneBufferGeometry":I=new hh[N.type](N.width,N.height,N.widthSegments,N.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":I=new hh[N.type](N.width,N.height,N.depth,N.widthSegments,N.heightSegments,N.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":I=new hh[N.type](N.radius,N.segments,N.thetaStart,N.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":I=new hh[N.type](N.radiusTop,N.radiusBottom,N.height,N.radialSegments,N.heightSegments,N.openEnded,N.thetaStart,N.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":I=new hh[N.type](N.radius,N.height,N.radialSegments,N.heightSegments,N.openEnded,N.thetaStart,N.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":I=new hh[N.type](N.radius,N.widthSegments,N.heightSegments,N.phiStart,N.phiLength,N.thetaStart,N.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":I=new hh[N.type](N.radius,N.detail);break;case"RingGeometry":case"RingBufferGeometry":I=new hh[N.type](N.innerRadius,N.outerRadius,N.thetaSegments,N.phiSegments,N.thetaStart,N.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":I=new hh[N.type](N.radius,N.tube,N.radialSegments,N.tubularSegments,N.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":I=new hh[N.type](N.radius,N.tube,N.tubularSegments,N.radialSegments,N.p,N.q);break;case"TubeGeometry":case"TubeBufferGeometry":I=new hh[N.type]((new Mh[N.path.type]).fromJSON(N.path),N.tubularSegments,N.radius,N.radialSegments,N.closed);break;case"LatheGeometry":case"LatheBufferGeometry":I=new hh[N.type](N.points,N.segments,N.phiStart,N.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":I=new hh[N.type](N.vertices,N.indices,N.radius,N.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var V=[],ee=0,te=N.shapes.length;ee<te;ee++){var re=h[N.shapes[ee]];V.push(re)}I=new hh[N.type](V,N.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(V=[],ee=0,te=N.shapes.length;ee<te;ee++){re=h[N.shapes[ee]];V.push(re)}var ne=N.options.extrudePath;void 0!==ne&&(N.options.extrudePath=(new Mh[ne.type]).fromJSON(ne)),I=new hh[N.type](V,N.options);break;case"BufferGeometry":case"InstancedBufferGeometry":I=x.parse(N);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)I=(new THREE.LegacyJSONLoader).parse(N,this.resourcePath).geometry;break;default:continue}I.uuid=N.uuid,void 0!==N.name&&(I.name=N.name),!0===I.isBufferGeometry&&void 0!==N.userData&&(I.userData=N.userData),p[N.uuid]=I}return p},parseMaterials:function(t,h){var p={},x={};if(void 0!==t){var M=new MaterialLoader;M.setTextures(h);for(var k=0,I=t.length;k<I;k++){var N=t[k];if("MultiMaterial"===N.type){for(var V=[],ee=0;ee<N.materials.length;ee++){var te=N.materials[ee];void 0===p[te.uuid]&&(p[te.uuid]=M.parse(te)),V.push(p[te.uuid])}x[N.uuid]=V}else void 0===p[N.uuid]&&(p[N.uuid]=M.parse(N)),x[N.uuid]=p[N.uuid]}}return x},parseAnimations:function(t){for(var h=[],p=0;p<t.length;p++){var x=t[p],M=AnimationClip.parse(x);void 0!==x.uuid&&(M.uuid=x.uuid),h.push(M)}return h},parseImages:function(t,h){var p=this,x={};function loadImage(t){return p.manager.itemStart(t),M.load(t,(function(){p.manager.itemEnd(t)}),void 0,(function(){p.manager.itemError(t),p.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){var M=new ImageLoader(new LoadingManager(h));M.setCrossOrigin(this.crossOrigin);for(var k=0,I=t.length;k<I;k++){var N=t[k],V=N.url;if(Array.isArray(V)){x[N.uuid]=[];for(var ee=0,te=V.length;ee<te;ee++){var re=V[ee],ne=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(re)?re:p.resourcePath+re;x[N.uuid].push(loadImage(ne))}}else{ne=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(N.url)?N.url:p.resourcePath+N.url;x[N.uuid]=loadImage(ne)}}}return x},parseTextures:function(t,h){function parseConstant(t,h){return"number"==typeof t?t:h[t]}var p={};if(void 0!==t)for(var x=0,M=t.length;x<M;x++){var k,I=t[x];I.image,h[I.image],(k=Array.isArray(h[I.image])?new CubeTexture(h[I.image]):new Texture(h[I.image])).needsUpdate=!0,k.uuid=I.uuid,void 0!==I.name&&(k.name=I.name),void 0!==I.mapping&&(k.mapping=parseConstant(I.mapping,Ch)),void 0!==I.offset&&k.offset.fromArray(I.offset),void 0!==I.repeat&&k.repeat.fromArray(I.repeat),void 0!==I.center&&k.center.fromArray(I.center),void 0!==I.rotation&&(k.rotation=I.rotation),void 0!==I.wrap&&(k.wrapS=parseConstant(I.wrap[0],Sh),k.wrapT=parseConstant(I.wrap[1],Sh)),void 0!==I.format&&(k.format=I.format),void 0!==I.type&&(k.type=I.type),void 0!==I.encoding&&(k.encoding=I.encoding),void 0!==I.minFilter&&(k.minFilter=parseConstant(I.minFilter,Th)),void 0!==I.magFilter&&(k.magFilter=parseConstant(I.magFilter,Th)),void 0!==I.anisotropy&&(k.anisotropy=I.anisotropy),void 0!==I.flipY&&(k.flipY=I.flipY),void 0!==I.premultiplyAlpha&&(k.premultiplyAlpha=I.premultiplyAlpha),void 0!==I.unpackAlignment&&(k.unpackAlignment=I.unpackAlignment),p[I.uuid]=k}return p},parseObject:function(t,h,p){var x;function getGeometry(t){return h[t],h[t]}function getMaterial(t){if(void 0!==t){if(Array.isArray(t)){for(var h=[],x=0,M=t.length;x<M;x++){var k=t[x];p[k],h.push(p[k])}return h}return p[t],p[t]}}switch(t.type){case"Scene":x=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(x.background=new Color(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?x.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(x.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":x=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(x.focus=t.focus),void 0!==t.zoom&&(x.zoom=t.zoom),void 0!==t.filmGauge&&(x.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(x.filmOffset=t.filmOffset),void 0!==t.view&&(x.view=Object.assign({},t.view));break;case"OrthographicCamera":x=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(x.zoom=t.zoom),void 0!==t.view&&(x.view=Object.assign({},t.view));break;case"AmbientLight":x=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":x=new DirectionalLight(t.color,t.intensity);break;case"PointLight":x=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":x=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":x=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":x=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":case"Mesh":var M=getGeometry(t.geometry),k=getMaterial(t.material);x=M.bones&&M.bones.length>0?new SkinnedMesh(M,k):new Mesh(M,k);break;case"InstancedMesh":M=getGeometry(t.geometry),k=getMaterial(t.material);var I=t.count,N=t.instanceMatrix;(x=new InstancedMesh(M,k,I)).instanceMatrix=new BufferAttribute(new Float32Array(N.array),16);break;case"LOD":x=new LOD;break;case"Line":x=new Line(getGeometry(t.geometry),getMaterial(t.material),t.mode);break;case"LineLoop":x=new LineLoop(getGeometry(t.geometry),getMaterial(t.material));break;case"LineSegments":x=new LineSegments(getGeometry(t.geometry),getMaterial(t.material));break;case"PointCloud":case"Points":x=new Points(getGeometry(t.geometry),getMaterial(t.material));break;case"Sprite":x=new Sprite(getMaterial(t.material));break;case"Group":x=new Group;break;default:x=new Object3D}if(x.uuid=t.uuid,void 0!==t.name&&(x.name=t.name),void 0!==t.matrix?(x.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(x.matrixAutoUpdate=t.matrixAutoUpdate),x.matrixAutoUpdate&&x.matrix.decompose(x.position,x.quaternion,x.scale)):(void 0!==t.position&&x.position.fromArray(t.position),void 0!==t.rotation&&x.rotation.fromArray(t.rotation),void 0!==t.quaternion&&x.quaternion.fromArray(t.quaternion),void 0!==t.scale&&x.scale.fromArray(t.scale)),void 0!==t.castShadow&&(x.castShadow=t.castShadow),void 0!==t.receiveShadow&&(x.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(x.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(x.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&x.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(x.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(x.visible=t.visible),void 0!==t.frustumCulled&&(x.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(x.renderOrder=t.renderOrder),void 0!==t.userData&&(x.userData=t.userData),void 0!==t.layers&&(x.layers.mask=t.layers),void 0!==t.children)for(var V=t.children,ee=0;ee<V.length;ee++)x.add(this.parseObject(V[ee],h,p));if("LOD"===t.type){void 0!==t.autoUpdate&&(x.autoUpdate=t.autoUpdate);for(var te=t.levels,re=0;re<te.length;re++){var ne=te[re],ie=x.getObjectByProperty("uuid",ne.object);void 0!==ie&&x.addLevel(ie,ne.distance)}}return x}});var _h,Ch={UVMapping:300,CubeReflectionMapping:Lo,CubeRefractionMapping:Eo,EquirectangularReflectionMapping:Io,EquirectangularRefractionMapping:Bo,SphericalReflectionMapping:Oo,CubeUVReflectionMapping:Ro,CubeUVRefractionMapping:Fo},Sh={RepeatWrapping:No,ClampToEdgeWrapping:Go,MirroredRepeatWrapping:jo},Th={NearestFilter:Uo,NearestMipmapNearestFilter:zo,NearestMipmapLinearFilter:Wo,LinearFilter:Ho,LinearMipmapNearestFilter:$o,LinearMipmapLinearFilter:Xo};function ImageBitmapLoader(t){Loader.call(this,t),this.options=void 0}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(t){this.type="Font",this.data=t}function createPath(t,h,p,x,M){var k=M.glyphs[t]||M.glyphs["?"];if(k){var I,N,V,ee,te,re,ne,ie,ae=new ShapePath;if(k.o)for(var oe=k._cachedOutline||(k._cachedOutline=k.o.split(" ")),se=0,ce=oe.length;se<ce;){switch(oe[se++]){case"m":I=oe[se++]*h+p,N=oe[se++]*h+x,ae.moveTo(I,N);break;case"l":I=oe[se++]*h+p,N=oe[se++]*h+x,ae.lineTo(I,N);break;case"q":V=oe[se++]*h+p,ee=oe[se++]*h+x,te=oe[se++]*h+p,re=oe[se++]*h+x,ae.quadraticCurveTo(te,re,V,ee);break;case"b":V=oe[se++]*h+p,ee=oe[se++]*h+x,te=oe[se++]*h+p,re=oe[se++]*h+x,ne=oe[se++]*h+p,ie=oe[se++]*h+x,ae.bezierCurveTo(te,re,ne,ie,V,ee)}}return{offsetX:k.ha*h,path:ae}}}function FontLoader(t){Loader.call(this,t)}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,setOptions:function setOptions(t){return this.options=t,this},load:function(t,h,p,x){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var M=this,k=ph.get(t);if(void 0!==k)return M.manager.itemStart(t),setTimeout((function(){h&&h(k),M.manager.itemEnd(t)}),0),k;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===M.options?createImageBitmap(t):createImageBitmap(t,M.options)})).then((function(p){ph.add(t,p),h&&h(p),M.manager.itemEnd(t)})).catch((function(h){x&&x(h),M.manager.itemError(t),M.manager.itemEnd(t)})),M.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(t,h){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,h),this},lineTo:function(t,h){return this.currentPath.lineTo(t,h),this},quadraticCurveTo:function(t,h,p,x){return this.currentPath.quadraticCurveTo(t,h,p,x),this},bezierCurveTo:function(t,h,p,x,M,k){return this.currentPath.bezierCurveTo(t,h,p,x,M,k),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,h){function toShapesNoHoles(t){for(var h=[],p=0,x=t.length;p<x;p++){var M=t[p],k=new Shape;k.curves=M.curves,h.push(k)}return h}function isPointInsidePolygon(t,h){for(var p=h.length,x=!1,M=p-1,k=0;k<p;M=k++){var I=h[M],N=h[k],V=N.x-I.x,ee=N.y-I.y;if(Math.abs(ee)>Number.EPSILON){if(ee<0&&(I=h[k],V=-V,N=h[M],ee=-ee),t.y<I.y||t.y>N.y)continue;if(t.y===I.y){if(t.x===I.x)return!0}else{var te=ee*(t.x-I.x)-V*(t.y-I.y);if(0===te)return!0;if(te<0)continue;x=!x}}else{if(t.y!==I.y)continue;if(N.x<=t.x&&t.x<=I.x||I.x<=t.x&&t.x<=N.x)return!0}}return x}var p=uh.isClockWise,x=this.subPaths;if(0===x.length)return[];if(!0===h)return toShapesNoHoles(x);var M,k,I,N=[];if(1===x.length)return k=x[0],(I=new Shape).curves=k.curves,N.push(I),N;var V=!p(x[0].getPoints());V=t?!V:V;var ee,te,re=[],ne=[],ie=[],ae=0;ne[ae]=void 0,ie[ae]=[];for(var oe=0,se=x.length;oe<se;oe++)M=p(ee=(k=x[oe]).getPoints()),(M=t?!M:M)?(!V&&ne[ae]&&ae++,ne[ae]={s:new Shape,p:ee},ne[ae].s.curves=k.curves,V&&ae++,ie[ae]=[]):ie[ae].push({h:k,p:ee[0]});if(!ne[0])return toShapesNoHoles(x);if(ne.length>1){for(var ce=!1,ue=[],le=0,he=ne.length;le<he;le++)re[le]=[];for(le=0,he=ne.length;le<he;le++)for(var fe=ie[le],de=0;de<fe.length;de++){for(var pe=fe[de],me=!0,ge=0;ge<ne.length;ge++)isPointInsidePolygon(pe.p,ne[ge].p)&&(le!==ge&&ue.push({froms:le,tos:ge,hole:de}),me?(me=!1,re[ge].push(pe)):ce=!0);me&&re[le].push(pe)}ue.length>0&&(ce||(ie=re))}oe=0;for(var ve=ne.length;oe<ve;oe++){I=ne[oe].s,N.push(I);for(var ye=0,be=(te=ie[oe]).length;ye<be;ye++)I.holes.push(te[ye].h)}return N}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(t,h){void 0===h&&(h=100);for(var p=[],x=function createPaths(t,h,p){for(var x=Array.from?Array.from(t):String(t).split(""),M=h/p.resolution,k=(p.boundingBox.yMax-p.boundingBox.yMin+p.underlineThickness)*M,I=[],N=0,V=0,ee=0;ee<x.length;ee++){var te=x[ee];if("\n"===te)N=0,V-=k;else{var re=createPath(te,M,N,V,p);N+=re.offsetX,I.push(re.path)}}return I}(t,h,this.data),M=0,k=x.length;M<k;M++)Array.prototype.push.apply(p,x[M].toShapes());return p}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(t,h,p,x){var M=this,k=new FileLoader(this.manager);k.setPath(this.path),k.load(t,(function(t){var p;try{p=JSON.parse(t)}catch(Vf){p=JSON.parse(t.substring(65,t.length-2))}var x=M.parse(p);h&&h(x)}),p,x)},parse:function(t){return new Font(t)}});var AudioContext$1_getContext=function(){return void 0===_h&&(_h=new(window.AudioContext||window.webkitAudioContext)),_h};function AudioLoader(t){Loader.call(this,t)}function SphericalHarmonics3(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Vector3)}function LightProbe(t,h){Light.call(this,void 0,h),this.sh=void 0!==t?t:new SphericalHarmonics3}function HemisphereLightProbe(t,h,p){LightProbe.call(this,void 0,p);var x=(new Color).set(t),M=(new Color).set(h),k=new Vector3(x.r,x.g,x.b),I=new Vector3(M.r,M.g,M.b),N=Math.sqrt(Math.PI),V=N*Math.sqrt(.75);this.sh.coefficients[0].copy(k).add(I).multiplyScalar(N),this.sh.coefficients[1].copy(k).sub(I).multiplyScalar(V)}function AmbientLightProbe(t,h){LightProbe.call(this,void 0,h);var p=(new Color).set(t);this.sh.coefficients[0].set(p.r,p.g,p.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(t,h,p,x){var M=new FileLoader(this.manager);M.setResponseType("arraybuffer"),M.setPath(this.path),M.load(t,(function(t){var p=t.slice(0);AudioContext$1_getContext().decodeAudioData(p,(function(t){h(t)}))}),p,x)}}),Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var h=0;h<9;h++)this.coefficients[h].copy(t[h]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,h){var p=t.x,x=t.y,M=t.z,k=this.coefficients;return h.copy(k[0]).multiplyScalar(.282095),h.addScale(k[1],.488603*x),h.addScale(k[2],.488603*M),h.addScale(k[3],.488603*p),h.addScale(k[4],p*x*1.092548),h.addScale(k[5],x*M*1.092548),h.addScale(k[6],.315392*(3*M*M-1)),h.addScale(k[7],p*M*1.092548),h.addScale(k[8],.546274*(p*p-x*x)),h},getIrradianceAt:function(t,h){var p=t.x,x=t.y,M=t.z,k=this.coefficients;return h.copy(k[0]).multiplyScalar(.886227),h.addScale(k[1],1.023328*x),h.addScale(k[2],1.023328*M),h.addScale(k[3],1.023328*p),h.addScale(k[4],.858086*p*x),h.addScale(k[5],.858086*x*M),h.addScale(k[6],.743125*M*M-.247708),h.addScale(k[7],.858086*p*M),h.addScale(k[8],.429043*(p*p-x*x)),h},add:function(t){for(var h=0;h<9;h++)this.coefficients[h].add(t.coefficients[h]);return this},scale:function(t){for(var h=0;h<9;h++)this.coefficients[h].multiplyScalar(t);return this},lerp:function(t,h){for(var p=0;p<9;p++)this.coefficients[p].lerp(t.coefficients[p],h);return this},equals:function(t){for(var h=0;h<9;h++)if(!this.coefficients[h].equals(t.coefficients[h]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,h){void 0===h&&(h=0);for(var p=this.coefficients,x=0;x<9;x++)p[x].fromArray(t,h+3*x);return this},toArray:function(t,h){void 0===t&&(t=[]),void 0===h&&(h=0);for(var p=this.coefficients,x=0;x<9;x++)p[x].toArray(t,h+3*x);return t}}),Object.assign(SphericalHarmonics3,{getBasisAt:function(t,h){var p=t.x,x=t.y,M=t.z;h[0]=.282095,h[1]=.488603*x,h[2]=.488603*M,h[3]=.488603*p,h[4]=1.092548*p*x,h[5]=1.092548*x*M,h[6]=.315392*(3*M*M-1),h[7]=1.092548*p*M,h[8]=.546274*(p*p-x*x)}}),LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return Light.prototype.toJSON.call(this,t)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}});var Ah=new Matrix4,Dh=new Matrix4;function Clock(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){var h=this._cache;if(h.focus!==t.focus||h.fov!==t.fov||h.aspect!==t.aspect*this.aspect||h.near!==t.near||h.far!==t.far||h.zoom!==t.zoom||h.eyeSep!==this.eyeSep){h.focus=t.focus,h.fov=t.fov,h.aspect=t.aspect*this.aspect,h.near=t.near,h.far=t.far,h.zoom=t.zoom,h.eyeSep=this.eyeSep;var p,x,M=t.projectionMatrix.clone(),k=h.eyeSep/2,I=k*h.near/h.focus,N=h.near*Math.tan(gc.DEG2RAD*h.fov*.5)/h.zoom;Dh.elements[12]=-k,Ah.elements[12]=k,p=-N*h.aspect+I,x=N*h.aspect+I,M.elements[0]=2*h.near/(x-p),M.elements[8]=(x+p)/(x-p),this.cameraL.projectionMatrix.copy(M),p=-N*h.aspect-I,x=N*h.aspect-I,M.elements[0]=2*h.near/(x-p),M.elements[8]=(x+p)/(x-p),this.cameraR.projectionMatrix.copy(M)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Dh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Ah)}}),Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var h=("undefined"==typeof performance?Date:performance).now();t=(h-this.oldTime)/1e3,this.oldTime=h,this.elapsedTime+=t}return t}});var kh=new Vector3,Ph=new Quaternion,Lh=new Vector3,Eh=new Vector3;function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext$1_getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}function Audio(t){Object3D.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t);var h=this.context.listener,p=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(kh,Ph,Lh),Eh.set(0,0,-1).applyQuaternion(Ph),h.positionX){var x=this.context.currentTime+this.timeDelta;h.positionX.linearRampToValueAtTime(kh.x,x),h.positionY.linearRampToValueAtTime(kh.y,x),h.positionZ.linearRampToValueAtTime(kh.z,x),h.forwardX.linearRampToValueAtTime(Eh.x,x),h.forwardY.linearRampToValueAtTime(Eh.y,x),h.forwardZ.linearRampToValueAtTime(Eh.z,x),h.upX.linearRampToValueAtTime(p.x,x),h.upY.linearRampToValueAtTime(p.y,x),h.upZ.linearRampToValueAtTime(p.z,x)}else h.setPosition(kh.x,kh.y,kh.z),h.setOrientation(Eh.x,Eh.y,Eh.z,p.x,p.y,p.z)}}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0!==this.isPlaying&&!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var h=this.context.createBufferSource();return h.buffer=this.buffer,h.loop=this.loop,h.loopStart=this.loopStart,h.loopEnd=this.loopEnd,h.onended=this.onEnded.bind(this),h.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=h,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,h=this.filters.length;t<h;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,h=this.filters.length;t<h;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1!==this.hasPlaybackControl&&this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Ih=new Vector3,Bh=new Quaternion,Oh=new Vector3,Rh=new Vector3;function PositionalAudio(t){Audio.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function AudioAnalyser(t,h){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==h?h:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function PropertyMixer(t,h,p){this.binding=t,this.valueSize=p;var x,M=Float64Array;switch(h){case"quaternion":x=this._slerp;break;case"string":case"bool":M=Array,x=this._select;break;default:x=this._lerp}this.buffer=new M(4*p),this._mixBufferRegion=x,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,h,p){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=h,this.panner.coneOuterGain=p,this},updateMatrixWorld:function(t){if(Object3D.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Ih,Bh,Oh),Rh.set(0,0,1).applyQuaternion(Bh);var h=this.panner;if(h.positionX){var p=this.context.currentTime+this.listener.timeDelta;h.positionX.linearRampToValueAtTime(Ih.x,p),h.positionY.linearRampToValueAtTime(Ih.y,p),h.positionZ.linearRampToValueAtTime(Ih.z,p),h.orientationX.linearRampToValueAtTime(Rh.x,p),h.orientationY.linearRampToValueAtTime(Rh.y,p),h.orientationZ.linearRampToValueAtTime(Rh.z,p)}else h.setPosition(Ih.x,Ih.y,Ih.z),h.setOrientation(Rh.x,Rh.y,Rh.z)}}}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,h=this.getFrequencyData(),p=0;p<h.length;p++)t+=h[p];return t/h.length}}),Object.assign(PropertyMixer.prototype,{accumulate:function(t,h){var p=this.buffer,x=this.valueSize,M=t*x+x,k=this.cumulativeWeight;if(0===k){for(var I=0;I!==x;++I)p[M+I]=p[I];k=h}else{var N=h/(k+=h);this._mixBufferRegion(p,M,0,N,x)}this.cumulativeWeight=k},apply:function(t){var h=this.valueSize,p=this.buffer,x=t*h+h,M=this.cumulativeWeight,k=this.binding;if(this.cumulativeWeight=0,M<1){var I=3*h;this._mixBufferRegion(p,x,I,1-M,h)}for(var N=h,V=h+h;N!==V;++N)if(p[N]!==p[N+h]){k.setValue(p,x);break}},saveOriginalState:function(){var t=this.binding,h=this.buffer,p=this.valueSize,x=3*p;t.getValue(h,x);for(var M=p,k=x;M!==k;++M)h[M]=h[x+M%p];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,h,p,x,M){if(x>=.5)for(var k=0;k!==M;++k)t[h+k]=t[p+k]},_slerp:function(t,h,p,x){Quaternion.slerpFlat(t,h,t,h,t,p,x)},_lerp:function(t,h,p,x,M){for(var k=1-x,I=0;I!==M;++I){var N=h+I;t[N]=t[N]*k+t[p+I]*x}}});var Fh="\\[\\]\\.:\\/",Nh=new RegExp("["+Fh+"]","g"),Vh="[^"+Fh+"]",Gh="[^"+Fh.replace("\\.","")+"]",jh=/((?:WC+[\/:])*)/.source.replace("WC",Vh),Uh=/(WCOD+)?/.source.replace("WCOD",Gh),zh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Vh),Wh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Vh),Hh=new RegExp("^"+jh+Uh+zh+Wh+"$"),$h=["material","materials","bones"];function Composite(t,h,p){var x=p||PropertyBinding.parseTrackName(h);this._targetGroup=t,this._bindings=t.subscribe_(h,x)}function PropertyBinding(t,h,p){this.path=h,this.parsedPath=p||PropertyBinding.parseTrackName(h),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function AnimationAction(t,h,p){this._mixer=t,this._clip=h,this._localRoot=p||null;for(var x=h.tracks,M=x.length,k=new Array(M),I={endingStart:Xs,endingEnd:Xs},N=0;N!==M;++N){var V=x[N].createInterpolant(null);k[N]=V,V.settings=I}this._interpolantSettings=I,this._interpolants=k,this._propertyBindings=new Array(M),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(t){"string"==typeof t&&(t=arguments[1]),this.value=t}function InstancedInterleavedBuffer(t,h,p){InterleavedBuffer.call(this,t,h),this.meshPerAttribute=p||1}function ascSort(t,h){return t.distance-h.distance}function intersectObject(t,h,p,x){if(!1!==t.visible&&(t.raycast(h,p),!0===x))for(var M=t.children,k=0,I=M.length;k<I;k++)intersectObject(M[k],h,p,!0)}Object.assign(Composite.prototype,{getValue:function(t,h){this.bind();var p=this._targetGroup.nCachedObjects_,x=this._bindings[p];void 0!==x&&x.getValue(t,h)},setValue:function(t,h){for(var p=this._bindings,x=this._targetGroup.nCachedObjects_,M=p.length;x!==M;++x)p[x].setValue(t,h)},bind:function(){for(var t=this._bindings,h=this._targetGroup.nCachedObjects_,p=t.length;h!==p;++h)t[h].bind()},unbind:function(){for(var t=this._bindings,h=this._targetGroup.nCachedObjects_,p=t.length;h!==p;++h)t[h].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(t,h,p){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,h,p):new PropertyBinding(t,h,p)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Nh,"")},parseTrackName:function(t){var h=Hh.exec(t);if(!h)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var p={nodeName:h[2],objectName:h[3],objectIndex:h[4],propertyName:h[5],propertyIndex:h[6]},x=p.nodeName&&p.nodeName.lastIndexOf(".");if(void 0!==x&&-1!==x){var M=p.nodeName.substring(x+1);-1!==$h.indexOf(M)&&(p.nodeName=p.nodeName.substring(0,x),p.objectName=M)}if(null===p.propertyName||0===p.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return p},findNode:function(t,h){if(!h||""===h||"root"===h||"."===h||-1===h||h===t.name||h===t.uuid)return t;if(t.skeleton){var p=t.skeleton.getBoneByName(h);if(void 0!==p)return p}if(t.children){var searchNodeSubtree=function(t){for(var p=0;p<t.length;p++){var x=t[p];if(x.name===h||x.uuid===h)return x;var M=searchNodeSubtree(x.children);if(M)return M}return null},x=searchNodeSubtree(t.children);if(x)return x}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function getValue_direct(t,h){t[h]=this.node[this.propertyName]},function getValue_array(t,h){for(var p=this.resolvedProperty,x=0,M=p.length;x!==M;++x)t[h++]=p[x]},function getValue_arrayElement(t,h){t[h]=this.resolvedProperty[this.propertyIndex]},function getValue_toArray(t,h){this.resolvedProperty.toArray(t,h)}],SetterByBindingTypeAndVersioning:[[function setValue_direct(t,h){this.targetObject[this.propertyName]=t[h]},function setValue_direct_setNeedsUpdate(t,h){this.targetObject[this.propertyName]=t[h],this.targetObject.needsUpdate=!0},function setValue_direct_setMatrixWorldNeedsUpdate(t,h){this.targetObject[this.propertyName]=t[h],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_array(t,h){for(var p=this.resolvedProperty,x=0,M=p.length;x!==M;++x)p[x]=t[h++]},function setValue_array_setNeedsUpdate(t,h){for(var p=this.resolvedProperty,x=0,M=p.length;x!==M;++x)p[x]=t[h++];this.targetObject.needsUpdate=!0},function setValue_array_setMatrixWorldNeedsUpdate(t,h){for(var p=this.resolvedProperty,x=0,M=p.length;x!==M;++x)p[x]=t[h++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_arrayElement(t,h){this.resolvedProperty[this.propertyIndex]=t[h]},function setValue_arrayElement_setNeedsUpdate(t,h){this.resolvedProperty[this.propertyIndex]=t[h],this.targetObject.needsUpdate=!0},function setValue_arrayElement_setMatrixWorldNeedsUpdate(t,h){this.resolvedProperty[this.propertyIndex]=t[h],this.targetObject.matrixWorldNeedsUpdate=!0}],[function setValue_fromArray(t,h){this.resolvedProperty.fromArray(t,h)},function setValue_fromArray_setNeedsUpdate(t,h){this.resolvedProperty.fromArray(t,h),this.targetObject.needsUpdate=!0},function setValue_fromArray_setMatrixWorldNeedsUpdate(t,h){this.resolvedProperty.fromArray(t,h),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function getValue_unbound(t,h){this.bind(),this.getValue(t,h)},setValue:function getValue_unbound(t,h){this.bind(),this.setValue(t,h)},bind:function(){var t=this.node,h=this.parsedPath,p=h.objectName,x=h.propertyName,M=h.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,h.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(p){var k=h.objectIndex;switch(p){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(var I=0;I<t.length;I++)if(t[I].name===k){k=I;break}break;default:if(void 0===t[p])return;t=t[p]}if(void 0!==k){if(void 0===t[k])return;t=t[k]}}var N=t[x];if(void 0!==N){var V=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?V=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(V=this.Versioning.MatrixWorldNeedsUpdate);var ee=this.BindingType.Direct;if(void 0!==M){if("morphTargetInfluences"===x){if(!t.geometry)return;if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return;for(I=0;I<this.node.geometry.morphAttributes.position.length;I++)if(t.geometry.morphAttributes.position[I].name===M){M=I;break}}else{if(!t.geometry.morphTargets)return;for(I=0;I<this.node.geometry.morphTargets.length;I++)if(t.geometry.morphTargets[I].name===M){M=I;break}}}ee=this.BindingType.ArrayElement,this.resolvedProperty=N,this.propertyIndex=M}else void 0!==N.fromArray&&void 0!==N.toArray?(ee=this.BindingType.HasFromToArray,this.resolvedProperty=N):Array.isArray(N)?(ee=this.BindingType.EntireArray,this.resolvedProperty=N):this.propertyName=x;this.getValue=this.GetterByBindingType[ee],this.setValue=this.SetterByBindingTypeAndVersioning[ee][V]}else h.nodeName}},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(function AnimationObjectGroup(){this.uuid=gc.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var h=0,p=arguments.length;h!==p;++h)t[arguments[h].uuid]=h;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var x=this;this.stats={objects:{get total(){return x._objects.length},get inUse(){return this.total-x.nCachedObjects_}},get bindingsPerObject(){return x._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,h=t.length,p=this.nCachedObjects_,x=this._indicesByUUID,M=this._paths,k=this._parsedPaths,I=this._bindings,N=I.length,V=0,ee=arguments.length;V!==ee;++V){var te=arguments[V],re=te.uuid,ne=x[re];if(void 0===ne){ne=h++,x[re]=ne,t.push(te);for(var ie=0,ae=N;ie!==ae;++ie)I[ie].push(new PropertyBinding(te,M[ie],k[ie]))}else if(ne<p){t[ne];var oe=--p,se=t[oe];x[se.uuid]=ne,t[ne]=se,x[re]=oe,t[oe]=te;for(ie=0,ae=N;ie!==ae;++ie){var ce=I[ie],ue=ce[oe],le=ce[ne];ce[ne]=ue,void 0===le&&(le=new PropertyBinding(te,M[ie],k[ie])),ce[oe]=le}}else t[ne]}this.nCachedObjects_=p},remove:function(){for(var t=this._objects,h=this.nCachedObjects_,p=this._indicesByUUID,x=this._bindings,M=x.length,k=0,I=arguments.length;k!==I;++k){var N=arguments[k],V=N.uuid,ee=p[V];if(void 0!==ee&&ee>=h){var te=h++,re=t[te];p[re.uuid]=ee,t[ee]=re,p[V]=te,t[te]=N;for(var ne=0,ie=M;ne!==ie;++ne){var ae=x[ne],oe=ae[te],se=ae[ee];ae[ee]=oe,ae[te]=se}}}this.nCachedObjects_=h},uncache:function(){for(var t=this._objects,h=t.length,p=this.nCachedObjects_,x=this._indicesByUUID,M=this._bindings,k=M.length,I=0,N=arguments.length;I!==N;++I){var V=arguments[I].uuid,ee=x[V];if(void 0!==ee)if(delete x[V],ee<p){var te=--p,re=t[te],ne=t[ce=--h];x[re.uuid]=ee,t[ee]=re,x[ne.uuid]=te,t[te]=ne,t.pop();for(var ie=0,ae=k;ie!==ae;++ie){var oe=(ue=M[ie])[te],se=ue[ce];ue[ee]=oe,ue[te]=se,ue.pop()}}else{var ce;x[(ne=t[ce=--h]).uuid]=ee,t[ee]=ne,t.pop();for(ie=0,ae=k;ie!==ae;++ie){var ue;(ue=M[ie])[ee]=ue[ce],ue.pop()}}}this.nCachedObjects_=p},subscribe_:function(t,h){var p=this._bindingsIndicesByPath,x=p[t],M=this._bindings;if(void 0!==x)return M[x];var k=this._paths,I=this._parsedPaths,N=this._objects,V=N.length,ee=this.nCachedObjects_,te=new Array(V);x=M.length,p[t]=x,k.push(t),I.push(h),M.push(te);for(var re=ee,ne=N.length;re!==ne;++re){var ie=N[re];te[re]=new PropertyBinding(ie,t,h)}return te},unsubscribe_:function(t){var h=this._bindingsIndicesByPath,p=h[t];if(void 0!==p){var x=this._paths,M=this._parsedPaths,k=this._bindings,I=k.length-1,N=k[I];h[t[I]]=p,k[p]=N,k.pop(),M[p]=M[I],M.pop(),x[p]=x[I],x.pop()}}}),Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,h){return this.loop=t,this.repetitions=h,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,h,p){if(t.fadeOut(h),this.fadeIn(h),p){var x=this._clip.duration,M=t._clip.duration,k=M/x,I=x/M;t.warp(1,k,h),this.warp(I,1,h)}return this},crossFadeTo:function(t,h,p){return t.crossFadeFrom(this,h,p)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,h,p){var x=this._mixer,M=x.time,k=this._timeScaleInterpolant,I=this.timeScale;null===k&&(k=x._lendControlInterpolant(),this._timeScaleInterpolant=k);var N=k.parameterPositions,V=k.sampleValues;return N[0]=M,N[1]=M+p,V[0]=t/I,V[1]=h/I,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,h,p,x){if(this.enabled){var M=this._startTime;if(null!==M){var k=(t-M)*p;if(k<0||0===p)return;this._startTime=null,h=p*k}h*=this._updateTimeScale(t);var I=this._updateTime(h),N=this._updateWeight(t);if(N>0)for(var V=this._interpolants,ee=this._propertyBindings,te=0,re=V.length;te!==re;++te)V[te].evaluate(I),ee[te].accumulate(x,N)}else this._updateWeight(t)},_updateWeight:function(t){var h=0;if(this.enabled){h=this.weight;var p=this._weightInterpolant;if(null!==p){var x=p.evaluate(t)[0];h*=x,t>p.parameterPositions[1]&&(this.stopFading(),0===x&&(this.enabled=!1))}}return this._effectiveWeight=h,h},_updateTimeScale:function(t){var h=0;if(!this.paused){h=this.timeScale;var p=this._timeScaleInterpolant;if(null!==p)h*=p.evaluate(t)[0],t>p.parameterPositions[1]&&(this.stopWarping(),0===h?this.paused=!0:this.timeScale=h)}return this._effectiveTimeScale=h,h},_updateTime:function(t){var h=this.time+t,p=this._clip.duration,x=this.loop,M=this._loopCount,k=2202===x;if(0===t)return-1===M?h:k&&1==(1&M)?p-h:h;if(2200===x){-1===M&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=p)h=p;else{if(!(h<0)){this.time=h;break e}h=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===M&&(t>=0?(M=0,this._setEndings(!0,0===this.repetitions,k)):this._setEndings(0===this.repetitions,!0,k)),h>=p||h<0){var I=Math.floor(h/p);h-=p*I,M+=Math.abs(I);var N=this.repetitions-M;if(N<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=t>0?p:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===N){var V=t<0;this._setEndings(V,!V,k)}else this._setEndings(!1,!1,k);this._loopCount=M,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:I})}}else this.time=h;if(k&&1==(1&M))return p-h}return h},_setEndings:function(t,h,p){var x=this._interpolantSettings;p?(x.endingStart=qs,x.endingEnd=qs):(x.endingStart=t?this.zeroSlopeAtStart?qs:Xs:Ks,x.endingEnd=h?this.zeroSlopeAtEnd?qs:Xs:Ks)},_scheduleFading:function(t,h,p){var x=this._mixer,M=x.time,k=this._weightInterpolant;null===k&&(k=x._lendControlInterpolant(),this._weightInterpolant=k);var I=k.parameterPositions,N=k.sampleValues;return I[0]=M,N[0]=h,I[1]=M+t,N[1]=p,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(t,h){var p=t._localRoot||this._root,x=t._clip.tracks,M=x.length,k=t._propertyBindings,I=t._interpolants,N=p.uuid,V=this._bindingsByRootAndName,ee=V[N];void 0===ee&&(ee={},V[N]=ee);for(var te=0;te!==M;++te){var re=x[te],ne=re.name,ie=ee[ne];if(void 0!==ie)k[te]=ie;else{if(void 0!==(ie=k[te])){null===ie._cacheIndex&&(++ie.referenceCount,this._addInactiveBinding(ie,N,ne));continue}var ae=h&&h._propertyBindings[te].binding.parsedPath;++(ie=new PropertyMixer(PropertyBinding.create(p,ne,ae),re.ValueTypeName,re.getValueSize())).referenceCount,this._addInactiveBinding(ie,N,ne),k[te]=ie}I[te].resultBuffer=ie.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var h=(t._localRoot||this._root).uuid,p=t._clip.uuid,x=this._actionsByClip[p];this._bindAction(t,x&&x.knownActions[0]),this._addInactiveAction(t,p,h)}for(var M=t._propertyBindings,k=0,I=M.length;k!==I;++k){var N=M[k];0==N.useCount++&&(this._lendBinding(N),N.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var h=t._propertyBindings,p=0,x=h.length;p!==x;++p){var M=h[p];0==--M.useCount&&(M.restoreOriginalState(),this._takeBackBinding(M))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var h=t._cacheIndex;return null!==h&&h<this._nActiveActions},_addInactiveAction:function(t,h,p){var x=this._actions,M=this._actionsByClip,k=M[h];if(void 0===k)k={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,M[h]=k;else{var I=k.knownActions;t._byClipCacheIndex=I.length,I.push(t)}t._cacheIndex=x.length,x.push(t),k.actionByRoot[p]=t},_removeInactiveAction:function(t){var h=this._actions,p=h[h.length-1],x=t._cacheIndex;p._cacheIndex=x,h[x]=p,h.pop(),t._cacheIndex=null;var M=t._clip.uuid,k=this._actionsByClip,I=k[M],N=I.knownActions,V=N[N.length-1],ee=t._byClipCacheIndex;V._byClipCacheIndex=ee,N[ee]=V,N.pop(),t._byClipCacheIndex=null,delete I.actionByRoot[(t._localRoot||this._root).uuid],0===N.length&&delete k[M],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var h=t._propertyBindings,p=0,x=h.length;p!==x;++p){var M=h[p];0==--M.referenceCount&&this._removeInactiveBinding(M)}},_lendAction:function(t){var h=this._actions,p=t._cacheIndex,x=this._nActiveActions++,M=h[x];t._cacheIndex=x,h[x]=t,M._cacheIndex=p,h[p]=M},_takeBackAction:function(t){var h=this._actions,p=t._cacheIndex,x=--this._nActiveActions,M=h[x];t._cacheIndex=x,h[x]=t,M._cacheIndex=p,h[p]=M},_addInactiveBinding:function(t,h,p){var x=this._bindingsByRootAndName,M=x[h],k=this._bindings;void 0===M&&(M={},x[h]=M),M[p]=t,t._cacheIndex=k.length,k.push(t)},_removeInactiveBinding:function(t){var h=this._bindings,p=t.binding,x=p.rootNode.uuid,M=p.path,k=this._bindingsByRootAndName,I=k[x],N=h[h.length-1],V=t._cacheIndex;N._cacheIndex=V,h[V]=N,h.pop(),delete I[M],0===Object.keys(I).length&&delete k[x]},_lendBinding:function(t){var h=this._bindings,p=t._cacheIndex,x=this._nActiveBindings++,M=h[x];t._cacheIndex=x,h[x]=t,M._cacheIndex=p,h[p]=M},_takeBackBinding:function(t){var h=this._bindings,p=t._cacheIndex,x=--this._nActiveBindings,M=h[x];t._cacheIndex=x,h[x]=t,M._cacheIndex=p,h[p]=M},_lendControlInterpolant:function(){var t=this._controlInterpolants,h=this._nActiveControlInterpolants++,p=t[h];return void 0===p&&((p=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=h,t[h]=p),p},_takeBackControlInterpolant:function(t){var h=this._controlInterpolants,p=t.__cacheIndex,x=--this._nActiveControlInterpolants,M=h[x];t.__cacheIndex=x,h[x]=t,M.__cacheIndex=p,h[p]=M},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,h){var p=h||this._root,x=p.uuid,M="string"==typeof t?AnimationClip.findByName(p,t):t,k=null!==M?M.uuid:t,I=this._actionsByClip[k],N=null;if(void 0!==I){var V=I.actionByRoot[x];if(void 0!==V)return V;N=I.knownActions[0],null===M&&(M=N._clip)}if(null===M)return null;var ee=new AnimationAction(this,M,h);return this._bindAction(ee,N),this._addInactiveAction(ee,k,x),ee},existingAction:function(t,h){var p=h||this._root,x=p.uuid,M="string"==typeof t?AnimationClip.findByName(p,t):t,k=M?M.uuid:t,I=this._actionsByClip[k];return void 0!==I&&I.actionByRoot[x]||null},stopAllAction:function(){var t=this._actions,h=this._nActiveActions,p=this._bindings,x=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var M=0;M!==h;++M)t[M].reset();for(M=0;M!==x;++M)p[M].useCount=0;return this},update:function(t){t*=this.timeScale;for(var h=this._actions,p=this._nActiveActions,x=this.time+=t,M=Math.sign(t),k=this._accuIndex^=1,I=0;I!==p;++I){h[I]._update(x,t,M,k)}var N=this._bindings,V=this._nActiveBindings;for(I=0;I!==V;++I)N[I].apply(k);return this},setTime:function(t){this.time=0;for(var h=0;h<this._actions.length;h++)this._actions[h].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var h=this._actions,p=t.uuid,x=this._actionsByClip,M=x[p];if(void 0!==M){for(var k=M.knownActions,I=0,N=k.length;I!==N;++I){var V=k[I];this._deactivateAction(V);var ee=V._cacheIndex,te=h[h.length-1];V._cacheIndex=null,V._byClipCacheIndex=null,te._cacheIndex=ee,h[ee]=te,h.pop(),this._removeInactiveBindingsForAction(V)}delete x[p]}},uncacheRoot:function(t){var h=t.uuid,p=this._actionsByClip;for(var x in p){var M=p[x].actionByRoot[h];void 0!==M&&(this._deactivateAction(M),this._removeInactiveAction(M))}var k=this._bindingsByRootAndName[h];if(void 0!==k)for(var I in k){var N=k[I];N.restoreOriginalState(),this._removeInactiveBinding(N)}},uncacheAction:function(t,h){var p=this.existingAction(t,h);null!==p&&(this._deactivateAction(p),this._removeInactiveAction(p))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(t){return InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(function Raycaster(t,h,p,x){this.ray=new Ray(t,h),this.near=p||0,this.far=x||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}.prototype,{linePrecision:1,set:function(t,h){this.ray.set(t,h)},setFromCamera:function(t,h){h&&h.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(h.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(h).sub(this.ray.origin).normalize(),this.camera=h):h&&h.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(h.near+h.far)/(h.near-h.far)).unproject(h),this.ray.direction.set(0,0,-1).transformDirection(h.matrixWorld),this.camera=h)},intersectObject:function(t,h,p){var x=p||[];return intersectObject(t,this,x,h),x.sort(ascSort),x},intersectObjects:function(t,h,p){var x=p||[];if(!1===Array.isArray(t))return x;for(var M=0,k=t.length;M<k;M++)intersectObject(t[M],this,x,h);return x.sort(ascSort),x}}),Object.assign(function Spherical(t,h,p){return this.radius=void 0!==t?t:1,this.phi=void 0!==h?h:0,this.theta=void 0!==p?p:0,this}.prototype,{set:function(t,h,p){return this.radius=t,this.phi=h,this.theta=p,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,h,p){return this.radius=Math.sqrt(t*t+h*h+p*p),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,p),this.phi=Math.acos(gc.clamp(h/this.radius,-1,1))),this}}),Object.assign(function Cylindrical(t,h,p){return this.radius=void 0!==t?t:1,this.theta=void 0!==h?h:0,this.y=void 0!==p?p:0,this}.prototype,{set:function(t,h,p){return this.radius=t,this.theta=h,this.y=p,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,h,p){return this.radius=Math.sqrt(t*t+p*p),this.theta=Math.atan2(t,p),this.y=h,this}});var Xh=new Vector2;function Box2(t,h){this.min=void 0!==t?t:new Vector2(1/0,1/0),this.max=void 0!==h?h:new Vector2(-1/0,-1/0)}Object.assign(Box2.prototype,{set:function(t,h){return this.min.copy(t),this.max.copy(h),this},setFromPoints:function(t){this.makeEmpty();for(var h=0,p=t.length;h<p;h++)this.expandByPoint(t[h]);return this},setFromCenterAndSize:function(t,h){var p=Xh.copy(h).multiplyScalar(.5);return this.min.copy(t).sub(p),this.max.copy(t).add(p),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(t=new Vector2),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(t=new Vector2),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,h){return void 0===h&&(h=new Vector2),h.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,h){return void 0===h&&(h=new Vector2),h.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Xh.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Kh=new Vector3,Yh=new Vector3;function Line3(t,h){this.start=void 0!==t?t:new Vector3,this.end=void 0!==h?h:new Vector3}function ImmediateRenderObject(t){Object3D.call(this),this.material=t,this.render=function(){}}Object.assign(Line3.prototype,{set:function(t,h){return this.start.copy(t),this.end.copy(h),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(t=new Vector3),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(t=new Vector3),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,h){return void 0===h&&(h=new Vector3),this.delta(h).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,h){Kh.subVectors(t,this.start),Yh.subVectors(this.end,this.start);var p=Yh.dot(Yh),x=Yh.dot(Kh)/p;return h&&(x=gc.clamp(x,0,1)),x},closestPointToPoint:function(t,h,p){var x=this.closestPointToPointParameter(t,h);return void 0===p&&(p=new Vector3),this.delta(p).multiplyScalar(x).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var Zh=new Vector3;function SpotLightHelper(t,h){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=h;for(var p=new BufferGeometry,x=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],M=0,k=1;M<32;M++,k++){var I=M/32*Math.PI*2,N=k/32*Math.PI*2;x.push(Math.cos(I),Math.sin(I),1,Math.cos(N),Math.sin(N),1)}p.setAttribute("position",new Float32BufferAttribute(x,3));var V=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(p,V),this.add(this.cone),this.update()}SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,h=t*Math.tan(this.light.angle);this.cone.scale.set(h,h,t),Zh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Zh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Jh=new Vector3,Qh=new Matrix4,ef=new Matrix4;function getBoneList(t){var h=[];t&&t.isBone&&h.push(t);for(var p=0;p<t.children.length;p++)h.push.apply(h,getBoneList(t.children[p]));return h}function SkeletonHelper(t){for(var h=getBoneList(t),p=new BufferGeometry,x=[],M=[],k=new Color(0,0,1),I=new Color(0,1,0),N=0;N<h.length;N++){var V=h[N];V.parent&&V.parent.isBone&&(x.push(0,0,0),x.push(0,0,0),M.push(k.r,k.g,k.b),M.push(I.r,I.g,I.b))}p.setAttribute("position",new Float32BufferAttribute(x,3)),p.setAttribute("color",new Float32BufferAttribute(M,3));var ee=new LineBasicMaterial({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,p,ee),this.root=t,this.bones=h,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function PointLightHelper(t,h,p){this.light=t,this.light.updateMatrixWorld(),this.color=p;var x=new SphereBufferGeometry(h,4,2),M=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,x,M),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(t){var h=this.bones,p=this.geometry,x=p.getAttribute("position");ef.getInverse(this.root.matrixWorld);for(var M=0,k=0;M<h.length;M++){var I=h[M];I.parent&&I.parent.isBone&&(Qh.multiplyMatrices(ef,I.matrixWorld),Jh.setFromMatrixPosition(Qh),x.setXYZ(k,Jh.x,Jh.y,Jh.z),Qh.multiplyMatrices(ef,I.parent.matrixWorld),Jh.setFromMatrixPosition(Qh),x.setXYZ(k+1,Jh.x,Jh.y,Jh.z),k+=2)}p.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,t)},PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var tf=new Vector3,rf=new Color,nf=new Color;function HemisphereLightHelper(t,h,p){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=p;var x=new OctahedronBufferGeometry(h);x.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var M=x.getAttribute("position"),k=new Float32Array(3*M.count);x.setAttribute("color",new BufferAttribute(k,3)),this.add(new Mesh(x,this.material)),this.update()}function GridHelper(t,h,p,x){t=t||10,h=h||10,p=new Color(void 0!==p?p:4473924),x=new Color(void 0!==x?x:8947848);for(var M=h/2,k=t/h,I=t/2,N=[],V=[],ee=0,te=0,re=-I;ee<=h;ee++,re+=k){N.push(-I,0,re,I,0,re),N.push(re,0,-I,re,0,I);var ne=ee===M?p:x;ne.toArray(V,te),te+=3,ne.toArray(V,te),te+=3,ne.toArray(V,te),te+=3,ne.toArray(V,te),te+=3}var ie=new BufferGeometry;ie.setAttribute("position",new Float32BufferAttribute(N,3)),ie.setAttribute("color",new Float32BufferAttribute(V,3));var ae=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,ie,ae)}function PolarGridHelper(t,h,p,x,M,k){t=t||10,h=h||16,p=p||8,x=x||64,M=new Color(void 0!==M?M:4473924),k=new Color(void 0!==k?k:8947848);var I,N,V,ee,te,re,ne,ie=[],ae=[];for(ee=0;ee<=h;ee++)V=ee/h*(2*Math.PI),I=Math.sin(V)*t,N=Math.cos(V)*t,ie.push(0,0,0),ie.push(I,0,N),ne=1&ee?M:k,ae.push(ne.r,ne.g,ne.b),ae.push(ne.r,ne.g,ne.b);for(ee=0;ee<=p;ee++)for(ne=1&ee?M:k,re=t-t/p*ee,te=0;te<x;te++)V=te/x*(2*Math.PI),I=Math.sin(V)*re,N=Math.cos(V)*re,ie.push(I,0,N),ae.push(ne.r,ne.g,ne.b),V=(te+1)/x*(2*Math.PI),I=Math.sin(V)*re,N=Math.cos(V)*re,ie.push(I,0,N),ae.push(ne.r,ne.g,ne.b);var oe=new BufferGeometry;oe.setAttribute("position",new Float32BufferAttribute(ie,3)),oe.setAttribute("color",new Float32BufferAttribute(ae,3));var se=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,oe,se)}HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var h=t.geometry.getAttribute("color");rf.copy(this.light.color),nf.copy(this.light.groundColor);for(var p=0,x=h.count;p<x;p++){var M=p<x/2?rf:nf;h.setXYZ(p,M.r,M.g,M.b)}h.needsUpdate=!0}t.lookAt(tf.setFromMatrixPosition(this.light.matrixWorld).negate())},GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(t){return LineSegments.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper;var af=new Vector3,of=new Vector3,sf=new Vector3;function DirectionalLightHelper(t,h,p){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=p,void 0===h&&(h=1);var x=new BufferGeometry;x.setAttribute("position",new Float32BufferAttribute([-h,h,0,h,h,0,h,-h,0,-h,-h,0,-h,h,0],3));var M=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(x,M),this.add(this.lightPlane),(x=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(x,M),this.add(this.targetLine),this.update()}DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){af.setFromMatrixPosition(this.light.matrixWorld),of.setFromMatrixPosition(this.light.target.matrixWorld),sf.subVectors(of,af),this.lightPlane.lookAt(of),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(of),this.targetLine.scale.z=sf.length()};var cf=new Vector3,uf=new Camera;function CameraHelper(t){var h=new BufferGeometry,p=new LineBasicMaterial({color:16777215,vertexColors:1}),x=[],M=[],k={},I=new Color(16755200),N=new Color(16711680),V=new Color(43775),ee=new Color(16777215),te=new Color(3355443);function addLine(t,h,p){addPoint(t,p),addPoint(h,p)}function addPoint(t,h){x.push(0,0,0),M.push(h.r,h.g,h.b),void 0===k[t]&&(k[t]=[]),k[t].push(x.length/3-1)}addLine("n1","n2",I),addLine("n2","n4",I),addLine("n4","n3",I),addLine("n3","n1",I),addLine("f1","f2",I),addLine("f2","f4",I),addLine("f4","f3",I),addLine("f3","f1",I),addLine("n1","f1",I),addLine("n2","f2",I),addLine("n3","f3",I),addLine("n4","f4",I),addLine("p","n1",N),addLine("p","n2",N),addLine("p","n3",N),addLine("p","n4",N),addLine("u1","u2",V),addLine("u2","u3",V),addLine("u3","u1",V),addLine("c","t",ee),addLine("p","c",te),addLine("cn1","cn2",te),addLine("cn3","cn4",te),addLine("cf1","cf2",te),addLine("cf3","cf4",te),h.setAttribute("position",new Float32BufferAttribute(x,3)),h.setAttribute("color",new Float32BufferAttribute(M,3)),LineSegments.call(this,h,p),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=k,this.update()}function setPoint(t,h,p,x,M,k,I){cf.set(M,k,I).unproject(x);var N=h[t];if(void 0!==N)for(var V=p.getAttribute("position"),ee=0,te=N.length;ee<te;ee++)V.setXYZ(N[ee],cf.x,cf.y,cf.z)}CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var t=this.geometry,h=this.pointMap;uf.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",h,t,uf,0,0,-1),setPoint("t",h,t,uf,0,0,1),setPoint("n1",h,t,uf,-1,-1,-1),setPoint("n2",h,t,uf,1,-1,-1),setPoint("n3",h,t,uf,-1,1,-1),setPoint("n4",h,t,uf,1,1,-1),setPoint("f1",h,t,uf,-1,-1,1),setPoint("f2",h,t,uf,1,-1,1),setPoint("f3",h,t,uf,-1,1,1),setPoint("f4",h,t,uf,1,1,1),setPoint("u1",h,t,uf,.7,1.1,-1),setPoint("u2",h,t,uf,-.7,1.1,-1),setPoint("u3",h,t,uf,0,2,-1),setPoint("cf1",h,t,uf,-1,0,1),setPoint("cf2",h,t,uf,1,0,1),setPoint("cf3",h,t,uf,0,-1,1),setPoint("cf4",h,t,uf,0,1,1),setPoint("cn1",h,t,uf,-1,0,-1),setPoint("cn2",h,t,uf,1,0,-1),setPoint("cn3",h,t,uf,0,-1,-1),setPoint("cn4",h,t,uf,0,1,-1),t.getAttribute("position").needsUpdate=!0};var lf=new Box3;function BoxHelper(t,h){this.object=t,void 0===h&&(h=16776960);var p=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=new Float32Array(24),M=new BufferGeometry;M.setIndex(new BufferAttribute(p,1)),M.setAttribute("position",new BufferAttribute(x,3)),LineSegments.call(this,M,new LineBasicMaterial({color:h})),this.matrixAutoUpdate=!1,this.update()}function Box3Helper(t,h){this.type="Box3Helper",this.box=t,h=h||16776960;var p=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),x=new BufferGeometry;x.setIndex(new BufferAttribute(p,1)),x.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,x,new LineBasicMaterial({color:h})),this.geometry.computeBoundingSphere()}function PlaneHelper(t,h,p){this.type="PlaneHelper",this.plane=t,this.size=void 0===h?1:h;var x=void 0!==p?p:16776960,M=new BufferGeometry;M.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),M.computeBoundingSphere(),Line.call(this,M,new LineBasicMaterial({color:x}));var k=new BufferGeometry;k.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),k.computeBoundingSphere(),this.add(new Mesh(k,new MeshBasicMaterial({color:x,opacity:.2,transparent:!0,depthWrite:!1})))}BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(t){if(void 0!==this.object&&lf.setFromObject(this.object),!lf.isEmpty()){var h=lf.min,p=lf.max,x=this.geometry.attributes.position,M=x.array;M[0]=p.x,M[1]=p.y,M[2]=p.z,M[3]=h.x,M[4]=p.y,M[5]=p.z,M[6]=h.x,M[7]=h.y,M[8]=p.z,M[9]=p.x,M[10]=h.y,M[11]=p.z,M[12]=p.x,M[13]=p.y,M[14]=h.z,M[15]=h.x,M[16]=p.y,M[17]=h.z,M[18]=h.x,M[19]=h.y,M[20]=h.z,M[21]=p.x,M[22]=h.y,M[23]=h.z,x.needsUpdate=!0,this.geometry.computeBoundingSphere()}},BoxHelper.prototype.setFromObject=function(t){return this.object=t,this.update(),this},BoxHelper.prototype.copy=function(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this},BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)},Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(t){var h=this.box;h.isEmpty()||(h.getCenter(this.position),h.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,t))},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(t){var h=-this.plane.constant;Math.abs(h)<1e-8&&(h=1e-8),this.scale.set(.5*this.size,.5*this.size,h),this.children[0].material.side=h<0?Va:Na,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,t)};var hf,ff,df=new Vector3;function ArrowHelper(t,h,p,x,M,k){Object3D.call(this),void 0===t&&(t=new Vector3(0,0,1)),void 0===h&&(h=new Vector3(0,0,0)),void 0===p&&(p=1),void 0===x&&(x=16776960),void 0===M&&(M=.2*p),void 0===k&&(k=.2*M),void 0===hf&&((hf=new BufferGeometry).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(ff=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(h),this.line=new Line(hf,new LineBasicMaterial({color:x})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(ff,new MeshBasicMaterial({color:x})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(p,M,k)}function AxesHelper(t){var h=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],p=new BufferGeometry;p.setAttribute("position",new Float32BufferAttribute(h,3)),p.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var x=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,p,x)}ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{df.set(t.z,0,-t.x).normalize();var h=Math.acos(t.y);this.quaternion.setFromAxisAngle(df,h)}},ArrowHelper.prototype.setLength=function(t,h,p){void 0===h&&(h=.2*t),void 0===p&&(p=.2*h),this.line.scale.set(1,Math.max(1e-4,t-h),1),this.line.updateMatrix(),this.cone.scale.set(p,h,p),this.cone.position.y=t,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},ArrowHelper.prototype.copy=function(t){return Object3D.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper;var pf=4,mf=8,gf=Math.pow(2,mf),vf=[.125,.215,.35,.446,.526,.582],yf=mf-pf+1+vf.length,bf=20,xf={[Ys]:0,[Zs]:1,[Qs]:2,[tc]:3,[rc]:4,[nc]:5,[Js]:6},Mf=new OrthographicCamera,wf=function _getBlurShader(t){var h=new Float32Array(t),p=new Vector3(0,1,0),x=new RawShaderMaterial({defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:h},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:p},inputEncoding:{value:xf[Ys]},outputEncoding:{value:xf[Ys]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${_getEncodings()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:Ua,depthTest:!1,depthWrite:!1});return x.type="SphericalGaussianBlur",x}(bf),_f=null,Cf=null,{_lodPlanes:Sf,_sizeLods:Tf,_sigmas:Af}=function _createPlanes(){for(var t=[],h=[],p=[],x=mf,M=0;M<yf;M++){var k=Math.pow(2,x);h.push(k);var I=1/k;M>mf-pf?I=vf[M-mf+pf-1]:0==M&&(I=0),p.push(I);for(var N=1/(k-1),V=-N/2,ee=1+N/2,te=[V,V,ee,V,ee,ee,V,V,ee,ee,V,ee],re=new Float32Array(108),ne=new Float32Array(72),ie=new Float32Array(36),ae=0;ae<6;ae++){var oe=ae%3*2/3-1,se=ae>2?0:-1,ce=[oe,se,0,oe+2/3,se,0,oe+2/3,se+1,0,oe,se,0,oe+2/3,se+1,0,oe,se+1,0];re.set(ce,18*ae),ne.set(te,12*ae);var ue=[ae,ae,ae,ae,ae,ae];ie.set(ue,6*ae)}var le=new BufferGeometry;le.setAttribute("position",new BufferAttribute(re,3)),le.setAttribute("uv",new BufferAttribute(ne,2)),le.setAttribute("faceIndex",new BufferAttribute(ie,1)),t.push(le),x>pf&&x--}return{_lodPlanes:t,_sizeLods:h,_sigmas:p}}(),Df=null,kf=null,Pf=null,Lf=(1+Math.sqrt(5))/2,Ef=1/Lf,If=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,Lf,Ef),new Vector3(0,Lf,-Ef),new Vector3(Ef,0,Lf),new Vector3(-Ef,0,Lf),new Vector3(Lf,Ef,0),new Vector3(-Lf,Ef,0)];function PMREMGenerator(t){kf=t,_compileMaterial(wf)}function _allocateTargets(t){var h={magFilter:Uo,minFilter:Uo,generateMipmaps:!1,type:t?t.type:qo,format:t?t.format:fs,encoding:t?t.encoding:Qs,depthBuffer:!1,stencilBuffer:!1},p=_createRenderTarget(h);return p.depthBuffer=!t,Df=_createRenderTarget(h),p}function _cleanup(t){Df.dispose(),kf.setRenderTarget(Pf),t.scissorTest=!1,t.setSize(t.width,t.height)}function _compileMaterial(t){var h=new Scene;h.add(new Mesh(Sf[0],t)),kf.compile(h,Mf)}function _createRenderTarget(t){var h=new WebGLRenderTarget(3*gf,3*gf,t);return h.texture.mapping=Ro,h.texture.name="PMREM.cubeUv",h.scissorTest=!0,h}function _setViewport(t,h,p,x,M){t.viewport.set(h,p,x,M),t.scissor.set(h,p,x,M)}function _applyPMREM(t){var h=kf.autoClear;kf.autoClear=!1;for(var p=1;p<yf;p++){_blur(t,p-1,p,Math.sqrt(Af[p]*Af[p]-Af[p-1]*Af[p-1]),If[(p-1)%If.length])}kf.autoClear=h}function _blur(t,h,p,x,M){_halfBlur(t,Df,h,p,x,"latitudinal",M),_halfBlur(Df,t,p,p,x,"longitudinal",M)}function _halfBlur(t,h,p,x,M,k,I){var N=new Scene;N.add(new Mesh(Sf[x],wf));for(var V=wf.uniforms,ee=Tf[p]-1,te=isFinite(M)?Math.PI/(2*ee):2*Math.PI/(2*bf-1),re=M/te,ne=isFinite(M)?1+Math.floor(3*re):bf,ie=[],ae=0,oe=0;oe<bf;++oe){var se=oe/re,ce=Math.exp(-se*se/2);ie.push(ce),0==oe?ae+=ce:oe<ne&&(ae+=2*ce)}for(oe=0;oe<ie.length;oe++)ie[oe]=ie[oe]/ae;V.envMap.value=t.texture,V.samples.value=ne,V.weights.value=ie,V.latitudinal.value="latitudinal"===k,I&&(V.poleAxis.value=I),V.dTheta.value=te,V.mipInt.value=mf-p,V.inputEncoding.value=xf[t.texture.encoding],V.outputEncoding.value=xf[t.texture.encoding];var ue=Tf[x];_setViewport(h,se=3*Math.max(0,gf-2*ue),(0===x?0:2*gf)+2*ue*(x>mf-pf?x-mf+pf:0),3*ue,2*ue),kf.setRenderTarget(h),kf.render(N,Mf)}function _getEquirectShader(){var t=new RawShaderMaterial({uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:xf[Ys]},outputEncoding:{value:xf[Ys]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${_getEncodings()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:Ua,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function _getCubemapShader(){var t=new RawShaderMaterial({uniforms:{envMap:{value:null},inputEncoding:{value:xf[Ys]},outputEncoding:{value:xf[Ys]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${_getEncodings()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:Ua,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function _getCommonVertexShader(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function _getEncodings(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function Spline(t){CatmullRomCurve3.call(this,t),this.type="catmullrom"}PMREMGenerator.prototype={constructor:PMREMGenerator,fromScene:function(t,h=0,p=.1,x=100){Pf=kf.getRenderTarget();var M=_allocateTargets();return function _sceneToCubeUV(t,h,p,x){var M=90,k=1,I=new PerspectiveCamera(M,k,h,p),N=[1,1,1,1,-1,1],V=[1,1,-1,-1,-1,1],ee=kf.outputEncoding,te=kf.toneMapping,re=kf.toneMappingExposure,ne=kf.getClearColor(),ie=kf.getClearAlpha();kf.toneMapping=So,kf.toneMappingExposure=1,kf.outputEncoding=Ys,t.scale.z*=-1;var ae=t.background;if(ae&&ae.isColor){ae.convertSRGBToLinear();var oe=Math.max(ae.r,ae.g,ae.b),se=Math.min(Math.max(Math.ceil(Math.log2(oe)),-128),127);ae=ae.multiplyScalar(Math.pow(2,-se));var ce=(se+128)/255;kf.setClearColor(ae,ce),t.background=null}for(var ue=0;ue<6;ue++){var le=ue%3;0==le?(I.up.set(0,N[ue],0),I.lookAt(V[ue],0,0)):1==le?(I.up.set(0,0,N[ue]),I.lookAt(0,V[ue],0)):(I.up.set(0,N[ue],0),I.lookAt(0,0,V[ue])),_setViewport(x,le*gf,ue>2?gf:0,gf,gf),kf.setRenderTarget(x),kf.render(t,I)}kf.toneMapping=te,kf.toneMappingExposure=re,kf.outputEncoding=ee,kf.setClearColor(ne,ie),t.scale.z*=-1}(t,p,x,M),h>0&&_blur(M,0,0,h),_applyPMREM(M),_cleanup(M),M},fromEquirectangular:function(t){return t.magFilter=Uo,t.minFilter=Uo,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Pf=kf.getRenderTarget();var h=_allocateTargets(t);return function _textureToCubeUV(t,h){var p=new Scene;t.isCubeTexture?null==Cf&&(Cf=_getCubemapShader()):null==_f&&(_f=_getEquirectShader());var x=t.isCubeTexture?Cf:_f;p.add(new Mesh(Sf[0],x));var M=x.uniforms;M.envMap.value=t,t.isCubeTexture||M.texelSize.value.set(1/t.image.width,1/t.image.height);M.inputEncoding.value=xf[t.encoding],M.outputEncoding.value=xf[t.encoding],_setViewport(h,0,0,3*gf,2*gf),kf.setRenderTarget(h),kf.render(p,Mf)}(t,h),_applyPMREM(h),_cleanup(h),h},compileCubemapShader:function(){null==Cf&&_compileMaterial(Cf=_getCubemapShader())},compileEquirectangularShader:function(){null==_f&&_compileMaterial(_f=_getEquirectShader())},dispose:function(){wf.dispose(),null!=Cf&&Cf.dispose(),null!=_f&&_f.dispose();for(var t=0;t<Sf.length;t++)Sf[t].dispose()}},Curve.create=function(t,h){return t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=h,t},Object.assign(CurvePath.prototype,{createPointsGeometry:function(t){var h=this.getPoints(t);return this.createGeometry(h)},createSpacedPointsGeometry:function(t){var h=this.getSpacedPoints(t);return this.createGeometry(h)},createGeometry:function(t){for(var h=new Geometry,p=0,x=t.length;p<x;p++){var M=t[p];h.vertices.push(new Vector3(M.x,M.y,M.z||0))}return h}}),Object.assign(Path.prototype,{fromPoints:function(t){return this.setFromPoints(t)}}),Object.create(CatmullRomCurve3.prototype),Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){},getControlPointsArray:function(){},reparametrizeByArcLength:function(){}}),GridHelper.prototype.setColors=function(){},SkeletonHelper.prototype.update=function(){},Object.assign(Loader.prototype,{extractUrlBase:function(t){return LoaderUtils_extractUrlBase(t)}}),Loader.Handlers={add:function(){},get:function(){}},Object.assign(ObjectLoader.prototype,{setTexturePath:function(t){return this.setResourcePath(t)}}),Object.assign(Box2.prototype,{center:function(t){return this.getCenter(t)},empty:function(){return this.isEmpty()},isIntersectionBox:function(t){return this.intersectsBox(t)},size:function(t){return this.getSize(t)}}),Object.assign(Box3.prototype,{center:function(t){return this.getCenter(t)},empty:function(){return this.isEmpty()},isIntersectionBox:function(t){return this.intersectsBox(t)},isIntersectionSphere:function(t){return this.intersectsSphere(t)},size:function(t){return this.getSize(t)}}),Frustum.prototype.setFromMatrix=function(t){return this.setFromProjectionMatrix(t)},Line3.prototype.center=function(t){return this.getCenter(t)},Object.assign(gc,{random16:function(){return Math.random()},nearestPowerOfTwo:function(t){return gc.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return gc.ceilPowerOfTwo(t)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(t,h){return this.toArray(t,h)},multiplyVector3:function(t){return t.applyMatrix3(this)},multiplyVector3Array:function(){},applyToBufferAttribute:function(t){return t.applyMatrix3(this)},applyToVector3Array:function(){}}),Object.assign(Matrix4.prototype,{extractPosition:function(t){return this.copyPosition(t)},flattenToArrayOffset:function(t,h){return this.toArray(t,h)},getPosition:function(){return(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return this.makeRotationFromQuaternion(t)},multiplyToArray:function(){},multiplyVector3:function(t){return t.applyMatrix4(this)},multiplyVector4:function(t){return t.applyMatrix4(this)},multiplyVector3Array:function(){},rotateAxis:function(t){t.transformDirection(this)},crossVector:function(t){return t.applyMatrix4(this)},translate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},rotateByAxis:function(){},applyToBufferAttribute:function(t){return t.applyMatrix4(this)},applyToVector3Array:function(){},makeFrustum:function(t,h,p,x,M,k){return this.makePerspective(t,h,x,p,M,k)}}),Plane.prototype.isIntersectionLine=function(t){return this.intersectsLine(t)},Quaternion.prototype.multiplyVector3=function(t){return t.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(t){return this.intersectsBox(t)},isIntersectionPlane:function(t){return this.intersectsPlane(t)},isIntersectionSphere:function(t){return this.intersectsSphere(t)}}),Object.assign(Triangle.prototype,{area:function(){return this.getArea()},barycoordFromPoint:function(t,h){return this.getBarycoord(t,h)},midpoint:function(t){return this.getMidpoint(t)},normal:function(t){return this.getNormal(t)},plane:function(t){return this.getPlane(t)}}),Object.assign(Triangle,{barycoordFromPoint:function(t,h,p,x,M){return Triangle.getBarycoord(t,h,p,x,M)},normal:function(t,h,p,x){return Triangle.getNormal(t,h,p,x)}}),Object.assign(Shape.prototype,{extractAllPoints:function(t){return this.extractPoints(t)},extrude:function(t){return new ExtrudeGeometry(this,t)},makeGeometry:function(t){return new ShapeGeometry(this,t)}}),Object.assign(Vector2.prototype,{fromAttribute:function(t,h,p){return this.fromBufferAttribute(t,h,p)},distanceToManhattan:function(t){return this.manhattanDistanceTo(t)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){},setEulerFromQuaternion:function(){},getPositionFromMatrix:function(t){return this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,h){return this.setFromMatrixColumn(h,t)},applyProjection:function(t){return this.applyMatrix4(t)},fromAttribute:function(t,h,p){return this.fromBufferAttribute(t,h,p)},distanceToManhattan:function(t){return this.manhattanDistanceTo(t)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(t,h,p){return this.fromBufferAttribute(t,h,p)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){},computeLineDistances:function(){},applyMatrix:function(t){return this.applyMatrix4(t)}}),Object.assign(Object3D.prototype,{getChildByName:function(t){return this.getObjectByName(t)},renderDepth:function(){},translate:function(t,h){return this.translateOnAxis(h,t)},getWorldRotation:function(){},applyMatrix:function(t){return this.applyMatrix4(t)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(t){this.rotation.order=t}},useQuaternion:{get:function(){},set:function(){}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return 0},set:function(){}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){},set:function(){}}),SkinnedMesh.prototype.initBones=function(){},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return this.arcLengthDivisions},set:function(t){this.arcLengthDivisions=t}}),PerspectiveCamera.prototype.setLens=function(t,h){void 0!==h&&(this.filmGauge=h),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(t){this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(t){this.shadow.bias=t}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(t){this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return this.usage===hc},set:function(){this.setUsage(hc)}}}),Object.assign(BufferAttribute.prototype,{setDynamic:function(t){return this.setUsage(!0===t?hc:lc),this},copyIndicesArray:function(){},setArray:function(){}}),Object.assign(BufferGeometry.prototype,{addIndex:function(t){this.setIndex(t)},addAttribute:function(t,h){return h&&h.isBufferAttribute||h&&h.isInterleavedBufferAttribute?"index"===t?(this.setIndex(h),this):this.setAttribute(t,h):this.setAttribute(t,new BufferAttribute(arguments[1],arguments[2]))},addDrawCall:function(t,h,p){this.addGroup(t,h)},clearDrawCalls:function(){this.clearGroups()},computeTangents:function(){},computeOffsets:function(){},removeAttribute:function(t){return this.deleteAttribute(t)},applyMatrix:function(t){return this.applyMatrix4(t)}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return this.usage===hc},set:function(t){this.setUsage(t)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(t){return this.setUsage(!0===t?hc:lc),this},setArray:function(){}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){},addShapeList:function(){},addShape:function(){}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){}},onUpdate:{value:function(){return this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new Color}},shading:{get:function(){},set:function(t){this.flatShading=1===t}},stencilMask:{get:function(){return this.stencilFuncMask},set:function(t){this.stencilFuncMask=t}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return!1},set:function(){}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(t){this.extensions.derivatives=t}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(t,h,p,x){this.setRenderTarget(t),this.clear(h,p,x)},animate:function(t){this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return this.getRenderTarget()},getMaxAnisotropy:function(){return this.capabilities.getMaxAnisotropy()},getPrecision:function(){return this.capabilities.precision},resetGLState:function(){return this.state.reset()},supportsFloatTextures:function(){return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){this.setScissorTest(t)},initMaterial:function(){},addPrePlugin:function(){},addPostPlugin:function(){},updateShadowMap:function(){},setFaceCulling:function(){},allocTextureUnit:function(){},setTexture:function(){},setTexture2D:function(){},setTextureCube:function(){},getActiveMipMapLevel:function(){return this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){this.shadowMap.type=t}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(t){this.outputEncoding=!0===t?Zs:Ys}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(t){this.texture.wrapS=t}},wrapT:{get:function(){return this.texture.wrapT},set:function(t){this.texture.wrapT=t}},magFilter:{get:function(){return this.texture.magFilter},set:function(t){this.texture.magFilter=t}},minFilter:{get:function(){return this.texture.minFilter},set:function(t){this.texture.minFilter=t}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(t){this.texture.anisotropy=t}},offset:{get:function(){return this.texture.offset},set:function(t){this.texture.offset=t}},repeat:{get:function(){return this.texture.repeat},set:function(t){this.texture.repeat=t}},format:{get:function(){return this.texture.format},set:function(t){this.texture.format=t}},type:{get:function(){return this.texture.type},set:function(t){this.texture.type=t}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(t){this.texture.generateMipmaps=t}}}),Object.defineProperties(Audio.prototype,{load:{value:function(t){var h=this;return(new AudioLoader).load(t,(function(t){h.setBuffer(t)})),this}},startTime:{set:function(){}}}),AudioAnalyser.prototype.getData=function(){return this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,h){return this.update(t,h)},vc.crossOrigin=void 0,vc.loadTexture=function(t,h,p,x){var M=new TextureLoader;M.setCrossOrigin(this.crossOrigin);var k=M.load(t,p,void 0,x);return h&&(k.mapping=h),k},vc.loadTextureCube=function(t,h,p,x){var M=new CubeTextureLoader;M.setCrossOrigin(this.crossOrigin);var k=M.load(t,p,void 0,x);return h&&(k.mapping=h),k},vc.loadCompressedTexture=function(){},vc.loadCompressedTextureCube=function(){},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"113"}}));var Bf={};function _createSuper(t){var h=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Vf){return!1}}();return function _createSuperInternal(){var p,x=_getPrototypeOf$1(t);if(h){var M=_getPrototypeOf$1(this).constructor;p=Reflect.construct(x,arguments,M)}else p=x.apply(this,arguments);return _possibleConstructorReturn$1(this,p)}}!function(){var t=function a1(){function W(t){this.message="JPEG error: "+t}return W.prototype=new Error,W.prototype.name="JpegError",W.constructor=W,W}(),h=function ag(){var h=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),p=4017,x=799,M=3406,k=2276,I=1567,N=3784,V=5793,ee=2896;function ak(t){null==t&&(t={}),null==t.w&&(t.w=-1),this.V=t.n,this.N=t.w}function a5(t,h){for(var p,x,M,k=0,I=[],N=16;N>0&&!t[N-1];)N--;I.push({children:[],index:0});var V=I[0];for(p=0;p<N;p++){for(x=0;x<t[p];x++){for((V=I.pop()).children[V.index]=h[k];V.index>0;)V=I.pop();for(V.index++,I.push(V);I.length<=p;)I.push(M={children:[],index:0}),V.children[V.index]=M.children,V=M;k++}p+1<N&&(I.push(M={children:[],index:0}),V.children[V.index]=M.children,V=M)}return I[0].children}function a2(t,h,p){return 64*((t.P+1)*h+p)}function a7(p,x,M,k,I,N,V,ee,te,re){null==re&&(re=!1);var ne,ie,ae,oe,se,ce,ue,le,he,fe,de,pe=M.m,me=M.Z,ge=x,ve=0,ye=0,be=0,xe=0,Me=0,we=0;function Y(){if(ye>0)return ye--,ve>>ye&1;if(255===(ve=p[x++])){var h=p[x++];if(h){if(220===h&&re){var k=Z(p,x+=2);if(x+=2,k>0&&k!==M.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",k)}else if(217===h){if(re){var I=8*Me;if(I>0&&I<M.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",I)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new t("unexpected marker")}}return ye=7,ve>>>7}function u(h){for(var p=h;;){switch(_typeof$1(p=p[Y()])){case"number":return p;case"object":continue}throw new t("invalid huffman sequence")}}function m(t){for(var h=0;t>0;)h=h<<1|Y(),t--;return h}function j(t){if(1===t)return 1===Y()?1:-1;var h=m(t);return h>=1<<t-1?h:h+(-1<<t)+1}function H(t,h,p,x,M){var k=p%pe;Me=(p/pe|0)*t.A+x;var I=k*t.h+M;h(t,a2(t,Me,I))}function w(t,h,p){Me=p/t.P|0;var x=p%t.P;h(t,a2(t,Me,x))}var _e=k.length;for(ue=me?0===N?0===ee?function $(t,h){var p=u(t.J),x=0===p?0:j(p)<<te;t.D[h]=t.Q+=x}:function b(t,h){t.D[h]|=Y()<<te}:0===ee?function P(t,p){if(be>0)be--;else for(var x=N,M=V;x<=M;){var k=u(t.i),I=15&k,ee=k>>4;if(0!==I){var re=h[x+=ee];t.D[p+re]=j(I)*(1<<te),x++}else{if(ee<15){be=m(ee)+(1<<ee)-1;break}x+=16}}}:function a4(p,x){for(var M,k,I=N,ee=V,re=0;I<=ee;){var ie=x+h[I],ae=p.D[ie]<0?-1:1;switch(xe){case 0:if(re=(k=u(p.i))>>4,0==(M=15&k))re<15?(be=m(re)+(1<<re),xe=4):(re=16,xe=1);else{if(1!==M)throw new t("invalid ACn encoding");ne=j(M),xe=re?2:3}continue;case 1:case 2:p.D[ie]?p.D[ie]+=ae*(Y()<<te):0==--re&&(xe=2===xe?3:0);break;case 3:p.D[ie]?p.D[ie]+=ae*(Y()<<te):(p.D[ie]=ne<<te,xe=0);break;case 4:p.D[ie]&&(p.D[ie]+=ae*(Y()<<te))}I++}4===xe&&0==--be&&(xe=0)}:function v(t,p){var x=u(t.J),M=0===x?0:j(x),k=1;for(t.D[p]=t.Q+=M;k<64;){var I=u(t.i),N=15&I,V=I>>4;if(0!==N){var ee=h[k+=V];t.D[p+ee]=j(N),k++}else{if(V<15)break;k+=16}}},he=1===_e?k[0].P*k[0].c:pe*M.R;we<=he;){var Ce=I?Math.min(he-we,I):he;if(Ce>0){for(ae=0;ae<_e;ae++)k[ae].Q=0;if(be=0,1===_e)for(ie=k[0],ce=0;ce<Ce;ce++)w(ie,ue,we),we++;else for(ce=0;ce<Ce;ce++){for(ae=0;ae<_e;ae++)for(fe=(ie=k[ae]).h,de=ie.A,oe=0;oe<de;oe++)for(se=0;se<fe;se++)H(ie,ue,we,oe,se);we++}}if(ye=0,!(le=an(p,x)))break;if(le.u&&(x=le.offset),!(le.M>=65488&&le.M<=65495))break;x+=2}return x-ge}function al(h,te,re){var ne,ie,ae,oe,se,ce,ue,le,he,fe,de,pe,me,ge,ve,ye,be,xe=h.$,Me=h.D;if(!xe)throw new t("missing required Quantization Table.");for(var we=0;we<64;we+=8)he=Me[te+we],fe=Me[te+we+1],de=Me[te+we+2],pe=Me[te+we+3],me=Me[te+we+4],ge=Me[te+we+5],ve=Me[te+we+6],ye=Me[te+we+7],he*=xe[we],0!=(fe|de|pe|me|ge|ve|ye)?(fe*=xe[we+1],de*=xe[we+2],pe*=xe[we+3],me*=xe[we+4],ge*=xe[we+5],ve*=xe[we+6],ye*=xe[we+7],ie=(ne=(ne=V*he+128>>8)+(ie=V*me+128>>8)+1>>1)-ie,be=(ae=de)*N+(oe=ve)*I+128>>8,ae=ae*I-oe*N+128>>8,ue=(se=(se=ee*(fe-ye)+128>>8)+(ue=ge<<4)+1>>1)-ue,ce=(le=(le=ee*(fe+ye)+128>>8)+(ce=pe<<4)+1>>1)-ce,oe=(ne=ne+(oe=be)+1>>1)-oe,ae=(ie=ie+ae+1>>1)-ae,be=se*k+le*M+2048>>12,se=se*M-le*k+2048>>12,le=be,be=ce*x+ue*p+2048>>12,ce=ce*p-ue*x+2048>>12,ue=be,re[we]=ne+le,re[we+7]=ne-le,re[we+1]=ie+ue,re[we+6]=ie-ue,re[we+2]=ae+ce,re[we+5]=ae-ce,re[we+3]=oe+se,re[we+4]=oe-se):(be=V*he+512>>10,re[we]=be,re[we+1]=be,re[we+2]=be,re[we+3]=be,re[we+4]=be,re[we+5]=be,re[we+6]=be,re[we+7]=be);for(var _e=0;_e<8;++_e)he=re[_e],0!=((fe=re[_e+8])|(de=re[_e+16])|(pe=re[_e+24])|(me=re[_e+32])|(ge=re[_e+40])|(ve=re[_e+48])|(ye=re[_e+56]))?(ie=(ne=4112+((ne=V*he+2048>>12)+(ie=V*me+2048>>12)+1>>1))-ie,be=(ae=de)*N+(oe=ve)*I+2048>>12,ae=ae*I-oe*N+2048>>12,oe=be,ue=(se=(se=ee*(fe-ye)+2048>>12)+(ue=ge)+1>>1)-ue,ce=(le=(le=ee*(fe+ye)+2048>>12)+(ce=pe)+1>>1)-ce,be=se*k+le*M+2048>>12,se=se*M-le*k+2048>>12,le=be,be=ce*x+ue*p+2048>>12,ce=ce*p-ue*x+2048>>12,(he=(ne=ne+oe+1>>1)+le)<16?he=0:he>=4080?he=255:he>>=4,(fe=(ie=ie+ae+1>>1)+(ue=be))<16?fe=0:fe>=4080?fe=255:fe>>=4,(de=(ae=ie-ae)+ce)<16?de=0:de>=4080?de=255:de>>=4,(pe=(oe=ne-oe)+se)<16?pe=0:pe>=4080?pe=255:pe>>=4,(me=oe-se)<16?me=0:me>=4080?me=255:me>>=4,(ge=ae-ce)<16?ge=0:ge>=4080?ge=255:ge>>=4,(ve=ie-ue)<16?ve=0:ve>=4080?ve=255:ve>>=4,(ye=ne-le)<16?ye=0:ye>=4080?ye=255:ye>>=4,Me[te+_e]=he,Me[te+_e+8]=fe,Me[te+_e+16]=de,Me[te+_e+24]=pe,Me[te+_e+32]=me,Me[te+_e+40]=ge,Me[te+_e+48]=ve,Me[te+_e+56]=ye):(be=(be=V*he+8192>>14)<-2040?0:be>=2024?255:be+2056>>4,Me[te+_e]=be,Me[te+_e+8]=be,Me[te+_e+16]=be,Me[te+_e+24]=be,Me[te+_e+32]=be,Me[te+_e+40]=be,Me[te+_e+48]=be,Me[te+_e+56]=be)}function a0(t,h){for(var p=h.P,x=h.c,M=new Int16Array(64),k=0;k<x;k++)for(var I=0;I<p;I++){al(h,a2(h,k,I),M)}return h.D}function an(t,h,p){null==p&&(p=h);var x=t.length-1,M=p<h?p:h;if(h>=x)return null;var k=Z(t,h);if(k>=65472&&k<=65534)return{u:null,M:k,offset:h};for(var I=Z(t,M);!(I>=65472&&I<=65534);){if(++M>=x)return null;I=Z(t,M)}return{u:k.toString(16),M:I,offset:M}}return ak.prototype={parse:function parse(p,x){null==x&&(x={});var M,k,I=x.F,N=0,V=null,ee=null,te=0;function G(){var t=Z(p,N),h=(N+=2)+t-2,x=an(p,h,N);x&&x.u&&(h=x.offset);var M=p.subarray(N,h);return N+=M.length,M}function n(t){for(var h=Math.ceil(t.o/8/t.X),p=Math.ceil(t.s/8/t.B),x=0;x<t.W.length;x++){Te=t.W[x];var M=Math.ceil(Math.ceil(t.o/8)*Te.h/t.X),k=Math.ceil(Math.ceil(t.s/8)*Te.A/t.B),I=h*Te.h,N=64*(p*Te.A)*(I+1);Te.D=new Int16Array(N),Te.P=M,Te.c=k}t.m=h,t.R=p}var re=[],ne=[],ie=[],ae=Z(p,N);if(N+=2,65496!==ae)throw new t("SOI not found");ae=Z(p,N),N+=2;e:for(;65497!==ae;){var oe,se,ce;switch(ae){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var ue=G();65504===ae&&74===ue[0]&&70===ue[1]&&73===ue[2]&&70===ue[3]&&0===ue[4]&&(V={version:{d:ue[5],T:ue[6]},K:ue[7],j:ue[8]<<8|ue[9],H:ue[10]<<8|ue[11],S:ue[12],I:ue[13],C:ue.subarray(14,14+3*ue[12]*ue[13])}),65518===ae&&65===ue[0]&&100===ue[1]&&111===ue[2]&&98===ue[3]&&101===ue[4]&&(ee={version:ue[5]<<8|ue[6],k:ue[7]<<8|ue[8],q:ue[9]<<8|ue[10],a:ue[11]});break;case 65499:for(var le=Z(p,N)+(N+=2)-2;N<le;){var he=p[N++],fe=new Uint16Array(64);if(he>>4==0)for(se=0;se<64;se++)fe[h[se]]=p[N++];else{if(he>>4!=1)throw new t("DQT - invalid table spec");for(se=0;se<64;se++)fe[h[se]]=Z(p,N),N+=2}re[15&he]=fe}break;case 65472:case 65473:case 65474:if(M)throw new t("Only single frame JPEGs supported");N+=2,(M={}).G=65473===ae,M.Z=65474===ae,M.precision=p[N++];var de,pe=Z(p,N),me=0,ge=0;N+=2,M.s=I||pe,M.o=Z(p,N),N+=2,M.W=[],M._={};var ve=p[N++];for(oe=0;oe<ve;oe++){de=p[N];var ye=p[N+1]>>4,be=15&p[N+1];me<ye&&(me=ye),ge<be&&(ge=be);var xe=p[N+2];ce=M.W.push({h:ye,A:be,L:xe,$:null}),M._[de]=ce-1,N+=3}M.X=me,M.B=ge,n(M);break;case 65476:var Me=Z(p,N);for(N+=2,oe=2;oe<Me;){var we=p[N++],_e=new Uint8Array(16),Ce=0;for(se=0;se<16;se++,N++)Ce+=_e[se]=p[N];var Se=new Uint8Array(Ce);for(se=0;se<Ce;se++,N++)Se[se]=p[N];oe+=17+Ce,(we>>4==0?ie:ne)[15&we]=a5(_e,Se)}break;case 65501:k=Z(p,N+=2),N+=2;break;case 65498:var Te,Ae=1==++te&&!I;N+=2;var De=p[N++],ke=[];for(oe=0;oe<De;oe++){var Le=p[N++],Ee=M._[Le];(Te=M.W[Ee]).index=Le;var Ie=p[N++];Te.J=ie[Ie>>4],Te.i=ne[15&Ie],ke.push(Te)}var Be=p[N++],Oe=p[N++],Re=p[N++];try{var Fe=a7(p,N,M,ke,k,Be,Oe,Re>>4,15&Re,Ae);N+=Fe}catch(Ge){if(Ge instanceof DNLMarkerError)return this.parse(p,{F:Ge.s});if(Ge instanceof EOIMarkerError)break e;throw Ge}break;case 65500:N+=4;break;case 65535:255!==p[N]&&N--;break;default:var Ne=an(p,N-2,N-3);if(Ne&&Ne.u){N=Ne.offset;break}if(N>=p.length-1)break e;throw new t("JpegImage.parse - unknown marker: "+ae.toString(16))}ae=Z(p,N),N+=2}for(this.width=M.o,this.height=M.s,this.g=V,this.b=ee,this.W=[],oe=0;oe<M.W.length;oe++){var Ve=re[(Te=M.W[oe]).L];Ve&&(Te.$=Ve),this.W.push({index:Te.index,e:a0(0,Te),l:Te.h/M.X,t:Te.A/M.B,P:Te.P,c:Te.c})}this.p=this.W.length},Y:function Y(t,h,p){null==p&&(p=!1);var x,M,k,I,N,V,ee,te,re,ne,ie,ae,oe=this.width/t,se=this.height/h,Y=0,ce=this.W.length,ue=t*h*ce,le=new Uint8ClampedArray(ue),he=new Uint32Array(t),fe=4294967288;for(ee=0;ee<ce;ee++){if(M=(x=this.W[ee]).l*oe,k=x.t*se,Y=ee,ie=x.e,I=x.P+1<<3,M!==ae){for(N=0;N<t;N++)te=0|N*M,he[N]=(te&fe)<<3|7&te;ae=M}for(V=0;V<h;V++)for(ne=I*((te=0|V*k)&fe)|(7&te)<<3,N=0;N<t;N++)le[Y]=ie[ne+he[N]],Y+=ce}var de=this.V;if(p||4!==ce||de||(de=new Int32Array([-256,255,-256,255,-256,255,-256,255])),de)for(ee=0;ee<ue;)for(te=0,re=0;te<ce;te++,ee++,re+=2)le[ee]=(le[ee]*de[re]>>8)+de[re+1];return le},get f(){return this.b?!!this.b.a:3===this.p?0!==this.N&&(82!==this.W[0].index||71!==this.W[1].index||66!==this.W[2].index):1===this.N},z:function aj(t){for(var h,p,x,M=0,k=t.length;M<k;M+=3)h=t[M],p=t[M+1],x=t[M+2],t[M]=h-179.456+1.402*x,t[M+1]=h+135.459-.344*p-.714*x,t[M+2]=h-226.816+1.772*p;return t},O:function aa(t){for(var h,p,x,M,k=0,I=0,N=t.length;I<N;I+=4)h=t[I],p=t[I+1],x=t[I+2],M=t[I+3],t[k++]=p*(-660635669420364e-19*p+.000437130475926232*x-54080610064599e-18*h+.00048449797120281*M-.154362151871126)-122.67195406894+x*(-.000957964378445773*x+.000817076911346625*h-.00477271405408747*M+1.53380253221734)+h*(.000961250184130688*h-.00266257332283933*M+.48357088451265)+M*(-.000336197177618394*M+.484791561490776),t[k++]=107.268039397724+p*(219927104525741e-19*p-.000640992018297945*x+.000659397001245577*h+.000426105652938837*M-.176491792462875)+x*(-.000778269941513683*x+.00130872261408275*h+.000770482631801132*M-.151051492775562)+h*(.00126935368114843*h-.00265090189010898*M+.25802910206845)+M*(-.000318913117588328*M-.213742400323665),t[k++]=p*(-.000570115196973677*p-263409051004589e-19*x+.0020741088115012*h-.00288260236853442*M+.814272968359295)-20.810012546947+x*(-153496057440975e-19*x-.000132689043961446*h+.000560833691242812*M-.195152027534049)+h*(.00174418132927582*h-.00255243321439347*M+.116935020465145)+M*(-.000343531996510555*M+.24165260232407);return t.subarray(0,k)},r:function a3(t){for(var h,p,x,M=0,k=t.length;M<k;M+=4)h=t[M],p=t[M+1],x=t[M+2],t[M]=434.456-h-1.402*x,t[M+1]=119.541-h+.344*p+.714*x,t[M+2]=481.816-h-1.772*p;return t},U:function as(t){for(var h,p,x,M,k=0,I=0,N=t.length;I<N;I+=4)h=t[I],p=t[I+1],x=t[I+2],M=t[I+3],t[k++]=255+h*(-6747147073602441e-20*h+.0008379262121013727*p+.0002894718188643294*x+.003264231057537806*M-1.1185611867203937)+p*(26374107616089405e-21*p-8626949158638572e-20*x-.0002748769067499491*M-.02155688794978967)+x*(-3878099212869363e-20*x-.0003267808279485286*M+.0686742238595345)-M*(.0003361971776183937*M+.7430659151342254),t[k++]=255+h*(.00013596372813588848*h+.000924537132573585*p+.00010567359618683593*x+.0004791864687436512*M-.3109689587515875)+p*(-.00023545346108370344*p+.0002702845253534714*x+.0020200308977307156*M-.7488052167015494)+x*(6834815998235662e-20*x+.00015168452363460973*M-.09751927774728933)-M*(.0003189131175883281*M+.7364883807733168),t[k++]=255+h*(13598650411385307e-21*h+.00012423956175490851*p+.0004751985097583589*x-36729317476630422e-22*M-.05562186980264034)+p*(.00016141380598724676*p+.0009692239130725186*x+.0007782692450036253*M-.44015232367526463)+x*(5.068882914068769e-7*x+.0017778369011375071*M-.7591454649749609)-M*(.0003435319965105553*M+.7063770186160144);return t.subarray(0,k)},getData:function getData(h){var p=h.width,x=h.height,M=h.forceRGB,k=h.isSourcePDF;if(this.p>4)throw new t("Unsupported color mode");var I=this.Y(p,x,k);if(1===this.p&&M){for(var N=I.length,V=new Uint8ClampedArray(3*N),ee=0,te=0;te<N;te++){var re=I[te];V[ee++]=re,V[ee++]=re,V[ee++]=re}return V}if(3===this.p&&this.f)return this.z(I);if(4===this.p){if(this.f)return M?this.O(I):this.r(I);if(M)return this.U(I)}return I}},ak}();function Z(t,h){return t[h]<<8|t[h+1]}Bf.JpegDecoder=h}(),Bf.encodeImage=function(t,h,p,x){var M={t256:[h],t257:[p],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[p],t279:[h*p*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(x)for(var k in x)M[k]=x[k];var I=new Uint8Array(Bf.encode([M])),N=new Uint8Array(t),V=new Uint8Array(1e3+h*p*4);for(k=0;k<I.length;k++)V[k]=I[k];for(k=0;k<N.length;k++)V[1e3+k]=N[k];return V.buffer},Bf.encode=function(t){var h=new Uint8Array(2e4),p=4,x=Bf._binBE;h[0]=h[1]=77,x.writeUshort(h,2,42);var M=8;x.writeUint(h,p,M),p+=4;for(var k=0;k<t.length;k++){var I=Bf._writeIFD(x,Bf._types.basic,h,M,t[k]);M=I[1],k<t.length-1&&(0!=(3&M)&&(M+=4-(3&M)),x.writeUint(h,I[0],M))}return h.slice(0,M).buffer},Bf.decode=function(t,h){null==h&&(h={parseMN:!0,debug:!1});var p=new Uint8Array(t),x=0,M=Bf._binBE.readASCII(p,x,2);x+=2;var k="II"==M?Bf._binLE:Bf._binBE;k.readUshort(p,x),x+=2;var I=k.readUint(p,x);x+=4;for(var N=[];;){var V=k.readUshort(p,I),ee=k.readUshort(p,I+4);if(0!=V&&(ee<1||13<ee)){log("error in TIFF");break}if(Bf._readIFD(k,p,I,N,0,h),0==(I=k.readUint(p,I+2+12*V)))break}return N},Bf.decodeImage=function(t,h,p){if(!h.data){var x=new Uint8Array(t),M=Bf._binBE.readASCII(x,0,2);if(null!=h.t256){h.isLE="II"==M,h.width=h.t256[0],h.height=h.t257[0];var k=h.t259?h.t259[0]:1,I=h.t266?h.t266[0]:1;h.t284&&2==h.t284[0]&&log("PlanarConfiguration 2 should not be used!"),7==k&&h.t258&&h.t258.length>3&&(h.t258=h.t258.slice(0,3));var N=h.t277?h.t277[0]:1,V=(h.t258?h.t258[0]:1)*N;1==k&&null!=h.t279&&h.t278&&32803==h.t262[0]&&(V=Math.round(8*h.t279[0]/(h.width*h.t278[0]))),h.t50885&&4==h.t50885[0]&&(V=3*h.t258[0]);var ee=8*Math.ceil(h.width*V/8),te=h.t273;(null==te||h.t322)&&(te=h.t324);var re=h.t279;1==k&&1==te.length&&(re=[h.height*(ee>>>3)]),(null==re||h.t322)&&(re=h.t325);var ne=new Uint8Array(h.height*(ee>>>3)),ie=0;if(null!=h.t322){for(var ae=h.t322[0],oe=h.t323[0],se=Math.floor((h.width+ae-1)/ae),ce=Math.floor((h.height+oe-1)/oe),ue=new Uint8Array(0|Math.ceil(ae*oe*V/8)),le=0;le<ce;le++)for(var he=0;he<se;he++){var fe=le*se+he;ue.fill(0),Bf.decode._decompress(h,p,x,te[fe],re[fe],k,ue,0,I,ae,oe),6==k?ne=ue:Bf._copyTile(ue,0|Math.ceil(ae*V/8),oe,ne,0|Math.ceil(h.width*V/8),h.height,0|Math.ceil(he*ae*V/8),le*oe)}ie=8*ne.length}else{if(null==te)return;var de=h.t278?h.t278[0]:h.height;de=Math.min(de,h.height);for(fe=0;fe<te.length;fe++)Bf.decode._decompress(h,p,x,te[fe],re[fe],k,ne,0|Math.ceil(ie/8),I,h.width,de),ie+=ee*de;ie=Math.min(ie,8*ne.length)}h.data=new Uint8Array(ne.buffer,0,0|Math.ceil(ie/8))}}},Bf.decode._decompress=function(t,h,p,x,M,k,I,N,V,ee,te){if(t.t271&&"Panasonic"==t.t271[0]&&t.t45&&6==t.t45[0]&&(k=34316),1==k)for(var re=0;re<M;re++)I[N+re]=p[x+re];else if(2==k)Bf.decode._decodeG2(p,x,M,I,N,ee,V);else if(3==k)Bf.decode._decodeG3(p,x,M,I,N,ee,V,!!t.t292&&1==(1&t.t292[0]));else if(4==k)Bf.decode._decodeG4(p,x,M,I,N,ee,V);else if(5==k)Bf.decode._decodeLZW(p,x,M,I,N,8);else if(6==k)Bf.decode._decodeOldJPEG(t,p,x,M,I,N);else if(7==k||34892==k)Bf.decode._decodeNewJPEG(t,p,x,M,I,N);else if(8==k||32946==k){var ne=new Uint8Array(p.buffer,x+2,M-6),ie=Bf._inflateRaw(ne);N+ie.length<=I.length&&I.set(ie,N)}else 9==k?Bf.decode._decodeVC5(p,x,M,I,N,t.t33422):32767==k?Bf.decode._decodeARW(t,p,x,M,I,N):32773==k?Bf.decode._decodePackBits(p,x,M,I,N):32809==k?Bf.decode._decodeThunder(p,x,M,I,N):34316==k?Bf.decode._decodePanasonic(t,p,x,M,I,N):34713==k?Bf.decode._decodeNikon(t,h,p,x,M,I,N):34676==k?Bf.decode._decodeLogLuv32(t,p,x,M,I,N):log("Unknown compression",k);var ae=t.t258?Math.min(32,t.t258[0]):1,oe=t.t277?t.t277[0]:1,se=ae*oe>>>3,ce=Math.ceil(ae*oe*ee/8);if(16==ae&&!t.isLE&&null==t.t33422)for(var ue=0;ue<te;ue++)for(var le=N+ue*ce,he=1;he<ce;he+=2){var fe=I[le+he];I[le+he]=I[le+he-1],I[le+he-1]=fe}if(t.t317&&2==t.t317[0])for(ue=0;ue<te;ue++){var de=N+ue*ce;if(16==ae)for(re=se;re<ce;re+=2){var pe=(I[de+re+1]<<8|I[de+re])+(I[de+re-se+1]<<8|I[de+re-se]);I[de+re]=255&pe,I[de+re+1]=pe>>>8&255}else if(3==oe)for(re=3;re<ce;re+=3)I[de+re]=I[de+re]+I[de+re-3]&255,I[de+re+1]=I[de+re+1]+I[de+re-2]&255,I[de+re+2]=I[de+re+2]+I[de+re-1]&255;else for(re=se;re<ce;re++)I[de+re]=I[de+re]+I[de+re-se]&255}},Bf.decode._decodePanasonic=function(t,h,p,x,M,k){var I,N,V,ee,te,re,ne,ie,ae=h.buffer,oe=t.t2[0],se=t.t3[0],ce=t.t10[0],ue=t.t45[0],le=0,he=0,fe=0,de=0,pe=6==ue?new Uint32Array(18):new Uint8Array(16),me=[0,0],ge=[0,0],ve=0,ye=new Uint8Array(16384),be=new Uint16Array(M.buffer);function getDataRaw(t){if(0==fe){var h=new Uint8Array(ae,p+he+8184,8200),x=new Uint8Array(ae,p+he,8184);ye.set(h),ye.set(x,h.length),he+=16384}if(5!=ue)return(ye[de=(fe=fe-t&131071)>>3^16368]|ye[de+1]<<8)>>(7&fe)&~(-1<<t);for(I=0;I<16;I++)pe[I]=ye[fe++],fe&=16383}function getBufferDataRW6(t){return ye[fe+15-t]}function resetPredNonzeros(){me[0]=0,me[1]=0,ge[0]=0,ge[1]=0}if(7==ue)throw ue;if(6==ue){var xe=12==ce,Me=xe?function readPageRw6_bps12(){pe[0]=getBufferDataRW6(0)<<4|getBufferDataRW6(1)>>4,pe[1]=4095&((15&getBufferDataRW6(1))<<8|getBufferDataRW6(2)),pe[2]=getBufferDataRW6(3)>>6&3,pe[3]=(63&getBufferDataRW6(3))<<2|getBufferDataRW6(4)>>6,pe[4]=(63&getBufferDataRW6(4))<<2|getBufferDataRW6(5)>>6,pe[5]=(63&getBufferDataRW6(5))<<2|getBufferDataRW6(6)>>6,pe[6]=getBufferDataRW6(6)>>4&3,pe[7]=(15&getBufferDataRW6(6))<<4|getBufferDataRW6(7)>>4,pe[8]=(15&getBufferDataRW6(7))<<4|getBufferDataRW6(8)>>4,pe[9]=(15&getBufferDataRW6(8))<<4|getBufferDataRW6(9)>>4,pe[10]=getBufferDataRW6(9)>>2&3,pe[11]=(3&getBufferDataRW6(9))<<6|getBufferDataRW6(10)>>2,pe[12]=(3&getBufferDataRW6(10))<<6|getBufferDataRW6(11)>>2,pe[13]=(3&getBufferDataRW6(11))<<6|getBufferDataRW6(12)>>2,pe[14]=3&getBufferDataRW6(12),pe[15]=getBufferDataRW6(13),pe[16]=getBufferDataRW6(14),pe[17]=getBufferDataRW6(15),fe+=16,de=0}:function readPageRW6(){pe[0]=getBufferDataRW6(0)<<6|getBufferDataRW6(1)>>2,pe[1]=16383&((3&getBufferDataRW6(1))<<12|getBufferDataRW6(2)<<4|getBufferDataRW6(3)>>4),pe[2]=getBufferDataRW6(3)>>2&3,pe[3]=(3&getBufferDataRW6(3))<<8|getBufferDataRW6(4),pe[4]=getBufferDataRW6(5)<<2|getBufferDataRW6(6)>>6,pe[5]=(63&getBufferDataRW6(6))<<4|getBufferDataRW6(7)>>4,pe[6]=getBufferDataRW6(7)>>2&3,pe[7]=(3&getBufferDataRW6(7))<<8|getBufferDataRW6(8),pe[8]=getBufferDataRW6(9)<<2&1020|getBufferDataRW6(10)>>6,pe[9]=1023&(getBufferDataRW6(10)<<4|getBufferDataRW6(11)>>4),pe[10]=getBufferDataRW6(11)>>2&3,pe[11]=(3&getBufferDataRW6(11))<<8|getBufferDataRW6(12),pe[12]=1023&(getBufferDataRW6(13)<<2&1020|getBufferDataRW6(14)>>6),pe[13]=1023&(getBufferDataRW6(14)<<4|getBufferDataRW6(15)>>4),fe+=16,de=0},we=xe?14:11,_e=xe?128:512,Ce=xe?2048:8192,Se=xe?16383:65535,Te=xe?4095:16383,Ae=oe/we,De=16*Ae,ke=xe?18:14;for(re=0;re<se-15;re+=16){var Le=Math.min(16,se-re),Ee=De*Le;for(ye=new Uint8Array(ae,p+le,Ee),fe=0,le+=Ee,ie=0,ne=0;ie<Le;ie++,ne=0){ve=(re+ie)*oe;for(var Ie=0;Ie<Ae;Ie++)for(Me(),resetPredNonzeros(),V=0,te=0,I=0;I<we;I++){if(ee=1&I,I%3==2){var Be=de<ke?pe[de++]:0;3==Be&&(Be=4),te=_e<<Be,V=1<<Be}var Oe=de<ke?pe[de++]:0;me[ee]?(Oe*=V,te<Ce&&ge[ee]>te&&(Oe+=ge[ee]-te),ge[ee]=Oe):(me[ee]=Oe,Oe?ge[ee]=Oe:Oe=ge[ee]),be[ve+ne++]=Oe-15<=Se?Oe-15&Se:Oe+2147483633>>31&Te}}}}else if(5==ue){var Re=12==ce?10:9;for(re=0;re<se;re++)for(ne=0;ne<oe;ne+=Re)getDataRaw(0),12==ce?(be[ve++]=((15&pe[1])<<8)+pe[0],be[ve++]=16*pe[2]+(pe[1]>>4),be[ve++]=((15&pe[4])<<8)+pe[3],be[ve++]=16*pe[5]+(pe[4]>>4),be[ve++]=((15&pe[7])<<8)+pe[6],be[ve++]=16*pe[8]+(pe[7]>>4),be[ve++]=((15&pe[10])<<8)+pe[9],be[ve++]=16*pe[11]+(pe[10]>>4),be[ve++]=((15&pe[13])<<8)+pe[12],be[ve++]=16*pe[14]+(pe[13]>>4)):14==ce&&(be[ve++]=pe[0]+((63&pe[1])<<8),be[ve++]=(pe[1]>>6)+4*pe[2]+((15&pe[3])<<10),be[ve++]=(pe[3]>>4)+16*pe[4]+((3&pe[5])<<12),be[ve++]=((252&pe[5])>>2)+(pe[6]<<6),be[ve++]=pe[7]+((63&pe[8])<<8),be[ve++]=(pe[8]>>6)+4*pe[9]+((15&pe[10])<<10),be[ve++]=(pe[10]>>4)+16*pe[11]+((3&pe[12])<<12),be[ve++]=((252&pe[12])>>2)+(pe[13]<<6),be[ve++]=pe[14]+((63&pe[15])<<8))}else{if(4!=ue)throw ue;for(re=0;re<se;re++)for(ne=0;ne<oe;ne++)ee=1&(I=ne%14),0==I&&resetPredNonzeros(),I%3==2&&(V=4>>3-getDataRaw(2)),ge[ee]?0!=(N=getDataRaw(8))&&(me[ee]-=128<<V,(me[ee]<0||4==V)&&(me[ee]&=~(-1<<V)),me[ee]+=N<<V):(ge[ee]=getDataRaw(8),(ge[ee]||I>11)&&(me[ee]=ge[ee]<<4|getDataRaw(4))),be[ve++]=me[1&ne]}},Bf.decode._decodeVC5=function(){var t,h,p,x=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],M=[3,3,3,3,2,2,2,1,1,1];function d(t){var h=t[1],p=t[0][h>>>3]>>>7-(7&h)&1;return t[1]++,p}function ag(h,p){if(null==t){t={};for(var M=0;M<x.length;M+=4)t[x[M+1]]=x.slice(M,M+4)}for(var k=d(h),I=t[k];null==I;)k=k<<1|d(h),I=t[k];var N=I[3];0!=N&&(N=0==d(h)?N:-N),p[0]=I[2],p[1]=N}function m(t,h){for(var p=0;p<h;p++)1==(1&t)&&t++,t>>>=1;return t}function A(t,h){return t>>h}function O(t,h,p,x,M,k){h[p]=A(A(11*t[M]-4*t[M+k]+t[M+k+k]+4,3)+t[x],1),h[p+k]=A(A(5*t[M]+4*t[M+k]-t[M+k+k]+4,3)-t[x],1)}function J(t,h,p,x,M,k){var I=t[M-k]-t[M+k],N=t[M],V=t[x];h[p]=A(A(I+4,3)+N+V,1),h[p+k]=A(A(4-I,3)+N-V,1)}function y(t,h,p,x,M,k){h[p]=A(A(5*t[M]+4*t[M-k]-t[M-k-k]+4,3)+t[x],1),h[p+k]=A(A(11*t[M]-4*t[M-k]+t[M-k-k]+4,3)-t[x],1)}function q(t){return t=p[t=t<0?0:t>4095?4095:t]>>>2}return function av(t,x,k,I,N,V){I=new Uint16Array(I.buffer),Date.now();var ee,te,re,ne,ie,ae,oe,se,ce=Bf._binBE,ue=x+k;x+=4;for(var le=1==V[0];x<ue;){var he=ce.readShort(t,x),fe=ce.readUshort(t,x+2);if(x+=4,12==he)be=fe;else if(20==he)ee=fe;else if(21==he)te=fe;else if(48==he)re=fe;else if(53==he)ne=fe;else if(35==he);else if(62==he)ie=fe;else if(101==he);else if(109==he)ae=fe;else if(84==he);else if(106==he);else if(107==he);else if(108==he);else if(102==he);else if(104==he)Ge=fe;else if(105==he);else{var de=he<0?-he:he,pe=65280&de,me=0;if(24576&de&&(8192&de?(me=65535&fe,me+=(255&de)<<16):me=65535&fe),24576==(24576&de)){if(null==oe){oe=[];for(var ge=0;ge<4;ge++)oe[ge]=new Int16Array((ee>>>1)*(te>>>1));se=new Int16Array((ee>>>1)*(te>>>1)),h=new Int16Array(1024);for(ge=0;ge<1024;ge++){var ve=ge-512,ye=Math.abs(ve),be=Math.floor(768*ye*ye*ye/16581375)+ye;h[ge]=Math.sign(ve)*be}p=new Uint16Array(4096);for(ge=0;ge<4096;ge++){var xe=ge,Me=65535*(Math.pow(113,xe/4095)-1)/112;p[ge]=Math.min(Me,65535)}}var we=oe[ie],_e=m(ee,1+M[re]),Ce=m(te,1+M[re]);if(0==re)for(var Se=0;Se<Ce;Se++)for(var Te=0;Te<_e;Te++){var Ae=x+2*(Se*_e+Te);we[Se*(ee>>>1)+Te]=t[Ae]<<8|t[Ae+1]}else{var De=[t,8*x],ke=[],Le=0,Ee=_e*Ce,Ie=[0,0],Be=0;for(fe=0;Le<Ee;)for(ag(De,Ie),Be=Ie[0],fe=Ie[1];Be>0;)ke[Le++]=fe,Be--;var Oe=(re-1)%3,Re=1!=Oe?_e:0,Fe=0!=Oe?Ce:0;for(Se=0;Se<Ce;Se++){var Ne=(Se+Fe)*(ee>>>1)+Re,Ve=Se*_e;for(Te=0;Te<_e;Te++)we[Ne+Te]=h[ke[Ve+Te]+512]*ne}if(2==Oe){var Ge=ee>>>1,je=2*_e,Ue=2*Ce;for(Se=0;Se<Ce;Se++)for(Te=0;Te<je;Te++){ge=2*Se*Ge+Te;var ze=Ce*Ge+(He=Se*Ge+Te);0==Se?O(we,se,ge,ze,He,Ge):Se==Ce-1?y(we,se,ge,ze,He,Ge):J(we,se,ge,ze,He,Ge)}var We=we;we=se,se=We;for(Se=0;Se<Ue;Se++)for(Te=0;Te<_e;Te++){var He;ge=Se*Ge+2*Te,ze=_e+(He=Se*Ge+Te);0==Te?O(we,se,ge,ze,He,1):Te==_e-1?y(we,se,ge,ze,He,1):J(we,se,ge,ze,He,1)}We=we;we=se,se=We;for(var $e=[],Xe=2-~~((re-1)/3),qe=0;qe<3;qe++)$e[qe]=ae>>14-2*qe&3;var Ke=$e[Xe];if(0!=Ke)for(Se=0;Se<Ue;Se++)for(Te=0;Te<je;Te++){we[ge=Se*Ge+Te]=we[ge]<<Ke}}}if(9==re&&3==ie){var Ye=oe[0],Ze=oe[1],Je=oe[2],Qe=oe[3];for(Se=0;Se<te;Se+=2)for(Te=0;Te<ee;Te+=2){var et=Se*ee+Te,tt=Ye[Ae=(Se>>>1)*(ee>>>1)+(Te>>>1)],rt=Ze[Ae]-2048,nt=Je[Ae]-2048,it=Qe[Ae]-2048,ot=(rt<<1)+tt,st=(nt<<1)+tt,ct=tt+it,ut=tt-it;le?(I[et]=q(ct),I[et+1]=q(st),I[et+ee]=q(ot),I[et+ee+1]=q(ut)):(I[et]=q(ot),I[et+1]=q(ct),I[et+ee]=q(ut),I[et+ee+1]=q(st))}}x+=4*me}else if(16388==de)x+=4*me;else if(8192!=pe&&8448!=pe&&9216!=pe)throw de.toString(16)}}}}(),Bf.decode._decodeLogLuv32=function(t,h,p,x,M,k){for(var I=t.width,N=4*I,V=0,ee=new Uint8Array(N);V<x;){for(var te=0;te<N;){var re=h[p+V];if(V++,re<128){for(var ne=0;ne<re;ne++)ee[te+ne]=h[p+V+ne];te+=re,V+=re}else{re-=126;for(ne=0;ne<re;ne++)ee[te+ne]=h[p+V];te+=re,V++}}for(var ie=0;ie<I;ie++)M[k+0]=ee[ie],M[k+1]=ee[ie+I],M[k+2]=ee[ie+2*I],M[k+4]=ee[ie+3*I],k+=6}},Bf.decode._ljpeg_diff=function(t,h,p){var x,M,k=Bf.decode._getbithuff;return x=k(t,h,p[0],p),0==((M=k(t,h,x,0))&1<<x-1)&&(M-=(1<<x)-1),M},Bf.decode._decodeARW=function(t,h,p,x,M,k){var I=t.t256[0],N=t.t257[0],V=t.t258[0],ee=t.isLE?Bf._binLE:Bf._binBE;if(I*N==x||I*N*1.5==x)if(I*N*1.5!=x){var te,re,ne,ie,ae,oe,se,ce,ue=new Uint16Array(16),le=new Uint8Array(I+1);for(ye=0;ye<N;ye++){for(var he=0;he<I;he++)le[he]=h[p++];for(ce=0,ve=0;ve<I-30;ce+=16){for(re=2047&(te=ee.readUint(le,ce)),ne=2047&te>>>11,ie=15&te>>>22,ae=15&te>>>26,oe=0;oe<4&&128<<oe<=re-ne;oe++);for(se=30,fe=0;fe<16;fe++)fe==ie?ue[fe]=re:fe==ae?ue[fe]=ne:(ue[fe]=((ee.readUshort(le,ce+(se>>3))>>>(7&se)&127)<<oe)+ne,ue[fe]>2047&&(ue[fe]=2047),se+=7);for(fe=0;fe<16;fe++,ve+=2){Te=ue[fe]<<1;Bf.decode._putsF(M,(ye*I+ve)*V,Te<<16-V)}ve-=1&ve?1:31}}}else for(var fe=0;fe<x;fe+=3){var de=h[p+fe+0],pe=h[p+fe+1],me=h[p+fe+2];M[k+fe]=pe<<4|de>>>4,M[k+fe+1]=de<<4|me>>>4,M[k+fe+2]=me<<4|pe>>>4}else{N+=8;var ge,ve,ye,be=[p,0,0,0],xe=new Uint16Array(32770),Me=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],we=0,_e=Bf.decode._ljpeg_diff;for(xe[0]=15,ge=fe=0;fe<18;fe++)for(var Ce=32768>>>(Me[fe]>>>8),Se=0;Se<Ce;Se++)xe[++ge]=Me[fe];for(ve=I;ve--;)for(ye=0;ye<N+1;ye+=2)if(ye==N&&(ye=1),we+=_e(h,be,xe),ye<N){var Te=4095&we;Bf.decode._putsF(M,(ye*I+ve)*V,Te<<16-V)}}},Bf.decode._decodeNikon=function(t,h,p,x,M,k,I){var N=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],V=t.t256[0],ee=t.t257[0],te=t.t258[0],re=0,ne=0,ie=Bf.decode._make_decoder,ae=Bf.decode._getbithuff,oe=h[0].exifIFD.makerNote,se=oe.t150?oe.t150:oe.t140,ce=0,ue=se[ce++],le=se[ce++];73!=ue&&88!=le||(ce+=2110),70==ue&&(re=2),14==te&&(re+=3);for(var he=[[0,0],[0,0]],fe=t.isLE?Bf._binLE:Bf._binBE,de=0;de<2;de++)for(var pe=0;pe<2;pe++)he[de][pe]=fe.readShort(se,ce),ce+=2;var me,ge,ve,ye,be,xe=1<<te&32767,Me=0,we=fe.readShort(se,ce);ce+=2,we>1&&(Me=Math.floor(xe/(we-1))),68==ue&&32==le&&Me>0&&(ne=fe.readShort(se,562));var _e=[0,0],Ce=ie(N[re]),Se=[x,0,0,0];for(me=0;me<ee;me++)for(ne&&me==ne&&(Ce=ie(N[re+1])),ge=0;ge<V;ge++){de=ae(p,Se,Ce[0],Ce),0==((be=1+(ae(p,Se,(ve=15&de)-(ye=de>>>4),0)<<1)<<ye>>>1)&1<<ve-1)&&(be-=(1<<ve)-(0==ye?1:0)),ge<2?_e[ge]=he[1&me][ge]+=be:_e[1&ge]+=be;var Te=Math.min(Math.max(_e[1&ge],0),(1<<te)-1),Ae=(me*V+ge)*te;Bf.decode._putsF(k,Ae,Te<<16-te)}},Bf.decode._putsF=function(t,h,p){p<<=8-(7&h);var x=h>>>3;t[x]|=p>>>16,t[x+1]|=p>>>8,t[x+2]|=p},Bf.decode._getbithuff=function(t,h,p,x){var M;Bf.decode._get_byte;var k=h[0],I=h[1],N=h[2],V=h[3];if(0==p||N<0)return 0;for(;!V&&N<p&&-1!=(M=t[k++])&&!(V=0);)I=(I<<8)+M,N+=8;if(M=I<<32-N>>>32-p,x?(N-=x[M+1]>>>8,M=255&x[M+1]):N-=p,N<0)throw"e";return h[0]=k,h[1]=I,h[2]=N,h[3]=V,M},Bf.decode._make_decoder=function(t){var h,p,x,M,k,I=[];for(h=16;0!=h&&!t[h];h--);var N=17;for(I[0]=h,x=p=1;p<=h;p++)for(M=0;M<t[p];M++,++N)for(k=0;k<1<<h-p;k++)x<=1<<h&&(I[x++]=p<<8|t[N]);return I},Bf.decode._decodeNewJPEG=function(t,h,p,x,M,k){x=Math.min(x,h.length-p);var I=t.t347,N=I?I.length:0,V=new Uint8Array(N+x);if(I){for(var ee=0,te=0;te<N-1&&(255!=I[te]||217!=I[te+1]);te++)V[ee++]=I[te];var re=h[p],ne=h[p+1];255==re&&216==ne||(V[ee++]=re,V[ee++]=ne);for(te=2;te<x;te++)V[ee++]=h[p+te]}else for(te=0;te<x;te++)V[te]=h[p+te];if(32803==t.t262[0]||7==t.t259[0]&&34892==t.t262[0]){var ie=t.t258[0],ae=Bf.LosslessJpegDecode(V),oe=ae.length;if(16==ie)if(t.isLE)for(te=0;te<oe;te++)M[k+(te<<1)]=255&ae[te],M[k+(te<<1)+1]=ae[te]>>>8;else for(te=0;te<oe;te++)M[k+(te<<1)]=ae[te]>>>8,M[k+(te<<1)+1]=255&ae[te];else if(14==ie||12==ie||10==ie){var se=16-ie;for(te=0;te<oe;te++)Bf.decode._putsF(M,te*ie,ae[te]<<se)}else{if(8!=ie)throw new Error("unsupported bit depth "+ie);for(te=0;te<oe;te++)M[k+te]=ae[te]}}else{var ce=new Bf.JpegDecoder;ce.parse(V);var ue=ce.getData({width:ce.width,height:ce.height,forceRGB:!0,isSourcePDF:!1});for(te=0;te<ue.length;te++)M[k+te]=ue[te]}6==t.t262[0]&&(t.t262[0]=2)},Bf.decode._decodeOldJPEGInit=function(t,h,p,x){var M,k,I,N,V,ee=216,te=0,re=0,ne=!1,ie=t.t513,ae=ie?ie[0]:0,oe=t.t514,se=oe?oe[0]:0,ce=t.t324||t.t273||ie,ue=t.t530,le=0,he=0,fe=t.t277?t.t277[0]:1,de=t.t515;if(ce&&(re=ce[0],ne=ce.length>1),!ne){if(255==h[p]&&h[p+1]==ee)return{jpegOffset:p};if(null!=ie&&(255==h[p+ae]&&h[p+ae+1]==ee?te=p+ae:log("JPEGInterchangeFormat does not point to SOI"),null==oe?log("JPEGInterchangeFormatLength field is missing"):(ae>=re||ae+se<=re)&&log("JPEGInterchangeFormatLength field value is invalid"),null!=te))return{jpegOffset:te}}if(null!=ue&&(le=ue[0],he=ue[1]),null!=ie&&null!=oe)if(se>=2&&ae+se<=re){for(M=255==h[p+ae+se-2]&&h[p+ae+se-1]==ee?new Uint8Array(se-2):new Uint8Array(se),I=0;I<M.length;I++)M[I]=h[p+ae+I];log("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else log("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(null==M){var pe=0,me=[];me[pe++]=255,me[pe++]=ee;var ge=t.t519;if(null==ge)throw new Error("JPEGQTables tag is missing");for(I=0;I<ge.length;I++)for(me[pe++]=255,me[pe++]=219,me[pe++]=0,me[pe++]=67,me[pe++]=I,N=0;N<64;N++)me[pe++]=h[p+ge[I]+N];for(V=0;V<2;V++){var ve=t[0==V?"t520":"t521"];if(null==ve)throw new Error((0==V?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(I=0;I<ve.length;I++){me[pe++]=255,me[pe++]=196;var ye=19;for(N=0;N<16;N++)ye+=h[p+ve[I]+N];for(me[pe++]=ye>>>8,me[pe++]=255&ye,me[pe++]=I|V<<4,N=0;N<16;N++)me[pe++]=h[p+ve[I]+N];for(N=0;N<ye;N++)me[pe++]=h[p+ve[I]+16+N]}}if(me[pe++]=255,me[pe++]=192,me[pe++]=0,me[pe++]=8+3*fe,me[pe++]=8,me[pe++]=t.height>>>8&255,me[pe++]=255&t.height,me[pe++]=t.width>>>8&255,me[pe++]=255&t.width,me[pe++]=fe,1==fe)me[pe++]=1,me[pe++]=17,me[pe++]=0;else for(I=0;I<3;I++)me[pe++]=I+1,me[pe++]=0!=I?17:(15&le)<<4|15&he,me[pe++]=I;null!=de&&0!=de[0]&&(me[pe++]=255,me[pe++]=221,me[pe++]=0,me[pe++]=4,me[pe++]=de[0]>>>8&255,me[pe++]=255&de[0]),M=new Uint8Array(me)}var be=-1;for(I=0;I<M.length-1;){if(255==M[I]&&192==M[I+1]){be=I;break}I++}if(-1==be){var xe=new Uint8Array(M.length+10+3*fe);xe.set(M);var Me=M.length;if(be=M.length,(M=xe)[Me++]=255,M[Me++]=192,M[Me++]=0,M[Me++]=8+3*fe,M[Me++]=8,M[Me++]=t.height>>>8&255,M[Me++]=255&t.height,M[Me++]=t.width>>>8&255,M[Me++]=255&t.width,M[Me++]=fe,1==fe)M[Me++]=1,M[Me++]=17,M[Me++]=0;else for(I=0;I<3;I++)M[Me++]=I+1,M[Me++]=0!=I?17:(15&le)<<4|15&he,M[Me++]=I}if(255==h[re]&&218==h[re+1]){var we=h[re+2]<<8|h[re+3];for((k=new Uint8Array(we+2))[0]=h[re],k[1]=h[re+1],k[2]=h[re+2],k[3]=h[re+3],I=0;I<we-2;I++)k[I+4]=h[re+I+4]}else{var _e=0;if((k=new Uint8Array(8+2*fe))[_e++]=255,k[_e++]=218,k[_e++]=0,k[_e++]=6+2*fe,k[_e++]=fe,1==fe)k[_e++]=1,k[_e++]=0;else for(I=0;I<3;I++)k[_e++]=I+1,k[_e++]=I<<4|I;k[_e++]=0,k[_e++]=63,k[_e++]=0}return{jpegOffset:p,tables:M,sosMarker:k,sofPosition:be}},Bf.decode._decodeOldJPEG=function(t,h,p,x,M,k){var I,N,V,ee,te=Bf.decode._decodeOldJPEGInit(t,h,p,x);if(null!=te.jpegOffset)for(I=p+x-te.jpegOffset,V=new Uint8Array(I),ie=0;ie<I;ie++)V[ie]=h[te.jpegOffset+ie];else{for(N=te.tables.length,(V=new Uint8Array(N+te.sosMarker.length+x+2)).set(te.tables),ee=N,V[te.sofPosition+5]=t.height>>>8&255,V[te.sofPosition+6]=255&t.height,V[te.sofPosition+7]=t.width>>>8&255,V[te.sofPosition+8]=255&t.width,255==h[p]&&h[p+1]==SOS||(V.set(te.sosMarker,ee),ee+=sosMarker.length),ie=0;ie<x;ie++)V[ee++]=h[p+ie];V[ee++]=255,V[ee++]=EOI}var re=new Bf.JpegDecoder;re.parse(V);for(var ne=re.getData({width:re.width,height:re.height,forceRGB:!0,isSourcePDF:!1}),ie=0;ie<ne.length;ie++)M[k+ie]=ne[ie];t.t262&&6==t.t262[0]&&(t.t262[0]=2)},Bf.decode._decodePackBits=function(t,h,p,x,M){for(var k=new Int8Array(t.buffer),I=new Int8Array(x.buffer),N=h+p;h<N;){var V=k[h];if(h++,V>=0&&V<128)for(var ee=0;ee<V+1;ee++)I[M]=k[h],M++,h++;if(V>=-127&&V<0){for(ee=0;ee<1-V;ee++)I[M]=k[h],M++;h++}}return M},Bf.decode._decodeThunder=function(t,h,p,x,M){for(var k=[0,1,0,-1],I=[0,1,2,3,0,-3,-2,-1],N=h+p,V=2*M,ee=0;h<N;){var te=t[h],re=te>>>6,ne=63&te;if(h++,3==re&&(ee=15&ne,x[V>>>1]|=ee<<4*(1-V&1),V++),0==re)for(var ie=0;ie<ne;ie++)x[V>>>1]|=ee<<4*(1-V&1),V++;if(2==re)for(ie=0;ie<2;ie++){4!=(ae=ne>>>3*(1-ie)&7)&&(ee+=I[ae],x[V>>>1]|=ee<<4*(1-V&1),V++)}if(1==re)for(ie=0;ie<3;ie++){var ae;2!=(ae=ne>>>2*(2-ie)&3)&&(ee+=k[ae],x[V>>>1]|=ee<<4*(1-V&1),V++)}}},Bf.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},Bf.decode._lens=function(){var t=function addKeys(t,h,p,x){for(var M=0;M<h.length;M++)t[h[M]]=p+M*x},h="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",p="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",x="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",M="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",k="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";h=h.split(","),p=p.split(","),x=x.split(","),M=M.split(","),k=k.split(",");var I={},N={};return t(I,h,0,1),t(I,x,64,64),t(I,k,1792,64),t(N,p,0,1),t(N,M,64,64),t(N,k,1792,64),[I,N]}(),Bf.decode._decodeG4=function(t,h,p,x,M,k,I){for(var N=Bf.decode,V=h<<3,ee=0,te="",re=[],ne=[],ie=0;ie<k;ie++)ne.push(0);ne=N._makeDiff(ne);for(var ae=0,oe=0,se=0,ce=0,ue=0,le=0,he="",fe=0,de=8*Math.ceil(k/8);V>>>3<h+p;){se=N._findDiff(ne,ae+(0==ae?0:1),1-ue),ce=N._findDiff(ne,se,ue);var pe=0;if(1==I&&(pe=t[V>>>3]>>>7-(7&V)&1),2==I&&(pe=t[V>>>3]>>>(7&V)&1),V++,te+=pe,"H"==he){if(null!=N._lens[ue][te]){var me=N._lens[ue][te];te="",ee+=me,me<64&&(N._addNtimes(re,ee,ue),ae+=ee,ue=1-ue,ee=0,0==--fe&&(he=""))}}else"0001"==te&&(te="",N._addNtimes(re,ce-ae,ue),ae=ce),"001"==te&&(te="",he="H",fe=2),null!=N._dmap[te]&&(oe=se+N._dmap[te],N._addNtimes(re,oe-ae,ue),ae=oe,te="",ue=1-ue);re.length==k&&""==he&&(N._writeBits(re,x,8*M+le*de),ue=0,le++,ae=0,ne=N._makeDiff(re),re=[])}},Bf.decode._findDiff=function(t,h,p){for(var x=0;x<t.length;x+=2)if(t[x]>=h&&t[x+1]==p)return t[x]},Bf.decode._makeDiff=function(t){var h=[];1==t[0]&&h.push(0,1);for(var p=1;p<t.length;p++)t[p-1]!=t[p]&&h.push(p,t[p]);return h.push(t.length,0,t.length,1),h},Bf.decode._decodeG2=function(t,h,p,x,M,k,I){for(var N=Bf.decode,V=h<<3,ee=0,te="",re=[],ne=0,ie=0,ae=8*Math.ceil(k/8);V>>>3<h+p;){var oe=0;1==I&&(oe=t[V>>>3]>>>7-(7&V)&1),2==I&&(oe=t[V>>>3]>>>(7&V)&1),V++,te+=oe,null!=(ee=N._lens[ne][te])&&(N._addNtimes(re,ee,ne),te="",ee<64&&(ne=1-ne),re.length==k&&(N._writeBits(re,x,8*M+ie*ae),re=[],ie++,ne=0,0!=(7&V)&&(V+=8-(7&V)),ee>=64&&(V+=8)))}},Bf.decode._decodeG3=function(t,h,p,x,M,k,I,N){for(var V=Bf.decode,ee=h<<3,te=0,re="",ne=[],ie=[],ae=0;ae<k;ae++)ne.push(0);for(var oe=0,se=0,ce=0,ue=0,le=0,he=-1,fe="",de=0,pe=!0,me=8*Math.ceil(k/8);ee>>>3<h+p;){ce=V._findDiff(ie,oe+(0==oe?0:1),1-le),ue=V._findDiff(ie,ce,le);var ge=0;if(1==I&&(ge=t[ee>>>3]>>>7-(7&ee)&1),2==I&&(ge=t[ee>>>3]>>>(7&ee)&1),ee++,re+=ge,pe){if(null!=V._lens[le][re]){var ve=V._lens[le][re];re="",te+=ve,ve<64&&(V._addNtimes(ne,te,le),le=1-le,te=0)}}else if("H"==fe){if(null!=V._lens[le][re]){ve=V._lens[le][re];re="",te+=ve,ve<64&&(V._addNtimes(ne,te,le),oe+=te,le=1-le,te=0,0==--de&&(fe=""))}}else"0001"==re&&(re="",V._addNtimes(ne,ue-oe,le),oe=ue),"001"==re&&(re="",fe="H",de=2),null!=V._dmap[re]&&(se=ce+V._dmap[re],V._addNtimes(ne,se-oe,le),oe=se,re="",le=1-le);re.endsWith("000000000001")&&(he>=0&&V._writeBits(ne,x,8*M+he*me),N&&(1==I&&(pe=1==(t[ee>>>3]>>>7-(7&ee)&1)),2==I&&(pe=1==(t[ee>>>3]>>>(7&ee)&1)),ee++),re="",le=0,he++,oe=0,ie=V._makeDiff(ne),ne=[])}ne.length==k&&V._writeBits(ne,x,8*M+he*me)},Bf.decode._addNtimes=function(t,h,p){for(var x=0;x<h;x++)t.push(p)},Bf.decode._writeBits=function(t,h,p){for(var x=0;x<t.length;x++)h[p+x>>>3]|=t[x]<<7-(p+x&7)},Bf.decode._decodeLZW=Bf.decode._decodeLZW=function(){var t,h,p,x,M=0,k=0,I=0,N=0,V=function O(){var p=t>>>3,x=(h[p]<<16|h[p+1]<<8|h[p+2])>>>24-(7&t)-k&(1<<k)-1;return t+=k,x},ee=new Uint32Array(16384),te=0,re=function i(t){k=t+1,M=N+1},ne=function D(t){for(var h=t<<2,M=ee[h+2],k=x+M-1;65535!=h;)p[k--]=ee[h],h=ee[h+1];x+=M},ie=function L(t,h){var p=M<<2,x=t<<2;ee[p]=ee[3+(h<<2)],ee[p+1]=x,ee[p+2]=ee[x+2]+1,ee[p+3]=ee[x+3],++M+1==1<<k&&12!=k&&k++};return function T(k,ae,oe,se,ce,ue){t=ae<<3,h=k,p=se,x=ce;var le=ae+oe<<3,he=0,fe=0;for(!function m(t){if(t!=te){te=t,N=1+(I=1<<t);for(var h=0;h<N+1;h++)ee[4*h]=ee[4*h+3]=h,ee[4*h+1]=65535,ee[4*h+2]=1}}(ue),re(ue);t<le&&(he=V())!=N;){if(he==I){if(re(ue),(he=V())==N)break;ne(he)}else he<M?(ne(he),ie(fe,he)):(ie(fe,fe),ne(M-1));fe=he}return x}}(),Bf.tags={},Bf._types=function(){var t=new Array(250);t.fill(0);return{basic:{main:t=t.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}(),Bf._readIFD=function(t,h,p,x,M,k){var I=t.readUshort(h,p);p+=2;var N={};k.debug&&log("   ".repeat(M),x.length-1,">>>----------------");for(var V=0;V<I;V++){var ee=t.readUshort(h,p);p+=2;var te=t.readUshort(h,p);p+=2;var re=t.readUint(h,p);p+=4;var ne=t.readUint(h,p);p+=4;var ie=[];if(1==te||7==te){var ae=re<5?p-4:ne;ae+re>h.buffer.byteLength&&(re=h.buffer.byteLength-ae),ie=new Uint8Array(h.buffer,ae,re)}if(2==te){var oe=re<5?p-4:ne,se=h[oe],ce=Math.max(0,Math.min(re-1,h.length-oe));se<128||0==ce?ie.push(t.readASCII(h,oe,ce)):ie=new Uint8Array(h.buffer,oe,ce)}if(3==te)for(var ue=0;ue<re;ue++)ie.push(t.readUshort(h,(re<3?p-4:ne)+2*ue));if(4==te||13==te)for(ue=0;ue<re;ue++)ie.push(t.readUint(h,(re<2?p-4:ne)+4*ue));if(5==te||10==te){var le=5==te?t.readUint:t.readInt;for(ue=0;ue<re;ue++)ie.push([le(h,ne+8*ue),le(h,ne+8*ue+4)])}if(8==te)for(ue=0;ue<re;ue++)ie.push(t.readShort(h,(re<3?p-4:ne)+2*ue));if(9==te)for(ue=0;ue<re;ue++)ie.push(t.readInt(h,(re<2?p-4:ne)+4*ue));if(11==te)for(ue=0;ue<re;ue++)ie.push(t.readFloat(h,ne+4*ue));if(12==te)for(ue=0;ue<re;ue++)ie.push(t.readDouble(h,ne+8*ue));if(0==re||0!=ie.length){if(k.debug&&log("   ".repeat(M),ee,te,Bf.tags[ee],ie),N["t"+ee]=ie,330==ee&&N.t272&&"DSLR-A100"==N.t272[0]);else if(330==ee||34665==ee||34853==ee||50740==ee&&t.readUshort(h,t.readUint(ie,0))<300||61440==ee){var he=50740==ee?[t.readUint(ie,0)]:ie,fe=[];for(ue=0;ue<he.length;ue++)Bf._readIFD(t,h,he[ue],fe,M+1,k);330==ee&&(N.subIFD=fe),34665==ee&&(N.exifIFD=fe[0]),34853==ee&&(N.gpsiIFD=fe[0]),50740==ee&&(N.dngPrvt=fe[0]),61440==ee&&(N.fujiIFD=fe[0])}if(37500==ee&&k.parseMN){var de=ie;if("Nikon"==t.readASCII(de,0,5))N.makerNote=Bf.decode(de.slice(10).buffer)[0];else if("OLYMP"==t.readASCII(de,0,5)||"OM SYSTEM"==t.readASCII(de,0,9)){var pe=[8208,8224,8240,8256,8272],me=[];Bf._readIFD(t,de,77==de[1]?16:85==de[5]?12:8,me,M+1,k);var ge=N.makerNote=me.pop();for(ue=0;ue<pe.length;ue++){var ve="t"+pe[ue];null!=ge[ve]&&(Bf._readIFD(t,de,ge[ve][0],me,M+1,k),ge[ve]=me.pop())}ge.t12288&&(Bf._readIFD(t,ge.t12288,0,me,M+1,k),ge.t12288=me.pop())}else if(t.readUshort(h,ne)<300&&t.readUshort(h,ne+4)<=12){me=[];Bf._readIFD(t,h,ne,me,M+1,k),N.makerNote=me[0]}}}else if(log(ee,"unknown TIFF tag type: ",te,"num:",re),0==V)return}return x.push(N),k.debug&&log("   ".repeat(M),"<<<---------------"),p},Bf._writeIFD=function(t,h,p,x,M){var k=Object.keys(M),I=k.length;M.exifIFD&&I--,M.gpsiIFD&&I--,t.writeUshort(p,x,I);for(var N=(x+=2)+12*I+4,V=0;V<k.length;V++){var ee=k[V];if("t34665"!=ee&&"t34853"!=ee){"exifIFD"==ee&&(ee="t34665"),"gpsiIFD"==ee&&(ee="t34853");var te=parseInt(ee.slice(1)),re=h.main[te];if(null==re&&(re=h.rest[te]),null==re||0==re)throw new Error("unknown type of tag: "+te);var ne=M[ee];if(34665==te)ne=[N],N=Bf._writeIFD(t,h,p,N,M.exifIFD)[1];if(34853==te)ne=[N],N=Bf._writeIFD(t,Bf._types.gps,p,N,M.gpsiIFD)[1];2==re&&(ne=ne[0]+"\0");var ie=ne.length;t.writeUshort(p,x,te),x+=2,t.writeUshort(p,x,re),x+=2,t.writeUint(p,x,ie);var ae=[-1,1,1,2,4,8,0,1,0,4,8,0,8][re]*ie,oe=x+=4;if(ae>4&&(t.writeUint(p,x,N),oe=N),1==re||7==re)for(var se=0;se<ie;se++)p[oe+se]=ne[se];else if(2==re)t.writeASCII(p,oe,ne);else if(3==re)for(se=0;se<ie;se++)t.writeUshort(p,oe+2*se,ne[se]);else if(4==re)for(se=0;se<ie;se++)t.writeUint(p,oe+4*se,ne[se]);else if(5==re||10==re){var ce=5==re?t.writeUint:t.writeInt;for(se=0;se<ie;se++){var ue=ne[se],le=ue[0],he=ue[1];if(null==le)throw"e";ce(p,oe+8*se,le),ce(p,oe+8*se+4,he)}}else if(9==re)for(se=0;se<ie;se++)t.writeInt(p,oe+4*se,ne[se]);else{if(12!=re)throw re;for(se=0;se<ie;se++)t.writeDouble(p,oe+8*se,ne[se])}ae>4&&(N+=ae+=1&ae),x+=4}}return[x,N]},Bf.toRGBA8=function(t,h){function gamma(t){return t<.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}var p=t.width,x=t.height,M=p*x,k=t.data,I=new Uint8Array(4*M),N=t.t262?t.t262[0]:2,V=t.t258?Math.min(32,t.t258[0]):1;null==t.t262&&1==V&&(N=0);var ee=t.t277?t.t277[0]:t.t258?t.t258.length:[1,1,3,1,1,4,3][N],te=t.t339?t.t339[0]:null;if(1==N&&32==V&&3!=te)throw"e";var re=Math.ceil(ee*V*p/8);if(0==N){h=1/256;for(var ne=0;ne<x;ne++){var ie=ne*re,ae=ne*p;if(1==V)for(var oe=0;oe<p;oe++){var se=ae+oe<<2,ce=k[ie+(oe>>3)]>>7-(7&oe)&1;I[se]=I[se+1]=I[se+2]=255*(1-ce),I[se+3]=255}if(4==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[ie+(oe>>1)]>>4-4*(1&oe)&15;I[se]=I[se+1]=I[se+2]=17*(15-ce),I[se+3]=255}if(8==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[ie+oe];I[se]=I[se+1]=I[se+2]=255-ce,I[se+3]=255}if(16==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[(le=ie+2*oe)+1]<<8|k[le];I[se]=I[se+1]=I[se+2]=Math.min(255,255-~~(ce*h)),I[se+3]=255}}}else if(1==N){null==h&&(h=1/256);var ue=0==(3&k.length)?new Float32Array(k.buffer):null;for(ne=0;ne<x;ne++){ie=ne*re,ae=ne*p;if(1==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[ie+(oe>>3)]>>7-(7&oe)&1;I[se]=I[se+1]=I[se+2]=255*ce,I[se+3]=255}if(2==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[ie+(oe>>2)]>>6-2*(3&oe)&3;I[se]=I[se+1]=I[se+2]=85*ce,I[se+3]=255}if(8==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[ie+oe*ee];I[se]=I[se+1]=I[se+2]=ce,I[se+3]=255}if(16==V)for(oe=0;oe<p;oe++){se=ae+oe<<2,ce=k[(le=ie+2*oe)+1]<<8|k[le];I[se]=I[se+1]=I[se+2]=Math.min(255,~~(ce*h)),I[se+3]=255}if(32==V)for(oe=0;oe<p;oe++){var le;se=ae+oe<<2,ce=ue[le=(ie>>>2)+oe];I[se]=I[se+1]=I[se+2]=~~(.5+255*ce),I[se+3]=255}}}else if(2==N)if(8==V){if(1==ee)for(oe=0;oe<M;oe++)I[4*oe]=I[4*oe+1]=I[4*oe+2]=k[oe],I[4*oe+3]=255;if(3==ee)for(oe=0;oe<M;oe++){var he=3*oe;I[se=oe<<2]=k[he],I[se+1]=k[he+1],I[se+2]=k[he+2],I[se+3]=255}if(ee>=4)for(oe=0;oe<M;oe++){he=oe*ee;I[se=oe<<2]=k[he],I[se+1]=k[he+1],I[se+2]=k[he+2],I[se+3]=k[he+3]}}else if(16==V){if(4==ee)for(oe=0;oe<M;oe++){he=8*oe+1;I[se=oe<<2]=k[he],I[se+1]=k[he+2],I[se+2]=k[he+4],I[se+3]=k[he+6]}if(3==ee)for(oe=0;oe<M;oe++){he=6*oe+1;I[se=oe<<2]=k[he],I[se+1]=k[he+2],I[se+2]=k[he+4],I[se+3]=255}}else{if(32!=V)throw V;var fe=new Float32Array(k.buffer),de=0;for(oe=0;oe<fe.length;oe++)de=Math.min(de,fe[oe]);if(de<0)for(oe=0;oe<k.length;oe+=4){var pe=k[oe];k[oe]=k[oe+3],k[oe+3]=pe,pe=k[oe+1],k[oe+1]=k[oe+2],k[oe+2]=pe}var me=[];for(oe=0;oe<65536;oe++)me.push(gamma(oe/65535));for(oe=0;oe<fe.length;oe++){var ge=Math.max(0,Math.min(1,fe[oe]));fe[oe]=me[~~(.5+65535*ge)]}if(3==ee)for(oe=0;oe<M;oe++){he=3*oe;I[se=oe<<2]=~~(.5+255*fe[he]),I[se+1]=~~(.5+255*fe[he+1]),I[se+2]=~~(.5+255*fe[he+2]),I[se+3]=255}else{if(4!=ee)throw ee;for(oe=0;oe<M;oe++){he=4*oe;I[se=oe<<2]=~~(.5+255*fe[he]),I[se+1]=~~(.5+255*fe[he+1]),I[se+2]=~~(.5+255*fe[he+2]),I[se+3]=~~(.5+255*fe[he+3])}}}else if(3==N){var ve=t.t320,ye=1<<V,be=8==V&&ee>1&&t.t338&&0!=t.t338[0];for(ne=0;ne<x;ne++)for(var xe=0;xe<p;xe++){se=(oe=ne*p+xe)<<2;var Me=0,we=ne*re;if(1==V)Me=k[we+(xe>>>3)]>>>7-(7&xe)&1;else if(2==V)Me=k[we+(xe>>>2)]>>>6-2*(3&xe)&3;else if(4==V)Me=k[we+(xe>>>1)]>>>4-4*(1&xe)&15;else{if(8!=V)throw V;Me=k[we+xe*ee]}I[se]=ve[Me]>>8,I[se+1]=ve[ye+Me]>>8,I[se+2]=ve[ye+ye+Me]>>8,I[se+3]=be?k[we+xe*ee+1]:255}}else if(5==N){var _e=ee>4?1:0;for(oe=0;oe<M;oe++){se=oe<<2;var Ce=oe*ee;if(window.UDOC){var Se=k[Ce],Te=k[Ce+1],Ae=k[Ce+2],De=k[Ce+3],ke=UDOC.C.cmykToRgb([Se*(1/255),Te*(1/255),Ae*(1/255),De*(1/255)]);I[se]=~~(.5+255*ke[0]),I[se+1]=~~(.5+255*ke[1]),I[se+2]=~~(.5+255*ke[2])}else{Se=255-k[Ce],Te=255-k[Ce+1],Ae=255-k[Ce+2],De=(255-k[Ce+3])*(1/255);I[se]=~~(Se*De+.5),I[se+1]=~~(Te*De+.5),I[se+2]=~~(Ae*De+.5)}I[se+3]=255*(1-_e)+k[Ce+4]*_e}}else if(6==N&&t.t278){var Le=t.t278[0];for(ne=0;ne<x;ne+=Le){oe=ne*p;for(var Ee=Le*p,Ie=0;Ie<Ee;Ie++){se=4*(oe+Ie),Ae=k[(Ce=3*oe+4*(Ie>>>1))+(1&Ie)];var Be=k[Ce+2]-128,Oe=k[Ce+3]-128,Re=Ae+((Oe>>2)+(Oe>>3)+(Oe>>5)),Fe=Ae-((Be>>2)+(Be>>4)+(Be>>5))-((Oe>>1)+(Oe>>3)+(Oe>>4)+(Oe>>5)),Ne=Ae+(Be+(Be>>1)+(Be>>2)+(Be>>6));I[se]=Math.max(0,Math.min(255,Re)),I[se+1]=Math.max(0,Math.min(255,Fe)),I[se+2]=Math.max(0,Math.min(255,Ne)),I[se+3]=255}}}else if(32845==N)for(ne=0;ne<x;ne++)for(xe=0;xe<p;xe++){se=4*(ne*p+xe);var Ve=k[(Ce=6*(ne*p+xe))+1]<<8|k[Ce],Ge=(Ve=Math.pow(2,(Ve+.5)/256-64),(k[Ce+3]+.5)/410),je=(k[Ce+5]+.5)/410,Ue=9*Ge/(6*Ge-16*je+12),ze=4*je/(6*Ge-16*je+12),We=Ue*Ve/ze,He=(1-Ue-ze)*Ve/ze;Re=2.69*We-1.276*(Ae=Ve)-.414*He,Fe=-1.022*We+1.978*Ae+.044*He,Ne=.061*We-.224*Ae+1.163*He;I[se]=255*gamma(Math.min(Re,1)),I[se+1]=255*gamma(Math.min(Fe,1)),I[se+2]=255*gamma(Math.min(Ne,1)),I[se+3]=255}else log("Unknown Photometric interpretation: "+N);return I},Bf.replaceIMG=function(t){null==t&&(t=document.getElementsByTagName("img"));for(var h=["tif","tiff","dng","cr2","nef"],p=0;p<t.length;p++){var x=t[p],M=x.getAttribute("src");if(null!=M){var k=M.split(".").pop().toLowerCase();if(-1!=h.indexOf(k)){var I=new XMLHttpRequest;Bf._xhrs.push(I),Bf._imgs.push(x),I.open("GET",M),I.responseType="arraybuffer",I.onload=Bf._imgLoaded,I.send()}}}},Bf._xhrs=[],Bf._imgs=[],Bf._imgLoaded=function(t){var h=Bf._xhrs.indexOf(t.target),p=Bf._imgs[h];Bf._xhrs.splice(h,1),Bf._imgs.splice(h,1),p.setAttribute("src",Bf.bufferToURI(t.target.response))},Bf.bufferToURI=function(t){var h=Bf.decode(t),p=h,x=0,M=p[0];h[0].subIFD&&(p=p.concat(h[0].subIFD));for(var k=0;k<p.length;k++){var I=p[k];if(!(null==I.t258||I.t258.length<3)){var N=I.t256*I.t257;N>x&&(x=N,M=I)}}Bf.decodeImage(t,M,h);var V=Bf.toRGBA8(M),ee=M.width,te=M.height,re=document.createElement("canvas");re.width=ee,re.height=te;var ne=re.getContext("2d"),ie=new ImageData(new Uint8ClampedArray(V.buffer),ee,te);return ne.putImageData(ie,0,0),re.toDataURL()},Bf._binBE={nextZero:function nextZero(t,h){for(;0!=t[h];)h++;return h},readUshort:function readUshort(t,h){return t[h]<<8|t[h+1]},readShort:function readShort(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+1],p[1]=t[h+0],Bf._binBE.i16[0]},readInt:function readInt(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+3],p[1]=t[h+2],p[2]=t[h+1],p[3]=t[h+0],Bf._binBE.i32[0]},readUint:function readUint(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+3],p[1]=t[h+2],p[2]=t[h+1],p[3]=t[h+0],Bf._binBE.ui32[0]},readASCII:function readASCII(t,h,p){for(var x="",M=0;M<p;M++)x+=String.fromCharCode(t[h+M]);return x},readFloat:function readFloat(t,h){for(var p=Bf._binBE.ui8,x=0;x<4;x++)p[x]=t[h+3-x];return Bf._binBE.fl32[0]},readDouble:function readDouble(t,h){for(var p=Bf._binBE.ui8,x=0;x<8;x++)p[x]=t[h+7-x];return Bf._binBE.fl64[0]},writeUshort:function writeUshort(t,h,p){t[h]=p>>8&255,t[h+1]=255&p},writeInt:function writeInt(t,h,p){var x=Bf._binBE.ui8;Bf._binBE.i32[0]=p,t[h+3]=x[0],t[h+2]=x[1],t[h+1]=x[2],t[h+0]=x[3]},writeUint:function writeUint(t,h,p){t[h]=p>>24&255,t[h+1]=p>>16&255,t[h+2]=p>>8&255,t[h+3]=p>>0&255},writeASCII:function writeASCII(t,h,p){for(var x=0;x<p.length;x++)t[h+x]=p.charCodeAt(x)},writeDouble:function writeDouble(t,h,p){Bf._binBE.fl64[0]=p;for(var x=0;x<8;x++)t[h+x]=Bf._binBE.ui8[7-x]}},Bf._binBE.ui8=new Uint8Array(8),Bf._binBE.i16=new Int16Array(Bf._binBE.ui8.buffer),Bf._binBE.i32=new Int32Array(Bf._binBE.ui8.buffer),Bf._binBE.ui32=new Uint32Array(Bf._binBE.ui8.buffer),Bf._binBE.fl32=new Float32Array(Bf._binBE.ui8.buffer),Bf._binBE.fl64=new Float64Array(Bf._binBE.ui8.buffer),Bf._binLE={nextZero:Bf._binBE.nextZero,readUshort:function readUshort(t,h){return t[h+1]<<8|t[h]},readShort:function readShort(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+0],p[1]=t[h+1],Bf._binBE.i16[0]},readInt:function readInt(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+0],p[1]=t[h+1],p[2]=t[h+2],p[3]=t[h+3],Bf._binBE.i32[0]},readUint:function readUint(t,h){var p=Bf._binBE.ui8;return p[0]=t[h+0],p[1]=t[h+1],p[2]=t[h+2],p[3]=t[h+3],Bf._binBE.ui32[0]},readASCII:Bf._binBE.readASCII,readFloat:function readFloat(t,h){for(var p=Bf._binBE.ui8,x=0;x<4;x++)p[x]=t[h+x];return Bf._binBE.fl32[0]},readDouble:function readDouble(t,h){for(var p=Bf._binBE.ui8,x=0;x<8;x++)p[x]=t[h+x];return Bf._binBE.fl64[0]},writeUshort:function writeUshort(t,h,p){t[h]=255&p,t[h+1]=p>>8&255},writeInt:function writeInt(t,h,p){var x=Bf._binBE.ui8;Bf._binBE.i32[0]=p,t[h+0]=x[0],t[h+1]=x[1],t[h+2]=x[2],t[h+3]=x[3]},writeUint:function writeUint(t,h,p){t[h]=p>>>0&255,t[h+1]=p>>>8&255,t[h+2]=p>>>16&255,t[h+3]=p>>>24&255},writeASCII:Bf._binBE.writeASCII},Bf._copyTile=function(t,h,p,x,M,k,I,N){for(var V=Math.min(h,M-I),ee=Math.min(p,k-N),te=0;te<ee;te++)for(var re=(N+te)*M+I,ne=te*h,ie=0;ie<V;ie++)x[re+ie]=t[ne+ie]},Bf._inflateRaw=function(){var t,h,p={};return p.H={},p.H.N=function(t,h){var x,M,k=Uint8Array,I=0,N=0,V=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0;if(3==t[0]&&0==t[1])return h||new k(0);var oe=p.H,se=oe.b,ce=oe.e,ue=oe.R,le=oe.n,he=oe.A,fe=oe.Z,de=oe.m,pe=null==h;for(pe&&(h=new k(t.length>>>2<<5));0==I;)if(I=se(t,ae,1),N=se(t,ae+1,2),ae+=3,0!=N){if(pe&&(h=p.H.W(h,ie+(1<<17))),1==N&&(x=de.J,M=de.h,re=511,ne=31),2==N){V=ce(t,ae,5)+257,ee=ce(t,ae+5,5)+1,te=ce(t,ae+10,4)+4,ae+=14;for(var me=1,ge=0;ge<38;ge+=2)de.Q[ge]=0,de.Q[ge+1]=0;for(ge=0;ge<te;ge++){var ve=ce(t,ae+3*ge,3);de.Q[1+(de.X[ge]<<1)]=ve,ve>me&&(me=ve)}ae+=3*te,le(de.Q,me),he(de.Q,me,de.u),x=de.w,M=de.d,ae=ue(de.u,(1<<me)-1,V+ee,t,ae,de.v);var ye=oe.V(de.v,0,V,de.C);re=(1<<ye)-1;var be=oe.V(de.v,V,ee,de.D);ne=(1<<be)-1,le(de.C,ye),he(de.C,ye,x),le(de.D,be),he(de.D,be,M)}for(;;){var xe=x[fe(t,ae)&re];ae+=15&xe;var Me=xe>>>4;if(Me>>>8==0)h[ie++]=Me;else{if(256==Me)break;var we=ie+Me-254;if(Me>264){var _e=de.q[Me-257];we=ie+(_e>>>3)+ce(t,ae,7&_e),ae+=7&_e}var Ce=M[fe(t,ae)&ne];ae+=15&Ce;var Se=Ce>>>4,Te=de.c[Se],Ae=(Te>>>4)+se(t,ae,15&Te);for(ae+=15&Te;ie<we;)h[ie]=h[ie++-Ae],h[ie]=h[ie++-Ae],h[ie]=h[ie++-Ae],h[ie]=h[ie++-Ae];ie=we}}}else{0!=(7&ae)&&(ae+=8-(7&ae));var De=4+(ae>>>3),ke=t[De-4]|t[De-3]<<8;pe&&(h=p.H.W(h,ie+ke)),h.set(new k(t.buffer,t.byteOffset+De,ke),ie),ae=De+ke<<3,ie+=ke}return h.length==ie?h:h.slice(0,ie)},p.H.W=function(t,h){var p=t.length;if(h<=p)return t;var x=new Uint8Array(p<<1);return x.set(t,0),x},p.H.R=function(t,h,x,M,k,I){for(var N=p.H.e,V=p.H.Z,ee=0;ee<x;){var te=t[V(M,k)&h];k+=15&te;var re=te>>>4;if(re<=15)I[ee]=re,ee++;else{var ne=0,ie=0;16==re?(ie=3+N(M,k,2),k+=2,ne=I[ee-1]):17==re?(ie=3+N(M,k,3),k+=3):18==re&&(ie=11+N(M,k,7),k+=7);for(var ae=ee+ie;ee<ae;)I[ee]=ne,ee++}}return k},p.H.V=function(t,h,p,x){for(var M=0,k=0,I=x.length>>>1;k<p;){var N=t[k+h];x[k<<1]=0,x[1+(k<<1)]=N,N>M&&(M=N),k++}for(;k<I;)x[k<<1]=0,x[1+(k<<1)]=0,k++;return M},p.H.n=function(t,h){for(var x,M,k,I,N=p.H.m,V=t.length,ee=N.j,te=0;te<=h;te++)ee[te]=0;for(te=1;te<V;te+=2)ee[t[te]]++;var re=N.K;for(x=0,ee[0]=0,M=1;M<=h;M++)x=x+ee[M-1]<<1,re[M]=x;for(k=0;k<V;k+=2)0!=(I=t[k+1])&&(t[k]=re[I],re[I]++)},p.H.A=function(t,h,x){for(var M=t.length,k=p.H.m.r,I=0;I<M;I+=2)if(0!=t[I+1])for(var N=I>>1,V=t[I+1],ee=N<<4|V,te=h-V,re=t[I]<<te,ne=re+(1<<te);re!=ne;){x[k[re]>>>15-h]=ee,re++}},p.H.l=function(t,h){for(var x=p.H.m.r,M=15-h,k=0;k<t.length;k+=2){var I=t[k]<<h-t[k+1];t[k]=x[I]>>>M}},p.H.M=function(t,h,p){p<<=7&h;var x=h>>>3;t[x]|=p,t[x+1]|=p>>>8},p.H.I=function(t,h,p){p<<=7&h;var x=h>>>3;t[x]|=p,t[x+1]|=p>>>8,t[x+2]|=p>>>16},p.H.e=function(t,h,p){return(t[h>>>3]|t[1+(h>>>3)]<<8)>>>(7&h)&(1<<p)-1},p.H.b=function(t,h,p){return(t[h>>>3]|t[1+(h>>>3)]<<8|t[2+(h>>>3)]<<16)>>>(7&h)&(1<<p)-1},p.H.Z=function(t,h){return(t[h>>>3]|t[1+(h>>>3)]<<8|t[2+(h>>>3)]<<16)>>>(7&h)},p.H.i=function(t,h){return(t[h>>>3]|t[1+(h>>>3)]<<8|t[2+(h>>>3)]<<16|t[3+(h>>>3)]<<24)>>>(7&h)},p.H.m=(t=Uint16Array,h=Uint32Array,{K:new t(16),j:new t(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new t(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new t(512),_:[],h:new t(32),$:[],w:new t(32768),C:[],v:[],d:new t(32768),D:[],u:new t(512),Q:[],r:new t(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new t(65536),g:new t(32768)}),function(){for(var t=p.H.m,h=0;h<32768;h++){var x=h;x=(4278255360&(x=(4042322160&(x=(3435973836&(x=(2863311530&x)>>>1|(1431655765&x)<<1))>>>2|(858993459&x)<<2))>>>4|(252645135&x)<<4))>>>8|(16711935&x)<<8,t.r[h]=(x>>>16|x<<16)>>>17}function n(t,h,p){for(;0!=h--;)t.push(0,p)}for(h=0;h<32;h++)t.q[h]=t.S[h]<<3|t.T[h],t.c[h]=t.p[h]<<4|t.z[h];n(t._,144,8),n(t._,112,9),n(t._,24,7),n(t._,8,8),p.H.n(t._,9),p.H.A(t._,9,t.J),p.H.l(t._,9),n(t.$,32,5),p.H.n(t.$,5),p.H.A(t.$,5,t.h),p.H.l(t.$,5),n(t.Q,19,0),n(t.C,286,0),n(t.D,30,0),n(t.v,320,0)}(),p.H.N}(),Bf.LosslessJpegDecode=function(){var t,h;function l(){return t[h++]}function m(){return t[h++]<<8|t[h++]}function a0(t){for(var h=l(),p=[0,0,0,255],x=[],M=0;M<16;M++)x[M]=l();for(M=0;M<16;M++)for(var k=0;k<x[M];k++){p[z(p,0,M+1,1)+3]=l()}var I=new Uint8Array(256);t[h]=[new Uint8Array(p),I];for(M=0;M<256;M++){for(var N=8,V=M,ee=0;255==p[ee+3]&&0!=N;)ee=p[ee+(V>>--N&1)];I[M]=ee}}function z(t,h,p,x){if(255!=t[h+3])return 0;if(0==p)return h;for(var M=0;M<2;M++){0==t[h+M]&&(t[h+M]=t.length,t.push(0,0,x,255));var k=z(t,t[h+M],p-1,x+1);if(0!=k)return k}return 0}function i(t){for(var h=t.b,p=t.f;h<25&&t.a<t.d;){var x=t.data[t.a++];255!=x||t.c||t.a++,p=p<<8|x,h+=8}if(h<0)throw"e";t.b=h,t.f=p}function H(t,h){return h.b<t&&i(h),h.f>>(h.b-=t)&65535>>16-t}function g(t,h){var p=t[0],x=0,M=255;h.b<16&&i(h);var k=h.f>>h.b-8&255;for(M=p[(x=t[1][k])+3],h.b-=p[x+2];255==M;)M=p[(x=p[x+(h.f>>--h.b&1)])+3];return M}function P(t,h){return t<32768>>16-h&&(t+=1-(1<<h)),t}function a2(t,h){var p=g(t,h);return 0==p?0:16==p?-32768:P(H(p,h),p)}function X(t,h,p,x,M,k){for(var I=0,N=0;N<k;N++){for(var V=N*h,ee=0;ee<h;ee+=M){I++;for(var te=0;te<M;te++)t[V+ee+te]=a2(x[te],p)}if(0!=p.e&&I%p.e==0&&0!=N){for(var re=p.a,ne=p.data;255!=ne[re]||!(208<=ne[re+1]&&ne[re+1]<=215);)re--;p.a=re+2,p.f=0,p.b=0}}}function o(t,h){return P(H(t,h),t)}function j(t,h,p,x,M,k,I,N){for(var V=p*I,ee=M;ee<k;ee++)t[ee]+=1<<N-1;for(var te=I;te<V;te+=I)for(ee=M;ee<k;ee++)t[te+ee]+=t[te+ee-I];for(var re=1;re<x;re++){var ne=re*V;for(ee=M;ee<k;ee++)t[ne+ee]+=t[ne+ee-V];for(te=I;te<V;te+=I)for(ee=M;ee<k;ee++){var ie=ne+te+ee,ae=ie-V,oe=t[ie-I],se=0;if(0==h)se=0;else if(1==h)se=oe;else if(2==h)se=t[ae];else if(3==h)se=t[ae-I];else if(4==h)se=oe+(t[ae]-t[ae-I]);else if(5==h)se=oe+(t[ae]-t[ae-I]>>>1);else if(6==h)se=t[ae]+(oe-t[ae-I]>>>1);else{if(7!=h)throw h;se=oe+t[ae]>>>1}t[ie]+=se}}}return function C(p){if(t=p,h=0,65496!=m())throw"e";for(var x=[],M=0,k=0,I=0,N=[],V=[],ee=[],te=0,re=0,ne=0;;){var ie=m();if(65535!=ie){var ae=m();if(65475==ie){k=l(),re=m(),ne=m(),te=l();for(var oe=0;oe<te;oe++){var se=l(),ce=l();if(0!=l())throw"e";x[se]=[oe,ce>>4,15&ce]}}else if(65476==ie)for(var ue=h+ae-2;h<ue;)a0(V);else{if(65498==ie){h++;for(oe=0;oe<te;oe++){var le=x[l()];ee[le[0]]=V[l()>>>4],N[le[0]]=le.slice(1)}M=l(),h+=2;break}65501==ie?I=m():h+=ae-2}}else h--}var he=new(k>8?Uint16Array:Uint8Array)(re*ne*te),fe={b:0,f:0,c:8==M,a:h,data:t,d:t.length,e:I};if(fe.c)!function a1(p,x,M,k,I){for(var N=t.length-h,V=0;V<N;V+=4){var ee=t[h+V];t[h+V]=t[h+V+3],t[h+V+3]=ee,ee=t[h+V+1],t[h+V+1]=t[h+V+2],t[h+V+2]=ee}for(var te=0;te<I;te++)for(var re=32768,ne=32768,ie=0;ie<x;ie+=2){var ae=g(k,M),oe=g(k,M);0!=ae&&(re+=o(ae,M)),0!=oe&&(ne+=o(oe,M)),p[te*x+ie]=65535&re,p[te*x+ie+1]=65535&ne}}(he,ne*te,fe,ee[0],re);else{var de=[],pe=0,me=0;for(oe=0;oe<te;oe++){var ge=N[oe];(Te=ge[0])>pe&&(pe=Te),(Se=ge[1])>me&&(me=Se),de.push(Te*Se)}if(1!=pe||1!=me){if(3!=te||1!=de[1]||1!=de[2])throw"e";if(2!=pe||1!=me&&2!=me)throw"e";var ve=[],ye=0;for(oe=0;oe<te;oe++){for(var be=0;be<de[oe];be++)ve.push(ee[oe]);ye+=de[oe]}var xe=ne/pe,Me=re/me,we=xe*Me;X(he,xe*ye,fe,ve,ye,Me),j(he,M,xe,Me,ye-2,ye,ye,k);var _e=new Uint16Array(we*de[0]);if(2==pe&&2==me){for(oe=0;oe<we;oe++)_e[4*oe]=he[6*oe],_e[4*oe+1]=he[6*oe+1],_e[4*oe+2]=he[6*oe+2],_e[4*oe+3]=he[6*oe+3];j(_e,M,4*xe,Me,0,1,1,k);for(oe=0;oe<we;oe++)he[6*oe]=_e[4*oe],he[6*oe+1]=_e[4*oe+1],he[6*oe+2]=_e[4*oe+2],he[6*oe+3]=_e[4*oe+3]}if(2==pe&&1==me){for(oe=0;oe<we;oe++)_e[2*oe]=he[4*oe],_e[2*oe+1]=he[4*oe+1];j(_e,M,2*xe,Me,0,1,1,k);for(oe=0;oe<we;oe++)he[4*oe]=_e[2*oe],he[4*oe+1]=_e[2*oe+1]}for(var Ce=he.slice(0),Se=0;Se<re;Se++)if(2==me)for(var Te=0;Te<ne;Te++){var Ae=((Se>>>1)*xe+(Te>>>1))*ye,De=2*(1&Se)+(1&Te);he[ke=(Se*ne+Te)*te]=Ce[Ae+De],he[ke+1]=Ce[Ae+4],he[ke+2]=Ce[Ae+5]}else for(Te=0;Te<ne;Te++){var ke;Ae=(Se*xe+(Te>>>1))*ye,De=1&Te;he[ke=(Se*ne+Te)*te]=Ce[Ae+De],he[ke+1]=Ce[Ae+2],he[ke+2]=Ce[Ae+3]}}else if(X(he,ne*te,fe,ee,te,re),0==I)j(he,M,ne,re,0,te,te,k);else{var Le=Math.floor(I/ne);for(Se=0;Se<re;Se+=Le){var Ee=he.slice(Se*ne*te,(Se+Le)*ne*te);j(Ee,M,ne,Le,0,te,te,k),he.set(Ee,Se*ne*te)}}}return he}}(),function(){var t=2,h=4,p=5,x=6,M=7,k=12,I=13,N=14,V=15,ee=17;function a2(t){var h={c:new Int8Array(2<<t.u)};return function a1(t,h,p){var x=[h,3*h+18,5*h+67,7*h+276,p];t.o=h,t.w=(x[4]+2*h)/(2*h+1)+1|0,t.v=Math.ceil(Math.log2(t.w)),t.t=9,function a6(t,h){for(var p=-h[4],x=0;p<=h[4];x++,p++)t[x]=p<=-h[3]?-4:p<=-h[2]?-3:p<=-h[1]?-2:p<-h[0]?-1:p<=h[0]?0:p<h[1]?1:p<h[2]?2:p<h[3]?3:4}(t.c,x)}(h,0,t.g),h}function D(t){for(var h=[[],[],[]],p=Math.max(2,t.w+32>>>6),x=0;x<3;x++)for(var M=0;M<41;M++)h[x][M]=[p,1];return h}function K(t,h){var p=0,x=8-t.a;if(t.j,t.a,h){if(h>=x)do{p<<=x,h-=x,p|=t[t.j]&(1<<x)-1,t.j++,x=8}while(h>=8);h&&(p<<=h,x-=h,p|=t[t.j]>>>x&(1<<h)-1),t.a=8-x}return p}function r(t,h,p,x,M,k,I,N){null==N&&(N=0);var V,ee,te,re,ne,ie,ae=k+1,oe=ae%2,se=0,ce=x[M],ue=x[M-1],le=x[M-2][ae],he=ue[ae-1],fe=ue[ae],de=ue[ae+1],pe=ce[ae-1],me=ce[ae+1],ge=Math.abs;if(oe&&(te=ge(de-fe),re=ge(le-fe),ne=ge(he-fe)),oe){if(ie=(ie=te>ne&&re<te?le+he:te<ne&&re<ne?le+de:de+he)+2*fe>>>2,N)return void(ce[ae]=ie);V=h.t*h.c[t.g+fe-le]+h.c[t.g+he-fe]}else ie=fe>he&&fe>de||fe<he&&fe<de?me+pe+2*fe>>>2:pe+me>>>1,V=h.t*h.c[t.g+fe-he]+h.c[t.g+he-pe];ee=ge(V);var ve=function a4(t){for(var h=-1,p=0;!p;h++)p=t[t.j]>>>7-t.a&1,t.a++,t.a&=7,t.a||t.j++;return h}(p);if(ve<t.n-h.v-1){var ye=function a0(t,h){var p=0;if(h<t)for(;p<=14&&h<<++p<t;);return p}(I[ee][0],I[ee][1]);se=K(p,ye)+(ve<<ye)}else se=K(p,h.v)+1;se=1&se?-1-(se>>>1):se>>>1,I[ee][0]+=ge(se),I[ee][1]==t.f&&(I[ee][0]>>>=1,I[ee][1]>>>=1),I[ee][1]++,ie=V<0?ie-se:ie+se,t.i&&(ie<0?ie+=h.w:ie>t.g&&(ie-=h.w)),ce[ae]=ie>=0?Math.min(ie,t.g):0}function U(t,h,p){for(var x=t[0].length,M=h;M<=p;M++)t[M][0]=t[M-1][1],t[M][x-1]=t[M-1][x-2]}function B(p){U(p,M,k),U(p,t,h),U(p,V,ee)}function _(t,p,x,M,k,N,V,ee,te,re,ne,ie,ae){for(var oe=0,se=1,ce=k<I&&k>h;se<t.m;)oe<t.m&&(r(t,p,x,M,k,oe,V[te],t.h&&(ce&&re||!ce&&(ne||(oe&ie)==ae))),r(t,p,x,M,N,oe,V[te],t.h&&(!ce&&re||ce&&(ne||(oe&ie)==ae))),oe+=2),oe>8&&(r(t,p,x,M,k,se,ee[te]),r(t,p,x,M,N,se,ee[te]),se+=2);B(M)}function a8(p,x,I,N,te,re){_(p,x,I,N,t,M,te,re,0,0,1,0,8),_(p,x,I,N,8,V,te,re,1,0,1,0,8),_(p,x,I,N,3,9,te,re,2,1,0,3,0),_(p,x,I,N,10,16,te,re,0,0,0,3,2),_(p,x,I,N,h,11,te,re,1,0,0,3,2),_(p,x,I,N,k,ee,te,re,2,1,0,3,0)}function a9(h,p,x,k,I,N){var ee=N.length,te=h.l;I+1==h.s&&(te=h.e-I*h.l);for(var re=6*h.e*k+I*h.l,ne=0;ne<6;ne++){for(var ie=0;ie<te;ie++){var ae,oe=N[ne%ee][ie%ee];ae=0==oe?t+(ne>>>1):2==oe?V+(ne>>>1):M+ne;var se=h.h?(2*ie/3&2147483646|ie%3&1)+(ie%3>>>1):ie>>>1;p[re+ie]=x[ae][se+1]}re+=h.e}}Bf._decompressRAF=function(M,V){var te=function a5(t){var h=Bf._binBE.readUshort,p={b:h(t,0),i:t[2],C:t[3],u:t[4],q:h(t,5),k:h(t,7),e:h(t,9),l:h(t,11),s:t[13],d:h(t,14)};if(18771!=p.b||p.i>1||p.q<6||p.q%6||p.e<768||p.e%24||768!=p.l||p.k<p.l||p.k%p.l||p.k-p.e>=p.l||p.s>16||p.s!=p.k/p.l||p.s!=Math.ceil(p.e/p.l)||p.d!=p.q/6||12!=p.u&&14!=p.u&&16!=p.u||16!=p.C&&0!=p.C)throw"Invalid data";if(0==p.i)throw"Not implemented. We need this file!";return p.h=16==p.C,p.m=0|(p.h?2*p.l/3:p.l>>>1),p.A=p.m+2,p.f=64,p.g=(1<<p.u)-1,p.n=4*p.u,p}(M),re=function a7(t,h){var p=new Array(h.s),x=4*h.s,M=16+x;12&x&&(M+=16-(12&x));for(var k=0,I=16;k<h.s;I+=4){var N=Bf._binBE.readUint(t,I);p[k]=t.slice(M,M+N),p[k].j=0,p[k].a=0,M+=N,k++}if(M!=t.length)throw"Invalid data";return p}(M,te),ne=a2(te),ie=new Int16Array(te.e*te.q);null==V&&(V=te.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var ae=[[0,3],[1,h],[p,11],[x,k],[I,16],[N,ee]],oe=[],se=0;se<18;se++)oe[se]=new Uint16Array(te.A);for(var ce=0;ce<te.s;ce++){var ue=D(ne),le=D(ne);for(se=0;se<18;se++)for(var he=0;he<te.A;he++)oe[se][he]=0;for(var fe=0;fe<te.d;fe++){a8(te,ne,re[ce],oe,ue,le);for(se=0;se<6;se++)for(he=0;he<te.A;he++)oe[ae[se][0]][he]=oe[ae[se][1]][he];a9(te,ie,oe,fe,ce,V);for(se=t;se<18;se++)if(-1==[p,x,I,N].indexOf(se))for(he=0;he<te.A;he++)oe[se][he]=0;B(oe)}}return ie}}();var Of=function(t){_inherits$1(TIFFLoader,t);var h=_createSuper(TIFFLoader);function TIFFLoader(t){return _classCallCheck$1(this,TIFFLoader),h.call(this,t)}return _createClass$1(TIFFLoader,[{key:"parse",value:function parse(t){var h=Bf.decode(t);Bf.decodeImage(t,h[0]);var p=Bf.toRGBA8(h[0]);return{width:h[0].width,height:h[0].height,data:p,flipY:!0,magFilter:Ho,minFilter:Xo}}}]),TIFFLoader}(DataTextureLoader),Rf=function(){function MxTIFFLoader(){_classCallCheck$1(this,MxTIFFLoader),_defineProperty(this,"imp",new Of)}return _createClass$1(MxTIFFLoader,[{key:"load",value:function load(t,h,p){this.imp.load(t,h,void 0,p)}}]),MxTIFFLoader}();const Ff=Object.freeze(Object.defineProperty({__proto__:null,b64Encode:b64Encode,b64Decode:b64Decode,crateHexString:crateHexString,saveAsFileDialog:saveAsFileDialog,downloadFile:downloadFile,downloadFileFromUrl:downloadFileFromUrl,getJsonFromUrl:ae,getFileFromUrl:oe,_ML_String:_ML_String,IsZero:IsZero,postMemoryFile:postMemoryFile,postEmscriptenIndexedDBFile:postEmscriptenIndexedDBFile,createCursor:createCursor,MxTools:se,MxCanvas2Image:ue,McGePoint3d:rn,McGeVector3d:nn,McGeMatrix3d:sn,McGeLongArray:cn,McGeStringArray:un,McGePoint3dArray:ln,McGeDoubleArray:hn,McGeBound:fn,MxCoordConvertType:yt,get MxCoordConvert(){return t.MxCoordConvert},getFilterImp:getFilterImp,MxCADResbuf:bt,MxCADUtilityClass:xt,MxCADUtility:Mt,MxCADSelectionSetStatus:wt,MxCADSelectionSet:_t,MxCADUiPrBase:Ct,MxCADUiPrPoint:St,MxCADUiPrDist:Tt,MxCADUiPrAngle:At,MxCADUiPrInt:Dt,MxCADUiPrKeyWord:kt,MxCADUiPrString:Pt,MxCADUiPrEntity:Lt,McRxObject:dt,McObjectIdType:pt,McObjectId:mt,McDbObject:gt,McDbObjectArray:vt,DxfCode:_r,get McDb(){return t.McDb},McCmColor:Cr,McDbLinetypeTableRecord:Sr,McDbDimStyleTableRecord:Tr,McDbTextStyleTableRecord:Ar,McDbLayerTableRecord:Dr,McDbLayerTable:kr,McDbLinetypeTable:Pr,McDbDimStyleTable:Lr,McDbTextStyleTable:Er,McDbDatabase:Ir,McDbBlockTableRecord:Br,McDbBlockTable:Or,McDbRasterImageDef:Rr,McDbDictionary:Fr,McDbXrecord:Nr,McDbGroup:Vr,McDbEntity:Et,McDbCurve:It,McDbLine:Bt,McDbText:Ot,McDbAttribute:Rt,McDbAttributeDefinition:Ft,McDbMText:Nt,McDbCircle:Vt,McDbPolyline:Gt,McDbBlockReference:jt,McDbSpatialFilter:Ut,McDbDimension:zt,McDbAlignedDimension:Wt,McDbRotatedDimension:Ht,McDb2LineAngularDimension:$t,McDbArc:Xt,McDbEllipse:qt,McDbPoint:Kt,McDbHatch:Yt,McDbProxyEntity:Zt,McDbRasterImage:Jt,McDbWipeout:Qt,McDbBackgroundEntity:er,McDbSpline:tr,FetchAttributes:zr,McObject:Wr,McAppType:Hr,MxCppType:$r,MxCADPluginMapDefaultData:Xr,MxCADPluginSampleCode:qr,MxCADPluginBase:Kr,MxPropertiesWindowCustomValueType:Yr,MxPropertiesWindowCustomValue:Zr,MxPropertiesWindowCustom:Jr,MxCompare:Qr,MxModifyColor:en,MxCADTempForbiddenIntelliSelect:tn,MxCADCloneType:rr,MxCADWorldDrawType:nr,IMcDbDwgFiler:ir,MxCADWorldDraw:or,McDbCustomEntity:sr,MxCADBaseCustomElement:dn,MxCADBaseCustomText:qn,MxCADMText:Kn,McDbXlsxTable:Qn,MLineJustificationType:ri,McDbMLine:ni,get MxCpp(){return t.MxCpp},loadMxCADassembly:loadMxCADassembly,MxCheckTheBrowser:MxCheckTheBrowser,Mx_About:Mx_About,createMxCad:Ei,ColorMethod:Ii,ColorIndexType:Bi,getColorUtils:Oi,createMcCmColor:Ri,setMcCmColor:Fi,drawText:drawText,drawCircle:drawCircle,drawLine:drawLine,drawMText:drawMText,drawPolyLine:drawPolyLine,drawPolygon:drawPolygon,drawArc:drawArc,drawEllipticalArc:drawEllipticalArc,Mx_Erase:Mx_Erase,drawRectang:Ji,MxMap:Qi,MxMapAddRasterTileLayer:MxMapAddRasterTileLayer,MxMapAddGoogleCnLayer:MxMapAddGoogleCnLayer,mx_gps84_To_gcj02:mx_gps84_To_gcj02,mx_gcj02_To_gps84:mx_gcj02_To_gps84,MxTIFFLoader:Rf},Symbol.toStringTag,{value:"Module"}));globalThis.Buffer=p.Buffer,globalThis.Buffer.alloc=p.Buffer.alloc,globalThis.Buffer.from=p.Buffer.from,t.ColorIndexType=Bi,t.ColorMethod=Ii,t.DxfCode=_r,t.FetchAttributes=zr,t.IMcDbDwgFiler=ir,t.IsZero=IsZero,t.MLineJustificationType=ri,t.McAppType=Hr,t.McCmColor=Cr,t.McDb2LineAngularDimension=$t,t.McDbAlignedDimension=Wt,t.McDbArc=Xt,t.McDbAttribute=Rt,t.McDbAttributeDefinition=Ft,t.McDbBackgroundEntity=er,t.McDbBlockReference=jt,t.McDbBlockTable=Or,t.McDbBlockTableRecord=Br,t.McDbCircle=Vt,t.McDbCurve=It,t.McDbCustomEntity=sr,t.McDbDatabase=Ir,t.McDbDictionary=Fr,t.McDbDimStyleTable=Lr,t.McDbDimStyleTableRecord=Tr,t.McDbDimension=zt,t.McDbEllipse=qt,t.McDbEntity=Et,t.McDbGroup=Vr,t.McDbHatch=Yt,t.McDbLayerTable=kr,t.McDbLayerTableRecord=Dr,t.McDbLine=Bt,t.McDbLinetypeTable=Pr,t.McDbLinetypeTableRecord=Sr,t.McDbMLine=ni,t.McDbMText=Nt,t.McDbObject=gt,t.McDbObjectArray=vt,t.McDbPoint=Kt,t.McDbPolyline=Gt,t.McDbProxyEntity=Zt,t.McDbRasterImage=Jt,t.McDbRasterImageDef=Rr,t.McDbRotatedDimension=Ht,t.McDbSpatialFilter=Ut,t.McDbSpline=tr,t.McDbText=Ot,t.McDbTextStyleTable=Er,t.McDbTextStyleTableRecord=Ar,t.McDbWipeout=Qt,t.McDbXlsxTable=Qn,t.McDbXrecord=Nr,t.McGeBound=fn,t.McGeDoubleArray=hn,t.McGeLongArray=cn,t.McGeMatrix3d=sn,t.McGePoint3d=rn,t.McGePoint3dArray=ln,t.McGeStringArray=un,t.McGeVector3d=nn,t.McObject=Wr,t.McObjectId=mt,t.McObjectIdType=pt,t.McRxObject=dt,t.MxCADBaseCustomElement=dn,t.MxCADBaseCustomText=qn,t.MxCADCloneType=rr,t.MxCADMText=Kn,t.MxCADPluginBase=Kr,t.MxCADPluginMapDefaultData=Xr,t.MxCADPluginSampleCode=qr,t.MxCADResbuf=bt,t.MxCADSelectionSet=_t,t.MxCADSelectionSetStatus=wt,t.MxCADTempForbiddenIntelliSelect=tn,t.MxCADUiPrAngle=At,t.MxCADUiPrBase=Ct,t.MxCADUiPrDist=Tt,t.MxCADUiPrEntity=Lt,t.MxCADUiPrInt=Dt,t.MxCADUiPrKeyWord=kt,t.MxCADUiPrPoint=St,t.MxCADUiPrString=Pt,t.MxCADUtility=Mt,t.MxCADUtilityClass=xt,t.MxCADWorldDraw=or,t.MxCADWorldDrawType=nr,t.MxCanvas2Image=ue,t.MxCheckTheBrowser=MxCheckTheBrowser,t.MxCompare=Qr,t.MxCoordConvertType=yt,t.MxCppType=$r,t.MxMap=Qi,t.MxMapAddGoogleCnLayer=MxMapAddGoogleCnLayer,t.MxMapAddRasterTileLayer=MxMapAddRasterTileLayer,t.MxModifyColor=en,t.MxPropertiesWindowCustom=Jr,t.MxPropertiesWindowCustomValue=Zr,t.MxPropertiesWindowCustomValueType=Yr,t.MxTIFFLoader=Rf,t.MxTools=se,t.Mx_About=Mx_About,t.Mx_Erase=Mx_Erase,t._ML_String=_ML_String,t.b64Decode=b64Decode,t.b64Encode=b64Encode,t.crateHexString=crateHexString,t.createCursor=createCursor,t.createMcCmColor=Ri,t.createMxCad=Ei,t.default=Ff,t.downloadFile=downloadFile,t.downloadFileFromUrl=downloadFileFromUrl,t.drawArc=drawArc,t.drawCircle=drawCircle,t.drawEllipticalArc=drawEllipticalArc,t.drawLine=drawLine,t.drawMText=drawMText,t.drawPolyLine=drawPolyLine,t.drawPolygon=drawPolygon,t.drawRectang=Ji,t.drawText=drawText,t.getColorUtils=Oi,t.getFileFromUrl=oe,t.getFilterImp=getFilterImp,t.getJsonFromUrl=ae,t.loadMxCADassembly=loadMxCADassembly,t.mx_gcj02_To_gps84=mx_gcj02_To_gps84,t.mx_gps84_To_gcj02=mx_gps84_To_gcj02,t.postEmscriptenIndexedDBFile=postEmscriptenIndexedDBFile,t.postMemoryFile=postMemoryFile,t.saveAsFileDialog=saveAsFileDialog,t.setMcCmColor=Fi,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
